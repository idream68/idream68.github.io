{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/hexo-theme-ayer/source/404.html","path":"404.html","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/dist/main.css","path":"dist/main.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/dist/main.js","path":"dist/main.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/css/custom.styl","path":"css/custom.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/css/clipboard.styl","path":"css/clipboard.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/404.jpg","path":"images/404.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/alipay.jpg","path":"images/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/ayer-side.svg","path":"images/ayer-side.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/ayer.png","path":"images/ayer.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/ayer.svg","path":"images/ayer.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/beian.png","path":"images/beian.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover1.jpg","path":"images/cover1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover2.jpg","path":"images/cover2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover5.jpg","path":"images/cover5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover3.jpg","path":"images/cover3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/forkme.png","path":"images/forkme.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover4.jpg","path":"images/cover4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover7.jpg","path":"images/cover7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/mouse.cur","path":"images/mouse.cur","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/sponsor.jpg","path":"images/sponsor.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/wechat.jpg","path":"images/wechat.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/images/cover6.jpg","path":"images/cover6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/busuanzi-2.3.pure.min.js","path":"js/busuanzi-2.3.pure.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/clickLove.js","path":"js/clickLove.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/clickBoom1.js","path":"js/clickBoom1.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/tocbot.min.js","path":"js/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/clickBoom2.js","path":"js/clickBoom2.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-ayer/source/js/dz.js","path":"js/dz.js","modified":0,"renderable":1},{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/README.md","path":"README.md","modified":0,"renderable":0},{"_id":"source/images/ShiroArchitecture.png","path":"images/ShiroArchitecture.png","modified":0,"renderable":0},{"_id":"source/images/java-multy-thread.png","path":"images/java-multy-thread.png","modified":0,"renderable":0},{"_id":"source/images/swagger_error.png","path":"images/swagger_error.png","modified":0,"renderable":0},{"_id":"source/images/snowflake-algorithm.png","path":"images/snowflake-algorithm.png","modified":0,"renderable":0},{"_id":"source/images/python-opencv-get-coler-in-img.png","path":"images/python-opencv-get-coler-in-img.png","modified":0,"renderable":0},{"_id":"source/images/qlexpress.jpg","path":"images/qlexpress.jpg","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-1.png","path":"images/docker-swarm/docker-swarm-1.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-10.png","path":"images/docker-swarm/docker-swarm-10.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-11.png","path":"images/docker-swarm/docker-swarm-11.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-3.png","path":"images/docker-swarm/docker-swarm-3.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-4.png","path":"images/docker-swarm/docker-swarm-4.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-12.png","path":"images/docker-swarm/docker-swarm-12.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-5.png","path":"images/docker-swarm/docker-swarm-5.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-2.png","path":"images/docker-swarm/docker-swarm-2.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-7.png","path":"images/docker-swarm/docker-swarm-7.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-8.png","path":"images/docker-swarm/docker-swarm-8.png","modified":0,"renderable":0},{"_id":"source/images/java-linkedlist/java-linkedlist-1.jpg","path":"images/java-linkedlist/java-linkedlist-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-linkedlist/java-linkedlist-2.jpg","path":"images/java-linkedlist/java-linkedlist-2.jpg","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-9.png","path":"images/docker-swarm/docker-swarm-9.png","modified":0,"renderable":0},{"_id":"source/images/docker-swarm/docker-swarm-6.png","path":"images/docker-swarm/docker-swarm-6.png","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-2.jpg","path":"images/java-cas/java-cas-2.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-4.jpg","path":"images/java-cas/java-cas-4.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-3.jpg","path":"images/java-cas/java-cas-3.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-5.jpg","path":"images/java-cas/java-cas-5.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-7.jpg","path":"images/java-cas/java-cas-7.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-8.jpg","path":"images/java-cas/java-cas-8.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-1.jpg","path":"images/java-cas/java-cas-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-arraylist/java-arraylist-1.jpg","path":"images/java-arraylist/java-arraylist-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-9.jpg","path":"images/java-cas/java-cas-9.jpg","modified":0,"renderable":0},{"_id":"source/images/java-arraylist/java-arraylist-2.jpg","path":"images/java-arraylist/java-arraylist-2.jpg","modified":0,"renderable":0},{"_id":"source/images/java-arraylist/java-arraylist-3.jpg","path":"images/java-arraylist/java-arraylist-3.jpg","modified":0,"renderable":0},{"_id":"source/images/java-arraylist/java-arraylist-5.jpg","path":"images/java-arraylist/java-arraylist-5.jpg","modified":0,"renderable":0},{"_id":"source/images/java-arraylist/java-arraylist-4.jpg","path":"images/java-arraylist/java-arraylist-4.jpg","modified":0,"renderable":0},{"_id":"source/images/java-volatile/java-volatile-1.jpg","path":"images/java-volatile/java-volatile-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-volatile/java-volatile-2.jpg","path":"images/java-volatile/java-volatile-2.jpg","modified":0,"renderable":0},{"_id":"source/images/kafka-base/logs-from-tpa-cross-record-statistics-in-tpa-cross-record-statistics-7b6c775b98-6s469.txt","path":"images/kafka-base/logs-from-tpa-cross-record-statistics-in-tpa-cross-record-statistics-7b6c775b98-6s469.txt","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-1.png","path":"images/java-lock/java-lock-1.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-10.png","path":"images/java-lock/java-lock-10.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-11.png","path":"images/java-lock/java-lock-11.png","modified":0,"renderable":0},{"_id":"source/images/java-cas/java-cas-6.jpg","path":"images/java-cas/java-cas-6.jpg","modified":0,"renderable":0},{"_id":"source/images/kafka-base/streams-and-tables-p1_p4.png","path":"images/kafka-base/streams-and-tables-p1_p4.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-12.png","path":"images/java-lock/java-lock-12.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-15.png","path":"images/java-lock/java-lock-15.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-14.png","path":"images/java-lock/java-lock-14.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-13.png","path":"images/java-lock/java-lock-13.png","modified":0,"renderable":0},{"_id":"source/images/kafka-base/logs-from-nsdml-server-in-nsdml-server-bff4cd685-nlzd2.txt","path":"images/kafka-base/logs-from-nsdml-server-in-nsdml-server-bff4cd685-nlzd2.txt","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-16.png","path":"images/java-lock/java-lock-16.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-18.png","path":"images/java-lock/java-lock-18.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-19.png","path":"images/java-lock/java-lock-19.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-17.png","path":"images/java-lock/java-lock-17.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-2.png","path":"images/java-lock/java-lock-2.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-22.png","path":"images/java-lock/java-lock-22.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-21.png","path":"images/java-lock/java-lock-21.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-20.png","path":"images/java-lock/java-lock-20.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-23.png","path":"images/java-lock/java-lock-23.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-3.png","path":"images/java-lock/java-lock-3.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-5.png","path":"images/java-lock/java-lock-5.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-6.png","path":"images/java-lock/java-lock-6.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-4.png","path":"images/java-lock/java-lock-4.png","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-8.png","path":"images/java-lock/java-lock-8.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-10.jpg","path":"images/mysql-index/mysql-index-10.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-1.jpg","path":"images/mysql-index/mysql-index-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-9.png","path":"images/java-lock/java-lock-9.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-11.jpg","path":"images/mysql-index/mysql-index-11.jpg","modified":0,"renderable":0},{"_id":"source/images/java-lock/java-lock-7.png","path":"images/java-lock/java-lock-7.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-12.jpg","path":"images/mysql-index/mysql-index-12.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-15.jpg","path":"images/mysql-index/mysql-index-15.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-13.png","path":"images/mysql-index/mysql-index-13.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-14.png","path":"images/mysql-index/mysql-index-14.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-16.jpg","path":"images/mysql-index/mysql-index-16.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-2.jpg","path":"images/mysql-index/mysql-index-2.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-17.png","path":"images/mysql-index/mysql-index-17.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-3.jpg","path":"images/mysql-index/mysql-index-3.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-4.png","path":"images/mysql-index/mysql-index-4.png","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-8.jpg","path":"images/mysql-index/mysql-index-8.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-9.jpg","path":"images/mysql-index/mysql-index-9.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-7.jpg","path":"images/mysql-index/mysql-index-7.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-1.webp","path":"images/mysql-lock/mysql-lock-1.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-5.jpg","path":"images/mysql-index/mysql-index-5.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-index/mysql-index-6.png","path":"images/mysql-index/mysql-index-6.png","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-5.webp","path":"images/mysql-lock/mysql-lock-5.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-2.webp","path":"images/mysql-lock/mysql-lock-2.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-4.jpg","path":"images/mysql-lock/mysql-lock-4.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-3.webp","path":"images/mysql-lock/mysql-lock-3.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-6.webp","path":"images/mysql-lock/mysql-lock-6.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-7.webp","path":"images/mysql-lock/mysql-lock-7.webp","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock-8.jpg","path":"images/mysql-lock/mysql-lock-8.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-lock/mysql-lock.png","path":"images/mysql-lock/mysql-lock.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/bindings.png","path":"images/rabbitmq-base/bindings.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/exchanges.png","path":"images/rabbitmq-base/exchanges.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/prefetch-count.png","path":"images/rabbitmq-base/prefetch-count.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/producer.png","path":"images/rabbitmq-base/producer.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/python-five.png","path":"images/rabbitmq-base/python-five.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/direct-exchange.png","path":"images/rabbitmq-base/direct-exchange.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/direct-exchange-multiple.png","path":"images/rabbitmq-base/direct-exchange-multiple.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/python-three-overall.png","path":"images/rabbitmq-base/python-three-overall.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/consumer.png","path":"images/rabbitmq-base/consumer.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/python-two.png","path":"images/rabbitmq-base/python-two.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/python-four.png","path":"images/rabbitmq-base/python-four.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/receiving.png","path":"images/rabbitmq-base/receiving.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-1.png","path":"images/mysql-transaction/mysql-transaction-1.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/sending.png","path":"images/rabbitmq-base/sending.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-10.png","path":"images/mysql-transaction/mysql-transaction-10.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-11.png","path":"images/mysql-transaction/mysql-transaction-11.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/python-one.png","path":"images/rabbitmq-base/python-one.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-12.png","path":"images/mysql-transaction/mysql-transaction-12.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-3.png","path":"images/mysql-transaction/mysql-transaction-3.png","modified":0,"renderable":0},{"_id":"source/images/rabbitmq-base/queue.png","path":"images/rabbitmq-base/queue.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-2.png","path":"images/mysql-transaction/mysql-transaction-2.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-13.png","path":"images/mysql-transaction/mysql-transaction-13.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-7.png","path":"images/mysql-transaction/mysql-transaction-7.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-4.png","path":"images/mysql-transaction/mysql-transaction-4.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-8.png","path":"images/mysql-transaction/mysql-transaction-8.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-9.png","path":"images/mysql-transaction/mysql-transaction-9.png","modified":0,"renderable":0},{"_id":"source/images/shiro/ShiroArchitecture.png","path":"images/shiro/ShiroArchitecture.png","modified":0,"renderable":0},{"_id":"source/images/java-hashmap/java-hash-map-1.jpg","path":"images/java-hashmap/java-hash-map-1.jpg","modified":0,"renderable":0},{"_id":"source/images/java-hashmap/java-hash-map-2.jpg","path":"images/java-hashmap/java-hash-map-2.jpg","modified":0,"renderable":0},{"_id":"source/images/java-hashmap/java-hash-map-3.jpg","path":"images/java-hashmap/java-hash-map-3.jpg","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-6.png","path":"images/mysql-transaction/mysql-transaction-6.png","modified":0,"renderable":0},{"_id":"source/images/mysql-transaction/mysql-transaction-5.png","path":"images/mysql-transaction/mysql-transaction-5.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/hexo-theme-ayer/.gitattributes","hash":"2e08e93c6f6790b02ab7f81a6191ed097b20cbf9","modified":1652171156560},{"_id":"themes/hexo-theme-ayer/.gitignore","hash":"8faed9be54528620a8da662ad9f242e7305d6757","modified":1652171156560},{"_id":"themes/hexo-theme-ayer/.npmignore","hash":"13239db7290ce1d6dfc62fb60191a8048c6e5781","modified":1652171156562},{"_id":"themes/hexo-theme-ayer/.travis.yml","hash":"870fcd9eb33bc4269d53bc84ddc6f8a69db7c611","modified":1652171156563},{"_id":"themes/hexo-theme-ayer/.postcssrc","hash":"c171a60205840e3dcd3825d5bbb6b2d19d48ee76","modified":1652171156562},{"_id":"themes/hexo-theme-ayer/README.md","hash":"9f783806ee31f664251c03190883545188dadc9a","modified":1652171156563},{"_id":"themes/hexo-theme-ayer/index.js","hash":"a144d64baec7130267f64272fb256a9be3aa7cd5","modified":1652171156564},{"_id":"themes/hexo-theme-ayer/package.json","hash":"64d0a313ac730177cc62f7228887c220f0764c7e","modified":1652171156591},{"_id":"themes/hexo-theme-ayer/move_config.js","hash":"9fde64d58714990bf93ba877bbc3b48f6b8fb7d9","modified":1652171156590},{"_id":"themes/hexo-theme-ayer/languages/de.yml","hash":"7b516d228f6175a079e260f1d5eb105644bacd15","modified":1652171156565},{"_id":"themes/hexo-theme-ayer/.stylintrc","hash":"eec4e824067be1a223745ca426aa367c8d482673","modified":1652171156563},{"_id":"themes/hexo-theme-ayer/logo.png","hash":"16fbb131601570b21890a922cd6e596691ccff42","modified":1652171156590},{"_id":"themes/hexo-theme-ayer/_config.yml","hash":"268710d40946da9d74ba91db7cb5f7928a3a2d02","modified":1652271347239},{"_id":"themes/hexo-theme-ayer/languages/default.yml","hash":"44e16cb5f43b5e17521a052d36fb7f66faf80c95","modified":1652171156565},{"_id":"themes/hexo-theme-ayer/languages/es.yml","hash":"7d44c39c9ab9c6f0b2e592e9f02a0b6b1b35daa8","modified":1652171156566},{"_id":"themes/hexo-theme-ayer/languages/en.yml","hash":"44e16cb5f43b5e17521a052d36fb7f66faf80c95","modified":1652171156566},{"_id":"themes/hexo-theme-ayer/languages/nl.yml","hash":"86518a4aa58bdbd57361eb2340b2d5e9a684a035","modified":1652171156568},{"_id":"themes/hexo-theme-ayer/languages/ko.yml","hash":"6d645ed779b8427e5bb5c87c5989f3013c613baf","modified":1652171156567},{"_id":"themes/hexo-theme-ayer/languages/fr.yml","hash":"deb03585d492faac20c360b3d96a1a7331dc0f78","modified":1652171156566},{"_id":"themes/hexo-theme-ayer/languages/zh-CN.yml","hash":"14d1fa64b52a252e2ed54a682c5d47b128780dcd","modified":1652171156569},{"_id":"themes/hexo-theme-ayer/languages/zh-TW.yml","hash":"68ddd866f1e74515cfe92faa5a37a067d9308142","modified":1652171156570},{"_id":"themes/hexo-theme-ayer/languages/ru.yml","hash":"22f2e2310d7025b03950f450865a6c3ae66fe677","modified":1652171156569},{"_id":"themes/hexo-theme-ayer/languages/no.yml","hash":"2faf5999099765bd662d0979e35e0d43d06bd63c","modified":1652171156568},{"_id":"themes/hexo-theme-ayer/layout/index.ejs","hash":"c40a98c0a6f55c27959e44c9e8e4f2619fc2ad3f","modified":1652171156588},{"_id":"themes/hexo-theme-ayer/languages/ja.yml","hash":"e6849a6c716b588bb17e19f72a61965c74570421","modified":1652171156567},{"_id":"themes/hexo-theme-ayer/languages/vi.yml","hash":"768ed9dc0161990dcdfdc4054ec281dda4d7a33e","modified":1652171156569},{"_id":"themes/hexo-theme-ayer/layout/page.ejs","hash":"75879224e47b3329d7accfc2403580a2412dce25","modified":1652171156589},{"_id":"themes/hexo-theme-ayer/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1652171156586},{"_id":"themes/hexo-theme-ayer/layout/plain-page.ejs","hash":"d351ff4aadd020a1960cc00f17fdd91a17e0cc54","modified":1652171156589},{"_id":"themes/hexo-theme-ayer/scripts/default_config.js","hash":"617c2614d8bd8ffda2f2f84ab54fb18866e39b33","modified":1652171156594},{"_id":"themes/hexo-theme-ayer/layout/post.ejs","hash":"75879224e47b3329d7accfc2403580a2412dce25","modified":1652171156589},{"_id":"themes/hexo-theme-ayer/layout/tags.ejs","hash":"e7c9f93c6f7041a7d2aa95e85cc131b22aa426b7","modified":1652171156590},{"_id":"themes/hexo-theme-ayer/languages/pt.yml","hash":"8ec0eacefc2ca124bafc86fe4fb23bd2b9cad8ab","modified":1652171156568},{"_id":"themes/hexo-theme-ayer/layout/layout.ejs","hash":"ff1211ce5ce406c177c4a6e158e0f72ab5ebdbb6","modified":1652171156588},{"_id":"themes/hexo-theme-ayer/layout/categories.ejs","hash":"b2deae0c31dd7fbf42a124db1b4c8c28d435c8e5","modified":1652171156587},{"_id":"themes/hexo-theme-ayer/layout/friends.ejs","hash":"2a4c0bfdf189ebae720f1325786a87c7cac51d37","modified":1652171156587},{"_id":"themes/hexo-theme-ayer/source-src/main.js","hash":"e42992bf24b2864e33ea5fdfab122b5d41851066","modified":1652171156613},{"_id":"themes/hexo-theme-ayer/layout/_partial/ads.ejs","hash":"2be035aeef82265c5b0cb6aec6f4135ad1e0aa75","modified":1652171156571},{"_id":"themes/hexo-theme-ayer/source/404.html","hash":"727bb80b870df99b9d816f36613fc6eae4c61c98","modified":1652171156613},{"_id":"themes/hexo-theme-ayer/layout/_partial/archive.ejs","hash":"1da014dd52294e132bc91eb2f45f67264a41e059","modified":1652171156572},{"_id":"themes/hexo-theme-ayer/source/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1652171156617},{"_id":"themes/hexo-theme-ayer/layout/_partial/after-footer.ejs","hash":"10c5e663f58245f63bad8d8f017dba237c667624","modified":1652171156571},{"_id":"themes/hexo-theme-ayer/layout/_partial/article.ejs","hash":"ff1f8fd0dce22409038e72097a9582d1bbf4e6e0","modified":1652171156572},{"_id":"themes/hexo-theme-ayer/layout/_partial/katex.ejs","hash":"02cb9da065cd315a06d62d13872dc687c62e9a1f","modified":1652171156575},{"_id":"themes/hexo-theme-ayer/layout/_partial/broadcast.ejs","hash":"21fadeb390cff713fd432d0565bb901f8caff0c0","modified":1652171156574},{"_id":"themes/hexo-theme-ayer/layout/_partial/ayer.ejs","hash":"061e5d25789c9a0c3df3172c0c53966053af89d1","modified":1652171156573},{"_id":"themes/hexo-theme-ayer/layout/_partial/archive-post.ejs","hash":"6b3e77cdbf8271c2a22b839608cccaa651f84e93","modified":1652171156572},{"_id":"themes/hexo-theme-ayer/layout/_partial/mathjax.ejs","hash":"bcc264b6d6b58b3b692139c4d8b1381da4820da8","modified":1652171156575},{"_id":"themes/hexo-theme-ayer/layout/_partial/google-analytics.ejs","hash":"3a23d6ae48305c9f1b5c400da780288c2425254b","modified":1652171156574},{"_id":"themes/hexo-theme-ayer/layout/_partial/modal.ejs","hash":"b9caece8b5fb47e250c67f6f80f101f08d04eba9","modified":1652171156576},{"_id":"themes/hexo-theme-ayer/layout/_partial/music.ejs","hash":"4a67b36cadf2661a5579a454b7d6e0be34e7a0d4","modified":1652171156577},{"_id":"themes/hexo-theme-ayer/layout/_partial/totop.ejs","hash":"b2fc5726168f012bc61845f33a46404ff4065947","modified":1652171156585},{"_id":"themes/hexo-theme-ayer/scripts/filters/index.js","hash":"e0c3b821ecd1cb614569282fb4f6e6f555545f8b","modified":1652171156595},{"_id":"themes/hexo-theme-ayer/scripts/helpers/ayer-plus-vendors.js","hash":"611f3bcd8220312f92c11fa6a5dad02f011068d2","modified":1652171156595},{"_id":"themes/hexo-theme-ayer/layout/_partial/footer.ejs","hash":"16c6877db510a28afff0334be8d2ffe2f76d7a3e","modified":1652171156574},{"_id":"themes/hexo-theme-ayer/scripts/filters/meta_generator.js","hash":"46f6461a2bdc509837c36ede4d32c8b12e3d49b9","modified":1652171156595},{"_id":"themes/hexo-theme-ayer/scripts/lib/core.js","hash":"00509e97554914e5b0a20e0843dc90bcf53461aa","modified":1652171156596},{"_id":"themes/hexo-theme-ayer/scripts/helpers/wordcount.js","hash":"2014b5c5053ad737887b61014a045cc1b08799cd","modified":1652171156596},{"_id":"themes/hexo-theme-ayer/layout/_partial/baidu-analytics.ejs","hash":"155327c23607f69989b58845f24d842a54e504b8","modified":1652171156573},{"_id":"themes/hexo-theme-ayer/layout/_partial/head.ejs","hash":"8081db5b9801f32773632c10fa169c34e1a82ba2","modified":1652171156575},{"_id":"themes/hexo-theme-ayer/layout/_partial/viewer.ejs","hash":"219f0a0ec2eb35e8ba27a849639a5f634273fb6f","modified":1652171156586},{"_id":"themes/hexo-theme-ayer/source/dist/main.js","hash":"d772b4177dae023ba55dd11d556a536d1ccfcce1","modified":1652171156617},{"_id":"themes/hexo-theme-ayer/source/dist/main.css","hash":"6f43d2b89beb684f020f80dd1a0952f4f6ee3659","modified":1652171156617},{"_id":"themes/hexo-theme-ayer/source/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1652171156617},{"_id":"themes/hexo-theme-ayer/source/css/custom.styl","hash":"32990e811ea6fba84673b6d7175c88a3b890b109","modified":1652171156617},{"_id":"themes/hexo-theme-ayer/source/css/clipboard.styl","hash":"145f335d6369744a75c2c39a50f63a88f720f85b","modified":1652171156616},{"_id":"themes/hexo-theme-ayer/source/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1652171156622},{"_id":"themes/hexo-theme-ayer/layout/_partial/sidebar.ejs","hash":"b7efb7f2b300de23d12ef310d710d809d979f4fd","modified":1652171156585},{"_id":"themes/hexo-theme-ayer/source/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1652171156623},{"_id":"themes/hexo-theme-ayer/source/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1652171156623},{"_id":"themes/hexo-theme-ayer/source/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1652171156622},{"_id":"themes/hexo-theme-ayer/source/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1652171156644},{"_id":"themes/hexo-theme-ayer/source/images/cover7.jpg","hash":"573bff6899d2d9c5bcba0dc9c60cd1ec9eb8b029","modified":1652171156644},{"_id":"themes/hexo-theme-ayer/source/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1652171156644},{"_id":"themes/hexo-theme-ayer/source/images/mouse.cur","hash":"c1ffe93a6ba0d25ef06bb3d097560762e4807593","modified":1652171156644},{"_id":"themes/hexo-theme-ayer/source-src/css/_darkmode.styl","hash":"eda0bf55d64f2cdeb75f9489818c34635bc85c00","modified":1652171156597},{"_id":"themes/hexo-theme-ayer/source-src/css/_remixicon.styl","hash":"78f4dd8c613df005d6ecf6a073d96d38bbbe531e","modified":1652171156610},{"_id":"themes/hexo-theme-ayer/source-src/css/_normalize.styl","hash":"b90386215434cc76549c046e7f67392049492a6a","modified":1652171156598},{"_id":"themes/hexo-theme-ayer/source-src/css/style.styl","hash":"89dfb772754ee919cb157a6e28d61bbabfe46c8d","modified":1652171156612},{"_id":"themes/hexo-theme-ayer/source/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1652171156648},{"_id":"themes/hexo-theme-ayer/source-src/css/_extend.styl","hash":"996ed7faa5ebf69af1f14f90f774dc7a53774537","modified":1652171156598},{"_id":"themes/hexo-theme-ayer/source-src/css/_variables.styl","hash":"2fdb4425b6213fed28921f53179e825aee0500cf","modified":1652171156611},{"_id":"themes/hexo-theme-ayer/source/js/clickLove.js","hash":"a35dfb7ff19796c005ee30b55fd95e39d6d59a89","modified":1652171156650},{"_id":"themes/hexo-theme-ayer/source-src/css/_mixins.styl","hash":"e4804d78ded3714495f8ac9cebdbd2871ed97549","modified":1652171156598},{"_id":"themes/hexo-theme-ayer/source/js/lazyload.min.js","hash":"d9bc50752cd7e331dbd0a833386838397c9a079f","modified":1652171156651},{"_id":"themes/hexo-theme-ayer/source/js/search.js","hash":"6d5c093d12e922ad204dab1723b786c35847bf1b","modified":1652171156653},{"_id":"themes/hexo-theme-ayer/source/js/clickBoom1.js","hash":"daac19b1cf7381f1a36deb6ac5a4892e14774887","modified":1652171156648},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/albums.ejs","hash":"f4cfbabca9f59a9e5aa457a6f2a9cf6f56cd22b3","modified":1652171156577},{"_id":"themes/hexo-theme-ayer/source-src/js/ayer.js","hash":"507e9689b119898dea446c7d583245ff41412b89","modified":1652171156612},{"_id":"themes/hexo-theme-ayer/source/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1652171156650},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/author.ejs","hash":"0e6c2862d75e5b21faf28a5cc3310d3515340287","modified":1652171156577},{"_id":"themes/hexo-theme-ayer/source-src/js/share.js","hash":"7c105c427d472d84bee2ef3f0a61efa4ac6d564f","modified":1652171156613},{"_id":"themes/hexo-theme-ayer/source/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1652171156653},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/category.ejs","hash":"89cb32e8d98bad81d3ef33377212e9b253699d3d","modified":1652171156578},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/busuanzi.ejs","hash":"895293405b2b3b19fe97d79f4a25e16bea153ae8","modified":1652171156578},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/date.ejs","hash":"947f513f7a85fbcf085624e46dc2ae6de8185eec","modified":1652171156579},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/clipboard.ejs","hash":"c93d82de1635536a633b6254b604590ab4428594","modified":1652171156578},{"_id":"themes/hexo-theme-ayer/source/js/clickBoom2.js","hash":"fd61d8aeb2cfeaa0e548ac83a1ee1631979cbdb9","modified":1652171156649},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/gallery.ejs","hash":"6f78a49edc91f230b0a838c77630e9671d8d6089","modified":1652171156579},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/search.ejs","hash":"47c818c236b063d6ce0c41e0824f9f10a3521414","modified":1652171156581},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/title.ejs","hash":"e55c57b8cb8c8acf0ed998ea31c2fbc1d6256027","modified":1652171156582},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/justifiedGallery.ejs","hash":"a313df6a014a0f2ba6b869dabc56bacb8ff6324d","modified":1652171156580},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/gitalk.ejs","hash":"c81d54a9d818fa21ebcab03cfecc3528821ff9a5","modified":1652171156580},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/minivaline.ejs","hash":"c09ba80cfa41aaac17f0f7ff2586e73241adab20","modified":1652171156581},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/tocbot.ejs","hash":"17ac504f2a6d561765046a0ba19dcce504104517","modified":1652171156583},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/nav.ejs","hash":"a73010cbbc463089a1376889850fb0890143c988","modified":1652171156581},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/tag.ejs","hash":"694b5101bcc44c9f9c1cc62e5ad2fdfb4b7c7a07","modified":1652171156582},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/topping.ejs","hash":"de2c50fb5b7a816287c6d048a2a22ae9c29abcdd","modified":1652171156583},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/share.ejs","hash":"9a978d55358878c97186ed010e536e1b314adb35","modified":1652171156582},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/twikoo.ejs","hash":"7f064611a2297dda84e6b329252e838666ac7c93","modified":1652171156584},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/albums.styl","hash":"5802253789028a4d9dac474168fc7132045e72ff","modified":1652171156599},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/ads.styl","hash":"e3e533ac5b9b6c5ef7d3829c890aff42dc29cfc1","modified":1652171156599},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/articles.styl","hash":"ddbe833939180afdc832659c5cdad08f77ef4f46","modified":1652171156601},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/word.ejs","hash":"5b785368a0a6f3b5538aa1b9e7574daa8dfb0df6","modified":1652171156585},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/apple.styl","hash":"333f9e59dc6625c4dee126a1c1a9c25ce9292655","modified":1652171156600},{"_id":"themes/hexo-theme-ayer/layout/_partial/post/valine.ejs","hash":"b71f2af08c1916b3c5ef3a553a1df16f1787af24","modified":1652171156584},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/archive.styl","hash":"9dbb04cf0ae07b50acd6f343e673df215a3c868e","modified":1652171156600},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/ayer.styl","hash":"cfcae3839170f2d04ea504a3cd3d62a9cde6647d","modified":1652171156601},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/float.styl","hash":"b1abfdfd05e74745484f7e6d043ef2842b3f6b41","modified":1652171156603},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/gitalk.styl","hash":"0678e8b330daea56fa30d14e97de73289a7d6f22","modified":1652171156604},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/article.styl","hash":"71f997526aa67d312c26a84393f43a4157447eaf","modified":1652171156601},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/friends.styl","hash":"10332c63736e4ce31353b7605012caf744a8286a","modified":1652171156603},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/categories.styl","hash":"cb3b1667c83182d6309e6d066f53f2771723729e","modified":1652171156601},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/mobile.styl","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1652171156606},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/lists.styl","hash":"dc45f8b1a5942d4d979fb0859bc47a86f73fe0a9","modified":1652171156605},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/footer.styl","hash":"ae22e9d1525f267be368359ed0096f26791b809e","modified":1652171156603},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/navbar.styl","hash":"30d7e1de22185c4b4da33eef66b5eb96f9e5ae98","modified":1652171156607},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/layout.styl","hash":"d4613f176636cae6a4af6124863a176c32ea6471","modified":1652171156605},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/highlight.styl","hash":"1210f704aae34ef653e3a458cccb700b05353ea1","modified":1652171156604},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/pace.styl","hash":"bbda18c692fc66ae99e45347ff52c14e44a08e3b","modified":1652171156607},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/justifiedGallery.styl","hash":"9828c78fb59c3ea3de7cce2569313d12c4b1a6ff","modified":1652171156605},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/sidebar.styl","hash":"cdc7bea47a768b18991decde0d38c554399621ee","modified":1652171156609},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/gallery.styl","hash":"f5eae1b0030cfd97f1646844c9d3f692dbb38946","modified":1652171156604},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/search.styl","hash":"3f2c7bd1371f6f25aec7c581dbae7b52f95ec4c6","modified":1652171156608},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/share.styl","hash":"4a6e6ac9156553dd5cee1eeee8fdc6f1f8a5d117","modified":1652171156608},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/totop.styl","hash":"b6010788be1d99a345abcf0cf9cdf0a564b90d3c","modified":1652171156610},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/reward.styl","hash":"924114f723a22dbb8970d023bc2e033141b3438d","modified":1652171156607},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/tag.styl","hash":"6072aa6bd16e0a1e75f0258d7b20587cab56fff8","modified":1652171156609},{"_id":"themes/hexo-theme-ayer/source-src/css/_partial/tocbot.styl","hash":"2135ab02e098ddfaaa60009d8413186a564af840","modified":1652171156610},{"_id":"themes/hexo-theme-ayer/source/images/alipay.jpg","hash":"8f5409e29764fca573f1d274003910aa3c919de1","modified":1652171156621},{"_id":"themes/hexo-theme-ayer/source/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1652171156624},{"_id":"themes/hexo-theme-ayer/source/images/wechat.jpg","hash":"93a362574a8498e75dca469b7bceb0b321fda387","modified":1652171156644},{"_id":"themes/hexo-theme-ayer/source/js/jquery-2.0.3.min.js","hash":"e68550a39c95a6400287b3abd77f40c44f322e50","modified":1652171156650},{"_id":"themes/hexo-theme-ayer/source/images/cover6.jpg","hash":"a5b8a5dddff2607fee5fccf5fdef3b214a8468cc","modified":1652171156644},{"_id":"source/CNAME","hash":"fb92dc87219b3532a37f66b586d6d5e1188c335b","modified":1653400168621},{"_id":"source/README.md","hash":"bbd636f1459e5df582b36a6f9b64d66b66d37476","modified":1652171156379},{"_id":"source/categories/index.md","hash":"aaef6e8dac9d96a13cb2a8fcf21fea29f746b83c","modified":1652171156409},{"_id":"source/friends/index.md","hash":"34d93b97e778bc341747450c0d88302c183c5207","modified":1652171156410},{"_id":"source/archives/index.md","hash":"fcfd1a7877ae8763c1357a7da42214bbd3ff08ae","modified":1652171156409},{"_id":"source/tags/index.md","hash":"ff94e90aee475c6be63d3d47b3f5a300402287aa","modified":1652171156560},{"_id":"source/images/java-multy-thread.png","hash":"440e10f9ff4669b459d528af2a9d14038dd66e4a","modified":1652171156511},{"_id":"source/images/swagger_error.png","hash":"d69198ed4552620ac29e494a778a92a72ade7985","modified":1652171156560},{"_id":"source/images/snowflake-algorithm.png","hash":"95e301b6d580df23bc5db65f3d4711d3ddd7939a","modified":1652171156557},{"_id":"source/_posts/database/mysql-mongo-data-transfer.md","hash":"0d80f037b87887436c79ecbee008b47145b1b718","modified":1652171156380},{"_id":"source/_posts/docker/docker-base.md","hash":"d0c012d0d8810ed35849df34930e898aa9d81ae1","modified":1652171156384},{"_id":"source/_posts/docker/docker-swarm.md","hash":"cf83bacb60add070294c35f0cca128c59b221554","modified":1652171156385},{"_id":"source/_posts/docker/docker-install.md","hash":"51d0edc5de97f7d7a35662a16962c06cb70438df","modified":1652171156384},{"_id":"source/_posts/hexo/hexo-quick-start.md","hash":"a12ed25d8a6b454f6efcd00d297f09e1b20552a9","modified":1652171156388},{"_id":"source/_posts/git/git-delete-history-log.md","hash":"b000404e534a218b8d5a18280fe7810a75365f6f","modified":1652171156387},{"_id":"source/_posts/docker/dockerFile.md","hash":"5ccac225d4f58441b15ecac99820d64619cb214c","modified":1652171156385},{"_id":"source/_posts/git/git-ssh-generate.md","hash":"229066ba1b3bbd69347fa95f3dec887db8e17802","modified":1652171156388},{"_id":"source/_posts/hexo/hexo-support-flow-chart.md","hash":"5a8e163ca35508cf1a207f781860705520a8e75f","modified":1652171156389},{"_id":"source/_posts/git/git-remote.md","hash":"950adc6c1bcc0d74b8f3bce807695d003dafc2f5","modified":1652171156388},{"_id":"source/_posts/java/QLExpress.md","hash":"4a5b8d66a7f5170bc14ecbee74a6961aaf2fe97e","modified":1652171156389},{"_id":"source/_posts/python/python-opencv-get-coler-in-img.md","hash":"f990aba08a0f780fcb5c9aad496a8c2fda1886b5","modified":1652171156399},{"_id":"source/_posts/markdown/markdown-base-grammar.md","hash":"0b24872b5d01341f61982c93a73984eaee25a1dc","modified":1652171156394},{"_id":"source/_posts/python/use-selenium-on-linux.md","hash":"32abdc8b94ff243f6c56c617ccc0a0ea28f56245","modified":1652171156400},{"_id":"source/_posts/elasticsearch/elasticsearchbase.md","hash":"7627f1bf309bb3b98b71b024fe0503784f6e832f","modified":1652270830224},{"_id":"source/images/docker-swarm/docker-swarm-1.png","hash":"b652f6dfdbb3b12258d45e4369043b870e4ed1c9","modified":1652171156411},{"_id":"source/_posts/hexo/uml.md","hash":"a3620744983fcc355968f3a6e19f4ddbc35fc922","modified":1652184480798},{"_id":"source/images/docker-swarm/docker-swarm-12.png","hash":"437189871a73ccaaac3db5bcc5f2085f7a05a860","modified":1652171156415},{"_id":"source/images/docker-swarm/docker-swarm-8.png","hash":"50151e92d507c91c77888e1a6d53802d8a3c283a","modified":1652171156424},{"_id":"source/images/docker-swarm/docker-swarm-9.png","hash":"105be41a2ff0642fe2a2ac8a4c45276dda1122fc","modified":1652171156424},{"_id":"source/images/java-cas/java-cas-2.jpg","hash":"b28c3259a15a77b3ac7f946309debcf3dbdb6c41","modified":1652171156431},{"_id":"source/images/docker-swarm/docker-swarm-7.png","hash":"10b67a4eedcb04278a480d238eeea62a6b759ff6","modified":1652171156423},{"_id":"source/images/java-cas/java-cas-5.jpg","hash":"64635a1b94b006248d5dae5d0069f9b107799138","modified":1652171156431},{"_id":"source/images/java-cas/java-cas-7.jpg","hash":"72e401e1bb50b72d8acb3867cf5ed95a71c0e4a9","modified":1652171156436},{"_id":"source/images/java-cas/java-cas-4.jpg","hash":"f3e6667dfb2f90e1c44e833a06dd8a2896eeb83d","modified":1652171156431},{"_id":"source/images/java-cas/java-cas-3.jpg","hash":"b3ad9922711d91e5d8fb6798a938d2d9689b2521","modified":1652171156431},{"_id":"source/images/java-cas/java-cas-9.jpg","hash":"029ebe3aca1c108c4af670dd1914fd1d9a988d74","modified":1652171156438},{"_id":"source/images/java-arraylist/java-arraylist-1.jpg","hash":"b64592546b7a3c8eeaf93276e64076a437a6c29f","modified":1652171156425},{"_id":"source/images/java-cas/java-cas-1.jpg","hash":"b1b578537ba5397304a73f22a117b7e3bb08c099","modified":1652171156425},{"_id":"source/images/java-cas/java-cas-8.jpg","hash":"5e16469ead8ca69785a1186241a5d08a8c20c0e8","modified":1652171156437},{"_id":"source/images/java-arraylist/java-arraylist-3.jpg","hash":"6d874676a0ee82340b5bb747c5deb3d683231281","modified":1652171156425},{"_id":"source/images/java-arraylist/java-arraylist-2.jpg","hash":"84158c67907d1b6a53ad49f08976680255915688","modified":1652171156425},{"_id":"source/images/java-volatile/java-volatile-1.jpg","hash":"da8ff67b12daf7bc3384b335f9baa0924bb7de74","modified":1652171156513},{"_id":"source/images/java-volatile/java-volatile-2.jpg","hash":"5277287b8eadf96a0ad1c03196d13f0d63d15ae2","modified":1652171156514},{"_id":"source/images/java-cas/java-cas-6.jpg","hash":"2b26517188df3a914d4ebf83dbed98075a66418c","modified":1652171156431},{"_id":"source/images/java-lock/java-lock-20.png","hash":"5c9250cc10ba8127846d51b875803afb76f460d0","modified":1652171156485},{"_id":"source/images/mysql-index/mysql-index-10.jpg","hash":"490b06bc70bcd2ec38e700e72a5a5e2a5f15e150","modified":1652171156514},{"_id":"source/images/mysql-index/mysql-index-1.jpg","hash":"44bb633f19ed353a9dee6bcd65216365bd118891","modified":1652171156514},{"_id":"source/images/java-lock/java-lock-9.png","hash":"8922577d55e39f9326b8eb2facb98886aeed0a02","modified":1652171156511},{"_id":"source/images/mysql-index/mysql-index-11.jpg","hash":"de1e41b3caf6d8687eb998f9dd468f73f9c87a6c","modified":1652171156516},{"_id":"source/images/mysql-index/mysql-index-12.jpg","hash":"2fa9ee47a816ac59c1bde63b5ac339121e84b764","modified":1652171156516},{"_id":"source/images/mysql-index/mysql-index-14.png","hash":"0b9134b4b2a87563d3dcf97f99bc5ca0f31113aa","modified":1652171156516},{"_id":"source/images/mysql-index/mysql-index-16.jpg","hash":"957a01b544a872baebb49659fc32a3ab850e5b0b","modified":1652171156520},{"_id":"source/images/mysql-index/mysql-index-13.png","hash":"e8d9279e7d174445c41fe3d16a1990778c96f9e2","modified":1652171156516},{"_id":"source/images/mysql-index/mysql-index-2.jpg","hash":"cb6782a8736443d63c3b8768495b80d59459ef88","modified":1652171156521},{"_id":"source/images/mysql-index/mysql-index-17.png","hash":"fd8ee5fd88200428abc483afdaa71967bdd31379","modified":1652171156521},{"_id":"source/images/mysql-index/mysql-index-3.jpg","hash":"35cceb31df26edbd0e277cb4e56ef2d587cf2c32","modified":1652171156522},{"_id":"source/images/mysql-index/mysql-index-4.png","hash":"0b9134b4b2a87563d3dcf97f99bc5ca0f31113aa","modified":1652171156523},{"_id":"source/images/mysql-index/mysql-index-15.jpg","hash":"af6c37378e55d1a2411c570fc4e1749c3ab94d65","modified":1652171156516},{"_id":"source/images/mysql-index/mysql-index-8.jpg","hash":"aa127fff5aa122104290b38586a2f2760a3b7994","modified":1652171156526},{"_id":"source/images/mysql-index/mysql-index-9.jpg","hash":"4a462f10bc0e63035d7f7f91b8795ac583dba91b","modified":1652171156527},{"_id":"source/images/mysql-index/mysql-index-7.jpg","hash":"a0b02a81d7eb89cbcc1aa02cee842b1dd7d0daff","modified":1652171156525},{"_id":"source/images/mysql-index/mysql-index-5.jpg","hash":"ff97e839e51250ae6a6619959affeac364c8dabc","modified":1652171156524},{"_id":"source/images/mysql-lock/mysql-lock-1.webp","hash":"9383fc1fffedb7016f9ba9e46395fd8768d10fbc","modified":1652171156527},{"_id":"source/images/mysql-lock/mysql-lock-2.webp","hash":"701210a5bf98ae7aa6628bd2550859d952ad5d97","modified":1652171156528},{"_id":"source/images/mysql-index/mysql-index-6.png","hash":"97826754fe7c57b8a509d16e0a42c420d8635666","modified":1652171156525},{"_id":"source/images/mysql-lock/mysql-lock-5.webp","hash":"323fbb391f0d17968d02603c46f1b269ad9beec2","modified":1652171156528},{"_id":"source/images/mysql-lock/mysql-lock-3.webp","hash":"ee45bce8dbc4bdc40267dece819d05c2c94992c5","modified":1652171156528},{"_id":"source/images/mysql-lock/mysql-lock-7.webp","hash":"f5b4d205043e9f891bbc03a6e0b8c072e5076b33","modified":1652171156531},{"_id":"source/images/mysql-lock/mysql-lock-4.jpg","hash":"675838b1cc8b951ae2af9a09b603b0c2b0794a4a","modified":1652171156528},{"_id":"source/images/mysql-lock/mysql-lock-8.jpg","hash":"19bc75e74d3f1dfa74deb5e2757aa70acbecf6bb","modified":1652171156531},{"_id":"source/images/mysql-lock/mysql-lock-6.webp","hash":"742c38fa753f215245c9e9351e074f7ab479975b","modified":1652171156530},{"_id":"source/images/rabbitmq-base/bindings.png","hash":"41e211a972dcd6bbca361008baa276318fadde15","modified":1652798491138},{"_id":"source/images/rabbitmq-base/exchanges.png","hash":"dd438322ed5919e11b186d4089aef47de7f719a6","modified":1652798486273},{"_id":"source/images/rabbitmq-base/producer.png","hash":"a7fa166089fd4e9d87ecf1c0e6ae852552832a7e","modified":1652709415393},{"_id":"source/images/rabbitmq-base/python-five.png","hash":"c1fffba56f2ba79a7d2dc5ed4867e6033bf41385","modified":1652880419197},{"_id":"source/images/rabbitmq-base/prefetch-count.png","hash":"78a3796d113a89038463ed2613e0292f74a22ec3","modified":1652797043018},{"_id":"source/images/rabbitmq-base/consumer.png","hash":"a539ac951a0cc71fb7d816415ec9aea432ed023f","modified":1652709537311},{"_id":"source/images/rabbitmq-base/direct-exchange-multiple.png","hash":"ac209b52a7e280b8b46230d2d3f8e636100c6506","modified":1652878262024},{"_id":"source/images/rabbitmq-base/direct-exchange.png","hash":"936cf5ed800ccd2fd9b9ab3989b606fd37d9799b","modified":1652878258007},{"_id":"source/images/rabbitmq-base/python-three-overall.png","hash":"723a8a707d1c971f75ebbe6d060206628f4f2ab7","modified":1652798495192},{"_id":"source/images/rabbitmq-base/python-two.png","hash":"059875c4bc4e3e79bb873acfc4f7f222ad885898","modified":1652793274639},{"_id":"source/images/rabbitmq-base/python-four.png","hash":"9861354f4fbfa294918aa23d917d59a47a2dcbb4","modified":1652878265888},{"_id":"source/images/rabbitmq-base/receiving.png","hash":"cc4f260212af5829f14336f14eeff1d33c919bfe","modified":1652792578034},{"_id":"source/images/rabbitmq-base/python-one.png","hash":"be0611cd80bb4ca21b65f9c28edb329a18475ab0","modified":1652791654746},{"_id":"source/images/rabbitmq-base/sending.png","hash":"007b8d064558478c7e96128df720e5ab7988f938","modified":1652791959445},{"_id":"source/images/rabbitmq-base/queue.png","hash":"f27586f970888b0311df6bdf971c43f7af2e0d4b","modified":1652709530930},{"_id":"source/images/mysql-transaction/mysql-transaction-7.png","hash":"5fd06afb49b243ace14010474f2aa7c42b2ecef1","modified":1652171156543},{"_id":"source/images/java-hashmap/java-hash-map-3.jpg","hash":"878a7db01dd7934315756b1874fabb998430d9c9","modified":1652171156441},{"_id":"source/_posts/database/mysql/mysql-base.md","hash":"2187ae6e01ceb4f6ac7ded3c336900731c8a6d02","modified":1653399560339},{"_id":"source/_posts/database/mysql/mysql-Interview-questions.md","hash":"2fe30487920395629699da19a98d540dcdca5555","modified":1652171156380},{"_id":"source/_posts/database/mysql/mysql-index.md","hash":"a1e8cbd387bbec597f6db4fd961f5259f48735e6","modified":1652171156382},{"_id":"source/_posts/database/mysql/mysql-transaction.md","hash":"7d9605ded2da9d64ef66089dee78117f2b1e76af","modified":1652171156383},{"_id":"source/_posts/database/mysql/mysql-view.md","hash":"acf1a6614c1dca232b04540e5aaa8e8d42889747","modified":1652171156383},{"_id":"source/_posts/database/mysql/mysql-lock-overview.md","hash":"6a2e95b764c34096bff0f18c37fb55f3d6a33e72","modified":1652171156382},{"_id":"source/_posts/database/redis/redisbase.md","hash":"61b19dd4f40162d30bae7e38d0dc06adf86da557","modified":1652259164210},{"_id":"source/images/java-hashmap/java-hash-map-2.jpg","hash":"b052a42886bb4748d75512a863985af6a67cbd9f","modified":1652171156441},{"_id":"source/_posts/java/container/java-currenchashmap.md","hash":"ad78d0e4d3a7c669399183167f5df77fc3a469e5","modified":1652171156390},{"_id":"source/_posts/java/container/java-hashmap.md","hash":"8df0f7bc75857d37d5d377ff0910fd50a59d4328","modified":1652171156392},{"_id":"source/_posts/java/container/java-linkedlist.md","hash":"7a4d2a8a8ef4f517670b865248b48c95098b315b","modified":1652171156393},{"_id":"source/_posts/java/container/java-arraylist.md","hash":"6ec94b5cf9152b00125d101f95ac31842eaf20b6","modified":1652171156390},{"_id":"source/_posts/java/functions/snowflake-algorithm.md","hash":"3197e0896f6a297a513ac5e6f16633738664f35f","modified":1652171156393},{"_id":"source/_posts/database/mongodb/mongobase.md","hash":"e4d8f997af575d82d93274e426f07839d79283fe","modified":1652259140381},{"_id":"source/_posts/java/multiThread/java-cas.md","hash":"41ba3f6d91663b0d35ddc9154d00730a03ee868c","modified":1652171156394},{"_id":"source/_posts/java/utils/maven-cmd.md","hash":"aaad7d7bb36a659037bde3a0f8442c7009829dd1","modified":1652171156394},{"_id":"source/_posts/java/multiThread/java-volatile.md","hash":"32c86ac19ae7ebf4da3ef6c2f79a6c5339361fef","modified":1652171156394},{"_id":"source/_posts/java/multiThread/java-lock.md","hash":"eb76ed5b230acc7fc12645fabbb14ede2560b9e4","modified":1652171156394},{"_id":"source/_posts/java/multiThread/java-thread-interrupt.md","hash":"b8e015c6fb2dbd003bc1c73d0e214908e01b52da","modified":1652171156394},{"_id":"source/_posts/spring/springboot/spring-boot-path.md","hash":"21700dbb76ec2968377750153266343faf7e64f0","modified":1652171156403},{"_id":"source/_posts/spring/springboot/diff-with-controller-restcontroller.md","hash":"de5a31db3f2efc75af7e4611b22f7fbb9c4d44b1","modified":1652171156400},{"_id":"source/_posts/java/multiThread/java-multi-thread.md","hash":"c20e4467851a84ee450739738a402a345338a0df","modified":1652171156394},{"_id":"source/_posts/spring/springboot/spring-diff-componentscan-mapperscan.md","hash":"8939d9e8591a636c8284e4d674d4c949e02752e9","modified":1652171156404},{"_id":"source/_posts/java/utils/modify-jar-config.md","hash":"05e988baf5162fe9e3608b15bdff32160d16725a","modified":1652171156394},{"_id":"source/_posts/spring/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations.md","hash":"3b43d824c9d942046511efef6f241577c10c136d","modified":1652171156405},{"_id":"source/_posts/spring/springboot/swagger2-unable-to-infer-base-url-error.md","hash":"c61bfa2be47f6bdd2cffb4f847dfef1ead07e60d","modified":1652171156404},{"_id":"source/_posts/spring/springcarding/AbstractApplicationContext-refresh.md","hash":"430d3a87a4899ec6584119972bd5434fd4c4bd8f","modified":1652275049460},{"_id":"source/_posts/spring/springcarding/ClassPathXmlApplicationContext-main.md","hash":"0da906e5e8972dca7a7fc7f18a3d3f339e3edf4b","modified":1652171156407},{"_id":"source/_posts/spring/springbootcarding/springbootcardingfirst.md","hash":"a24a20a138d9164a238df331531cdc3e02da5ecf","modified":1652253058428},{"_id":"source/_posts/spring/springcloud/springcloudbase.md","hash":"3f75d53a513e8f4488e8669a45005ae44993341e","modified":1652253114242},{"_id":"source/_posts/messagequeue/kafka/eventstream.md","hash":"ab00a63a2b98ce7a3069bdf936e7d232499ffcf3","modified":1652966676162},{"_id":"source/_posts/spring/springcarding/AbstractXmlApplicationContext-new.md","hash":"2bf81d1bda2dbba1b7d2c616eb8610a7182c8494","modified":1652171156406},{"_id":"source/_posts/spring/springboot/shiro/shiro-redis-session.md","hash":"ccb3055a11d0d3e320f8a3a0bd8f18b70a580834","modified":1652171156403},{"_id":"source/_posts/messagequeue/kafka/kafkabase.md","hash":"6a1ad4ea1ebf414574553190bfb57b75d017f781","modified":1652968989154},{"_id":"source/_posts/spring/springboot/shiro/shiro-redis-jwt.md","hash":"b0c7142de0fbba7f44ae3ce74e1df499a38777c6","modified":1652171156402},{"_id":"source/_posts/spring/springboot/shiro/shiro-base.md","hash":"abd85cc775c4e87a1e0bcd268261db073f9c2381","modified":1652171156401},{"_id":"source/_posts/messagequeue/rabbitmq/rabbitmqbase.md","hash":"a374884e8c445ffd415388fa289133a058c8e832","modified":1653378658740},{"_id":"themes/hexo-theme-ayer/screenshots/hexo-theme-ayer.png","hash":"4111670e622ce09837b6b9cc641782af75805079","modified":1652171156591},{"_id":"source/_posts/spring/springboot/shiro/shiro-jwt.md","hash":"a0c14d3910134ff6c410f5ec2a7eddc49795d550","modified":1652171156402},{"_id":"themes/hexo-theme-ayer/source/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1652171156624},{"_id":"themes/hexo-theme-ayer/source/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1652171156624},{"_id":"source/_posts/spring/springboot/shiro/shiro-customer-encryption.md","hash":"95e9e6efa600075cb904c96b1c011bfa042dea13","modified":1652171156401},{"_id":"source/images/qlexpress.jpg","hash":"debc2755f613352b07b3ae558a6d16a3a34e2fd7","modified":1652171156557},{"_id":"source/images/docker-swarm/docker-swarm-10.png","hash":"2d7f42c77034e4026c0c898a04a13c39663dfc97","modified":1652171156412},{"_id":"source/images/docker-swarm/docker-swarm-4.png","hash":"c0aa73f784f4245d99149ba0d83a96cf91ed1539","modified":1652171156415},{"_id":"source/images/java-linkedlist/java-linkedlist-1.jpg","hash":"9e9d39a57bb0a0fb39ef9eb917bf5c07004dbc33","modified":1652171156441},{"_id":"source/images/java-linkedlist/java-linkedlist-2.jpg","hash":"5415482d1338a18f123a1a80784b0578390240dc","modified":1652171156444},{"_id":"source/images/docker-swarm/docker-swarm-6.png","hash":"a38b20db19b04dcfb17ca7c7464ca4e19aaee230","modified":1652171156423},{"_id":"source/images/java-arraylist/java-arraylist-4.jpg","hash":"4d60f0b437bd128aee832884ac5aea34d5b45515","modified":1652171156425},{"_id":"source/images/java-arraylist/java-arraylist-5.jpg","hash":"fa93cd33d76a8b484e14dfe691aad647eaf473bb","modified":1652171156425},{"_id":"source/images/java-lock/java-lock-14.png","hash":"4d3ed7db23daa0831460b55ad34b8b7cb4eee356","modified":1652171156462},{"_id":"source/images/java-lock/java-lock-8.png","hash":"009586e3e146f981bf45d2ed15ab95099d470776","modified":1652171156511},{"_id":"source/images/java-lock/java-lock-7.png","hash":"aaccf6ac133bd3f760810181f5072351a5bf4c8f","modified":1652171156508},{"_id":"source/images/mysql-transaction/mysql-transaction-1.png","hash":"9eacace9b6eb1572f11a56028dbbd2b10edd0613","modified":1652171156531},{"_id":"source/images/mysql-transaction/mysql-transaction-10.png","hash":"363291abf891654ba569be01b554cd64d2ce1fc5","modified":1652171156539},{"_id":"source/images/mysql-transaction/mysql-transaction-12.png","hash":"48506d86a7cc668b6f232449793fcc4e030d7c5b","modified":1652171156541},{"_id":"source/images/mysql-transaction/mysql-transaction-11.png","hash":"94e14d57c86c9fa0b8f5dc46bb6cc2e351a82924","modified":1652171156541},{"_id":"source/images/mysql-transaction/mysql-transaction-2.png","hash":"5b863d93e1abbabfb11f93fbdc914527c25eb879","modified":1652171156543},{"_id":"source/images/mysql-transaction/mysql-transaction-3.png","hash":"39e50224ef93deeaa203f72a663fcfc971c0406e","modified":1652171156543},{"_id":"source/images/mysql-transaction/mysql-transaction-13.png","hash":"068c98c92d692dcd939b5a4d604ed17774514f33","modified":1652171156542},{"_id":"source/images/mysql-transaction/mysql-transaction-9.png","hash":"f407102ad3f777a558ca04f251466c7e0c5af794","modified":1652171156543},{"_id":"source/images/mysql-transaction/mysql-transaction-8.png","hash":"073ad90f570f9516d1103170e87eb95f13416c2c","modified":1652171156543},{"_id":"source/images/java-hashmap/java-hash-map-1.jpg","hash":"c78a815eddf7cd13693b0f0acf579d25af6bc89f","modified":1652171156440},{"_id":"source/images/mysql-transaction/mysql-transaction-6.png","hash":"d11750fa7e8e855aa657eb8cc8e0f4bae41a75c7","modified":1652171156543},{"_id":"source/images/ShiroArchitecture.png","hash":"a375c77b6b688503e9b621cfea9be42333f6a5ba","modified":1652171156410},{"_id":"source/images/python-opencv-get-coler-in-img.png","hash":"ea203ab1658e18f3d9be0b88fda8c34b09194ac5","modified":1652171156556},{"_id":"source/images/docker-swarm/docker-swarm-3.png","hash":"18d0ce91b2054d28ccf15eaea5cff91d0395a8e1","modified":1652171156415},{"_id":"source/images/docker-swarm/docker-swarm-5.png","hash":"64eb3bd3211cdb5f2016be02bff7fc0d970b2cc4","modified":1652171156415},{"_id":"source/images/docker-swarm/docker-swarm-11.png","hash":"91e6bb774bcba11f40525921a5f91d323be4d90e","modified":1652171156412},{"_id":"source/images/docker-swarm/docker-swarm-2.png","hash":"93e4d914412095eccb98be661b26e80d242f4caa","modified":1652171156415},{"_id":"source/images/java-lock/java-lock-15.png","hash":"232fda890365e1f6337f701b258c8f0a64558dc8","modified":1652171156464},{"_id":"source/images/mysql-transaction/mysql-transaction-4.png","hash":"46264f7108be973e36ad35c6f59d3cb4f16d0859","modified":1652171156543},{"_id":"source/images/shiro/ShiroArchitecture.png","hash":"a375c77b6b688503e9b621cfea9be42333f6a5ba","modified":1652171156557},{"_id":"source/images/mysql-transaction/mysql-transaction-5.png","hash":"71be0a13b22323cf9f02c1c4a88eeb5c0c775ddf","modified":1652171156543},{"_id":"source/images/java-lock/java-lock-12.png","hash":"e94915d673ee97f806898cb7f8bab7b2427ecf90","modified":1652171156457},{"_id":"source/images/java-lock/java-lock-3.png","hash":"1c47e3474346b67003f2ef8c60c9e6d9f1f7caf0","modified":1652171156494},{"_id":"source/images/java-lock/java-lock-5.png","hash":"b807ddae3bc2cb8545f2f99c2b40e85555ec02bf","modified":1652171156504},{"_id":"source/images/java-lock/java-lock-4.png","hash":"451d5eeddcbdb5ff32096180fcf1d03dce2081cd","modified":1652171156494},{"_id":"source/images/java-lock/java-lock-6.png","hash":"f4bc37e4cf2921493163956c75ac2b113b4e806d","modified":1652171156508},{"_id":"themes/hexo-theme-ayer/source/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1652171156624},{"_id":"source/images/kafka-base/logs-from-tpa-cross-record-statistics-in-tpa-cross-record-statistics-7b6c775b98-6s469.txt","hash":"dbb6d157fde148738fc613065fdb73160d66c9ba","modified":1653270847229},{"_id":"source/images/java-lock/java-lock-10.png","hash":"3d28161ee1e95d61e157dca47f6f1b7c91b2b08f","modified":1652171156445},{"_id":"source/images/java-lock/java-lock-11.png","hash":"322f6b4d2873ffcac551a52f12dc78ab0b3ed9ef","modified":1652171156445},{"_id":"source/images/java-lock/java-lock-16.png","hash":"97406dcd083b5ae757db2e67964f84f55abdd117","modified":1652171156464},{"_id":"source/images/java-lock/java-lock-13.png","hash":"42f20c895ef931ce498d3a28aa7f0e652878cf4f","modified":1652171156460},{"_id":"source/images/java-lock/java-lock-17.png","hash":"3f5c51737adb254a0cc10350cb570d30ae539925","modified":1652171156471},{"_id":"source/images/java-lock/java-lock-1.png","hash":"174cf674a7b6d6120a20382fbb023d069d174d89","modified":1652171156445},{"_id":"source/images/java-lock/java-lock-19.png","hash":"a1f6a71a396d35f2183bbf6aa38da36e287f7ace","modified":1652171156480},{"_id":"source/images/java-lock/java-lock-22.png","hash":"587636365477ff7d5138123dbc633cc47bfe9496","modified":1652171156494},{"_id":"source/images/java-lock/java-lock-23.png","hash":"74441a80a0350466cbe4548e9ed6a9c872417fc1","modified":1652171156494},{"_id":"source/images/java-lock/java-lock-21.png","hash":"7d096056931802545eca7b253f0d27dec17f4469","modified":1652171156490},{"_id":"source/images/java-lock/java-lock-18.png","hash":"da53433eddd3e369211bf0a4c2846cae819e7aa8","modified":1652171156476},{"_id":"source/images/java-lock/java-lock-2.png","hash":"babd7efac9d1a1c07dc404617e09cfe519b5dd78","modified":1652171156485},{"_id":"source/images/mysql-lock/mysql-lock.png","hash":"88227c8e5e86df14148966963ce29e545b272241","modified":1652171156531},{"_id":"themes/hexo-theme-ayer/source/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1652171156640},{"_id":"source/images/kafka-base/streams-and-tables-p1_p4.png","hash":"ebf7662b7bbac585b02021d990629e95c9ec79c5","modified":1652966036378},{"_id":"source/images/kafka-base/logs-from-nsdml-server-in-nsdml-server-bff4cd685-nlzd2.txt","hash":"b50ee673a2f6d1933d322a56d246993663fe8789","modified":1653050240705},{"_id":"public/atom.xml","hash":"8c69c22448b11f98120ec7731888f9817f5b0c50","modified":1653400178572},{"_id":"public/search.xml","hash":"a1d9ed8b51072b8dd7cdf4acf76f7e91582f321c","modified":1653400178572},{"_id":"public/tags/index.html","hash":"7b45f73fd525d4b2937223a12b28f19223f283ca","modified":1653400178572},{"_id":"public/categories/index.html","hash":"683b676b09dfbdb0eee586e7b1224f0a1e7e4398","modified":1653400178572},{"_id":"public/friends/index.html","hash":"13f567ca78a68e98df5205b9622f6b671de773ec","modified":1653400178572},{"_id":"public/2022/05/11/spring/springcloud/springcloudbase/index.html","hash":"59a4c427d17814c6aeabcf6b9fa6d5a47dd1ee54","modified":1653400178572},{"_id":"public/2022/05/11/spring/springbootcarding/springbootcardingfirst/index.html","hash":"d353d9c281b11bcbe2aa79a0aa6c414d89c7a46d","modified":1653400178572},{"_id":"public/2022/05/10/hexo/uml/index.html","hash":"8ada911b9a192bd586c1ab63a65e975600ae076f","modified":1653400178572},{"_id":"public/2021/05/10/spring/springboot/spring-diff-componentscan-mapperscan/index.html","hash":"435094dbb70f180c4156e241774857ebaad2750d","modified":1653400178572},{"_id":"public/2021/05/07/docker/docker-base/index.html","hash":"2048d32a1d8d021fd6f8f35be008cca7ef3fb6f3","modified":1653400178572},{"_id":"public/2021/04/30/spring/springboot/spring-boot-path/index.html","hash":"769a7adf96f52b05198478704ef90020fe04b4a8","modified":1653400178572},{"_id":"public/categories/docker/index.html","hash":"de916bf8433a6fdddb802a059d79d2c97f38ad86","modified":1653400178572},{"_id":"public/categories/git/index.html","hash":"e4221741e182556e4a888af0c246ffe7c6730257","modified":1653400178572},{"_id":"public/categories/markdown/index.html","hash":"be5e443110b75d7d92baee0ed224787788652f93","modified":1653400178572},{"_id":"public/categories/java/page/2/index.html","hash":"1702490cd247b2ef33445106ef82e9b4285b90da","modified":1653400178572},{"_id":"public/categories/selenium/index.html","hash":"07a2d19dfc4977e35ae07b90e7f3b2952655dd29","modified":1653400178572},{"_id":"public/categories/python/index.html","hash":"201b6e9635093cbf83c3309ec587becd43e84667","modified":1653400178572},{"_id":"public/categories/elasticsearch/index.html","hash":"78a5769f48240cb406d158c3ae6a9b4fb5730128","modified":1653400178572},{"_id":"public/categories/database/mysql/index.html","hash":"655785058e0103ec45fdfbb3e3e4b53019588c08","modified":1653400178572},{"_id":"public/categories/database/redis/index.html","hash":"dc0718d64fd225344db738334ca7fd8b484bc072","modified":1653400178572},{"_id":"public/categories/java/container/index.html","hash":"a2f733120a72795682964975b0b6d4740221b961","modified":1653400178572},{"_id":"public/categories/database/mongodb/index.html","hash":"4263b479420682aafe73ad5fa13b8030c775c8bf","modified":1653400178572},{"_id":"public/categories/maven/index.html","hash":"e36172b5df92d4996cebdb6eb588e392d785403c","modified":1653400178572},{"_id":"public/categories/spring/page/2/index.html","hash":"afd8539211bf7aaea2f5a5e4119e051bd1eb22be","modified":1653400178572},{"_id":"public/categories/springboot/index.html","hash":"93703c74b2ca0f4f5a99383f071189d936cab257","modified":1653400178572},{"_id":"public/categories/spring-cloud/index.html","hash":"9893e6e99b071d15ca079e6119ac121180253abf","modified":1653400178572},{"_id":"public/categories/rabbitmq/index.html","hash":"65e2e73b7e80bd06b22768e7cc82a3fedcda06d0","modified":1653400178572},{"_id":"public/categories/kafka/index.html","hash":"39a606e2373e32d6f22365c87f9b2c08bd87c76b","modified":1653400178572},{"_id":"public/categories/spring/spring-carding/index.html","hash":"4b72f17a552179e9f94463e6dbf6a5bfe123861f","modified":1653400178572},{"_id":"public/categories/springboot/springboot-carding/index.html","hash":"88a57f0cbc185a1df93a5c68692e83936c0f13d0","modified":1653400178572},{"_id":"public/categories/rabbitmq/queue/index.html","hash":"589530a8106236ffd4faac8b74a675ce820f673a","modified":1653400178572},{"_id":"public/categories/kafka/queue/index.html","hash":"5aa85b3086e89b6a88fef04618e2ec005d55c843","modified":1653400178572},{"_id":"public/categories/spring/springboot/shiro/index.html","hash":"e1a134196ee4dd065eca7baaac81a91927de96d6","modified":1653400178572},{"_id":"public/archives/page/6/index.html","hash":"9db6f79f607a7509f0c4d34a2d2923467706b7d2","modified":1653400178572},{"_id":"public/archives/2021/page/5/index.html","hash":"afc008045c534bd61ae2ad79b4d333955807d4ac","modified":1653400178572},{"_id":"public/archives/2021/04/index.html","hash":"f90c2df601bd600bc3c7b5f929a5aeb0d47d9223","modified":1653400178572},{"_id":"public/archives/2021/05/page/4/index.html","hash":"8aa3107155b7c6147a694219cb19122ebf4338f7","modified":1653400178572},{"_id":"public/archives/2021/06/index.html","hash":"a2340737e4bdecfe5f653454278e7bf4d091a9db","modified":1653400178572},{"_id":"public/archives/2021/07/index.html","hash":"3b0740c4f8a4a33ba4fc375dc939f600169eace7","modified":1653400178572},{"_id":"public/archives/2022/page/2/index.html","hash":"61b35c36f75760ef9611e9721172d9ddb9361fe8","modified":1653400178572},{"_id":"public/archives/2022/05/page/2/index.html","hash":"efcaadd30e0f8b3ab47759615e6962d31c05b145","modified":1653400178572},{"_id":"public/tags/mongo/index.html","hash":"10fb11f791429e80d840fc12296e94b07ba51b91","modified":1653400178572},{"_id":"public/tags//index.html","hash":"fa015f018290fee002007c27ee3a3895a27e762a","modified":1653400178572},{"_id":"public/tags/docker/index.html","hash":"1995035724a713300203541b7aa4a2e1338f8b30","modified":1653400178572},{"_id":"public/tags/docker-install/index.html","hash":"f04c49563a72f91914126ad73f7f242b86f62813","modified":1653400178572},{"_id":"public/tags/docker-swarm/index.html","hash":"bc05eac53ddca476b0dfd2149429273795b171a2","modified":1653400178572},{"_id":"public/tags/docker-/index.html","hash":"38a697333b5b4eddf251f1252fed76e41e604e25","modified":1653400178572},{"_id":"public/tags/git/index.html","hash":"82c2f6a1c20a2e4a6b3bc9fac9f9af685bf51dc0","modified":1653400178572},{"_id":"public/tags/Dockerfile/index.html","hash":"1dba58d666796958317aff56c6372214d3db1e1a","modified":1653400178572},{"_id":"public/tags/ssh/index.html","hash":"415c737821dffc3674cef95651a47bae88b1d7ec","modified":1653400178572},{"_id":"public/tags/markdown/index.html","hash":"9abfa669a417e73950bec9a5260cf0e101520d0c","modified":1653400178572},{"_id":"public/tags/java/page/2/index.html","hash":"3088f00b658b7769ff06d503c457eed988c0a388","modified":1653400178572},{"_id":"public/tags/help/index.html","hash":"514ec184c8d5e541e185644376145117ddae7d34","modified":1653400178572},{"_id":"public/tags/selenium/index.html","hash":"20ae1143cfb6418afa2c9c845810740afaa30566","modified":1653400178572},{"_id":"public/tags/linux-selenium/index.html","hash":"06dbe4d3d4684ac5c99605d5b0be1f436e70f624","modified":1653400178572},{"_id":"public/tags/python/index.html","hash":"0a14d9f7e7926ed8c893f00d124c8eb8f679e702","modified":1653400178572},{"_id":"public/tags/docker-selenium/index.html","hash":"64c1bb56ad4588f66732930777efe6a8b2388928","modified":1653400178572},{"_id":"public/tags/opencv/index.html","hash":"46823e0952b0824899e485fe7674eee80d325d4b","modified":1653400178572},{"_id":"public/tags//index.html","hash":"6bf9333efe222cee27db33c7c6e8f0633a604d0c","modified":1653400178572},{"_id":"public/tags/elasticsearch/index.html","hash":"8624ff625731eebb1af1f250697f068da7370d7c","modified":1653400178572},{"_id":"public/tags/base/index.html","hash":"37c025aeb6b9e48c172015e23a969188f768f9b4","modified":1653400178572},{"_id":"public/tags//index.html","hash":"7164954aa979580054613579dcebd8d93d54af21","modified":1653400178572},{"_id":"public/tags//index.html","hash":"aae38735bce4826e1fce446d92381d50c3b1b22a","modified":1653400178572},{"_id":"public/tags/redis/index.html","hash":"e50dc29632f8c30aae86dde8cad15ebf4c60f6e0","modified":1653400178572},{"_id":"public/tags/cache/index.html","hash":"fcce5f90ee6effd860f0897416f86335df789d0a","modified":1653400178572},{"_id":"public/tags/Map/index.html","hash":"aa83a2cbaa693d7565d8128b385cce48fa3df08f","modified":1653400178572},{"_id":"public/tags/list/index.html","hash":"e60a7810e74f5f335beffbdcd6be697e98393d9b","modified":1653400178572},{"_id":"public/tags//index.html","hash":"c1ea5f7ea8afe40fe13d84bc01067120859f336d","modified":1653400178572},{"_id":"public/tags/mongodb/index.html","hash":"84ff6c014f07c34a872bbf2bedf1089510277b68","modified":1653400178572},{"_id":"public/tags/cas/index.html","hash":"875a56ba2fcec3e20af9840b12b91a7ad5f41985","modified":1653400178572},{"_id":"public/tags//index.html","hash":"2e69ea75aee876c24996e96dc10f3e53a7db8b0f","modified":1653400178572},{"_id":"public/tags/maven/index.html","hash":"70ad73e1c8b65baf68f8de0444bbbfeb01f6db02","modified":1653400178572},{"_id":"public/tags/path/index.html","hash":"3cbfb7b0ba99ed44e646ebd5bcb81bea06b3ad0d","modified":1653400178572},{"_id":"public/tags/swagger/index.html","hash":"cbbed6809ab79cd6fd825ff95029657caf95e4d8","modified":1653400178572},{"_id":"public/tags/spring/index.html","hash":"b5135b06e0537e6e2375bd4cb29f1a29c031c2db","modified":1653400178572},{"_id":"public/tags/spring/index.html","hash":"f230087b3d996e247c38fb140f97bbecbf5067e9","modified":1653400178572},{"_id":"public/tags//index.html","hash":"f3d4477635aa6b0553d8d586fe518711d86a2b57","modified":1653400178572},{"_id":"public/tags/spring-cloud/index.html","hash":"8df628094dc02b5d067fc7afc005bce5fb5284cd","modified":1653400178572},{"_id":"public/tags//index.html","hash":"d299a92190609326574b8419518d9e4428f7beea","modified":1653400178572},{"_id":"public/tags/rabbitmq/index.html","hash":"6acafd2ebbc9c8528c15e338af4964e00c071cf2","modified":1653400178572},{"_id":"public/tags/queue/index.html","hash":"81cf6f2dc7a848b7ed64ed3aaecdc13a1eb982f1","modified":1653400178572},{"_id":"public/tags/shiro/index.html","hash":"02caaeea6eafd23ae176aad2b348348e73eae505","modified":1653400178572},{"_id":"public/tags/kafka/index.html","hash":"9bb9db404942bee01c6b4d33132e1999200045d4","modified":1653400178572},{"_id":"public/tags/jwt/index.html","hash":"fd2581a346fd990632480b4880768578bd68ccdf","modified":1653400178572},{"_id":"public/tags/encryption/index.html","hash":"ef95fea34b4d5fa92eac540c48838f2a528eb6d6","modified":1653400178572},{"_id":"public/archives/index.html","hash":"08c7ec1a512b2d3a0426e2e9478a0c030c97c921","modified":1653400178572},{"_id":"public/2022/05/24/database/mysql/mysql-base/index.html","hash":"8dacfc13a372add7c83bb1888ea64a9d8e8b0640","modified":1653400178572},{"_id":"public/2022/05/19/messagequeue/kafka/eventstream/index.html","hash":"87232d9b6ed9ed9f4649178fe26b8465ed513cf6","modified":1653400178572},{"_id":"public/2022/05/11/messagequeue/rabbitmq/rabbitmqbase/index.html","hash":"5a96cf0cac64382703a8f77990a8a92f50e47119","modified":1653400178572},{"_id":"public/2022/05/11/messagequeue/kafka/kafkabase/index.html","hash":"c72b4d3f2ff5b76cea1b84766f802160d04e738f","modified":1653400178572},{"_id":"public/2022/05/11/elasticsearch/elasticsearchbase/index.html","hash":"4ff03813ecf056f59b8352732f5e7e599de448f6","modified":1653400178572},{"_id":"public/2022/05/11/database/redis/redisbase/index.html","hash":"3ab25aafd5681231040922c50127b214f224d15f","modified":1653400178572},{"_id":"public/2022/05/11/database/mongodb/mongobase/index.html","hash":"9defb7bd385fa24c738d2a19d8041b8cda5aba90","modified":1653400178572},{"_id":"public/2022/05/10/hexo/hexo-quick-start/index.html","hash":"a84c925ba8c36272ef0db30d87f5d897cb16a423","modified":1653400178572},{"_id":"public/2021/07/19/java/QLExpress/index.html","hash":"51375e357d274363f248d2fe9fff555610b59418","modified":1653400178572},{"_id":"public/2021/06/15/spring/springboot/shiro/shiro-customer-encryption/index.html","hash":"ed855f0aa34f3e364e03a9a8cdd25407f4913e54","modified":1653400178572},{"_id":"public/2021/06/15/spring/springboot/shiro/shiro-redis-jwt/index.html","hash":"234272f59354356b7b6b891d4ad12571f9d22cb9","modified":1653400178572},{"_id":"public/2021/06/15/spring/springboot/shiro/shiro-redis-session/index.html","hash":"0c35d6681e5bd18a221544fbbbff4c4a0aaba95d","modified":1653400178572},{"_id":"public/2021/06/15/spring/springboot/shiro/shiro-jwt/index.html","hash":"a7df3926d0d87cb0c653b4d048cc2ac084218495","modified":1653400178572},{"_id":"public/2021/06/15/spring/springboot/shiro/shiro-base/index.html","hash":"1db3d65d1d67fdc483bc30d710eb2d2ea124c02b","modified":1653400178572},{"_id":"public/2021/06/08/java/multiThread/java-thread-interrupt/index.html","hash":"7bf2d8a15e87bab8d7beb33c45951730f886d46a","modified":1653400178572},{"_id":"public/2021/05/24/java/multiThread/java-lock/index.html","hash":"7c22d783bfe30175e02e4fc74ab5bfb9310b6204","modified":1653400178572},{"_id":"public/2021/05/24/java/multiThread/java-multi-thread/index.html","hash":"ad2376da1548aeddd847549117f3b78478396711","modified":1653400178572},{"_id":"public/2021/05/19/java/multiThread/java-cas/index.html","hash":"a118d54636de1209e215bee40fa7072eaee4b3d8","modified":1653400178572},{"_id":"public/2021/05/17/java/container/java-linkedlist/index.html","hash":"5048cdc3334c2e61331a9e7cb723c03a7e42f477","modified":1653400178572},{"_id":"public/2021/05/17/java/container/java-arraylist/index.html","hash":"c0d10eac79ff4fb0ee78b60215d73eb72cd94e2a","modified":1653400178572},{"_id":"public/2021/05/17/java/container/java-hashmap/index.html","hash":"12829d775bb057851ffa8fd6d57d92393cdd1bb7","modified":1653400178572},{"_id":"public/2021/05/14/java/container/java-currenchashmap/index.html","hash":"9b5bdc201b9063af909304a55caac33522562c0e","modified":1653400178572},{"_id":"public/2021/05/13/database/mysql/mysql-view/index.html","hash":"316c618554163254ee704d5fd4368239dde5e734","modified":1653400178572},{"_id":"public/2021/05/13/database/mysql/mysql-index/index.html","hash":"fe44c0ebe71aeb6ab19257e6bae8acfb76977139","modified":1653400178572},{"_id":"public/2021/05/13/database/mysql/mysql-transaction/index.html","hash":"97e4a7a36a731a5863cf1673880f5f27f2fbce0a","modified":1653400178572},{"_id":"public/2021/05/12/java/multiThread/java-volatile/index.html","hash":"b2e17093329099eeb96162c9bd2b007cb9a4cca5","modified":1653400178572},{"_id":"public/2021/05/11/spring/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations/index.html","hash":"79cfa3732f709232e505034beeab417f9805b5b3","modified":1653400178572},{"_id":"public/2021/05/11/spring/springcarding/AbstractXmlApplicationContext-new/index.html","hash":"651b514ba84a40a47fa0e271ad40e8a69bf05395","modified":1653400178572},{"_id":"public/2021/05/11/spring/springcarding/AbstractApplicationContext-refresh/index.html","hash":"316ebcb590085f69beb31e925c9ccd3b997aa7ae","modified":1653400178572},{"_id":"public/2021/05/11/spring/springcarding/ClassPathXmlApplicationContext-main/index.html","hash":"7505765cee37f860024331f3876fa585996a7639","modified":1653400178572},{"_id":"public/2021/05/11/spring/springboot/diff-with-controller-restcontroller/index.html","hash":"d9f35eb32d628b0a6f8055371e5af24fbdd707d2","modified":1653400178572},{"_id":"public/2021/05/11/hexo/hexo-support-flow-chart/index.html","hash":"00f073a7858a5a0305266db48ce02bd762fe55e3","modified":1653400178572},{"_id":"public/2021/05/10/python/use-selenium-on-linux/index.html","hash":"8bd4ff5ed180119e694947d0dd5c0346320cdaa5","modified":1653400178572},{"_id":"public/2021/05/10/markdown/markdown-base-grammar/index.html","hash":"51c75084567ca6790d2722f2da84d44650a6f5f7","modified":1653400178572},{"_id":"public/2021/05/10/python/python-opencv-get-coler-in-img/index.html","hash":"b0b876adf376ab7c4d93563a3dcc2402cb4ad869","modified":1653400178572},{"_id":"public/2021/05/08/java/utils/maven-cmd/index.html","hash":"16d59ca1cc2ff66f388aa233e1c8807689bb5f75","modified":1653400178572},{"_id":"public/2021/05/08/database/mysql-mongo-data-transfer/index.html","hash":"19137c5b49babafb5c375e420544e8ac9a1f647c","modified":1653400178572},{"_id":"public/2021/05/08/java/utils/modify-jar-config/index.html","hash":"5fc79ab09f8720a3670c55ff1d3c8e7757c4c892","modified":1653400178572},{"_id":"public/2021/05/08/docker/dockerFile/index.html","hash":"ead8a6edef4ebd13834e90828f289b209cc63e40","modified":1653400178572},{"_id":"public/2021/05/08/spring/springboot/swagger2-unable-to-infer-base-url-error/index.html","hash":"7c1982eeb7b24de80b781a5a8738fcf9b51bf3b8","modified":1653400178572},{"_id":"public/2021/05/07/docker/docker-install/index.html","hash":"6596ee866aa9e75b4118cbbbae750e7ec8483745","modified":1653400178572},{"_id":"public/2021/05/07/docker/docker-swarm/index.html","hash":"b70ae3ecacdefbb6afa4941fd0718d85be44e504","modified":1653400178572},{"_id":"public/2021/05/07/git/git-ssh-generate/index.html","hash":"bd5a7c0395deb8465e1094ebe7f580117714f144","modified":1653400178572},{"_id":"public/2021/04/30/java/functions/snowflake-algorithm/index.html","hash":"90b9d7e8216a04f9e0220875b78c54f65748c253","modified":1653400178572},{"_id":"public/2021/05/07/git/git-delete-history-log/index.html","hash":"543acccc9be2af283b7637818912d117f9b396ef","modified":1653400178572},{"_id":"public/2021/05/07/git/git-remote/index.html","hash":"07b89394e9a58d2e847738388c642c229533d88e","modified":1653400178572},{"_id":"public/2021/04/28/database/mysql/mysql-lock-overview/index.html","hash":"3c7ce3b3e9ab2cf855178192fd8c246b779c6b01","modified":1653400178572},{"_id":"public/2021/04/28/database/mysql/mysql-Interview-questions/index.html","hash":"84b91bcbe3fd943bb5b1057178563b1768faa1c6","modified":1653400178572},{"_id":"public/categories/database/index.html","hash":"1fb9dfafa4b0f979d26d763bfee03b0ebc5c424c","modified":1653400178572},{"_id":"public/categories/java/index.html","hash":"c3c774c9c196237e8cc1b2d065374f5a8358b6e8","modified":1653400178572},{"_id":"public/categories/spring/index.html","hash":"c4f8929c2acf7dd7ba017c7beb726e1ec3f84226","modified":1653400178572},{"_id":"public/categories/spring/springboot/index.html","hash":"55291e0bd78f8d329539508e30bf464074910213","modified":1653400178572},{"_id":"public/archives/page/2/index.html","hash":"1fd0dea0a7fbaf9dd28725e072bb9aa043e090fa","modified":1653400178572},{"_id":"public/archives/page/3/index.html","hash":"d8926dd050de1bfad0710f9c4da8166878945d44","modified":1653400178572},{"_id":"public/archives/page/4/index.html","hash":"1029cc574678eecb948460abe8bf23933a2e318d","modified":1653400178572},{"_id":"public/archives/page/5/index.html","hash":"9a8a35a2a691150443d57378d998ae441930c726","modified":1653400178572},{"_id":"public/archives/2021/index.html","hash":"412699bd4110d9a87a4b3cd2b40149becf0a7e55","modified":1653400178572},{"_id":"public/archives/2021/page/2/index.html","hash":"b30e8b1ce3d0d89f80ebe8aa1aedf57a5a8f6506","modified":1653400178572},{"_id":"public/archives/2021/page/3/index.html","hash":"515161a643e8bc9defc5e4bcd2d0a89ae6fa80b9","modified":1653400178572},{"_id":"public/archives/2021/page/4/index.html","hash":"4e35cfd39a5fd9305beca8240fb53a4caa5d6483","modified":1653400178572},{"_id":"public/archives/2021/05/index.html","hash":"6636607a711815bf6b61e8a2385bb38e08454ac8","modified":1653400178572},{"_id":"public/archives/2021/05/page/2/index.html","hash":"369dc25b9c969d0dad929fec3ce54b3ea2856992","modified":1653400178572},{"_id":"public/archives/2021/05/page/3/index.html","hash":"ee8f8c422dc74280e934972f274d39c4507a1f21","modified":1653400178572},{"_id":"public/archives/2022/index.html","hash":"a752fe68056a57fef5df3c8b6e47ab32cfa2f864","modified":1653400178572},{"_id":"public/index.html","hash":"e7d062768ace70813a085ad76af1238c35d092bd","modified":1653400178572},{"_id":"public/archives/2022/05/index.html","hash":"9fee1e8820f48dc4fd18e84ce06125ea04ad809b","modified":1653400178572},{"_id":"public/page/3/index.html","hash":"4d631a6b6d1dcc66d33bd52833e806a91ce5becb","modified":1653400178572},{"_id":"public/page/2/index.html","hash":"c4745efa19773af2ee1cd3defe588f3f11e7d635","modified":1653400178572},{"_id":"public/page/4/index.html","hash":"042d6d02c416d854550219eed6e8e4e8ce642a02","modified":1653400178572},{"_id":"public/page/5/index.html","hash":"990b55b112d22f6b0ea4a4ba8554639cadc77968","modified":1653400178572},{"_id":"public/page/6/index.html","hash":"c6c8f3d670de7eb1f5ab4460eb49bf10344969d0","modified":1653400178572},{"_id":"public/tags/mysql/index.html","hash":"fd2ff4fc1e3547fcdd1205436f3b2b37879e889f","modified":1653400178572},{"_id":"public/tags/java/index.html","hash":"e78c14a582a9017d172cc16bd7be944dc4ffd29c","modified":1653400178572},{"_id":"public/tags/springboot/index.html","hash":"bc310a075e7506423ed50715b5c7695da69b5a3d","modified":1653400178572},{"_id":"public/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1653400178572},{"_id":"public/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1653400178572},{"_id":"public/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1653400178572},{"_id":"public/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1653400178572},{"_id":"public/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1653400178572},{"_id":"public/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1653400178572},{"_id":"public/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1653400178572},{"_id":"public/images/cover7.jpg","hash":"573bff6899d2d9c5bcba0dc9c60cd1ec9eb8b029","modified":1653400178572},{"_id":"public/images/mouse.cur","hash":"c1ffe93a6ba0d25ef06bb3d097560762e4807593","modified":1653400178572},{"_id":"public/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1653400178572},{"_id":"public/CNAME","hash":"fb92dc87219b3532a37f66b586d6d5e1188c335b","modified":1653400178572},{"_id":"public/README.md","hash":"bbd636f1459e5df582b36a6f9b64d66b66d37476","modified":1653400178572},{"_id":"public/images/swagger_error.png","hash":"d69198ed4552620ac29e494a778a92a72ade7985","modified":1653400178572},{"_id":"public/images/java-multy-thread.png","hash":"440e10f9ff4669b459d528af2a9d14038dd66e4a","modified":1653400178572},{"_id":"public/images/snowflake-algorithm.png","hash":"95e301b6d580df23bc5db65f3d4711d3ddd7939a","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-1.png","hash":"b652f6dfdbb3b12258d45e4369043b870e4ed1c9","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-12.png","hash":"437189871a73ccaaac3db5bcc5f2085f7a05a860","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-7.png","hash":"10b67a4eedcb04278a480d238eeea62a6b759ff6","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-8.png","hash":"50151e92d507c91c77888e1a6d53802d8a3c283a","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-9.png","hash":"105be41a2ff0642fe2a2ac8a4c45276dda1122fc","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-2.jpg","hash":"b28c3259a15a77b3ac7f946309debcf3dbdb6c41","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-4.jpg","hash":"f3e6667dfb2f90e1c44e833a06dd8a2896eeb83d","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-3.jpg","hash":"b3ad9922711d91e5d8fb6798a938d2d9689b2521","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-5.jpg","hash":"64635a1b94b006248d5dae5d0069f9b107799138","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-7.jpg","hash":"72e401e1bb50b72d8acb3867cf5ed95a71c0e4a9","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-8.jpg","hash":"5e16469ead8ca69785a1186241a5d08a8c20c0e8","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-1.jpg","hash":"b1b578537ba5397304a73f22a117b7e3bb08c099","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-9.jpg","hash":"029ebe3aca1c108c4af670dd1914fd1d9a988d74","modified":1653400178572},{"_id":"public/images/java-arraylist/java-arraylist-1.jpg","hash":"b64592546b7a3c8eeaf93276e64076a437a6c29f","modified":1653400178572},{"_id":"public/images/java-arraylist/java-arraylist-2.jpg","hash":"84158c67907d1b6a53ad49f08976680255915688","modified":1653400178572},{"_id":"public/images/java-arraylist/java-arraylist-3.jpg","hash":"6d874676a0ee82340b5bb747c5deb3d683231281","modified":1653400178572},{"_id":"public/images/java-volatile/java-volatile-1.jpg","hash":"da8ff67b12daf7bc3384b335f9baa0924bb7de74","modified":1653400178572},{"_id":"public/images/java-volatile/java-volatile-2.jpg","hash":"5277287b8eadf96a0ad1c03196d13f0d63d15ae2","modified":1653400178572},{"_id":"public/images/java-cas/java-cas-6.jpg","hash":"2b26517188df3a914d4ebf83dbed98075a66418c","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-20.png","hash":"5c9250cc10ba8127846d51b875803afb76f460d0","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-10.jpg","hash":"490b06bc70bcd2ec38e700e72a5a5e2a5f15e150","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-9.png","hash":"8922577d55e39f9326b8eb2facb98886aeed0a02","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-11.jpg","hash":"de1e41b3caf6d8687eb998f9dd468f73f9c87a6c","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-1.jpg","hash":"44bb633f19ed353a9dee6bcd65216365bd118891","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-15.jpg","hash":"af6c37378e55d1a2411c570fc4e1749c3ab94d65","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-12.jpg","hash":"2fa9ee47a816ac59c1bde63b5ac339121e84b764","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-13.png","hash":"e8d9279e7d174445c41fe3d16a1990778c96f9e2","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-14.png","hash":"0b9134b4b2a87563d3dcf97f99bc5ca0f31113aa","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-16.jpg","hash":"957a01b544a872baebb49659fc32a3ab850e5b0b","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-3.jpg","hash":"35cceb31df26edbd0e277cb4e56ef2d587cf2c32","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-2.jpg","hash":"cb6782a8736443d63c3b8768495b80d59459ef88","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-17.png","hash":"fd8ee5fd88200428abc483afdaa71967bdd31379","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-4.png","hash":"0b9134b4b2a87563d3dcf97f99bc5ca0f31113aa","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-8.jpg","hash":"aa127fff5aa122104290b38586a2f2760a3b7994","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-9.jpg","hash":"4a462f10bc0e63035d7f7f91b8795ac583dba91b","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-7.jpg","hash":"a0b02a81d7eb89cbcc1aa02cee842b1dd7d0daff","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-1.webp","hash":"9383fc1fffedb7016f9ba9e46395fd8768d10fbc","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-5.jpg","hash":"ff97e839e51250ae6a6619959affeac364c8dabc","modified":1653400178572},{"_id":"public/images/mysql-index/mysql-index-6.png","hash":"97826754fe7c57b8a509d16e0a42c420d8635666","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-5.webp","hash":"323fbb391f0d17968d02603c46f1b269ad9beec2","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-2.webp","hash":"701210a5bf98ae7aa6628bd2550859d952ad5d97","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-4.jpg","hash":"675838b1cc8b951ae2af9a09b603b0c2b0794a4a","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-3.webp","hash":"ee45bce8dbc4bdc40267dece819d05c2c94992c5","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-6.webp","hash":"742c38fa753f215245c9e9351e074f7ab479975b","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-7.webp","hash":"f5b4d205043e9f891bbc03a6e0b8c072e5076b33","modified":1653400178572},{"_id":"public/images/rabbitmq-base/bindings.png","hash":"41e211a972dcd6bbca361008baa276318fadde15","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock-8.jpg","hash":"19bc75e74d3f1dfa74deb5e2757aa70acbecf6bb","modified":1653400178572},{"_id":"public/images/rabbitmq-base/prefetch-count.png","hash":"78a3796d113a89038463ed2613e0292f74a22ec3","modified":1653400178572},{"_id":"public/images/rabbitmq-base/exchanges.png","hash":"dd438322ed5919e11b186d4089aef47de7f719a6","modified":1653400178572},{"_id":"public/images/rabbitmq-base/producer.png","hash":"a7fa166089fd4e9d87ecf1c0e6ae852552832a7e","modified":1653400178572},{"_id":"public/images/rabbitmq-base/python-five.png","hash":"c1fffba56f2ba79a7d2dc5ed4867e6033bf41385","modified":1653400178572},{"_id":"public/images/rabbitmq-base/direct-exchange.png","hash":"936cf5ed800ccd2fd9b9ab3989b606fd37d9799b","modified":1653400178572},{"_id":"public/images/rabbitmq-base/direct-exchange-multiple.png","hash":"ac209b52a7e280b8b46230d2d3f8e636100c6506","modified":1653400178572},{"_id":"public/images/rabbitmq-base/consumer.png","hash":"a539ac951a0cc71fb7d816415ec9aea432ed023f","modified":1653400178572},{"_id":"public/images/rabbitmq-base/python-three-overall.png","hash":"723a8a707d1c971f75ebbe6d060206628f4f2ab7","modified":1653400178572},{"_id":"public/images/rabbitmq-base/python-four.png","hash":"9861354f4fbfa294918aa23d917d59a47a2dcbb4","modified":1653400178572},{"_id":"public/images/rabbitmq-base/receiving.png","hash":"cc4f260212af5829f14336f14eeff1d33c919bfe","modified":1653400178572},{"_id":"public/images/rabbitmq-base/python-two.png","hash":"059875c4bc4e3e79bb873acfc4f7f222ad885898","modified":1653400178572},{"_id":"public/images/rabbitmq-base/sending.png","hash":"007b8d064558478c7e96128df720e5ab7988f938","modified":1653400178572},{"_id":"public/images/rabbitmq-base/python-one.png","hash":"be0611cd80bb4ca21b65f9c28edb329a18475ab0","modified":1653400178572},{"_id":"public/images/rabbitmq-base/queue.png","hash":"f27586f970888b0311df6bdf971c43f7af2e0d4b","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-7.png","hash":"5fd06afb49b243ace14010474f2aa7c42b2ecef1","modified":1653400178572},{"_id":"public/images/java-hashmap/java-hash-map-2.jpg","hash":"b052a42886bb4748d75512a863985af6a67cbd9f","modified":1653400178572},{"_id":"public/images/java-hashmap/java-hash-map-3.jpg","hash":"878a7db01dd7934315756b1874fabb998430d9c9","modified":1653400178572},{"_id":"public/images/alipay.jpg","hash":"8f5409e29764fca573f1d274003910aa3c919de1","modified":1653400178572},{"_id":"public/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1653400178572},{"_id":"public/images/wechat.jpg","hash":"93a362574a8498e75dca469b7bceb0b321fda387","modified":1653400178572},{"_id":"public/images/qlexpress.jpg","hash":"debc2755f613352b07b3ae558a6d16a3a34e2fd7","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-10.png","hash":"2d7f42c77034e4026c0c898a04a13c39663dfc97","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-4.png","hash":"c0aa73f784f4245d99149ba0d83a96cf91ed1539","modified":1653400178572},{"_id":"public/images/java-linkedlist/java-linkedlist-1.jpg","hash":"9e9d39a57bb0a0fb39ef9eb917bf5c07004dbc33","modified":1653400178572},{"_id":"public/images/java-linkedlist/java-linkedlist-2.jpg","hash":"5415482d1338a18f123a1a80784b0578390240dc","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-6.png","hash":"a38b20db19b04dcfb17ca7c7464ca4e19aaee230","modified":1653400178572},{"_id":"public/images/java-arraylist/java-arraylist-4.jpg","hash":"4d60f0b437bd128aee832884ac5aea34d5b45515","modified":1653400178572},{"_id":"public/images/java-arraylist/java-arraylist-5.jpg","hash":"fa93cd33d76a8b484e14dfe691aad647eaf473bb","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-14.png","hash":"4d3ed7db23daa0831460b55ad34b8b7cb4eee356","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-8.png","hash":"009586e3e146f981bf45d2ed15ab95099d470776","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-7.png","hash":"aaccf6ac133bd3f760810181f5072351a5bf4c8f","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-1.png","hash":"9eacace9b6eb1572f11a56028dbbd2b10edd0613","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-10.png","hash":"363291abf891654ba569be01b554cd64d2ce1fc5","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-12.png","hash":"48506d86a7cc668b6f232449793fcc4e030d7c5b","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-3.png","hash":"39e50224ef93deeaa203f72a663fcfc971c0406e","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-11.png","hash":"94e14d57c86c9fa0b8f5dc46bb6cc2e351a82924","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-2.png","hash":"5b863d93e1abbabfb11f93fbdc914527c25eb879","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-13.png","hash":"068c98c92d692dcd939b5a4d604ed17774514f33","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-9.png","hash":"f407102ad3f777a558ca04f251466c7e0c5af794","modified":1653400178572},{"_id":"public/images/java-hashmap/java-hash-map-1.jpg","hash":"c78a815eddf7cd13693b0f0acf579d25af6bc89f","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-8.png","hash":"073ad90f570f9516d1103170e87eb95f13416c2c","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-6.png","hash":"d11750fa7e8e855aa657eb8cc8e0f4bae41a75c7","modified":1653400178572},{"_id":"public/js/clickLove.js","hash":"9e8e79d69ad8338761272f86fe5cad0ad5e503cc","modified":1653400178572},{"_id":"public/css/custom.css","hash":"58950a4f4cd82465f85428ec17b3bc05f8153b56","modified":1653400178572},{"_id":"public/css/clipboard.css","hash":"7990b92ffeda1b06b94b50140d9c95dac21bd418","modified":1653400178572},{"_id":"public/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1653400178572},{"_id":"public/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1653400178572},{"_id":"public/js/clickBoom1.js","hash":"56582907b4c2ece5187b8d64125f91ddabb8a24e","modified":1653400178572},{"_id":"public/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1653400178572},{"_id":"public/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1653400178572},{"_id":"public/404.html","hash":"86cb9b15558d623c1e6038e77e781e544524684e","modified":1653400178572},{"_id":"public/js/clickBoom2.js","hash":"bea5232eb8b32542283d9a28257f4b85ce2f3c1b","modified":1653400178572},{"_id":"public/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1653400178572},{"_id":"public/dist/main.js","hash":"ddee860717697321d9a96464c9179fdca00327a5","modified":1653400178572},{"_id":"public/dist/main.css","hash":"6f43d2b89beb684f020f80dd1a0952f4f6ee3659","modified":1653400178572},{"_id":"public/js/jquery-2.0.3.min.js","hash":"800edb7787c30f4982bf38f2cb8f4f6fb61340e9","modified":1653400178572},{"_id":"public/images/cover6.jpg","hash":"a5b8a5dddff2607fee5fccf5fdef3b214a8468cc","modified":1653400178572},{"_id":"public/images/ShiroArchitecture.png","hash":"a375c77b6b688503e9b621cfea9be42333f6a5ba","modified":1653400178572},{"_id":"public/images/python-opencv-get-coler-in-img.png","hash":"ea203ab1658e18f3d9be0b88fda8c34b09194ac5","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-11.png","hash":"91e6bb774bcba11f40525921a5f91d323be4d90e","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-3.png","hash":"18d0ce91b2054d28ccf15eaea5cff91d0395a8e1","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-5.png","hash":"64eb3bd3211cdb5f2016be02bff7fc0d970b2cc4","modified":1653400178572},{"_id":"public/images/docker-swarm/docker-swarm-2.png","hash":"93e4d914412095eccb98be661b26e80d242f4caa","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-15.png","hash":"232fda890365e1f6337f701b258c8f0a64558dc8","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-4.png","hash":"46264f7108be973e36ad35c6f59d3cb4f16d0859","modified":1653400178572},{"_id":"public/images/shiro/ShiroArchitecture.png","hash":"a375c77b6b688503e9b621cfea9be42333f6a5ba","modified":1653400178572},{"_id":"public/images/mysql-transaction/mysql-transaction-5.png","hash":"71be0a13b22323cf9f02c1c4a88eeb5c0c775ddf","modified":1653400178572},{"_id":"public/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1653400178572},{"_id":"public/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-12.png","hash":"e94915d673ee97f806898cb7f8bab7b2427ecf90","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-6.png","hash":"f4bc37e4cf2921493163956c75ac2b113b4e806d","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-3.png","hash":"1c47e3474346b67003f2ef8c60c9e6d9f1f7caf0","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-4.png","hash":"451d5eeddcbdb5ff32096180fcf1d03dce2081cd","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-5.png","hash":"b807ddae3bc2cb8545f2f99c2b40e85555ec02bf","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-10.png","hash":"3d28161ee1e95d61e157dca47f6f1b7c91b2b08f","modified":1653400178572},{"_id":"public/images/kafka-base/logs-from-tpa-cross-record-statistics-in-tpa-cross-record-statistics-7b6c775b98-6s469.txt","hash":"dbb6d157fde148738fc613065fdb73160d66c9ba","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-11.png","hash":"322f6b4d2873ffcac551a52f12dc78ab0b3ed9ef","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-16.png","hash":"97406dcd083b5ae757db2e67964f84f55abdd117","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-13.png","hash":"42f20c895ef931ce498d3a28aa7f0e652878cf4f","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-17.png","hash":"3f5c51737adb254a0cc10350cb570d30ae539925","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-1.png","hash":"174cf674a7b6d6120a20382fbb023d069d174d89","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-19.png","hash":"a1f6a71a396d35f2183bbf6aa38da36e287f7ace","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-22.png","hash":"587636365477ff7d5138123dbc633cc47bfe9496","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-23.png","hash":"74441a80a0350466cbe4548e9ed6a9c872417fc1","modified":1653400178572},{"_id":"public/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-21.png","hash":"7d096056931802545eca7b253f0d27dec17f4469","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-18.png","hash":"da53433eddd3e369211bf0a4c2846cae819e7aa8","modified":1653400178572},{"_id":"public/images/java-lock/java-lock-2.png","hash":"babd7efac9d1a1c07dc404617e09cfe519b5dd78","modified":1653400178572},{"_id":"public/images/mysql-lock/mysql-lock.png","hash":"88227c8e5e86df14148966963ce29e545b272241","modified":1653400178572},{"_id":"public/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1653400178572},{"_id":"public/images/kafka-base/streams-and-tables-p1_p4.png","hash":"ebf7662b7bbac585b02021d990629e95c9ec79c5","modified":1653400178572},{"_id":"public/images/kafka-base/logs-from-nsdml-server-in-nsdml-server-bff4cd685-nlzd2.txt","hash":"b50ee673a2f6d1933d322a56d246993663fe8789","modified":1653400178572}],"Category":[{"name":"database","_id":"cl3k7f4op0004xklohlg600kh"},{"name":"docker","_id":"cl3k7f4os000bxklo0bu12ym3"},{"name":"git","_id":"cl3k7f4oy000rxklo029208jx"},{"name":"markdown","_id":"cl3k7f4p20014xklobotleuke"},{"name":"java","_id":"cl3k7f4p4001cxklogppj8b19"},{"name":"selenium","_id":"cl3k7f4p8001txklocvgy78ov"},{"name":"python","_id":"cl3k7f4p90021xklo93a6ei9h"},{"name":"elasticsearch","_id":"cl3k7f4pa0029xklo56f1em2h"},{"name":"mysql","parent":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pb002fxkloagt957zi"},{"name":"redis","parent":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4ph003axklo18fm1vi6"},{"name":"container","parent":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pk003vxklo424w3hp0"},{"name":"mongodb","parent":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4po004jxklo078w31of"},{"name":"maven","_id":"cl3k7f4po004oxklobryp8pzz"},{"name":"spring","_id":"cl3k7f4po004txklof6ys8r84"},{"name":"springboot","_id":"cl3k7f4ps005qxklo1siy0v66"},{"name":"spring cloud","_id":"cl3k7f4ps005txkloe6q10sjb"},{"name":"rabbitmq","_id":"cl3k7f4pt005wxkloeh435dlj"},{"name":"kafka","_id":"cl3k7f4pu0063xklo4k54cfzp"},{"name":"springboot","parent":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4pv0069xklo1f0k1u32"},{"name":"spring carding","parent":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4pw006kxkloh2ok3j32"},{"name":"springboot carding","parent":"cl3k7f4ps005qxklo1siy0v66","_id":"cl3k7f4q00079xklo5am66uw2"},{"name":"queue","parent":"cl3k7f4pt005wxkloeh435dlj","_id":"cl3k7f4q1007fxklo641i0cea"},{"name":"queue","parent":"cl3k7f4pu0063xklo4k54cfzp","_id":"cl3k7f4q2007nxklo40i6c5c9"},{"name":"shiro","parent":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4q4007xxklo1v6yadrd"}],"Data":[],"Page":[{"title":"archives","type":"archives","layout":"archives","date":"2021-04-28T02:40:00.000Z","_content":"","source":"archives/index.md","raw":"---\ntitle: archives\ntype: archives\nlayout: \"archives\"\ndate: 2021-04-28 10:40:00\n---","updated":"2022-05-10T08:25:56.409Z","path":"archives/index.html","comments":1,"_id":"cl3k7f4ol0000xklohb1j2foo","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","type":"categories","layout":"categories","date":"2021-04-28T02:12:54.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ntype: categories\nlayout: \"categories\"\ndate: 2021-04-28 10:12:54\n---","updated":"2022-05-10T08:25:56.409Z","path":"categories/index.html","comments":1,"_id":"cl3k7f4oo0002xklofe4ug9ed","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"friends","type":"friends","loyout":"friends","date":"2021-04-28T02:13:18.000Z","_content":"","source":"friends/index.md","raw":"---\ntitle: friends\ntype: friends\nloyout: \"friends\"\ndate: 2021-04-28 10:13:18\n---","updated":"2022-05-10T08:25:56.410Z","path":"friends/index.html","comments":1,"layout":"page","_id":"cl3k7f4oq0006xklogggu9o84","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","type":"tags","layout":"tags","date":"2021-04-28T02:42:09.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ntype: tags\nlayout: tags\ndate: 2021-04-28 10:42:09\n---","updated":"2022-05-10T08:25:56.560Z","path":"tags/index.html","comments":1,"_id":"cl3k7f4or0008xklo6ed427rp","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"mysql,mongo","date":"2021-05-08T08:10:00.000Z","_content":"\nmysql:\n\nnavicat \n\nhttps://blog.csdn.net/xuanjiewu/article/details/86152633\n\nmysqldump\n\n\n\neg: \n\n\n\neg:\n\nhttps://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples\n\nworkbench\n\nhttps://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html\n\nmongo:\n\nmongo toolshttps://docs.mongodb.com/database-tools/installation/installation/\n\nmongodump\n\neg:\n\n```\nmongodump -h <host:port> -d <db> -c <collection> -u <user> -p <password> -o <directory-path>\n```\n\nhttps://docs.mongodb.com/database-tools/mongodump/\n\nmongorestore\n\neg:\n\n```\nmongorestore -h <host:port> -d <db> -c <collection> -u <user> -p <password> --drop <input-path>\n```\n\nhttps://docs.mongodb.com/database-tools/mongorestore/\n\n","source":"_posts/database/mysql-mongo-data-transfer.md","raw":"---\ntitle: mysql,mongo\ndate: 2021-05-08 16:10:00\ncategories:\n  - database\ntags:\n  - mysql\n  - mongo\n  - \n---\n\nmysql:\n\nnavicat \n\nhttps://blog.csdn.net/xuanjiewu/article/details/86152633\n\nmysqldump\n\n\n\neg: \n\n\n\neg:\n\nhttps://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples\n\nworkbench\n\nhttps://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html\n\nmongo:\n\nmongo toolshttps://docs.mongodb.com/database-tools/installation/installation/\n\nmongodump\n\neg:\n\n```\nmongodump -h <host:port> -d <db> -c <collection> -u <user> -p <password> -o <directory-path>\n```\n\nhttps://docs.mongodb.com/database-tools/mongodump/\n\nmongorestore\n\neg:\n\n```\nmongorestore -h <host:port> -d <db> -c <collection> -u <user> -p <password> --drop <input-path>\n```\n\nhttps://docs.mongodb.com/database-tools/mongorestore/\n\n","slug":"database/mysql-mongo-data-transfer","published":1,"updated":"2022-05-10T08:25:56.380Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4om0001xkloez7x4ysw","content":"<p>mysql:</p>\n<p>navicat </p>\n<p><a href=\"https://blog.csdn.net/xuanjiewu/article/details/86152633\">https://blog.csdn.net/xuanjiewu/article/details/86152633</a></p>\n<p>mysqldump</p>\n<p></p>\n<p>eg: </p>\n<p></p>\n<p>eg:</p>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples\">https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples</a></p>\n<p>workbench</p>\n<p><a href=\"https://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html\">https://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html</a></p>\n<p>mongo:</p>\n<p>mongo tools<a href=\"https://docs.mongodb.com/database-tools/installation/installation/\">https://docs.mongodb.com/database-tools/installation/installation/</a></p>\n<p>mongodump</p>\n<p>eg:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodump -h &lt;host:port&gt; -d &lt;db&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; -o &lt;directory-path&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.mongodb.com/database-tools/mongodump/\">https://docs.mongodb.com/database-tools/mongodump/</a></p>\n<p>mongorestore</p>\n<p>eg:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongorestore -h &lt;host:port&gt; -d &lt;db&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; --drop &lt;input-path&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.mongodb.com/database-tools/mongorestore/\">https://docs.mongodb.com/database-tools/mongorestore/</a></p>\n<p></p>\n","site":{"data":{}},"excerpt":"","more":"<p>mysql:</p>\n<p>navicat </p>\n<p><a href=\"https://blog.csdn.net/xuanjiewu/article/details/86152633\">https://blog.csdn.net/xuanjiewu/article/details/86152633</a></p>\n<p>mysqldump</p>\n<p></p>\n<p>eg: </p>\n<p></p>\n<p>eg:</p>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples\">https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html#mysqldump-option-examples</a></p>\n<p>workbench</p>\n<p><a href=\"https://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html\">https://dev.mysql.com/doc/workbench/en/wb-admin-export-import-management.html</a></p>\n<p>mongo:</p>\n<p>mongo tools<a href=\"https://docs.mongodb.com/database-tools/installation/installation/\">https://docs.mongodb.com/database-tools/installation/installation/</a></p>\n<p>mongodump</p>\n<p>eg:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodump -h &lt;host:port&gt; -d &lt;db&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; -o &lt;directory-path&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.mongodb.com/database-tools/mongodump/\">https://docs.mongodb.com/database-tools/mongodump/</a></p>\n<p>mongorestore</p>\n<p>eg:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongorestore -h &lt;host:port&gt; -d &lt;db&gt; -c &lt;collection&gt; -u &lt;user&gt; -p &lt;password&gt; --drop &lt;input-path&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://docs.mongodb.com/database-tools/mongorestore/\">https://docs.mongodb.com/database-tools/mongorestore/</a></p>\n<p></p>\n"},{"title":"docker","date":"2021-05-07T12:17:50.000Z","_content":"\n### 1.\n\n```shell\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n### 2.\n\n```shell\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n```\n\n### 3. Docker-CE\n\n-  Yum \n\n-  Docker-CE \n\n```shell\nsudo yum install docker-ce\n```\n\n### 4. Docker-CE\n```shell\nsudo systemctl enable dockersudo systemctl start docker\n```\n### 5.[] Docker \ndocker  Docker  UnixSocket  UnixSocket  root  docker  docker  docker \n-  Docker \n```shell\nsudo groupadd docker\n```\n-  docker \n```shell\nsudo usermod -aG docker $USER\n```\n- \n```shell\nsudo newgrp docker\n```\n\nhttps://www.cnblogs.com/myzony/p/9071210.html","source":"_posts/docker/docker-install.md","raw":"---\ntitle: docker\ndate: 2021-05-07 20:17:50\ncategories: \n  - docker\ntags:\n  - docker\n  - docker install\n---\n\n### 1.\n\n```shell\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n```\n\n### 2.\n\n```shell\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n```\n\n### 3. Docker-CE\n\n-  Yum \n\n-  Docker-CE \n\n```shell\nsudo yum install docker-ce\n```\n\n### 4. Docker-CE\n```shell\nsudo systemctl enable dockersudo systemctl start docker\n```\n### 5.[] Docker \ndocker  Docker  UnixSocket  UnixSocket  root  docker  docker  docker \n-  Docker \n```shell\nsudo groupadd docker\n```\n-  docker \n```shell\nsudo usermod -aG docker $USER\n```\n- \n```shell\nsudo newgrp docker\n```\n\nhttps://www.cnblogs.com/myzony/p/9071210.html","slug":"docker/docker-install","published":1,"updated":"2022-05-10T08:25:56.384Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4oo0003xklo40l2eflq","content":"<h3 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1.\"></a>1.</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2.\"></a>2.</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3--Docker-CE\"><a href=\"#3--Docker-CE\" class=\"headerlink\" title=\"3. Docker-CE\"></a>3. Docker-CE</h3><ul>\n<li><p> Yum </p>\n</li>\n<li><p> Docker-CE </p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4--Docker-CE\"><a href=\"#4--Docker-CE\" class=\"headerlink\" title=\"4. Docker-CE\"></a>4. Docker-CE</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl enable dockersudo systemctl start docker</span><br></pre></td></tr></table></figure>\n<h3 id=\"5---Docker-\"><a href=\"#5---Docker-\" class=\"headerlink\" title=\"5.[] Docker \"></a>5.[] Docker </h3><p>docker  Docker  UnixSocket  UnixSocket  root  docker  docker  docker </p>\n<ul>\n<li> Docker <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd docker</span><br></pre></td></tr></table></figure></li>\n<li> docker <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo newgrp docker</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><a href=\"https://www.cnblogs.com/myzony/p/9071210.html\">https://www.cnblogs.com/myzony/p/9071210.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1.\"></a>1.</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-\"><a href=\"#2-\" class=\"headerlink\" title=\"2.\"></a>2.</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3--Docker-CE\"><a href=\"#3--Docker-CE\" class=\"headerlink\" title=\"3. Docker-CE\"></a>3. Docker-CE</h3><ul>\n<li><p> Yum </p>\n</li>\n<li><p> Docker-CE </p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4--Docker-CE\"><a href=\"#4--Docker-CE\" class=\"headerlink\" title=\"4. Docker-CE\"></a>4. Docker-CE</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl enable dockersudo systemctl start docker</span><br></pre></td></tr></table></figure>\n<h3 id=\"5---Docker-\"><a href=\"#5---Docker-\" class=\"headerlink\" title=\"5.[] Docker \"></a>5.[] Docker </h3><p>docker  Docker  UnixSocket  UnixSocket  root  docker  docker  docker </p>\n<ul>\n<li> Docker <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd docker</span><br></pre></td></tr></table></figure></li>\n<li> docker <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo newgrp docker</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><a href=\"https://www.cnblogs.com/myzony/p/9071210.html\">https://www.cnblogs.com/myzony/p/9071210.html</a></p>\n"},{"title":"docker","date":"2021-05-07T12:17:41.000Z","_content":"\n1. [docker install](../docker-install)\n2. [Dockerfile](../../08/dockerFile)\n3. [docker swarm](../docker-swarm)\n\n","source":"_posts/docker/docker-base.md","raw":"---\ntitle: docker\ndate: 2021-05-07 20:17:41\ncategories:\n  - docker\ntags:\n  - docker\n---\n\n1. [docker install](../docker-install)\n2. [Dockerfile](../../08/dockerFile)\n3. [docker swarm](../docker-swarm)\n\n","slug":"docker/docker-base","published":1,"updated":"2022-05-10T08:25:56.384Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4or0007xklo2zwt48fc","content":"<ol>\n<li><a href=\"../docker-install\">docker install</a></li>\n<li><a href=\"../../08/dockerFile\">Dockerfile</a></li>\n<li><a href=\"../docker-swarm\">docker swarm</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><a href=\"../docker-install\">docker install</a></li>\n<li><a href=\"../../08/dockerFile\">Dockerfile</a></li>\n<li><a href=\"../docker-swarm\">docker swarm</a></li>\n</ol>\n"},{"title":"DockerDocker Swarm","date":"2021-05-07T12:17:32.000Z","typora-root-url":"..","_content":"\n## Docker Swarm\n\n![img](/images/docker-swarm/docker-swarm-1.png)\n\nSwarmDockerdockerGOhttps://github.com/docker/swarm DockerSwarmDocker APIDocker\n\nClient(compose,docker-py)SwarmDockerSwarmSwarmSwarmDocker\n\nDocker Swarm  Docker Compose  Docker Docker Compose  Docker Swarm  Docker Swarm \n\n Docker 1.12.0 Docker Swarm  Docker docker swarm Etcd  Consul \n\nSwarm deamon(Scheduler)(router),SwarmDockerSwarmSwarm\n\n## Docker Swarm \n\n![img](/images/docker-swarm/docker-swarm-2.png)\n\n Docker ClientSwarm (Cluster)\n\nSwarmmaster-slavemanagermanagernodeagentmanagerRaftmanagerDNS\n\n## .Swarm\n\n```\n1.Swarm\ndockerSwarmKitdockerswarmswarm\n \n2.Node\ndockerDockerDocker\nswarm  \nManagerManager\n\n \n3.Service\n\n \n4.Task\ndocekrManagerworker\n \n-------------------------------------------------------------------------------\ndocker swarminit, join, leave, updatedocker swarm --help\ndocker servicecreate, inspect, update, remove, tasksdocker service--help\ndocker nodeaccept, promote, demote, inspect, update, tasks, ls, rmdocker node --help\n   \nnodeswarmdockernodenode\nmanager nodes\nworker nodes\n \n1manager nodeleader\n2worker nodetask\n3service\n   serviceworker nodestaskservicedocker \n4tasktaskservicetaskdocker\n```\n\n## Swarm\n\n1. Node\n\n![img](/images/docker-swarm/docker-swarm-3.png)\n\n2. Service\n\n![img](/images/docker-swarm/docker-swarm-4.png)\n\n3. \n\n![img](/images/docker-swarm/docker-swarm-5.png)\n\n4. \n\n![img](/images/docker-swarm/docker-swarm-6.png)\n\n \n\n## Swarm\n\n```\nSwarm(scheduler)leaderspread, binpack, random.\n1Random\nNodespreadbinpackCPU, RAM\n\n  \n2Spread\nSpreadbinpack\nSpread\n  \n3Binpack\nBinpackbinpack\n\n```\n\n## Swarm Cluster\n\n```\n1\noverlay\n   \n2\ncluster--replicas n\nload balance\ndocker serviceCluster\n\n   \n3\nSwarm Clusterscale\n\n   \nrunrun\n\"--replicas n\"\"--mode=global\"\n  \n--replicas n\n--replicas 3\n  \n--mode=global\n--mode global Swarm  7  Docker \n   \n4. \nclusterserver\nconstraintswarm cluster \n   \n------------------Swarm cluster----------------------\n1Docker\n2scheduler\n3API\n   \nclusterdocker service\n   \ndocker swarmtask\"docker service ls\" \"docker service ps + taskID\"\n\n```\n\n## Dcoker Swarm \n\n\n\n(centos)\n\nIP192.168.31.43 manager43 swarm manager\n\nIP192.168.31.188 node188 swarm node\n\nIP192.168.31.139 node139 swarm node\n\n1\n\n```\n1) \n# 192.168.31.43  \n[root@manager43 ~]# hostnamectl set-hostname manager43\n \n# 192.168.31.188 \n[root@node188 ~]# hostnamectl set-hostname node188\n \n# 192.168.31.139 \n[root@node139 ~]# hostnamectl set-hostname node139\n \n2)hosts()\n[root@manager43 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n \n192.168.31.43 manager43\n192.168.31.188 node188\n192.168.31.139 node139\n \n# scpnode\n[root@manager43 ~]# scp /etc/hosts root@192.168.31.188:/etc/hosts\n[root@manager43 ~]# scp /etc/hosts root@192.168.31.139:/etc/hosts\n \n3) \n2377/tcp7946/udp4789/udpoverlay \n[root@manager43 ~]# systemctl disable firewalld.service\n[root@manager43 ~]# systemctl stop firewalld.service\n \n4) docker(...)\n[root@manager43 ~]# yum -y install docker\n[root@node188 ~]# yum -y install docker\n[root@node139 ~]# yum -y install docker\n```\n\ndocker[docker](https://www.cnblogs.com/zhujingzhi/p/9656298.html)\n\n:[docker](https://www.cnblogs.com/brianzhu/p/8565411.html)\n\n2Swarm\n\n```\n1) Swarm\n[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43\nSwarm initialized: current node (z2n633mty5py7u9wyl423qnq0) is now a manager.\n \nTo add a worker to this swarm, run the following command:\n \n    # (tokentoken)\n    docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377  \n \nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n \nswarmtoken tokentoken\n--advertise-addrswarmworkeripmanager\n \n\n# \n[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43\nError response from daemon: This node is already part of a swarm. Use \"docker swarm leave\" to leave this swarm and join another one.\n# \n[root@manager43 ~]# docker swarm leave -f\nleave-fOK\n \n2) \n[root@manager43 ~]# docker info\n Swarm\n \n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\n(node ID*)\n \n3) Swarm\nSwarm\n \n# 192.168.31.188 \n[root@node188 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377\nThis node joined a swarm as a worker.\n \n# 192.168.31.139 \n[root@node139 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377\nThis node joined a swarm as a worker.\n \nswarm\n \nmanager43\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n \n--------------------------------------------------------------------------------------------------------------------\navailablity\nswarmnodeavailability activedrain\nactivenodemanager\ndrainnodetaskmanager\n[root@manager43 ~]# docker node update --availability drain node139               # node139node139\"docker node rm --force node139\"\nnode139\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Drain                                   18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n \nnode1draintask\nactive\n[root@manager43 ~]# docker node update --availability active node139\nnode139\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n```\n\n3Swarm(nginx)\n\n```\nDocker 1.12Scalinghealth checkdnsvipservice\n1) \n# \n[root@manager43 ~]# docker network create -d overlay nginx_net\na52jy33asc5o0ts0rq823bf0m\n[root@manager43 ~]# docker network ls | grep nginx_net\na52jy33asc5o        nginx_net           overlay             swarm\n \n# \n[root@manager43 ~]# docker service create --replicas 1 --network nginx_net --name my_nginx -p 80:80 nginx    # --replicas 1 nginxnginx\nolexfmtdf94sxyeetkchwhehg\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nmanager-nodenginx\n--replicas \nnginxtomcattomcat\n \n#  docker service ls \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nolexfmtdf94s        my_nginx            replicated          1/1                 nginx:latest        *:80->80/tcp\n \n2) Swarm\n-pretty  --pretty \n[root@manager43 ~]# docker service inspect --pretty my_nginx\nID:             zs7fw4ereo5w7ohd4n9ii06nt\nName:           my_nginx\nService Mode:   Replicated\n Replicas:      1\nPlacement:\nUpdateConfig:\n Parallelism:   1\n On failure:    pause\n Monitoring Period: 5s\n Max failure ratio: 0\n Update order:      stop-first\nRollbackConfig:\n Parallelism:   1\n On failure:    pause\n Monitoring Period: 5s\n Max failure ratio: 0\n Rollback order:    stop-first\nContainerSpec:\n Image:         nginx:latest@sha256:b73f527d86e3461fd652f62cf47e7b375196063bbbd503e853af5be16597cb2e\n Init:          false\nResources:\nNetworks: nginx_net\nEndpoint Mode:  vip\nPorts:\n PublishedPort = 80\n  Protocol = tcp\n  TargetPort = 80\n  PublishMode = ingress\n \n# manager-nodehttp://192.168.31.43\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      \n STATE  Preparing Running \n \nmanager-nodenginx\n[root@manager43 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n0dc7103f8030        nginx:latest        \"nginx -g 'daemon of\"   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj\n \n3) Swarm(scale)\nserviceswarmServicekubernetes docker service scale \nmy_nginx4\n[root@manager43 ~]# docker service scale my_nginx=4\nmy_nginx scaled to 4\noverall progress: 4 out of 4 tasks\n1/4: running   [==================================================>]\n2/4: running   [==================================================>]\n3/4: running   [==================================================>]\n4/4: running   [==================================================>]\nverify: Service converged\n \nscale nginx \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      \nmlprstt9ds5x        my_nginx.2          nginx:latest        node139             Running             Running 52 seconds ago                         \ny09lk90tdzdp        my_nginx.3          nginx:latest        node139             Running             Running 52 seconds ago                         \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 2 minutes ago  \n \nmy_nginxmanager-node3\n4my_nginxmy_nginx\n \n \n4) node\n\nswarmDocker\n    \n\nnode139node139dockertasknode139task\ntask\"docker node ls\"node139swarm(Down)\n[root@node139 ~]# systemctl stop docker\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\nppk7q0bjond8a58xja7in1qid *   manager43           Ready               Active              Leader              18.06.0-ce\nmums8azgbrffnecp3q8fz70pl     node139             Down                Active                                  18.06.1-ce\nz3n36maf03yjg7odghikuv574     node188             Ready               Active                                  18.06.1-ce\n    \n\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                       \nwb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Running             Running about a minute ago                      \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 4 minutes ago                           \nrhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Running             Running about a minute ago                      \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 4 minutes ago                           \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 6 minutes ago\n \nnode139tasknode188manager43\n \nnode188manager43task192.168.31.188192.168.31.4380swarm\n[root@manager43 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\nae4c5c2e6f3f        nginx:latest        \"nginx -g 'daemon of\"   4 minutes ago       Up 4 minutes        80/tcp              my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\n0dc7103f8030        nginx:latest        \"nginx -g 'daemon of\"   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj\n \n[root@node188 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\na63ef253f7dd        nginx:latest        \"nginx -g 'daemon of\"   3 minutes ago       Up 3 minutes        80/tcp              my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n74a1a1db81d4        nginx:latest        \"nginx -g 'daemon of\"   8 minutes ago       Up 8 minutes        80/tcp              my_nginx.4.clolfl3zlvj0ewmh85c2ljnza\n \nnode188manager43node139task\n[root@manager43 ~]# docker stop my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\nmy_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\n \n[root@node188 ~]# docker stop my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\nmy_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n \ntasknode139\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 2 hours ago                          \nj2q61f8jtzba        my_nginx.2          nginx:latest        node188             Running             Running 24 seconds ago                       \nwb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 29 seconds ago                      \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 11 minutes ago                       \noz9wyjuldw1t        my_nginx.3          nginx:latest        manager43           Running             Running 40 seconds ago                       \nrhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 45 seconds ago                      \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 11 minutes ago                       \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 12 minutes ago    \nswarm clusterworker nodeworker node\n \n \n5) Swarm (scale)\nswarmscale\nmy_nginx1\n[root@manager43 ~]# docker service scale my_nginx=1\nmy_nginx scaled to 1\noverall progress: 1 out of 1 tasks\n1/1:  \nverify: Service converged\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          1/1                 nginx:latest        *:80->80/tcp\n \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                         \nwb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Shutdown            Complete 9 hours ago                         \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago                      \nrhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Shutdown            Complete 9 hours ago                         \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago      \n \ndocker service ps my_nginx nodeShutdown\n \nnode\n[root@node188 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\nf93c0a27374a        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 44 seconds ago                       my_nginx.2.j2q61f8jtzba9kb3unupkhl25\na63ef253f7dd        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                          my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n[root@node139 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS               NAMES\ne8ac2e44f5c4        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                       my_nginx.2.mlprstt9ds5xi48u1rzscgfdk\n5b031aa5a2cc        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                       my_nginx.3.y09lk90tdzdp8cwj6mm5oyr3f\nnodedocker ps -a stoprm\n \n6) scaledocker service update      /\n[root@manager43 ~]# docker service update --replicas 3 my_nginx\nmy_nginx\noverall progress: 3 out of 3 tasks\n1/3: running   [==================================================>]\n2/3: running   [==================================================>]\n3/3: running   [==================================================>]\nverify: Service converged\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:latest        *:80->80/tcp\n \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                        \nj3hduzd9pret        my_nginx.2          nginx:latest        node188             Running             Running 18 seconds ago                      \nwb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 9 hours ago                        \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago                      \ngng96vc5vqpv        my_nginx.3          nginx:latest        node139             Running             Running 18 seconds ago                      \nrhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 9 hours ago                        \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago    \n \ndocker service update   \n[root@manager43 ~]# docker service update --image nginx:new my_nginx\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:new           *:80->80/tcp\nIMAGE nginx:new\n \n \n7) my_nginx\n[root@manager43 ~]# docker service rm my_nginx\n \ntask\n```\n\n4SwarmVolume(mount)\n\n```\n1) volume\n[root@manager43 ~]# docker volume --help\n \nUsage:  docker volume COMMAND\n \nManage volumes\n \nCommands:\n  create      Create a volume\n  inspect     Display detailed information on one or more volumes\n  ls          List volumes\n  prune       Remove all unused local volumes\n  rm          Remove one or more volumes\n \nRun 'docker volume COMMAND --help' for more information on a command.\n \n2) volume\n[root@manager43 ~]# docker volume create --name testvolume\ntestvolume\n \n# volume\n[root@manager43 ~]# docker volume ls\nDRIVER              VOLUME NAME\nlocal               testvolume\n \n# volume\n[root@manager43 ~]# docker volume inspect testvolume\n[\n    {\n        \"CreatedAt\": \"2018-10-21T10:50:02+08:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {},\n        \"Mountpoint\": \"/var/lib/docker/volumes/testvolume/_data\",\n        \"Name\": \"testvolume\",\n        \"Options\": {},\n        \"Scope\": \"local\"\n    }\n]\n \n \n3) testvolume(nginx)\n[root@manager43 ~]# docker service create --replicas 3 --mount type=volume,src=testvolume,dst=/zjz --name test_nginx nginx\nsh7wc8yzcvr0xaedo4tnraj7l\noverall progress: 3 out of 3 tasks\n1/3: running   [==================================================>]\n2/3: running   [==================================================>]\n3/3: running   [==================================================>]\nverify: Service converged\n \n\nsrcsourcedsttarget\n \n# \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nsh7wc8yzcvr0        test_nginx          replicated          3/3                 nginx:latest       \n[root@manager43 ~]# docker service ps test_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nm7m41kwt4q6w        test_nginx.1        nginx:latest        node188             Running             Running 56 seconds ago                      \nkayh81q1o1kx        test_nginx.2        nginx:latest        node139             Running             Running 56 seconds ago                      \neq11v0rcwy38        test_nginx.3        nginx:latest        manager43           Running             Running 56 seconds ago           \n \n# ()\n# \n[root@manager43 ~]# docker exec -it 63451219cb4e /bin/bash\nroot@63451219cb4e:/# cd /zjz/\nroot@63451219cb4e:/zjz# ls\nroot@63451219cb4e:/zjz# echo \"gen wo xue docker\" > docker.txt\nroot@63451219cb4e:/zjz# ls\ndocker.txt\n \ndocker volume inspect testvolume ()\n/var/lib/docker/volumes/testvolume/_data\n[root@manager43 ~]# cd /var/lib/docker/volumes/testvolume/_data\n[root@manager43 _data]# ls\ndocker.txt\n[root@manager43 _data]# cat docker.txt\ngen wo xue docker\n \nnodevolume\n[root@manager43 _data]# ln -s /var/lib/docker/volumes/testvolume/_data /zjz\n[root@manager43 _data]# cd /zjz/\n[root@manager43 zjz]# ls\ndocker.txt\n[root@manager43 zjz]# echo \"123\" > 1.txt  \n[root@manager43 zjz]# ll\n 8\n-rw-r--r-- 1 root root  4 10 21 11:04 1.txt\n-rw-r--r-- 1 root root 18 10 21 11:00 docker.txt\n \n# \n[root@manager43 zjz]# docker exec -it 63451219cb4e /bin/bash\nroot@63451219cb4e:/# cd /zjz/\nroot@63451219cb4e:/zjz# ls\n1.txt  docker.txt\nroot@63451219cb4e:/zjz# cat 1.txt\n123\nroot@63451219cb4e:/zjz# cat docker.txt\ngen wo xue docker\n \n# \n\ndocker service create --mount type=bind,target=/container_data/,source=/host_data/\ntargetsource\n \n# \n[root@manager43 ~]# docker service create --replicas 1 --mount type=bind,target=/usr/share/nginx/html/,source=/opt/web/ --network nginx_net --name zjz_nginx -p 8880:80 nginx\n```\n\n5Swarm\n\nnginx\ndocker compose docker-compose.ymlcomposeswarm([docker compose](https://www.cnblogs.com/zhujingzhi/p/9786622.html))\n\n```\n\n(nginxvisualizerportainer)  GUI \ndocker servicedocker stack\n \n1) docker-compose.yml\n[root@manager43 ~]# mkdir testswarm\n[root@manager43 ~]# cd testswarm/\n[root@manager43 testswarm]# cat docker-compose.yml\nversion: \"3\"\nservices:\n  nginx:\n    image: nginx\n    ports:\n      - 8888:80\n    deploy:\n      mode: replicated\n      replocas: 3\n \n  visualizer:\n    image: dockersamples/visualizer\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n    deploy:\n      replicas: 1\n      placement:\n        constraints: [node.role == manager]\n \n  portainer:\n    image: portainer/portainer\n    ports:\n      - \"9000:9000\"\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n    deploy:\n      replicas: 1\n      placement:\n        constraints: [node.role == manager]\n \n2) yml\n[root@manager43 testswarm]# docker stack deploy -c docker-compose.yml deploy_deamon\nCreating network deploy_deamon_default\nCreating service deploy_deamon_portainer\nCreating service deploy_deamon_nginx\nCreating service deploy_deamon_visualizer\n \n\n \n# \n[root@manager43 testswarm]# docker service ls\nID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS\nxj2f1t5ax3nm        deploy_deamon_nginx        replicated          3/3                 nginx:latest                      *:8888->80/tcp\nky9qpldr5abb        deploy_deamon_portainer    replicated          1/1                 portainer/portainer:latest        *:9000->9000/tcp\nr47ff177x1ir        deploy_deamon_visualizer   replicated          1/1                 dockersamples/visualizer:latest   *:8080->8080/tcp\n \n[root@manager43 testswarm]# docker service ps deploy_deamon_nginx\nID                  NAME                    IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nz3v4uc1ujsnq        deploy_deamon_nginx.1   nginx:latest        node139             Running             Running about a minute ago                      \njhg3ups0cko5        deploy_deamon_nginx.2   nginx:latest        manager43           Running             Running about a minute ago                      \n3e6guv791x21        deploy_deamon_nginx.3   nginx:latest        node188             Running             Running about a minute ago        \n \n[root@manager43 testswarm]# docker service ps deploy_deamon_portainer\nID                  NAME                        IMAGE                        NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nwhyuvy82cvvw        deploy_deamon_portainer.1   portainer/portainer:latest   manager43           Running             Running about a minute ago                      \n \n[root@manager43 testswarm]# docker service ps deploy_deamon_visualizer\nID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nwge5w1eqykg3        deploy_deamon_visualizer.1   dockersamples/visualizer:latest   manager43           Running             Starting 7 seconds ago                     \n```\n\n\n\n![img](/images/docker-swarm/docker-swarm-7.png)\n\n![img](/images/docker-swarm/docker-swarm-8.png)\n\n![img](/images/docker-swarm/docker-swarm-9.png)\n\n![img](/images/docker-swarm/docker-swarm-10.png)\n\n![img](/images/docker-swarm/docker-swarm-11.png)\n\n## Docker Swarm \n\n```\nDocker1.12swarm(overlay networks)\nping\n   \nswarm\n1\n2service discoveryswarmIP(vip)DNS\n3DNSVIP\n4swarmswarmswarm\n5TCP/UDP7946  \n6UDP4789  \n   \n\n-----------Swarmoverlay------------\n[root@manager-node ~]# docker network create --driver overlay --opt encrypted --subnet 10.10.19.0/24 ngx_net\n   \n\nopt encrypted  swarmopt encryptedvxlan\n--subnet overlayswarm\n   \n[root@manager-node ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nd7aa48d3e485        bridge              bridge              local            \n9e637a97a3b9        docker_gwbridge     bridge              local            \nb5a41c8c71e7        host                host                local            \n7f4fx3jf4dbr        ingress             overlay             swarm            \n3x2wgugr6zmn        ngx_net             overlay             swarm            \n0808a5c72a0a        none                null                local\n   \nSwarm2\"ngx_net\"\"ingress\"\nSwarm  ingress \nmanagerSCOPE swarm Swarm\nSwarmworkerworkerswarm\nworker\n   \n------------------overlay-------------------\n[root@manager-node ~]# docker service create --replicas 5 --network ngx_net --name my-test -p 80:80 nginx\n   \n\"my-test\"3taskoverlaySwarmRunning\n[root@manager-node ~]# docker service ls\nID            NAME     REPLICAS  IMAGE  COMMAND\ndsaxs6v463g9  my-test  5/5       nginx\n   \nmanager-noderunning\n[root@manager-node ~]# docker service ps my-test\nID                         NAME       IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR\n8433fuiy7vpu0p80arl7vggfe  my-test.1  nginx  node2         Running        Running 2 minutes ago\nf1h7a0vtojv18zrsiw8j0rzaw  my-test.2  nginx  node1         Running        Running 2 minutes ago\nex73ifk3jvzw8ukurl8yu7fyq  my-test.3  nginx  node1         Running        Running 2 minutes ago\ncyu73jd8psupfhken23vvmpud  my-test.4  nginx  manager-node  Running        Running 2 minutes ago\nbtorxekfix4hcqh4v83dr0tzw  my-test.5  nginx  manager-node  Running        Running 2 minutes ago\n   \nrunningmy-network\n   \nmy-network\n[root@manager-node ~]# docker network inspect ngx_net\n[\n    {\n        \"Name\": \"ngx_net\",\n        \"Id\": \"3x2wgugr6zmn1mcyf9k1du27p\",\n        \"Scope\": \"swarm\",\n        \"Driver\": \"overlay\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": null,\n            \"Config\": [\n                {\n                    \"Subnet\": \"10.10.19.0/24\",\n                    \"Gateway\": \"10.10.19.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Containers\": {\n            \"00f47e38deea76269eb03ba13695ec0b0c740601c85019546d6a9a17fd434663\": {\n                \"Name\": \"my-test.5.btorxekfix4hcqh4v83dr0tzw\",\n                \"EndpointID\": \"ea962d07eee150b263ae631b8a7f8c1950337c11ef2c3d488a7c3717defd8601\",\n                \"MacAddress\": \"02:42:0a:0a:13:03\",\n                \"IPv4Address\": \"10.10.19.3/24\",\n                \"IPv6Address\": \"\"\n            },\n            \"957620c6f7abb44ad8dd2d842d333f5e5c1655034dc43e49abbbd680de3a5341\": {\n                \"Name\": \"my-test.4.cyu73jd8psupfhken23vvmpud\",\n                \"EndpointID\": \"f33a6e9ddf1dd01bcfc43ffefd19e19514658f001cdf9b2fbe23bc3fdf56a42a\",\n                \"MacAddress\": \"02:42:0a:0a:13:07\",\n                \"IPv4Address\": \"10.10.19.7/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n        \"Options\": {\n            \"com.docker.network.driver.overlay.vxlanid_list\": \"257\"\n        },\n        \"Labels\": {}\n    }\n]\n   \nmanager-nodemy-testmy-test.5.btorxekfix4hcqh4v83dr0tzw\nmy-test.4.cyu73jd8psupfhken23vvmpudtaskngx_netnode1node2\n[root@node1 ~]# docker network inspect ngx_net\n.......\n        \"Containers\": {\n            \"7d9986fad5a7d834676ba76ae75aff2258f840953f1dc633c3ef3c0efd2b2501\": {\n                \"Name\": \"my-test.3.ex73ifk3jvzw8ukurl8yu7fyq\",\n                \"EndpointID\": \"957ca19f3d5480762dbd14fd9a6a1cd01a8deac3e8e35b23d1350f480a7b2f37\",\n                \"MacAddress\": \"02:42:0a:0a:13:06\",\n                \"IPv4Address\": \"10.10.19.6/24\",\n                \"IPv6Address\": \"\"\n            },\n            \"9e50fceada1d7c653a886ca29d2bf2606debafe8c8a97f2d79104faf3ecf8a46\": {\n                \"Name\": \"my-test.2.f1h7a0vtojv18zrsiw8j0rzaw\",\n                \"EndpointID\": \"b1c209c7b68634e88e0bf5e100fe03435b3096054da6555c61e6c207ac651ac2\",\n                \"MacAddress\": \"02:42:0a:0a:13:05\",\n                \"IPv4Address\": \"10.10.19.5/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n.........\n  \n[root@node2 web]# docker network inspect ngx_net\n........\n        \"Containers\": {\n            \"4bdcce0ee63edc08d943cf4a049eac027719ff2dc14b7c3aa85fdddc5d1da968\": {\n                \"Name\": \"my-test.1.8433fuiy7vpu0p80arl7vggfe\",\n                \"EndpointID\": \"df58de85b0a0e4d128bf332fc783f6528d1f179b0f9f3b7aa70ebc832640d3bc\",\n                \"MacAddress\": \"02:42:0a:0a:13:04\",\n                \"IPv4Address\": \"10.10.19.4/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n   \nIP\n[root@manager-node ~]# docker service inspect --format='{{json .Endpoint.VirtualIPs}}' my-test\n[{\"NetworkID\":\"7f4fx3jf4dbrp97aioc05pul4\",\"Addr\":\"10.255.0.6/16\"},{\"NetworkID\":\"3x2wgugr6zmn1mcyf9k1du27p\",\"Addr\":\"10.10.19.2/24\"}]\n   \n10.10.19.2swarmvip\n```\n\n![img](/images/docker-swarm/docker-swarm-12.png)\n\nngx_netIP\n\n```\n[root@node2 ~]# docker ps\nCONTAINER ID    IMAGE           COMMAND                  CREATED         STATUS             PORTS    NAMES\n4bdcce0ee63e    nginx:latest    \"nginx -g 'daemon off\"   22 minutes ago  Up 22 minutes      80/tcp   my-test.1.8433fuiy7vpu0p80arl7vggfe\n  \n[root@node2 ~]# docker exec -ti 4bdcce0ee63e /bin/bash\nroot@4bdcce0ee63e:/# ip addr                                                                                          \n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n1786: eth0@if1787: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:ff:00:08 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.255.0.8/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 10.255.0.6/32 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:feff:8/64 scope link\n       valid_lft forever preferred_lft forever\n1788: eth1@if1789: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet 172.18.0.3/16 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe12:3/64 scope link\n       valid_lft forever preferred_lft forever\n1791: eth2@if1792: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:0a:13:04 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n    inet 10.10.19.4/24 scope global eth2\n       valid_lft forever preferred_lft forever\n    inet 10.10.19.2/32 scope global eth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe0a:1304/64 scope link\n       valid_lft forever preferred_lft forever\n  \nroot@4bdcce0ee63e:/# ping 10.10.19.3\nPING 10.10.19.3 (10.10.19.3): 56 data bytes\n64 bytes from 10.10.19.3: icmp_seq=0 ttl=64 time=0.890 ms\n64 bytes from 10.10.19.3: icmp_seq=1 ttl=64 time=0.622 ms\n.....-\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.622/0.756/0.890/0.134 ms\n  \nroot@4bdcce0ee63e:/# ping 10.10.19.6\nPING 10.10.19.6 (10.10.19.6): 56 data bytes\n64 bytes from 10.10.19.6: icmp_seq=0 ttl=64 time=0.939 ms\n64 bytes from 10.10.19.6: icmp_seq=1 ttl=64 time=0.590 ms\n  \n----------------------------swarm--------------------------\nswarmVIPVIPDNSDNS\n\n  \noverlaySwarmVIP\nactivetask\n  \n\ncentosmy-testnginx\n[root@manager-node ~]# docker service create --name my-centos --network ngx_net centos       \n  \ncentoscentos\n[root@manager-node ~]# docker service ps my-centos\nID                         NAME             IMAGE   NODE   DESIRED STATE  CURRENT STATE            ERROR\ne03pqgkjs3l1qizc6v4aqaune  my-centos.1      centos  node2  Running        Preparing 4 seconds ago\n  \ncentosnode2centosshell\n[root@node2 ~]# docker ps\nCONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS            NAMES\ne4554490d891        centos:latest            \"/bin/bash\"             About an hour ago   Up About an hour   my-centos.1.9yk5ie28gwk9mw1h1jovb68ki\n  \n[root@node2 ~]# docker exec -ti my-centos.1.9yk5ie28gwk9mw1h1jovb68ki /bin/bash\nroot@4bdcce0ee63e:/# nslookup my-test\nServer: 127.0.0.11\nAddress 1: 127.0.0.11\n  \nName: my-test\nAddress 1: 10.10.19.2 10.10.19.2\n  \n  \ncentos DNSmy-testIP\nroot@4bdcce0ee63e:/# nslookup tasks.my-test\nServer: 127.0.0.11\nAddress 1: 127.0.0.11\n  \nName: tasks.my-test\nAddress 1: 10.10.19.4 my-test.1.8433fuiy7vpu0p80arl7vggfe\nAddress 2: 10.10.19.5 my-test.2.f1h7a0vtojv18zrsiw8j0rzaw\nAddress 3: 10.10.19.6 my-test.3.ex73ifk3jvzw8ukurl8yu7fyq\nAddress 2: 10.10.19.7 my-test.4.cyu73jd8psupfhken23vvmpud\nAddress 3: 10.10.19.3 my-test.5.btorxekfix4hcqh4v83dr0tzw\n  \ncentoswgetmy-testnginx\nroot@4bdcce0ee63e:/# wget -O- my-test     \nConnecting to my-test (10.10.19.2:80)\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n  \nSwarmHTTPVIPactivetaskround-robinactivetask\n  \n-----------------------------------DNS round-robin-----------------------------\nDNS round-robinVIP --endpoint-mode dnsrr \n\n  \nDNS round-robin-p\n[root@manager-node ~]# docker service create --replicas 3 --name my-dnsrr-nginx --network ngx_net --endpoint-mode dnsrr nginx\n  \n[root@manager-node ~]# docker service ps my-dnsrr-nginx\nID                         NAME              IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR\n65li2zbhxvvoaesndmwjokouj  my-dnsrr-nginx.1  nginx  node1         Running        Running 2 minutes ago\n5hjw7wm4xr877879m0ewjciuj  my-dnsrr-nginx.2  nginx  manager-node  Running        Running 2 minutes ago\nafo7acduge2qfy60e87liz557  my-dnsrr-nginx.3  nginx  manager-node  Running        Running 2 minutes ago\n  \n  \nDNSDNSIP\nroot@4bdcce0ee63e:/# nslookup my-dnsrr-nginx\nServer:    127.0.0.11\nAddress 1: 127.0.0.11\n  \nName:      my-dnsrr-nginx\nAddress 1: 10.10.19.10 my-dnsrr-nginx.3.0sm1n9o8hygzarv5t5eq46okn.my-network\nAddress 2: 10.10.19.9  my-dnsrr-nginx.2.b3o1uoa8m003b2kk0ytl9lawh.my-network\nAddress 3: 10.10.19.8  my-dnsrr-nginx.1.55za4c83jq9846rle6eigiq15.my-network\n  \nVIP\nDockerdignslookupDNSDNSVIPIPpingVIP\n```\n\n\n\n[https://www.cnblogs.com/zhujingzhi/p/9792432.html](https://www.cnblogs.com/zhujingzhi/p/9792432.html)","source":"_posts/docker/docker-swarm.md","raw":"---\ntitle: DockerDocker Swarm\ndate: 2021-05-07 20:17:32\ncategories:\n  - docker\ntags:\n  - docker\n  - docker swarm\n  - docker \ntypora-root-url: ..\n---\n\n## Docker Swarm\n\n![img](/images/docker-swarm/docker-swarm-1.png)\n\nSwarmDockerdockerGOhttps://github.com/docker/swarm DockerSwarmDocker APIDocker\n\nClient(compose,docker-py)SwarmDockerSwarmSwarmSwarmDocker\n\nDocker Swarm  Docker Compose  Docker Docker Compose  Docker Swarm  Docker Swarm \n\n Docker 1.12.0 Docker Swarm  Docker docker swarm Etcd  Consul \n\nSwarm deamon(Scheduler)(router),SwarmDockerSwarmSwarm\n\n## Docker Swarm \n\n![img](/images/docker-swarm/docker-swarm-2.png)\n\n Docker ClientSwarm (Cluster)\n\nSwarmmaster-slavemanagermanagernodeagentmanagerRaftmanagerDNS\n\n## .Swarm\n\n```\n1.Swarm\ndockerSwarmKitdockerswarmswarm\n \n2.Node\ndockerDockerDocker\nswarm  \nManagerManager\n\n \n3.Service\n\n \n4.Task\ndocekrManagerworker\n \n-------------------------------------------------------------------------------\ndocker swarminit, join, leave, updatedocker swarm --help\ndocker servicecreate, inspect, update, remove, tasksdocker service--help\ndocker nodeaccept, promote, demote, inspect, update, tasks, ls, rmdocker node --help\n   \nnodeswarmdockernodenode\nmanager nodes\nworker nodes\n \n1manager nodeleader\n2worker nodetask\n3service\n   serviceworker nodestaskservicedocker \n4tasktaskservicetaskdocker\n```\n\n## Swarm\n\n1. Node\n\n![img](/images/docker-swarm/docker-swarm-3.png)\n\n2. Service\n\n![img](/images/docker-swarm/docker-swarm-4.png)\n\n3. \n\n![img](/images/docker-swarm/docker-swarm-5.png)\n\n4. \n\n![img](/images/docker-swarm/docker-swarm-6.png)\n\n \n\n## Swarm\n\n```\nSwarm(scheduler)leaderspread, binpack, random.\n1Random\nNodespreadbinpackCPU, RAM\n\n  \n2Spread\nSpreadbinpack\nSpread\n  \n3Binpack\nBinpackbinpack\n\n```\n\n## Swarm Cluster\n\n```\n1\noverlay\n   \n2\ncluster--replicas n\nload balance\ndocker serviceCluster\n\n   \n3\nSwarm Clusterscale\n\n   \nrunrun\n\"--replicas n\"\"--mode=global\"\n  \n--replicas n\n--replicas 3\n  \n--mode=global\n--mode global Swarm  7  Docker \n   \n4. \nclusterserver\nconstraintswarm cluster \n   \n------------------Swarm cluster----------------------\n1Docker\n2scheduler\n3API\n   \nclusterdocker service\n   \ndocker swarmtask\"docker service ls\" \"docker service ps + taskID\"\n\n```\n\n## Dcoker Swarm \n\n\n\n(centos)\n\nIP192.168.31.43 manager43 swarm manager\n\nIP192.168.31.188 node188 swarm node\n\nIP192.168.31.139 node139 swarm node\n\n1\n\n```\n1) \n# 192.168.31.43  \n[root@manager43 ~]# hostnamectl set-hostname manager43\n \n# 192.168.31.188 \n[root@node188 ~]# hostnamectl set-hostname node188\n \n# 192.168.31.139 \n[root@node139 ~]# hostnamectl set-hostname node139\n \n2)hosts()\n[root@manager43 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n \n192.168.31.43 manager43\n192.168.31.188 node188\n192.168.31.139 node139\n \n# scpnode\n[root@manager43 ~]# scp /etc/hosts root@192.168.31.188:/etc/hosts\n[root@manager43 ~]# scp /etc/hosts root@192.168.31.139:/etc/hosts\n \n3) \n2377/tcp7946/udp4789/udpoverlay \n[root@manager43 ~]# systemctl disable firewalld.service\n[root@manager43 ~]# systemctl stop firewalld.service\n \n4) docker(...)\n[root@manager43 ~]# yum -y install docker\n[root@node188 ~]# yum -y install docker\n[root@node139 ~]# yum -y install docker\n```\n\ndocker[docker](https://www.cnblogs.com/zhujingzhi/p/9656298.html)\n\n:[docker](https://www.cnblogs.com/brianzhu/p/8565411.html)\n\n2Swarm\n\n```\n1) Swarm\n[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43\nSwarm initialized: current node (z2n633mty5py7u9wyl423qnq0) is now a manager.\n \nTo add a worker to this swarm, run the following command:\n \n    # (tokentoken)\n    docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377  \n \nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n \nswarmtoken tokentoken\n--advertise-addrswarmworkeripmanager\n \n\n# \n[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43\nError response from daemon: This node is already part of a swarm. Use \"docker swarm leave\" to leave this swarm and join another one.\n# \n[root@manager43 ~]# docker swarm leave -f\nleave-fOK\n \n2) \n[root@manager43 ~]# docker info\n Swarm\n \n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\n(node ID*)\n \n3) Swarm\nSwarm\n \n# 192.168.31.188 \n[root@node188 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377\nThis node joined a swarm as a worker.\n \n# 192.168.31.139 \n[root@node139 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377\nThis node joined a swarm as a worker.\n \nswarm\n \nmanager43\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n \n--------------------------------------------------------------------------------------------------------------------\navailablity\nswarmnodeavailability activedrain\nactivenodemanager\ndrainnodetaskmanager\n[root@manager43 ~]# docker node update --availability drain node139               # node139node139\"docker node rm --force node139\"\nnode139\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Drain                                   18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n \nnode1draintask\nactive\n[root@manager43 ~]# docker node update --availability active node139\nnode139\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\n3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce\nvww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce\nc5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce\n```\n\n3Swarm(nginx)\n\n```\nDocker 1.12Scalinghealth checkdnsvipservice\n1) \n# \n[root@manager43 ~]# docker network create -d overlay nginx_net\na52jy33asc5o0ts0rq823bf0m\n[root@manager43 ~]# docker network ls | grep nginx_net\na52jy33asc5o        nginx_net           overlay             swarm\n \n# \n[root@manager43 ~]# docker service create --replicas 1 --network nginx_net --name my_nginx -p 80:80 nginx    # --replicas 1 nginxnginx\nolexfmtdf94sxyeetkchwhehg\noverall progress: 1 out of 1 tasks\n1/1: running   [==================================================>]\nverify: Service converged\nmanager-nodenginx\n--replicas \nnginxtomcattomcat\n \n#  docker service ls \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nolexfmtdf94s        my_nginx            replicated          1/1                 nginx:latest        *:80->80/tcp\n \n2) Swarm\n-pretty  --pretty \n[root@manager43 ~]# docker service inspect --pretty my_nginx\nID:             zs7fw4ereo5w7ohd4n9ii06nt\nName:           my_nginx\nService Mode:   Replicated\n Replicas:      1\nPlacement:\nUpdateConfig:\n Parallelism:   1\n On failure:    pause\n Monitoring Period: 5s\n Max failure ratio: 0\n Update order:      stop-first\nRollbackConfig:\n Parallelism:   1\n On failure:    pause\n Monitoring Period: 5s\n Max failure ratio: 0\n Rollback order:    stop-first\nContainerSpec:\n Image:         nginx:latest@sha256:b73f527d86e3461fd652f62cf47e7b375196063bbbd503e853af5be16597cb2e\n Init:          false\nResources:\nNetworks: nginx_net\nEndpoint Mode:  vip\nPorts:\n PublishedPort = 80\n  Protocol = tcp\n  TargetPort = 80\n  PublishMode = ingress\n \n# manager-nodehttp://192.168.31.43\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      \n STATE  Preparing Running \n \nmanager-nodenginx\n[root@manager43 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n0dc7103f8030        nginx:latest        \"nginx -g 'daemon of\"   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj\n \n3) Swarm(scale)\nserviceswarmServicekubernetes docker service scale \nmy_nginx4\n[root@manager43 ~]# docker service scale my_nginx=4\nmy_nginx scaled to 4\noverall progress: 4 out of 4 tasks\n1/4: running   [==================================================>]\n2/4: running   [==================================================>]\n3/4: running   [==================================================>]\n4/4: running   [==================================================>]\nverify: Service converged\n \nscale nginx \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      \nmlprstt9ds5x        my_nginx.2          nginx:latest        node139             Running             Running 52 seconds ago                         \ny09lk90tdzdp        my_nginx.3          nginx:latest        node139             Running             Running 52 seconds ago                         \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 2 minutes ago  \n \nmy_nginxmanager-node3\n4my_nginxmy_nginx\n \n \n4) node\n\nswarmDocker\n    \n\nnode139node139dockertasknode139task\ntask\"docker node ls\"node139swarm(Down)\n[root@node139 ~]# systemctl stop docker\n[root@manager43 ~]# docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\nppk7q0bjond8a58xja7in1qid *   manager43           Ready               Active              Leader              18.06.0-ce\nmums8azgbrffnecp3q8fz70pl     node139             Down                Active                                  18.06.1-ce\nz3n36maf03yjg7odghikuv574     node188             Ready               Active                                  18.06.1-ce\n    \n\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                       \nwb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Running             Running about a minute ago                      \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 4 minutes ago                           \nrhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Running             Running about a minute ago                      \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 4 minutes ago                           \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 6 minutes ago\n \nnode139tasknode188manager43\n \nnode188manager43task192.168.31.188192.168.31.4380swarm\n[root@manager43 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\nae4c5c2e6f3f        nginx:latest        \"nginx -g 'daemon of\"   4 minutes ago       Up 4 minutes        80/tcp              my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\n0dc7103f8030        nginx:latest        \"nginx -g 'daemon of\"   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj\n \n[root@node188 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\na63ef253f7dd        nginx:latest        \"nginx -g 'daemon of\"   3 minutes ago       Up 3 minutes        80/tcp              my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n74a1a1db81d4        nginx:latest        \"nginx -g 'daemon of\"   8 minutes ago       Up 8 minutes        80/tcp              my_nginx.4.clolfl3zlvj0ewmh85c2ljnza\n \nnode188manager43node139task\n[root@manager43 ~]# docker stop my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\nmy_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21\n \n[root@node188 ~]# docker stop my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\nmy_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n \ntasknode139\n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 2 hours ago                          \nj2q61f8jtzba        my_nginx.2          nginx:latest        node188             Running             Running 24 seconds ago                       \nwb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 29 seconds ago                      \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 11 minutes ago                       \noz9wyjuldw1t        my_nginx.3          nginx:latest        manager43           Running             Running 40 seconds ago                       \nrhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 45 seconds ago                      \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 11 minutes ago                       \nclolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 12 minutes ago    \nswarm clusterworker nodeworker node\n \n \n5) Swarm (scale)\nswarmscale\nmy_nginx1\n[root@manager43 ~]# docker service scale my_nginx=1\nmy_nginx scaled to 1\noverall progress: 1 out of 1 tasks\n1/1:  \nverify: Service converged\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          1/1                 nginx:latest        *:80->80/tcp\n \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                         \nwb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Shutdown            Complete 9 hours ago                         \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago                      \nrhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Shutdown            Complete 9 hours ago                         \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago      \n \ndocker service ps my_nginx nodeShutdown\n \nnode\n[root@node188 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\nf93c0a27374a        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 44 seconds ago                       my_nginx.2.j2q61f8jtzba9kb3unupkhl25\na63ef253f7dd        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                          my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5\n[root@node139 ~]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS               NAMES\ne8ac2e44f5c4        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                       my_nginx.2.mlprstt9ds5xi48u1rzscgfdk\n5b031aa5a2cc        nginx:latest        \"nginx -g 'daemon of\"   9 hours ago         Exited (0) 9 hours ago                       my_nginx.3.y09lk90tdzdp8cwj6mm5oyr3f\nnodedocker ps -a stoprm\n \n6) scaledocker service update      /\n[root@manager43 ~]# docker service update --replicas 3 my_nginx\nmy_nginx\noverall progress: 3 out of 3 tasks\n1/3: running   [==================================================>]\n2/3: running   [==================================================>]\n3/3: running   [==================================================>]\nverify: Service converged\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:latest        *:80->80/tcp\n \n[root@manager43 ~]# docker service ps my_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nyzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                        \nj3hduzd9pret        my_nginx.2          nginx:latest        node188             Running             Running 18 seconds ago                      \nwb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 9 hours ago                        \nmlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago                      \ngng96vc5vqpv        my_nginx.3          nginx:latest        node139             Running             Running 18 seconds ago                      \nrhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 9 hours ago                        \ny09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago    \n \ndocker service update   \n[root@manager43 ~]# docker service update --image nginx:new my_nginx\n \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nzs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:new           *:80->80/tcp\nIMAGE nginx:new\n \n \n7) my_nginx\n[root@manager43 ~]# docker service rm my_nginx\n \ntask\n```\n\n4SwarmVolume(mount)\n\n```\n1) volume\n[root@manager43 ~]# docker volume --help\n \nUsage:  docker volume COMMAND\n \nManage volumes\n \nCommands:\n  create      Create a volume\n  inspect     Display detailed information on one or more volumes\n  ls          List volumes\n  prune       Remove all unused local volumes\n  rm          Remove one or more volumes\n \nRun 'docker volume COMMAND --help' for more information on a command.\n \n2) volume\n[root@manager43 ~]# docker volume create --name testvolume\ntestvolume\n \n# volume\n[root@manager43 ~]# docker volume ls\nDRIVER              VOLUME NAME\nlocal               testvolume\n \n# volume\n[root@manager43 ~]# docker volume inspect testvolume\n[\n    {\n        \"CreatedAt\": \"2018-10-21T10:50:02+08:00\",\n        \"Driver\": \"local\",\n        \"Labels\": {},\n        \"Mountpoint\": \"/var/lib/docker/volumes/testvolume/_data\",\n        \"Name\": \"testvolume\",\n        \"Options\": {},\n        \"Scope\": \"local\"\n    }\n]\n \n \n3) testvolume(nginx)\n[root@manager43 ~]# docker service create --replicas 3 --mount type=volume,src=testvolume,dst=/zjz --name test_nginx nginx\nsh7wc8yzcvr0xaedo4tnraj7l\noverall progress: 3 out of 3 tasks\n1/3: running   [==================================================>]\n2/3: running   [==================================================>]\n3/3: running   [==================================================>]\nverify: Service converged\n \n\nsrcsourcedsttarget\n \n# \n[root@manager43 ~]# docker service ls\nID                  NAME                MODE                REPLICAS            IMAGE               PORTS\nsh7wc8yzcvr0        test_nginx          replicated          3/3                 nginx:latest       \n[root@manager43 ~]# docker service ps test_nginx\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nm7m41kwt4q6w        test_nginx.1        nginx:latest        node188             Running             Running 56 seconds ago                      \nkayh81q1o1kx        test_nginx.2        nginx:latest        node139             Running             Running 56 seconds ago                      \neq11v0rcwy38        test_nginx.3        nginx:latest        manager43           Running             Running 56 seconds ago           \n \n# ()\n# \n[root@manager43 ~]# docker exec -it 63451219cb4e /bin/bash\nroot@63451219cb4e:/# cd /zjz/\nroot@63451219cb4e:/zjz# ls\nroot@63451219cb4e:/zjz# echo \"gen wo xue docker\" > docker.txt\nroot@63451219cb4e:/zjz# ls\ndocker.txt\n \ndocker volume inspect testvolume ()\n/var/lib/docker/volumes/testvolume/_data\n[root@manager43 ~]# cd /var/lib/docker/volumes/testvolume/_data\n[root@manager43 _data]# ls\ndocker.txt\n[root@manager43 _data]# cat docker.txt\ngen wo xue docker\n \nnodevolume\n[root@manager43 _data]# ln -s /var/lib/docker/volumes/testvolume/_data /zjz\n[root@manager43 _data]# cd /zjz/\n[root@manager43 zjz]# ls\ndocker.txt\n[root@manager43 zjz]# echo \"123\" > 1.txt  \n[root@manager43 zjz]# ll\n 8\n-rw-r--r-- 1 root root  4 10 21 11:04 1.txt\n-rw-r--r-- 1 root root 18 10 21 11:00 docker.txt\n \n# \n[root@manager43 zjz]# docker exec -it 63451219cb4e /bin/bash\nroot@63451219cb4e:/# cd /zjz/\nroot@63451219cb4e:/zjz# ls\n1.txt  docker.txt\nroot@63451219cb4e:/zjz# cat 1.txt\n123\nroot@63451219cb4e:/zjz# cat docker.txt\ngen wo xue docker\n \n# \n\ndocker service create --mount type=bind,target=/container_data/,source=/host_data/\ntargetsource\n \n# \n[root@manager43 ~]# docker service create --replicas 1 --mount type=bind,target=/usr/share/nginx/html/,source=/opt/web/ --network nginx_net --name zjz_nginx -p 8880:80 nginx\n```\n\n5Swarm\n\nnginx\ndocker compose docker-compose.ymlcomposeswarm([docker compose](https://www.cnblogs.com/zhujingzhi/p/9786622.html))\n\n```\n\n(nginxvisualizerportainer)  GUI \ndocker servicedocker stack\n \n1) docker-compose.yml\n[root@manager43 ~]# mkdir testswarm\n[root@manager43 ~]# cd testswarm/\n[root@manager43 testswarm]# cat docker-compose.yml\nversion: \"3\"\nservices:\n  nginx:\n    image: nginx\n    ports:\n      - 8888:80\n    deploy:\n      mode: replicated\n      replocas: 3\n \n  visualizer:\n    image: dockersamples/visualizer\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n    deploy:\n      replicas: 1\n      placement:\n        constraints: [node.role == manager]\n \n  portainer:\n    image: portainer/portainer\n    ports:\n      - \"9000:9000\"\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n    deploy:\n      replicas: 1\n      placement:\n        constraints: [node.role == manager]\n \n2) yml\n[root@manager43 testswarm]# docker stack deploy -c docker-compose.yml deploy_deamon\nCreating network deploy_deamon_default\nCreating service deploy_deamon_portainer\nCreating service deploy_deamon_nginx\nCreating service deploy_deamon_visualizer\n \n\n \n# \n[root@manager43 testswarm]# docker service ls\nID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS\nxj2f1t5ax3nm        deploy_deamon_nginx        replicated          3/3                 nginx:latest                      *:8888->80/tcp\nky9qpldr5abb        deploy_deamon_portainer    replicated          1/1                 portainer/portainer:latest        *:9000->9000/tcp\nr47ff177x1ir        deploy_deamon_visualizer   replicated          1/1                 dockersamples/visualizer:latest   *:8080->8080/tcp\n \n[root@manager43 testswarm]# docker service ps deploy_deamon_nginx\nID                  NAME                    IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nz3v4uc1ujsnq        deploy_deamon_nginx.1   nginx:latest        node139             Running             Running about a minute ago                      \njhg3ups0cko5        deploy_deamon_nginx.2   nginx:latest        manager43           Running             Running about a minute ago                      \n3e6guv791x21        deploy_deamon_nginx.3   nginx:latest        node188             Running             Running about a minute ago        \n \n[root@manager43 testswarm]# docker service ps deploy_deamon_portainer\nID                  NAME                        IMAGE                        NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS\nwhyuvy82cvvw        deploy_deamon_portainer.1   portainer/portainer:latest   manager43           Running             Running about a minute ago                      \n \n[root@manager43 testswarm]# docker service ps deploy_deamon_visualizer\nID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\nwge5w1eqykg3        deploy_deamon_visualizer.1   dockersamples/visualizer:latest   manager43           Running             Starting 7 seconds ago                     \n```\n\n\n\n![img](/images/docker-swarm/docker-swarm-7.png)\n\n![img](/images/docker-swarm/docker-swarm-8.png)\n\n![img](/images/docker-swarm/docker-swarm-9.png)\n\n![img](/images/docker-swarm/docker-swarm-10.png)\n\n![img](/images/docker-swarm/docker-swarm-11.png)\n\n## Docker Swarm \n\n```\nDocker1.12swarm(overlay networks)\nping\n   \nswarm\n1\n2service discoveryswarmIP(vip)DNS\n3DNSVIP\n4swarmswarmswarm\n5TCP/UDP7946  \n6UDP4789  \n   \n\n-----------Swarmoverlay------------\n[root@manager-node ~]# docker network create --driver overlay --opt encrypted --subnet 10.10.19.0/24 ngx_net\n   \n\nopt encrypted  swarmopt encryptedvxlan\n--subnet overlayswarm\n   \n[root@manager-node ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nd7aa48d3e485        bridge              bridge              local            \n9e637a97a3b9        docker_gwbridge     bridge              local            \nb5a41c8c71e7        host                host                local            \n7f4fx3jf4dbr        ingress             overlay             swarm            \n3x2wgugr6zmn        ngx_net             overlay             swarm            \n0808a5c72a0a        none                null                local\n   \nSwarm2\"ngx_net\"\"ingress\"\nSwarm  ingress \nmanagerSCOPE swarm Swarm\nSwarmworkerworkerswarm\nworker\n   \n------------------overlay-------------------\n[root@manager-node ~]# docker service create --replicas 5 --network ngx_net --name my-test -p 80:80 nginx\n   \n\"my-test\"3taskoverlaySwarmRunning\n[root@manager-node ~]# docker service ls\nID            NAME     REPLICAS  IMAGE  COMMAND\ndsaxs6v463g9  my-test  5/5       nginx\n   \nmanager-noderunning\n[root@manager-node ~]# docker service ps my-test\nID                         NAME       IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR\n8433fuiy7vpu0p80arl7vggfe  my-test.1  nginx  node2         Running        Running 2 minutes ago\nf1h7a0vtojv18zrsiw8j0rzaw  my-test.2  nginx  node1         Running        Running 2 minutes ago\nex73ifk3jvzw8ukurl8yu7fyq  my-test.3  nginx  node1         Running        Running 2 minutes ago\ncyu73jd8psupfhken23vvmpud  my-test.4  nginx  manager-node  Running        Running 2 minutes ago\nbtorxekfix4hcqh4v83dr0tzw  my-test.5  nginx  manager-node  Running        Running 2 minutes ago\n   \nrunningmy-network\n   \nmy-network\n[root@manager-node ~]# docker network inspect ngx_net\n[\n    {\n        \"Name\": \"ngx_net\",\n        \"Id\": \"3x2wgugr6zmn1mcyf9k1du27p\",\n        \"Scope\": \"swarm\",\n        \"Driver\": \"overlay\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": null,\n            \"Config\": [\n                {\n                    \"Subnet\": \"10.10.19.0/24\",\n                    \"Gateway\": \"10.10.19.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Containers\": {\n            \"00f47e38deea76269eb03ba13695ec0b0c740601c85019546d6a9a17fd434663\": {\n                \"Name\": \"my-test.5.btorxekfix4hcqh4v83dr0tzw\",\n                \"EndpointID\": \"ea962d07eee150b263ae631b8a7f8c1950337c11ef2c3d488a7c3717defd8601\",\n                \"MacAddress\": \"02:42:0a:0a:13:03\",\n                \"IPv4Address\": \"10.10.19.3/24\",\n                \"IPv6Address\": \"\"\n            },\n            \"957620c6f7abb44ad8dd2d842d333f5e5c1655034dc43e49abbbd680de3a5341\": {\n                \"Name\": \"my-test.4.cyu73jd8psupfhken23vvmpud\",\n                \"EndpointID\": \"f33a6e9ddf1dd01bcfc43ffefd19e19514658f001cdf9b2fbe23bc3fdf56a42a\",\n                \"MacAddress\": \"02:42:0a:0a:13:07\",\n                \"IPv4Address\": \"10.10.19.7/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n        \"Options\": {\n            \"com.docker.network.driver.overlay.vxlanid_list\": \"257\"\n        },\n        \"Labels\": {}\n    }\n]\n   \nmanager-nodemy-testmy-test.5.btorxekfix4hcqh4v83dr0tzw\nmy-test.4.cyu73jd8psupfhken23vvmpudtaskngx_netnode1node2\n[root@node1 ~]# docker network inspect ngx_net\n.......\n        \"Containers\": {\n            \"7d9986fad5a7d834676ba76ae75aff2258f840953f1dc633c3ef3c0efd2b2501\": {\n                \"Name\": \"my-test.3.ex73ifk3jvzw8ukurl8yu7fyq\",\n                \"EndpointID\": \"957ca19f3d5480762dbd14fd9a6a1cd01a8deac3e8e35b23d1350f480a7b2f37\",\n                \"MacAddress\": \"02:42:0a:0a:13:06\",\n                \"IPv4Address\": \"10.10.19.6/24\",\n                \"IPv6Address\": \"\"\n            },\n            \"9e50fceada1d7c653a886ca29d2bf2606debafe8c8a97f2d79104faf3ecf8a46\": {\n                \"Name\": \"my-test.2.f1h7a0vtojv18zrsiw8j0rzaw\",\n                \"EndpointID\": \"b1c209c7b68634e88e0bf5e100fe03435b3096054da6555c61e6c207ac651ac2\",\n                \"MacAddress\": \"02:42:0a:0a:13:05\",\n                \"IPv4Address\": \"10.10.19.5/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n.........\n  \n[root@node2 web]# docker network inspect ngx_net\n........\n        \"Containers\": {\n            \"4bdcce0ee63edc08d943cf4a049eac027719ff2dc14b7c3aa85fdddc5d1da968\": {\n                \"Name\": \"my-test.1.8433fuiy7vpu0p80arl7vggfe\",\n                \"EndpointID\": \"df58de85b0a0e4d128bf332fc783f6528d1f179b0f9f3b7aa70ebc832640d3bc\",\n                \"MacAddress\": \"02:42:0a:0a:13:04\",\n                \"IPv4Address\": \"10.10.19.4/24\",\n                \"IPv6Address\": \"\"\n            }\n        },\n   \nIP\n[root@manager-node ~]# docker service inspect --format='{{json .Endpoint.VirtualIPs}}' my-test\n[{\"NetworkID\":\"7f4fx3jf4dbrp97aioc05pul4\",\"Addr\":\"10.255.0.6/16\"},{\"NetworkID\":\"3x2wgugr6zmn1mcyf9k1du27p\",\"Addr\":\"10.10.19.2/24\"}]\n   \n10.10.19.2swarmvip\n```\n\n![img](/images/docker-swarm/docker-swarm-12.png)\n\nngx_netIP\n\n```\n[root@node2 ~]# docker ps\nCONTAINER ID    IMAGE           COMMAND                  CREATED         STATUS             PORTS    NAMES\n4bdcce0ee63e    nginx:latest    \"nginx -g 'daemon off\"   22 minutes ago  Up 22 minutes      80/tcp   my-test.1.8433fuiy7vpu0p80arl7vggfe\n  \n[root@node2 ~]# docker exec -ti 4bdcce0ee63e /bin/bash\nroot@4bdcce0ee63e:/# ip addr                                                                                          \n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n1786: eth0@if1787: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:ff:00:08 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.255.0.8/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 10.255.0.6/32 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:feff:8/64 scope link\n       valid_lft forever preferred_lft forever\n1788: eth1@if1789: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default\n    link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet 172.18.0.3/16 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe12:3/64 scope link\n       valid_lft forever preferred_lft forever\n1791: eth2@if1792: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default\n    link/ether 02:42:0a:0a:13:04 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n    inet 10.10.19.4/24 scope global eth2\n       valid_lft forever preferred_lft forever\n    inet 10.10.19.2/32 scope global eth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe0a:1304/64 scope link\n       valid_lft forever preferred_lft forever\n  \nroot@4bdcce0ee63e:/# ping 10.10.19.3\nPING 10.10.19.3 (10.10.19.3): 56 data bytes\n64 bytes from 10.10.19.3: icmp_seq=0 ttl=64 time=0.890 ms\n64 bytes from 10.10.19.3: icmp_seq=1 ttl=64 time=0.622 ms\n.....-\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.622/0.756/0.890/0.134 ms\n  \nroot@4bdcce0ee63e:/# ping 10.10.19.6\nPING 10.10.19.6 (10.10.19.6): 56 data bytes\n64 bytes from 10.10.19.6: icmp_seq=0 ttl=64 time=0.939 ms\n64 bytes from 10.10.19.6: icmp_seq=1 ttl=64 time=0.590 ms\n  \n----------------------------swarm--------------------------\nswarmVIPVIPDNSDNS\n\n  \noverlaySwarmVIP\nactivetask\n  \n\ncentosmy-testnginx\n[root@manager-node ~]# docker service create --name my-centos --network ngx_net centos       \n  \ncentoscentos\n[root@manager-node ~]# docker service ps my-centos\nID                         NAME             IMAGE   NODE   DESIRED STATE  CURRENT STATE            ERROR\ne03pqgkjs3l1qizc6v4aqaune  my-centos.1      centos  node2  Running        Preparing 4 seconds ago\n  \ncentosnode2centosshell\n[root@node2 ~]# docker ps\nCONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS            NAMES\ne4554490d891        centos:latest            \"/bin/bash\"             About an hour ago   Up About an hour   my-centos.1.9yk5ie28gwk9mw1h1jovb68ki\n  \n[root@node2 ~]# docker exec -ti my-centos.1.9yk5ie28gwk9mw1h1jovb68ki /bin/bash\nroot@4bdcce0ee63e:/# nslookup my-test\nServer: 127.0.0.11\nAddress 1: 127.0.0.11\n  \nName: my-test\nAddress 1: 10.10.19.2 10.10.19.2\n  \n  \ncentos DNSmy-testIP\nroot@4bdcce0ee63e:/# nslookup tasks.my-test\nServer: 127.0.0.11\nAddress 1: 127.0.0.11\n  \nName: tasks.my-test\nAddress 1: 10.10.19.4 my-test.1.8433fuiy7vpu0p80arl7vggfe\nAddress 2: 10.10.19.5 my-test.2.f1h7a0vtojv18zrsiw8j0rzaw\nAddress 3: 10.10.19.6 my-test.3.ex73ifk3jvzw8ukurl8yu7fyq\nAddress 2: 10.10.19.7 my-test.4.cyu73jd8psupfhken23vvmpud\nAddress 3: 10.10.19.3 my-test.5.btorxekfix4hcqh4v83dr0tzw\n  \ncentoswgetmy-testnginx\nroot@4bdcce0ee63e:/# wget -O- my-test     \nConnecting to my-test (10.10.19.2:80)\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n  \nSwarmHTTPVIPactivetaskround-robinactivetask\n  \n-----------------------------------DNS round-robin-----------------------------\nDNS round-robinVIP --endpoint-mode dnsrr \n\n  \nDNS round-robin-p\n[root@manager-node ~]# docker service create --replicas 3 --name my-dnsrr-nginx --network ngx_net --endpoint-mode dnsrr nginx\n  \n[root@manager-node ~]# docker service ps my-dnsrr-nginx\nID                         NAME              IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR\n65li2zbhxvvoaesndmwjokouj  my-dnsrr-nginx.1  nginx  node1         Running        Running 2 minutes ago\n5hjw7wm4xr877879m0ewjciuj  my-dnsrr-nginx.2  nginx  manager-node  Running        Running 2 minutes ago\nafo7acduge2qfy60e87liz557  my-dnsrr-nginx.3  nginx  manager-node  Running        Running 2 minutes ago\n  \n  \nDNSDNSIP\nroot@4bdcce0ee63e:/# nslookup my-dnsrr-nginx\nServer:    127.0.0.11\nAddress 1: 127.0.0.11\n  \nName:      my-dnsrr-nginx\nAddress 1: 10.10.19.10 my-dnsrr-nginx.3.0sm1n9o8hygzarv5t5eq46okn.my-network\nAddress 2: 10.10.19.9  my-dnsrr-nginx.2.b3o1uoa8m003b2kk0ytl9lawh.my-network\nAddress 3: 10.10.19.8  my-dnsrr-nginx.1.55za4c83jq9846rle6eigiq15.my-network\n  \nVIP\nDockerdignslookupDNSDNSVIPIPpingVIP\n```\n\n\n\n[https://www.cnblogs.com/zhujingzhi/p/9792432.html](https://www.cnblogs.com/zhujingzhi/p/9792432.html)","slug":"docker/docker-swarm","published":1,"updated":"2022-05-10T08:25:56.385Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4or0009xklo43lb86fd","content":"<h2 id=\"Docker-Swarm\"><a href=\"#Docker-Swarm\" class=\"headerlink\" title=\"Docker Swarm\"></a>Docker Swarm</h2><p><img src=\"/images/docker-swarm/docker-swarm-1.png\" alt=\"img\"></p>\n<p>SwarmDockerdockerGO<a href=\"https://github.com/docker/swarm%EF%BC%8C\">https://github.com/docker/swarm</a> DockerSwarmDocker APIDocker</p>\n<p>Client(compose,docker-py)SwarmDockerSwarmSwarmSwarmDocker</p>\n<p>Docker Swarm  Docker Compose  Docker Docker Compose  Docker Swarm  Docker Swarm </p>\n<p> Docker 1.12.0 Docker Swarm  Docker docker swarm Etcd  Consul </p>\n<p>Swarm deamon(Scheduler)(router),SwarmDockerSwarmSwarm</p>\n<h2 id=\"Docker-Swarm-\"><a href=\"#Docker-Swarm-\" class=\"headerlink\" title=\"Docker Swarm \"></a>Docker Swarm </h2><p><img src=\"/images/docker-swarm/docker-swarm-2.png\" alt=\"img\"></p>\n<p> Docker ClientSwarm (Cluster)</p>\n<p>Swarmmaster-slavemanagermanagernodeagentmanagerRaftmanagerDNS</p>\n<h2 id=\"-Swarm\"><a href=\"#-Swarm\" class=\"headerlink\" title=\".Swarm\"></a>.Swarm</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.Swarm</span><br><span class=\"line\">dockerSwarmKitdockerswarmswarm</span><br><span class=\"line\"> </span><br><span class=\"line\">2.Node</span><br><span class=\"line\">dockerDockerDocker</span><br><span class=\"line\">swarm  </span><br><span class=\"line\">ManagerManager</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">3.Service</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">4.Task</span><br><span class=\"line\">docekrManagerworker</span><br><span class=\"line\"> </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">docker swarminit, join, leave, updatedocker swarm --help</span><br><span class=\"line\">docker servicecreate, inspect, update, remove, tasksdocker service--help</span><br><span class=\"line\">docker nodeaccept, promote, demote, inspect, update, tasks, ls, rmdocker node --help</span><br><span class=\"line\">   </span><br><span class=\"line\">nodeswarmdockernodenode</span><br><span class=\"line\">manager nodes</span><br><span class=\"line\">worker nodes</span><br><span class=\"line\"> </span><br><span class=\"line\">1manager nodeleader</span><br><span class=\"line\">2worker nodetask</span><br><span class=\"line\">3service</span><br><span class=\"line\">   serviceworker nodestaskservicedocker </span><br><span class=\"line\">4tasktaskservicetaskdocker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Swarm\"><a href=\"#Swarm\" class=\"headerlink\" title=\"Swarm\"></a>Swarm</h2><ol>\n<li>Node</li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-3.png\" alt=\"img\"></p>\n<ol start=\"2\">\n<li>Service</li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-4.png\" alt=\"img\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-5.png\" alt=\"img\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-6.png\" alt=\"img\"></p>\n<h2 id=\"Swarm\"><a href=\"#Swarm\" class=\"headerlink\" title=\"Swarm\"></a>Swarm</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Swarm(scheduler)leaderspread, binpack, random.</span><br><span class=\"line\">1Random</span><br><span class=\"line\">NodespreadbinpackCPU, RAM</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">2Spread</span><br><span class=\"line\">Spreadbinpack</span><br><span class=\"line\">Spread</span><br><span class=\"line\">  </span><br><span class=\"line\">3Binpack</span><br><span class=\"line\">Binpackbinpack</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Swarm-Cluster\"><a href=\"#Swarm-Cluster\" class=\"headerlink\" title=\"Swarm Cluster\"></a>Swarm Cluster</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">overlay</span><br><span class=\"line\">   </span><br><span class=\"line\">2</span><br><span class=\"line\">cluster--replicas n</span><br><span class=\"line\">load balance</span><br><span class=\"line\">docker serviceCluster</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">3</span><br><span class=\"line\">Swarm Clusterscale</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">runrun</span><br><span class=\"line\">&quot;--replicas n&quot;&quot;--mode=global&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">--replicas n</span><br><span class=\"line\">--replicas 3</span><br><span class=\"line\">  </span><br><span class=\"line\">--mode=global</span><br><span class=\"line\">--mode global Swarm  7  Docker </span><br><span class=\"line\">   </span><br><span class=\"line\">4. </span><br><span class=\"line\">clusterserver</span><br><span class=\"line\">constraintswarm cluster </span><br><span class=\"line\">   </span><br><span class=\"line\">------------------Swarm cluster----------------------</span><br><span class=\"line\">1Docker</span><br><span class=\"line\">2scheduler</span><br><span class=\"line\">3API</span><br><span class=\"line\">   </span><br><span class=\"line\">clusterdocker service</span><br><span class=\"line\">   </span><br><span class=\"line\">docker swarmtask&quot;docker service ls&quot; &quot;docker service ps + taskID&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dcoker-Swarm-\"><a href=\"#Dcoker-Swarm-\" class=\"headerlink\" title=\"Dcoker Swarm \"></a>Dcoker Swarm </h2><p></p>\n<p>(centos)</p>\n<p>IP192.168.31.43 manager43 swarm manager</p>\n<p>IP192.168.31.188 node188 swarm node</p>\n<p>IP192.168.31.139 node139 swarm node</p>\n<p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) </span><br><span class=\"line\"># 192.168.31.43  </span><br><span class=\"line\">[root@manager43 ~]# hostnamectl set-hostname manager43</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.188 </span><br><span class=\"line\">[root@node188 ~]# hostnamectl set-hostname node188</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.139 </span><br><span class=\"line\">[root@node139 ~]# hostnamectl set-hostname node139</span><br><span class=\"line\"> </span><br><span class=\"line\">2)hosts()</span><br><span class=\"line\">[root@manager43 ~]# cat /etc/hosts</span><br><span class=\"line\">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class=\"line\">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class=\"line\"> </span><br><span class=\"line\">192.168.31.43 manager43</span><br><span class=\"line\">192.168.31.188 node188</span><br><span class=\"line\">192.168.31.139 node139</span><br><span class=\"line\"> </span><br><span class=\"line\"># scpnode</span><br><span class=\"line\">[root@manager43 ~]# scp /etc/hosts root@192.168.31.188:/etc/hosts</span><br><span class=\"line\">[root@manager43 ~]# scp /etc/hosts root@192.168.31.139:/etc/hosts</span><br><span class=\"line\"> </span><br><span class=\"line\">3) </span><br><span class=\"line\">2377/tcp7946/udp4789/udpoverlay </span><br><span class=\"line\">[root@manager43 ~]# systemctl disable firewalld.service</span><br><span class=\"line\">[root@manager43 ~]# systemctl stop firewalld.service</span><br><span class=\"line\"> </span><br><span class=\"line\">4) docker(...)</span><br><span class=\"line\">[root@manager43 ~]# yum -y install docker</span><br><span class=\"line\">[root@node188 ~]# yum -y install docker</span><br><span class=\"line\">[root@node139 ~]# yum -y install docker</span><br></pre></td></tr></table></figure>\n\n<p>docker<a href=\"https://www.cnblogs.com/zhujingzhi/p/9656298.html\">docker</a></p>\n<p>:<a href=\"https://www.cnblogs.com/brianzhu/p/8565411.html\">docker</a></p>\n<p>2Swarm</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) Swarm</span><br><span class=\"line\">[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43</span><br><span class=\"line\">Swarm initialized: current node (z2n633mty5py7u9wyl423qnq0) is now a manager.</span><br><span class=\"line\"> </span><br><span class=\"line\">To add a worker to this swarm, run the following command:</span><br><span class=\"line\"> </span><br><span class=\"line\">    # (tokentoken)</span><br><span class=\"line\">    docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377  </span><br><span class=\"line\"> </span><br><span class=\"line\">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class=\"line\"> </span><br><span class=\"line\">swarmtoken tokentoken</span><br><span class=\"line\">--advertise-addrswarmworkeripmanager</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43</span><br><span class=\"line\">Error response from daemon: This node is already part of a swarm. Use &quot;docker swarm leave&quot; to leave this swarm and join another one.</span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker swarm leave -f</span><br><span class=\"line\">leave-fOK</span><br><span class=\"line\"> </span><br><span class=\"line\">2) </span><br><span class=\"line\">[root@manager43 ~]# docker info</span><br><span class=\"line\"> Swarm</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">(node ID*)</span><br><span class=\"line\"> </span><br><span class=\"line\">3) Swarm</span><br><span class=\"line\">Swarm</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.188 </span><br><span class=\"line\">[root@node188 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377</span><br><span class=\"line\">This node joined a swarm as a worker.</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.139 </span><br><span class=\"line\">[root@node139 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377</span><br><span class=\"line\">This node joined a swarm as a worker.</span><br><span class=\"line\"> </span><br><span class=\"line\">swarm</span><br><span class=\"line\"> </span><br><span class=\"line\">manager43</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\"> </span><br><span class=\"line\">--------------------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">availablity</span><br><span class=\"line\">swarmnodeavailability activedrain</span><br><span class=\"line\">activenodemanager</span><br><span class=\"line\">drainnodetaskmanager</span><br><span class=\"line\">[root@manager43 ~]# docker node update --availability drain node139               # node139node139&quot;docker node rm --force node139&quot;</span><br><span class=\"line\">node139</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Drain                                   18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\"> </span><br><span class=\"line\">node1draintask</span><br><span class=\"line\">active</span><br><span class=\"line\">[root@manager43 ~]# docker node update --availability active node139</span><br><span class=\"line\">node139</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br></pre></td></tr></table></figure>\n\n<p>3Swarm(nginx)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Docker 1.12Scalinghealth checkdnsvipservice</span><br><span class=\"line\">1) </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker network create -d overlay nginx_net</span><br><span class=\"line\">a52jy33asc5o0ts0rq823bf0m</span><br><span class=\"line\">[root@manager43 ~]# docker network ls | grep nginx_net</span><br><span class=\"line\">a52jy33asc5o        nginx_net           overlay             swarm</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 1 --network nginx_net --name my_nginx -p 80:80 nginx    # --replicas 1 nginxnginx</span><br><span class=\"line\">olexfmtdf94sxyeetkchwhehg</span><br><span class=\"line\">overall progress: 1 out of 1 tasks</span><br><span class=\"line\">1/1: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\">manager-nodenginx</span><br><span class=\"line\">--replicas </span><br><span class=\"line\">nginxtomcattomcat</span><br><span class=\"line\"> </span><br><span class=\"line\">#  docker service ls </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">olexfmtdf94s        my_nginx            replicated          1/1                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">2) Swarm</span><br><span class=\"line\">-pretty  --pretty </span><br><span class=\"line\">[root@manager43 ~]# docker service inspect --pretty my_nginx</span><br><span class=\"line\">ID:             zs7fw4ereo5w7ohd4n9ii06nt</span><br><span class=\"line\">Name:           my_nginx</span><br><span class=\"line\">Service Mode:   Replicated</span><br><span class=\"line\"> Replicas:      1</span><br><span class=\"line\">Placement:</span><br><span class=\"line\">UpdateConfig:</span><br><span class=\"line\"> Parallelism:   1</span><br><span class=\"line\"> On failure:    pause</span><br><span class=\"line\"> Monitoring Period: 5s</span><br><span class=\"line\"> Max failure ratio: 0</span><br><span class=\"line\"> Update order:      stop-first</span><br><span class=\"line\">RollbackConfig:</span><br><span class=\"line\"> Parallelism:   1</span><br><span class=\"line\"> On failure:    pause</span><br><span class=\"line\"> Monitoring Period: 5s</span><br><span class=\"line\"> Max failure ratio: 0</span><br><span class=\"line\"> Rollback order:    stop-first</span><br><span class=\"line\">ContainerSpec:</span><br><span class=\"line\"> Image:         nginx:latest@sha256:b73f527d86e3461fd652f62cf47e7b375196063bbbd503e853af5be16597cb2e</span><br><span class=\"line\"> Init:          false</span><br><span class=\"line\">Resources:</span><br><span class=\"line\">Networks: nginx_net</span><br><span class=\"line\">Endpoint Mode:  vip</span><br><span class=\"line\">Ports:</span><br><span class=\"line\"> PublishedPort = 80</span><br><span class=\"line\">  Protocol = tcp</span><br><span class=\"line\">  TargetPort = 80</span><br><span class=\"line\">  PublishMode = ingress</span><br><span class=\"line\"> </span><br><span class=\"line\"># manager-nodehttp://192.168.31.43</span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      </span><br><span class=\"line\"> STATE  Preparing Running </span><br><span class=\"line\"> </span><br><span class=\"line\">manager-nodenginx</span><br><span class=\"line\">[root@manager43 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">0dc7103f8030        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj</span><br><span class=\"line\"> </span><br><span class=\"line\">3) Swarm(scale)</span><br><span class=\"line\">serviceswarmServicekubernetes docker service scale </span><br><span class=\"line\">my_nginx4</span><br><span class=\"line\">[root@manager43 ~]# docker service scale my_nginx=4</span><br><span class=\"line\">my_nginx scaled to 4</span><br><span class=\"line\">overall progress: 4 out of 4 tasks</span><br><span class=\"line\">1/4: running   [==================================================&gt;]</span><br><span class=\"line\">2/4: running   [==================================================&gt;]</span><br><span class=\"line\">3/4: running   [==================================================&gt;]</span><br><span class=\"line\">4/4: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">scale nginx </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      </span><br><span class=\"line\">mlprstt9ds5x        my_nginx.2          nginx:latest        node139             Running             Running 52 seconds ago                         </span><br><span class=\"line\">y09lk90tdzdp        my_nginx.3          nginx:latest        node139             Running             Running 52 seconds ago                         </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 2 minutes ago  </span><br><span class=\"line\"> </span><br><span class=\"line\">my_nginxmanager-node3</span><br><span class=\"line\">4my_nginxmy_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">4) node</span><br><span class=\"line\"></span><br><span class=\"line\">swarmDocker</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">node139node139dockertasknode139task</span><br><span class=\"line\">task&quot;docker node ls&quot;node139swarm(Down)</span><br><span class=\"line\">[root@node139 ~]# systemctl stop docker</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">ppk7q0bjond8a58xja7in1qid *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">mums8azgbrffnecp3q8fz70pl     node139             Down                Active                                  18.06.1-ce</span><br><span class=\"line\">z3n36maf03yjg7odghikuv574     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                       </span><br><span class=\"line\">wb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Running             Running about a minute ago                      </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 4 minutes ago                           </span><br><span class=\"line\">rhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Running             Running about a minute ago                      </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 4 minutes ago                           </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 6 minutes ago</span><br><span class=\"line\"> </span><br><span class=\"line\">node139tasknode188manager43</span><br><span class=\"line\"> </span><br><span class=\"line\">node188manager43task192.168.31.188192.168.31.4380swarm</span><br><span class=\"line\">[root@manager43 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">ae4c5c2e6f3f        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   4 minutes ago       Up 4 minutes        80/tcp              my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\">0dc7103f8030        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@node188 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">a63ef253f7dd        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   3 minutes ago       Up 3 minutes        80/tcp              my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">74a1a1db81d4        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   8 minutes ago       Up 8 minutes        80/tcp              my_nginx.4.clolfl3zlvj0ewmh85c2ljnza</span><br><span class=\"line\"> </span><br><span class=\"line\">node188manager43node139task</span><br><span class=\"line\">[root@manager43 ~]# docker stop my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\">my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@node188 ~]# docker stop my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\"> </span><br><span class=\"line\">tasknode139</span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 2 hours ago                          </span><br><span class=\"line\">j2q61f8jtzba        my_nginx.2          nginx:latest        node188             Running             Running 24 seconds ago                       </span><br><span class=\"line\">wb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 29 seconds ago                      </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 11 minutes ago                       </span><br><span class=\"line\">oz9wyjuldw1t        my_nginx.3          nginx:latest        manager43           Running             Running 40 seconds ago                       </span><br><span class=\"line\">rhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 45 seconds ago                      </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 11 minutes ago                       </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 12 minutes ago    </span><br><span class=\"line\">swarm clusterworker nodeworker node</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">5) Swarm (scale)</span><br><span class=\"line\">swarmscale</span><br><span class=\"line\">my_nginx1</span><br><span class=\"line\">[root@manager43 ~]# docker service scale my_nginx=1</span><br><span class=\"line\">my_nginx scaled to 1</span><br><span class=\"line\">overall progress: 1 out of 1 tasks</span><br><span class=\"line\">1/1:  </span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          1/1                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                         </span><br><span class=\"line\">wb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Shutdown            Complete 9 hours ago                         </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago                      </span><br><span class=\"line\">rhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Shutdown            Complete 9 hours ago                         </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago      </span><br><span class=\"line\"> </span><br><span class=\"line\">docker service ps my_nginx nodeShutdown</span><br><span class=\"line\"> </span><br><span class=\"line\">node</span><br><span class=\"line\">[root@node188 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class=\"line\">f93c0a27374a        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 44 seconds ago                       my_nginx.2.j2q61f8jtzba9kb3unupkhl25</span><br><span class=\"line\">a63ef253f7dd        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                          my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">[root@node139 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS               NAMES</span><br><span class=\"line\">e8ac2e44f5c4        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                       my_nginx.2.mlprstt9ds5xi48u1rzscgfdk</span><br><span class=\"line\">5b031aa5a2cc        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                       my_nginx.3.y09lk90tdzdp8cwj6mm5oyr3f</span><br><span class=\"line\">nodedocker ps -a stoprm</span><br><span class=\"line\"> </span><br><span class=\"line\">6) scaledocker service update      /</span><br><span class=\"line\">[root@manager43 ~]# docker service update --replicas 3 my_nginx</span><br><span class=\"line\">my_nginx</span><br><span class=\"line\">overall progress: 3 out of 3 tasks</span><br><span class=\"line\">1/3: running   [==================================================&gt;]</span><br><span class=\"line\">2/3: running   [==================================================&gt;]</span><br><span class=\"line\">3/3: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                        </span><br><span class=\"line\">j3hduzd9pret        my_nginx.2          nginx:latest        node188             Running             Running 18 seconds ago                      </span><br><span class=\"line\">wb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 9 hours ago                        </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago                      </span><br><span class=\"line\">gng96vc5vqpv        my_nginx.3          nginx:latest        node139             Running             Running 18 seconds ago                      </span><br><span class=\"line\">rhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 9 hours ago                        </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago    </span><br><span class=\"line\"> </span><br><span class=\"line\">docker service update   </span><br><span class=\"line\">[root@manager43 ~]# docker service update --image nginx:new my_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:new           *:80-&gt;80/tcp</span><br><span class=\"line\">IMAGE nginx:new</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">7) my_nginx</span><br><span class=\"line\">[root@manager43 ~]# docker service rm my_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\">task</span><br></pre></td></tr></table></figure>\n\n<p>4SwarmVolume(mount)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume --help</span><br><span class=\"line\"> </span><br><span class=\"line\">Usage:  docker volume COMMAND</span><br><span class=\"line\"> </span><br><span class=\"line\">Manage volumes</span><br><span class=\"line\"> </span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  create      Create a volume</span><br><span class=\"line\">  inspect     Display detailed information on one or more volumes</span><br><span class=\"line\">  ls          List volumes</span><br><span class=\"line\">  prune       Remove all unused local volumes</span><br><span class=\"line\">  rm          Remove one or more volumes</span><br><span class=\"line\"> </span><br><span class=\"line\">Run &#x27;docker volume COMMAND --help&#x27; for more information on a command.</span><br><span class=\"line\"> </span><br><span class=\"line\">2) volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume create --name testvolume</span><br><span class=\"line\">testvolume</span><br><span class=\"line\"> </span><br><span class=\"line\"># volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume ls</span><br><span class=\"line\">DRIVER              VOLUME NAME</span><br><span class=\"line\">local               testvolume</span><br><span class=\"line\"> </span><br><span class=\"line\"># volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume inspect testvolume</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;CreatedAt&quot;: &quot;2018-10-21T10:50:02+08:00&quot;,</span><br><span class=\"line\">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class=\"line\">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class=\"line\">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/testvolume/_data&quot;,</span><br><span class=\"line\">        &quot;Name&quot;: &quot;testvolume&quot;,</span><br><span class=\"line\">        &quot;Options&quot;: &#123;&#125;,</span><br><span class=\"line\">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">3) testvolume(nginx)</span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 3 --mount type=volume,src=testvolume,dst=/zjz --name test_nginx nginx</span><br><span class=\"line\">sh7wc8yzcvr0xaedo4tnraj7l</span><br><span class=\"line\">overall progress: 3 out of 3 tasks</span><br><span class=\"line\">1/3: running   [==================================================&gt;]</span><br><span class=\"line\">2/3: running   [==================================================&gt;]</span><br><span class=\"line\">3/3: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">srcsourcedsttarget</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">sh7wc8yzcvr0        test_nginx          replicated          3/3                 nginx:latest       </span><br><span class=\"line\">[root@manager43 ~]# docker service ps test_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">m7m41kwt4q6w        test_nginx.1        nginx:latest        node188             Running             Running 56 seconds ago                      </span><br><span class=\"line\">kayh81q1o1kx        test_nginx.2        nginx:latest        node139             Running             Running 56 seconds ago                      </span><br><span class=\"line\">eq11v0rcwy38        test_nginx.3        nginx:latest        manager43           Running             Running 56 seconds ago           </span><br><span class=\"line\"> </span><br><span class=\"line\"># ()</span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker exec -it 63451219cb4e /bin/bash</span><br><span class=\"line\">root@63451219cb4e:/# cd /zjz/</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">root@63451219cb4e:/zjz# echo &quot;gen wo xue docker&quot; &gt; docker.txt</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\"> </span><br><span class=\"line\">docker volume inspect testvolume ()</span><br><span class=\"line\">/var/lib/docker/volumes/testvolume/_data</span><br><span class=\"line\">[root@manager43 ~]# cd /var/lib/docker/volumes/testvolume/_data</span><br><span class=\"line\">[root@manager43 _data]# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\">[root@manager43 _data]# cat docker.txt</span><br><span class=\"line\">gen wo xue docker</span><br><span class=\"line\"> </span><br><span class=\"line\">nodevolume</span><br><span class=\"line\">[root@manager43 _data]# ln -s /var/lib/docker/volumes/testvolume/_data /zjz</span><br><span class=\"line\">[root@manager43 _data]# cd /zjz/</span><br><span class=\"line\">[root@manager43 zjz]# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\">[root@manager43 zjz]# echo &quot;123&quot; &gt; 1.txt  </span><br><span class=\"line\">[root@manager43 zjz]# ll</span><br><span class=\"line\"> 8</span><br><span class=\"line\">-rw-r--r-- 1 root root  4 10 21 11:04 1.txt</span><br><span class=\"line\">-rw-r--r-- 1 root root 18 10 21 11:00 docker.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 zjz]# docker exec -it 63451219cb4e /bin/bash</span><br><span class=\"line\">root@63451219cb4e:/# cd /zjz/</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">1.txt  docker.txt</span><br><span class=\"line\">root@63451219cb4e:/zjz# cat 1.txt</span><br><span class=\"line\">123</span><br><span class=\"line\">root@63451219cb4e:/zjz# cat docker.txt</span><br><span class=\"line\">gen wo xue docker</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\"></span><br><span class=\"line\">docker service create --mount type=bind,target=/container_data/,source=/host_data/</span><br><span class=\"line\">targetsource</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 1 --mount type=bind,target=/usr/share/nginx/html/,source=/opt/web/ --network nginx_net --name zjz_nginx -p 8880:80 nginx</span><br></pre></td></tr></table></figure>\n\n<p>5Swarm</p>\n<p>nginx<br>docker compose docker-compose.ymlcomposeswarm(<a href=\"https://www.cnblogs.com/zhujingzhi/p/9786622.html\">docker compose</a>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">(nginxvisualizerportainer)  GUI </span><br><span class=\"line\">docker servicedocker stack</span><br><span class=\"line\"> </span><br><span class=\"line\">1) docker-compose.yml</span><br><span class=\"line\">[root@manager43 ~]# mkdir testswarm</span><br><span class=\"line\">[root@manager43 ~]# cd testswarm/</span><br><span class=\"line\">[root@manager43 testswarm]# cat docker-compose.yml</span><br><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  nginx:</span><br><span class=\"line\">    image: nginx</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8888:80</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      mode: replicated</span><br><span class=\"line\">      replocas: 3</span><br><span class=\"line\"> </span><br><span class=\"line\">  visualizer:</span><br><span class=\"line\">    image: dockersamples/visualizer</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8080:8080&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      replicas: 1</span><br><span class=\"line\">      placement:</span><br><span class=\"line\">        constraints: [node.role == manager]</span><br><span class=\"line\"> </span><br><span class=\"line\">  portainer:</span><br><span class=\"line\">    image: portainer/portainer</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9000:9000&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      replicas: 1</span><br><span class=\"line\">      placement:</span><br><span class=\"line\">        constraints: [node.role == manager]</span><br><span class=\"line\"> </span><br><span class=\"line\">2) yml</span><br><span class=\"line\">[root@manager43 testswarm]# docker stack deploy -c docker-compose.yml deploy_deamon</span><br><span class=\"line\">Creating network deploy_deamon_default</span><br><span class=\"line\">Creating service deploy_deamon_portainer</span><br><span class=\"line\">Creating service deploy_deamon_nginx</span><br><span class=\"line\">Creating service deploy_deamon_visualizer</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ls</span><br><span class=\"line\">ID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS</span><br><span class=\"line\">xj2f1t5ax3nm        deploy_deamon_nginx        replicated          3/3                 nginx:latest                      *:8888-&gt;80/tcp</span><br><span class=\"line\">ky9qpldr5abb        deploy_deamon_portainer    replicated          1/1                 portainer/portainer:latest        *:9000-&gt;9000/tcp</span><br><span class=\"line\">r47ff177x1ir        deploy_deamon_visualizer   replicated          1/1                 dockersamples/visualizer:latest   *:8080-&gt;8080/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_nginx</span><br><span class=\"line\">ID                  NAME                    IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">z3v4uc1ujsnq        deploy_deamon_nginx.1   nginx:latest        node139             Running             Running about a minute ago                      </span><br><span class=\"line\">jhg3ups0cko5        deploy_deamon_nginx.2   nginx:latest        manager43           Running             Running about a minute ago                      </span><br><span class=\"line\">3e6guv791x21        deploy_deamon_nginx.3   nginx:latest        node188             Running             Running about a minute ago        </span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_portainer</span><br><span class=\"line\">ID                  NAME                        IMAGE                        NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">whyuvy82cvvw        deploy_deamon_portainer.1   portainer/portainer:latest   manager43           Running             Running about a minute ago                      </span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_visualizer</span><br><span class=\"line\">ID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">wge5w1eqykg3        deploy_deamon_visualizer.1   dockersamples/visualizer:latest   manager43           Running             Starting 7 seconds ago                     </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-7.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-8.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-9.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-10.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-11.png\" alt=\"img\"></p>\n<h2 id=\"Docker-Swarm-\"><a href=\"#Docker-Swarm-\" class=\"headerlink\" title=\"Docker Swarm \"></a>Docker Swarm </h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Docker1.12swarm(overlay networks)</span><br><span class=\"line\">ping</span><br><span class=\"line\">   </span><br><span class=\"line\">swarm</span><br><span class=\"line\">1</span><br><span class=\"line\">2service discoveryswarmIP(vip)DNS</span><br><span class=\"line\">3DNSVIP</span><br><span class=\"line\">4swarmswarmswarm</span><br><span class=\"line\">5TCP/UDP7946  </span><br><span class=\"line\">6UDP4789  </span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\">-----------Swarmoverlay------------</span><br><span class=\"line\">[root@manager-node ~]# docker network create --driver overlay --opt encrypted --subnet 10.10.19.0/24 ngx_net</span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\">opt encrypted  swarmopt encryptedvxlan</span><br><span class=\"line\">--subnet overlayswarm</span><br><span class=\"line\">   </span><br><span class=\"line\">[root@manager-node ~]# docker network ls</span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">d7aa48d3e485        bridge              bridge              local            </span><br><span class=\"line\">9e637a97a3b9        docker_gwbridge     bridge              local            </span><br><span class=\"line\">b5a41c8c71e7        host                host                local            </span><br><span class=\"line\">7f4fx3jf4dbr        ingress             overlay             swarm            </span><br><span class=\"line\">3x2wgugr6zmn        ngx_net             overlay             swarm            </span><br><span class=\"line\">0808a5c72a0a        none                null                local</span><br><span class=\"line\">   </span><br><span class=\"line\">Swarm2&quot;ngx_net&quot;&quot;ingress&quot;</span><br><span class=\"line\">Swarm  ingress </span><br><span class=\"line\">managerSCOPE swarm Swarm</span><br><span class=\"line\">Swarmworkerworkerswarm</span><br><span class=\"line\">worker</span><br><span class=\"line\">   </span><br><span class=\"line\">------------------overlay-------------------</span><br><span class=\"line\">[root@manager-node ~]# docker service create --replicas 5 --network ngx_net --name my-test -p 80:80 nginx</span><br><span class=\"line\">   </span><br><span class=\"line\">&quot;my-test&quot;3taskoverlaySwarmRunning</span><br><span class=\"line\">[root@manager-node ~]# docker service ls</span><br><span class=\"line\">ID            NAME     REPLICAS  IMAGE  COMMAND</span><br><span class=\"line\">dsaxs6v463g9  my-test  5/5       nginx</span><br><span class=\"line\">   </span><br><span class=\"line\">manager-noderunning</span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-test</span><br><span class=\"line\">ID                         NAME       IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR</span><br><span class=\"line\">8433fuiy7vpu0p80arl7vggfe  my-test.1  nginx  node2         Running        Running 2 minutes ago</span><br><span class=\"line\">f1h7a0vtojv18zrsiw8j0rzaw  my-test.2  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">ex73ifk3jvzw8ukurl8yu7fyq  my-test.3  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">cyu73jd8psupfhken23vvmpud  my-test.4  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">btorxekfix4hcqh4v83dr0tzw  my-test.5  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">   </span><br><span class=\"line\">runningmy-network</span><br><span class=\"line\">   </span><br><span class=\"line\">my-network</span><br><span class=\"line\">[root@manager-node ~]# docker network inspect ngx_net</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;Name&quot;: &quot;ngx_net&quot;,</span><br><span class=\"line\">        &quot;Id&quot;: &quot;3x2wgugr6zmn1mcyf9k1du27p&quot;,</span><br><span class=\"line\">        &quot;Scope&quot;: &quot;swarm&quot;,</span><br><span class=\"line\">        &quot;Driver&quot;: &quot;overlay&quot;,</span><br><span class=\"line\">        &quot;EnableIPv6&quot;: false,</span><br><span class=\"line\">        &quot;IPAM&quot;: &#123;</span><br><span class=\"line\">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class=\"line\">            &quot;Options&quot;: null,</span><br><span class=\"line\">            &quot;Config&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;Subnet&quot;: &quot;10.10.19.0/24&quot;,</span><br><span class=\"line\">                    &quot;Gateway&quot;: &quot;10.10.19.1&quot;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Internal&quot;: false,</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;00f47e38deea76269eb03ba13695ec0b0c740601c85019546d6a9a17fd434663&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.5.btorxekfix4hcqh4v83dr0tzw&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;ea962d07eee150b263ae631b8a7f8c1950337c11ef2c3d488a7c3717defd8601&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:03&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.3/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;957620c6f7abb44ad8dd2d842d333f5e5c1655034dc43e49abbbd680de3a5341&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.4.cyu73jd8psupfhken23vvmpud&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;f33a6e9ddf1dd01bcfc43ffefd19e19514658f001cdf9b2fbe23bc3fdf56a42a&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:07&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.7/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Options&quot;: &#123;</span><br><span class=\"line\">            &quot;com.docker.network.driver.overlay.vxlanid_list&quot;: &quot;257&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Labels&quot;: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">   </span><br><span class=\"line\">manager-nodemy-testmy-test.5.btorxekfix4hcqh4v83dr0tzw</span><br><span class=\"line\">my-test.4.cyu73jd8psupfhken23vvmpudtaskngx_netnode1node2</span><br><span class=\"line\">[root@node1 ~]# docker network inspect ngx_net</span><br><span class=\"line\">.......</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;7d9986fad5a7d834676ba76ae75aff2258f840953f1dc633c3ef3c0efd2b2501&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.3.ex73ifk3jvzw8ukurl8yu7fyq&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;957ca19f3d5480762dbd14fd9a6a1cd01a8deac3e8e35b23d1350f480a7b2f37&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:06&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.6/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;9e50fceada1d7c653a886ca29d2bf2606debafe8c8a97f2d79104faf3ecf8a46&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.2.f1h7a0vtojv18zrsiw8j0rzaw&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;b1c209c7b68634e88e0bf5e100fe03435b3096054da6555c61e6c207ac651ac2&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:05&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.5/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">.........</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 web]# docker network inspect ngx_net</span><br><span class=\"line\">........</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;4bdcce0ee63edc08d943cf4a049eac027719ff2dc14b7c3aa85fdddc5d1da968&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.1.8433fuiy7vpu0p80arl7vggfe&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;df58de85b0a0e4d128bf332fc783f6528d1f179b0f9f3b7aa70ebc832640d3bc&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:04&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.4/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">   </span><br><span class=\"line\">IP</span><br><span class=\"line\">[root@manager-node ~]# docker service inspect --format=&#x27;&#123;&#123;json .Endpoint.VirtualIPs&#125;&#125;&#x27; my-test</span><br><span class=\"line\">[&#123;&quot;NetworkID&quot;:&quot;7f4fx3jf4dbrp97aioc05pul4&quot;,&quot;Addr&quot;:&quot;10.255.0.6/16&quot;&#125;,&#123;&quot;NetworkID&quot;:&quot;3x2wgugr6zmn1mcyf9k1du27p&quot;,&quot;Addr&quot;:&quot;10.10.19.2/24&quot;&#125;]</span><br><span class=\"line\">   </span><br><span class=\"line\">10.10.19.2swarmvip</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/docker-swarm/docker-swarm-12.png\" alt=\"img\"></p>\n<p>ngx_netIP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID    IMAGE           COMMAND                  CREATED         STATUS             PORTS    NAMES</span><br><span class=\"line\">4bdcce0ee63e    nginx:latest    &quot;nginx -g &#x27;daemon off&quot;   22 minutes ago  Up 22 minutes      80/tcp   my-test.1.8433fuiy7vpu0p80arl7vggfe</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 ~]# docker exec -ti 4bdcce0ee63e /bin/bash</span><br><span class=\"line\">root@4bdcce0ee63e:/# ip addr                                                                                          </span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">    inet 127.0.0.1/8 scope host lo</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 ::1/128 scope host</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1786: eth0@if1787: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:0a:ff:00:08 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class=\"line\">    inet 10.255.0.8/16 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet 10.255.0.6/32 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:aff:feff:8/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1788: eth1@if1789: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class=\"line\">    inet 172.18.0.3/16 scope global eth1</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:acff:fe12:3/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1791: eth2@if1792: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:0a:0a:13:04 brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class=\"line\">    inet 10.10.19.4/24 scope global eth2</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet 10.10.19.2/32 scope global eth2</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:aff:fe0a:1304/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">  </span><br><span class=\"line\">root@4bdcce0ee63e:/# ping 10.10.19.3</span><br><span class=\"line\">PING 10.10.19.3 (10.10.19.3): 56 data bytes</span><br><span class=\"line\">64 bytes from 10.10.19.3: icmp_seq=0 ttl=64 time=0.890 ms</span><br><span class=\"line\">64 bytes from 10.10.19.3: icmp_seq=1 ttl=64 time=0.622 ms</span><br><span class=\"line\">.....-</span><br><span class=\"line\">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class=\"line\">round-trip min/avg/max/stddev = 0.622/0.756/0.890/0.134 ms</span><br><span class=\"line\">  </span><br><span class=\"line\">root@4bdcce0ee63e:/# ping 10.10.19.6</span><br><span class=\"line\">PING 10.10.19.6 (10.10.19.6): 56 data bytes</span><br><span class=\"line\">64 bytes from 10.10.19.6: icmp_seq=0 ttl=64 time=0.939 ms</span><br><span class=\"line\">64 bytes from 10.10.19.6: icmp_seq=1 ttl=64 time=0.590 ms</span><br><span class=\"line\">  </span><br><span class=\"line\">----------------------------swarm--------------------------</span><br><span class=\"line\">swarmVIPVIPDNSDNS</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">overlaySwarmVIP</span><br><span class=\"line\">activetask</span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">centosmy-testnginx</span><br><span class=\"line\">[root@manager-node ~]# docker service create --name my-centos --network ngx_net centos       </span><br><span class=\"line\">  </span><br><span class=\"line\">centoscentos</span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-centos</span><br><span class=\"line\">ID                         NAME             IMAGE   NODE   DESIRED STATE  CURRENT STATE            ERROR</span><br><span class=\"line\">e03pqgkjs3l1qizc6v4aqaune  my-centos.1      centos  node2  Running        Preparing 4 seconds ago</span><br><span class=\"line\">  </span><br><span class=\"line\">centosnode2centosshell</span><br><span class=\"line\">[root@node2 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS            NAMES</span><br><span class=\"line\">e4554490d891        centos:latest            &quot;/bin/bash&quot;             About an hour ago   Up About an hour   my-centos.1.9yk5ie28gwk9mw1h1jovb68ki</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 ~]# docker exec -ti my-centos.1.9yk5ie28gwk9mw1h1jovb68ki /bin/bash</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup my-test</span><br><span class=\"line\">Server: 127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name: my-test</span><br><span class=\"line\">Address 1: 10.10.19.2 10.10.19.2</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">centos DNSmy-testIP</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup tasks.my-test</span><br><span class=\"line\">Server: 127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name: tasks.my-test</span><br><span class=\"line\">Address 1: 10.10.19.4 my-test.1.8433fuiy7vpu0p80arl7vggfe</span><br><span class=\"line\">Address 2: 10.10.19.5 my-test.2.f1h7a0vtojv18zrsiw8j0rzaw</span><br><span class=\"line\">Address 3: 10.10.19.6 my-test.3.ex73ifk3jvzw8ukurl8yu7fyq</span><br><span class=\"line\">Address 2: 10.10.19.7 my-test.4.cyu73jd8psupfhken23vvmpud</span><br><span class=\"line\">Address 3: 10.10.19.3 my-test.5.btorxekfix4hcqh4v83dr0tzw</span><br><span class=\"line\">  </span><br><span class=\"line\">centoswgetmy-testnginx</span><br><span class=\"line\">root@4bdcce0ee63e:/# wget -O- my-test     </span><br><span class=\"line\">Connecting to my-test (10.10.19.2:80)</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">SwarmHTTPVIPactivetaskround-robinactivetask</span><br><span class=\"line\">  </span><br><span class=\"line\">-----------------------------------DNS round-robin-----------------------------</span><br><span class=\"line\">DNS round-robinVIP --endpoint-mode dnsrr </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">DNS round-robin-p</span><br><span class=\"line\">[root@manager-node ~]# docker service create --replicas 3 --name my-dnsrr-nginx --network ngx_net --endpoint-mode dnsrr nginx</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-dnsrr-nginx</span><br><span class=\"line\">ID                         NAME              IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR</span><br><span class=\"line\">65li2zbhxvvoaesndmwjokouj  my-dnsrr-nginx.1  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">5hjw7wm4xr877879m0ewjciuj  my-dnsrr-nginx.2  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">afo7acduge2qfy60e87liz557  my-dnsrr-nginx.3  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">DNSDNSIP</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup my-dnsrr-nginx</span><br><span class=\"line\">Server:    127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name:      my-dnsrr-nginx</span><br><span class=\"line\">Address 1: 10.10.19.10 my-dnsrr-nginx.3.0sm1n9o8hygzarv5t5eq46okn.my-network</span><br><span class=\"line\">Address 2: 10.10.19.9  my-dnsrr-nginx.2.b3o1uoa8m003b2kk0ytl9lawh.my-network</span><br><span class=\"line\">Address 3: 10.10.19.8  my-dnsrr-nginx.1.55za4c83jq9846rle6eigiq15.my-network</span><br><span class=\"line\">  </span><br><span class=\"line\">VIP</span><br><span class=\"line\">DockerdignslookupDNSDNSVIPIPpingVIP</span><br></pre></td></tr></table></figure>\n\n\n\n<p><a href=\"https://www.cnblogs.com/zhujingzhi/p/9792432.html\">https://www.cnblogs.com/zhujingzhi/p/9792432.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Docker-Swarm\"><a href=\"#Docker-Swarm\" class=\"headerlink\" title=\"Docker Swarm\"></a>Docker Swarm</h2><p><img src=\"/images/docker-swarm/docker-swarm-1.png\" alt=\"img\"></p>\n<p>SwarmDockerdockerGO<a href=\"https://github.com/docker/swarm%EF%BC%8C\">https://github.com/docker/swarm</a> DockerSwarmDocker APIDocker</p>\n<p>Client(compose,docker-py)SwarmDockerSwarmSwarmSwarmDocker</p>\n<p>Docker Swarm  Docker Compose  Docker Docker Compose  Docker Swarm  Docker Swarm </p>\n<p> Docker 1.12.0 Docker Swarm  Docker docker swarm Etcd  Consul </p>\n<p>Swarm deamon(Scheduler)(router),SwarmDockerSwarmSwarm</p>\n<h2 id=\"Docker-Swarm-\"><a href=\"#Docker-Swarm-\" class=\"headerlink\" title=\"Docker Swarm \"></a>Docker Swarm </h2><p><img src=\"/images/docker-swarm/docker-swarm-2.png\" alt=\"img\"></p>\n<p> Docker ClientSwarm (Cluster)</p>\n<p>Swarmmaster-slavemanagermanagernodeagentmanagerRaftmanagerDNS</p>\n<h2 id=\"-Swarm\"><a href=\"#-Swarm\" class=\"headerlink\" title=\".Swarm\"></a>.Swarm</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.Swarm</span><br><span class=\"line\">dockerSwarmKitdockerswarmswarm</span><br><span class=\"line\"> </span><br><span class=\"line\">2.Node</span><br><span class=\"line\">dockerDockerDocker</span><br><span class=\"line\">swarm  </span><br><span class=\"line\">ManagerManager</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">3.Service</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">4.Task</span><br><span class=\"line\">docekrManagerworker</span><br><span class=\"line\"> </span><br><span class=\"line\">-------------------------------------------------------------------------------</span><br><span class=\"line\">docker swarminit, join, leave, updatedocker swarm --help</span><br><span class=\"line\">docker servicecreate, inspect, update, remove, tasksdocker service--help</span><br><span class=\"line\">docker nodeaccept, promote, demote, inspect, update, tasks, ls, rmdocker node --help</span><br><span class=\"line\">   </span><br><span class=\"line\">nodeswarmdockernodenode</span><br><span class=\"line\">manager nodes</span><br><span class=\"line\">worker nodes</span><br><span class=\"line\"> </span><br><span class=\"line\">1manager nodeleader</span><br><span class=\"line\">2worker nodetask</span><br><span class=\"line\">3service</span><br><span class=\"line\">   serviceworker nodestaskservicedocker </span><br><span class=\"line\">4tasktaskservicetaskdocker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Swarm\"><a href=\"#Swarm\" class=\"headerlink\" title=\"Swarm\"></a>Swarm</h2><ol>\n<li>Node</li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-3.png\" alt=\"img\"></p>\n<ol start=\"2\">\n<li>Service</li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-4.png\" alt=\"img\"></p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-5.png\" alt=\"img\"></p>\n<ol start=\"4\">\n<li></li>\n</ol>\n<p><img src=\"/images/docker-swarm/docker-swarm-6.png\" alt=\"img\"></p>\n<h2 id=\"Swarm\"><a href=\"#Swarm\" class=\"headerlink\" title=\"Swarm\"></a>Swarm</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Swarm(scheduler)leaderspread, binpack, random.</span><br><span class=\"line\">1Random</span><br><span class=\"line\">NodespreadbinpackCPU, RAM</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">2Spread</span><br><span class=\"line\">Spreadbinpack</span><br><span class=\"line\">Spread</span><br><span class=\"line\">  </span><br><span class=\"line\">3Binpack</span><br><span class=\"line\">Binpackbinpack</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Swarm-Cluster\"><a href=\"#Swarm-Cluster\" class=\"headerlink\" title=\"Swarm Cluster\"></a>Swarm Cluster</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">overlay</span><br><span class=\"line\">   </span><br><span class=\"line\">2</span><br><span class=\"line\">cluster--replicas n</span><br><span class=\"line\">load balance</span><br><span class=\"line\">docker serviceCluster</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">3</span><br><span class=\"line\">Swarm Clusterscale</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">runrun</span><br><span class=\"line\">&quot;--replicas n&quot;&quot;--mode=global&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">--replicas n</span><br><span class=\"line\">--replicas 3</span><br><span class=\"line\">  </span><br><span class=\"line\">--mode=global</span><br><span class=\"line\">--mode global Swarm  7  Docker </span><br><span class=\"line\">   </span><br><span class=\"line\">4. </span><br><span class=\"line\">clusterserver</span><br><span class=\"line\">constraintswarm cluster </span><br><span class=\"line\">   </span><br><span class=\"line\">------------------Swarm cluster----------------------</span><br><span class=\"line\">1Docker</span><br><span class=\"line\">2scheduler</span><br><span class=\"line\">3API</span><br><span class=\"line\">   </span><br><span class=\"line\">clusterdocker service</span><br><span class=\"line\">   </span><br><span class=\"line\">docker swarmtask&quot;docker service ls&quot; &quot;docker service ps + taskID&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dcoker-Swarm-\"><a href=\"#Dcoker-Swarm-\" class=\"headerlink\" title=\"Dcoker Swarm \"></a>Dcoker Swarm </h2><p></p>\n<p>(centos)</p>\n<p>IP192.168.31.43 manager43 swarm manager</p>\n<p>IP192.168.31.188 node188 swarm node</p>\n<p>IP192.168.31.139 node139 swarm node</p>\n<p>1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) </span><br><span class=\"line\"># 192.168.31.43  </span><br><span class=\"line\">[root@manager43 ~]# hostnamectl set-hostname manager43</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.188 </span><br><span class=\"line\">[root@node188 ~]# hostnamectl set-hostname node188</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.139 </span><br><span class=\"line\">[root@node139 ~]# hostnamectl set-hostname node139</span><br><span class=\"line\"> </span><br><span class=\"line\">2)hosts()</span><br><span class=\"line\">[root@manager43 ~]# cat /etc/hosts</span><br><span class=\"line\">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class=\"line\">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class=\"line\"> </span><br><span class=\"line\">192.168.31.43 manager43</span><br><span class=\"line\">192.168.31.188 node188</span><br><span class=\"line\">192.168.31.139 node139</span><br><span class=\"line\"> </span><br><span class=\"line\"># scpnode</span><br><span class=\"line\">[root@manager43 ~]# scp /etc/hosts root@192.168.31.188:/etc/hosts</span><br><span class=\"line\">[root@manager43 ~]# scp /etc/hosts root@192.168.31.139:/etc/hosts</span><br><span class=\"line\"> </span><br><span class=\"line\">3) </span><br><span class=\"line\">2377/tcp7946/udp4789/udpoverlay </span><br><span class=\"line\">[root@manager43 ~]# systemctl disable firewalld.service</span><br><span class=\"line\">[root@manager43 ~]# systemctl stop firewalld.service</span><br><span class=\"line\"> </span><br><span class=\"line\">4) docker(...)</span><br><span class=\"line\">[root@manager43 ~]# yum -y install docker</span><br><span class=\"line\">[root@node188 ~]# yum -y install docker</span><br><span class=\"line\">[root@node139 ~]# yum -y install docker</span><br></pre></td></tr></table></figure>\n\n<p>docker<a href=\"https://www.cnblogs.com/zhujingzhi/p/9656298.html\">docker</a></p>\n<p>:<a href=\"https://www.cnblogs.com/brianzhu/p/8565411.html\">docker</a></p>\n<p>2Swarm</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) Swarm</span><br><span class=\"line\">[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43</span><br><span class=\"line\">Swarm initialized: current node (z2n633mty5py7u9wyl423qnq0) is now a manager.</span><br><span class=\"line\"> </span><br><span class=\"line\">To add a worker to this swarm, run the following command:</span><br><span class=\"line\"> </span><br><span class=\"line\">    # (tokentoken)</span><br><span class=\"line\">    docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377  </span><br><span class=\"line\"> </span><br><span class=\"line\">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class=\"line\"> </span><br><span class=\"line\">swarmtoken tokentoken</span><br><span class=\"line\">--advertise-addrswarmworkeripmanager</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker swarm init --advertise-addr 192.168.31.43</span><br><span class=\"line\">Error response from daemon: This node is already part of a swarm. Use &quot;docker swarm leave&quot; to leave this swarm and join another one.</span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker swarm leave -f</span><br><span class=\"line\">leave-fOK</span><br><span class=\"line\"> </span><br><span class=\"line\">2) </span><br><span class=\"line\">[root@manager43 ~]# docker info</span><br><span class=\"line\"> Swarm</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">(node ID*)</span><br><span class=\"line\"> </span><br><span class=\"line\">3) Swarm</span><br><span class=\"line\">Swarm</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.188 </span><br><span class=\"line\">[root@node188 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377</span><br><span class=\"line\">This node joined a swarm as a worker.</span><br><span class=\"line\"> </span><br><span class=\"line\"># 192.168.31.139 </span><br><span class=\"line\">[root@node139 ~]# docker swarm join --token SWMTKN-1-2lefzq18zohy9yr1vskutf1sfb2a590xz9d0mjj2m15zu9eprw-2938j5f50t35ycut0vbj2sx0s 192.168.31.43:2377</span><br><span class=\"line\">This node joined a swarm as a worker.</span><br><span class=\"line\"> </span><br><span class=\"line\">swarm</span><br><span class=\"line\"> </span><br><span class=\"line\">manager43</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\"> </span><br><span class=\"line\">--------------------------------------------------------------------------------------------------------------------</span><br><span class=\"line\">availablity</span><br><span class=\"line\">swarmnodeavailability activedrain</span><br><span class=\"line\">activenodemanager</span><br><span class=\"line\">drainnodetaskmanager</span><br><span class=\"line\">[root@manager43 ~]# docker node update --availability drain node139               # node139node139&quot;docker node rm --force node139&quot;</span><br><span class=\"line\">node139</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Drain                                   18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\"> </span><br><span class=\"line\">node1draintask</span><br><span class=\"line\">active</span><br><span class=\"line\">[root@manager43 ~]# docker node update --availability active node139</span><br><span class=\"line\">node139</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">3jcmnzjh0e99ipgshk1ykuovd *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">vww7ue2xprzg46bjx7afo4h04     node139             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">c5klw5ns4adcvumzgiv66xpyj     node188             Ready               Active                                  18.06.1-ce</span><br></pre></td></tr></table></figure>\n\n<p>3Swarm(nginx)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Docker 1.12Scalinghealth checkdnsvipservice</span><br><span class=\"line\">1) </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker network create -d overlay nginx_net</span><br><span class=\"line\">a52jy33asc5o0ts0rq823bf0m</span><br><span class=\"line\">[root@manager43 ~]# docker network ls | grep nginx_net</span><br><span class=\"line\">a52jy33asc5o        nginx_net           overlay             swarm</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 1 --network nginx_net --name my_nginx -p 80:80 nginx    # --replicas 1 nginxnginx</span><br><span class=\"line\">olexfmtdf94sxyeetkchwhehg</span><br><span class=\"line\">overall progress: 1 out of 1 tasks</span><br><span class=\"line\">1/1: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\">manager-nodenginx</span><br><span class=\"line\">--replicas </span><br><span class=\"line\">nginxtomcattomcat</span><br><span class=\"line\"> </span><br><span class=\"line\">#  docker service ls </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">olexfmtdf94s        my_nginx            replicated          1/1                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">2) Swarm</span><br><span class=\"line\">-pretty  --pretty </span><br><span class=\"line\">[root@manager43 ~]# docker service inspect --pretty my_nginx</span><br><span class=\"line\">ID:             zs7fw4ereo5w7ohd4n9ii06nt</span><br><span class=\"line\">Name:           my_nginx</span><br><span class=\"line\">Service Mode:   Replicated</span><br><span class=\"line\"> Replicas:      1</span><br><span class=\"line\">Placement:</span><br><span class=\"line\">UpdateConfig:</span><br><span class=\"line\"> Parallelism:   1</span><br><span class=\"line\"> On failure:    pause</span><br><span class=\"line\"> Monitoring Period: 5s</span><br><span class=\"line\"> Max failure ratio: 0</span><br><span class=\"line\"> Update order:      stop-first</span><br><span class=\"line\">RollbackConfig:</span><br><span class=\"line\"> Parallelism:   1</span><br><span class=\"line\"> On failure:    pause</span><br><span class=\"line\"> Monitoring Period: 5s</span><br><span class=\"line\"> Max failure ratio: 0</span><br><span class=\"line\"> Rollback order:    stop-first</span><br><span class=\"line\">ContainerSpec:</span><br><span class=\"line\"> Image:         nginx:latest@sha256:b73f527d86e3461fd652f62cf47e7b375196063bbbd503e853af5be16597cb2e</span><br><span class=\"line\"> Init:          false</span><br><span class=\"line\">Resources:</span><br><span class=\"line\">Networks: nginx_net</span><br><span class=\"line\">Endpoint Mode:  vip</span><br><span class=\"line\">Ports:</span><br><span class=\"line\"> PublishedPort = 80</span><br><span class=\"line\">  Protocol = tcp</span><br><span class=\"line\">  TargetPort = 80</span><br><span class=\"line\">  PublishMode = ingress</span><br><span class=\"line\"> </span><br><span class=\"line\"># manager-nodehttp://192.168.31.43</span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      </span><br><span class=\"line\"> STATE  Preparing Running </span><br><span class=\"line\"> </span><br><span class=\"line\">manager-nodenginx</span><br><span class=\"line\">[root@manager43 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">0dc7103f8030        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj</span><br><span class=\"line\"> </span><br><span class=\"line\">3) Swarm(scale)</span><br><span class=\"line\">serviceswarmServicekubernetes docker service scale </span><br><span class=\"line\">my_nginx4</span><br><span class=\"line\">[root@manager43 ~]# docker service scale my_nginx=4</span><br><span class=\"line\">my_nginx scaled to 4</span><br><span class=\"line\">overall progress: 4 out of 4 tasks</span><br><span class=\"line\">1/4: running   [==================================================&gt;]</span><br><span class=\"line\">2/4: running   [==================================================&gt;]</span><br><span class=\"line\">3/4: running   [==================================================&gt;]</span><br><span class=\"line\">4/4: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">scale nginx </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE               ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                      </span><br><span class=\"line\">mlprstt9ds5x        my_nginx.2          nginx:latest        node139             Running             Running 52 seconds ago                         </span><br><span class=\"line\">y09lk90tdzdp        my_nginx.3          nginx:latest        node139             Running             Running 52 seconds ago                         </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 2 minutes ago  </span><br><span class=\"line\"> </span><br><span class=\"line\">my_nginxmanager-node3</span><br><span class=\"line\">4my_nginxmy_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">4) node</span><br><span class=\"line\"></span><br><span class=\"line\">swarmDocker</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">node139node139dockertasknode139task</span><br><span class=\"line\">task&quot;docker node ls&quot;node139swarm(Down)</span><br><span class=\"line\">[root@node139 ~]# systemctl stop docker</span><br><span class=\"line\">[root@manager43 ~]# docker node ls</span><br><span class=\"line\">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class=\"line\">ppk7q0bjond8a58xja7in1qid *   manager43           Ready               Active              Leader              18.06.0-ce</span><br><span class=\"line\">mums8azgbrffnecp3q8fz70pl     node139             Down                Active                                  18.06.1-ce</span><br><span class=\"line\">z3n36maf03yjg7odghikuv574     node188             Ready               Active                                  18.06.1-ce</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running about an hour ago                       </span><br><span class=\"line\">wb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Running             Running about a minute ago                      </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 4 minutes ago                           </span><br><span class=\"line\">rhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Running             Running about a minute ago                      </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 4 minutes ago                           </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 6 minutes ago</span><br><span class=\"line\"> </span><br><span class=\"line\">node139tasknode188manager43</span><br><span class=\"line\"> </span><br><span class=\"line\">node188manager43task192.168.31.188192.168.31.4380swarm</span><br><span class=\"line\">[root@manager43 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">ae4c5c2e6f3f        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   4 minutes ago       Up 4 minutes        80/tcp              my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\">0dc7103f8030        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   About an hour ago   Up About an hour    80/tcp              my_nginx.1.yzonph0zu7km0211uj0ro5brj</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@node188 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">a63ef253f7dd        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   3 minutes ago       Up 3 minutes        80/tcp              my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">74a1a1db81d4        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   8 minutes ago       Up 8 minutes        80/tcp              my_nginx.4.clolfl3zlvj0ewmh85c2ljnza</span><br><span class=\"line\"> </span><br><span class=\"line\">node188manager43node139task</span><br><span class=\"line\">[root@manager43 ~]# docker stop my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\">my_nginx.3.rhbj4bcr4t2c3y2f8vyfmbi21</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@node188 ~]# docker stop my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\"> </span><br><span class=\"line\">tasknode139</span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 2 hours ago                          </span><br><span class=\"line\">j2q61f8jtzba        my_nginx.2          nginx:latest        node188             Running             Running 24 seconds ago                       </span><br><span class=\"line\">wb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 29 seconds ago                      </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Running 11 minutes ago                       </span><br><span class=\"line\">oz9wyjuldw1t        my_nginx.3          nginx:latest        manager43           Running             Running 40 seconds ago                       </span><br><span class=\"line\">rhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 45 seconds ago                      </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Running 11 minutes ago                       </span><br><span class=\"line\">clolfl3zlvj0        my_nginx.4          nginx:latest        node188             Running             Running 12 minutes ago    </span><br><span class=\"line\">swarm clusterworker nodeworker node</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">5) Swarm (scale)</span><br><span class=\"line\">swarmscale</span><br><span class=\"line\">my_nginx1</span><br><span class=\"line\">[root@manager43 ~]# docker service scale my_nginx=1</span><br><span class=\"line\">my_nginx scaled to 1</span><br><span class=\"line\">overall progress: 1 out of 1 tasks</span><br><span class=\"line\">1/1:  </span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          1/1                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE             ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                         </span><br><span class=\"line\">wb1cpk9k22rl        my_nginx.2          nginx:latest        node188             Shutdown            Complete 9 hours ago                         </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago                      </span><br><span class=\"line\">rhbj4bcr4t2c        my_nginx.3          nginx:latest        manager43           Shutdown            Complete 9 hours ago                         </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 29 seconds ago      </span><br><span class=\"line\"> </span><br><span class=\"line\">docker service ps my_nginx nodeShutdown</span><br><span class=\"line\"> </span><br><span class=\"line\">node</span><br><span class=\"line\">[root@node188 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class=\"line\">f93c0a27374a        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 44 seconds ago                       my_nginx.2.j2q61f8jtzba9kb3unupkhl25</span><br><span class=\"line\">a63ef253f7dd        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                          my_nginx.2.wb1cpk9k22rl1ydab7aozl2b5</span><br><span class=\"line\">[root@node139 ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS               NAMES</span><br><span class=\"line\">e8ac2e44f5c4        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                       my_nginx.2.mlprstt9ds5xi48u1rzscgfdk</span><br><span class=\"line\">5b031aa5a2cc        nginx:latest        &quot;nginx -g &#x27;daemon of&quot;   9 hours ago         Exited (0) 9 hours ago                       my_nginx.3.y09lk90tdzdp8cwj6mm5oyr3f</span><br><span class=\"line\">nodedocker ps -a stoprm</span><br><span class=\"line\"> </span><br><span class=\"line\">6) scaledocker service update      /</span><br><span class=\"line\">[root@manager43 ~]# docker service update --replicas 3 my_nginx</span><br><span class=\"line\">my_nginx</span><br><span class=\"line\">overall progress: 3 out of 3 tasks</span><br><span class=\"line\">1/3: running   [==================================================&gt;]</span><br><span class=\"line\">2/3: running   [==================================================&gt;]</span><br><span class=\"line\">3/3: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:latest        *:80-&gt;80/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ps my_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">yzonph0zu7km        my_nginx.1          nginx:latest        manager43           Running             Running 11 hours ago                        </span><br><span class=\"line\">j3hduzd9pret        my_nginx.2          nginx:latest        node188             Running             Running 18 seconds ago                      </span><br><span class=\"line\">wb1cpk9k22rl         \\_ my_nginx.2      nginx:latest        node188             Shutdown            Complete 9 hours ago                        </span><br><span class=\"line\">mlprstt9ds5x         \\_ my_nginx.2      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago                      </span><br><span class=\"line\">gng96vc5vqpv        my_nginx.3          nginx:latest        node139             Running             Running 18 seconds ago                      </span><br><span class=\"line\">rhbj4bcr4t2c         \\_ my_nginx.3      nginx:latest        manager43           Shutdown            Complete 9 hours ago                        </span><br><span class=\"line\">y09lk90tdzdp         \\_ my_nginx.3      nginx:latest        node139             Shutdown            Shutdown 4 minutes ago    </span><br><span class=\"line\"> </span><br><span class=\"line\">docker service update   </span><br><span class=\"line\">[root@manager43 ~]# docker service update --image nginx:new my_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">zs7fw4ereo5w        my_nginx            replicated          3/3                 nginx:new           *:80-&gt;80/tcp</span><br><span class=\"line\">IMAGE nginx:new</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">7) my_nginx</span><br><span class=\"line\">[root@manager43 ~]# docker service rm my_nginx</span><br><span class=\"line\"> </span><br><span class=\"line\">task</span><br></pre></td></tr></table></figure>\n\n<p>4SwarmVolume(mount)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume --help</span><br><span class=\"line\"> </span><br><span class=\"line\">Usage:  docker volume COMMAND</span><br><span class=\"line\"> </span><br><span class=\"line\">Manage volumes</span><br><span class=\"line\"> </span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  create      Create a volume</span><br><span class=\"line\">  inspect     Display detailed information on one or more volumes</span><br><span class=\"line\">  ls          List volumes</span><br><span class=\"line\">  prune       Remove all unused local volumes</span><br><span class=\"line\">  rm          Remove one or more volumes</span><br><span class=\"line\"> </span><br><span class=\"line\">Run &#x27;docker volume COMMAND --help&#x27; for more information on a command.</span><br><span class=\"line\"> </span><br><span class=\"line\">2) volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume create --name testvolume</span><br><span class=\"line\">testvolume</span><br><span class=\"line\"> </span><br><span class=\"line\"># volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume ls</span><br><span class=\"line\">DRIVER              VOLUME NAME</span><br><span class=\"line\">local               testvolume</span><br><span class=\"line\"> </span><br><span class=\"line\"># volume</span><br><span class=\"line\">[root@manager43 ~]# docker volume inspect testvolume</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;CreatedAt&quot;: &quot;2018-10-21T10:50:02+08:00&quot;,</span><br><span class=\"line\">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class=\"line\">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class=\"line\">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/testvolume/_data&quot;,</span><br><span class=\"line\">        &quot;Name&quot;: &quot;testvolume&quot;,</span><br><span class=\"line\">        &quot;Options&quot;: &#123;&#125;,</span><br><span class=\"line\">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">3) testvolume(nginx)</span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 3 --mount type=volume,src=testvolume,dst=/zjz --name test_nginx nginx</span><br><span class=\"line\">sh7wc8yzcvr0xaedo4tnraj7l</span><br><span class=\"line\">overall progress: 3 out of 3 tasks</span><br><span class=\"line\">1/3: running   [==================================================&gt;]</span><br><span class=\"line\">2/3: running   [==================================================&gt;]</span><br><span class=\"line\">3/3: running   [==================================================&gt;]</span><br><span class=\"line\">verify: Service converged</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">srcsourcedsttarget</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service ls</span><br><span class=\"line\">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class=\"line\">sh7wc8yzcvr0        test_nginx          replicated          3/3                 nginx:latest       </span><br><span class=\"line\">[root@manager43 ~]# docker service ps test_nginx</span><br><span class=\"line\">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">m7m41kwt4q6w        test_nginx.1        nginx:latest        node188             Running             Running 56 seconds ago                      </span><br><span class=\"line\">kayh81q1o1kx        test_nginx.2        nginx:latest        node139             Running             Running 56 seconds ago                      </span><br><span class=\"line\">eq11v0rcwy38        test_nginx.3        nginx:latest        manager43           Running             Running 56 seconds ago           </span><br><span class=\"line\"> </span><br><span class=\"line\"># ()</span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker exec -it 63451219cb4e /bin/bash</span><br><span class=\"line\">root@63451219cb4e:/# cd /zjz/</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">root@63451219cb4e:/zjz# echo &quot;gen wo xue docker&quot; &gt; docker.txt</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\"> </span><br><span class=\"line\">docker volume inspect testvolume ()</span><br><span class=\"line\">/var/lib/docker/volumes/testvolume/_data</span><br><span class=\"line\">[root@manager43 ~]# cd /var/lib/docker/volumes/testvolume/_data</span><br><span class=\"line\">[root@manager43 _data]# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\">[root@manager43 _data]# cat docker.txt</span><br><span class=\"line\">gen wo xue docker</span><br><span class=\"line\"> </span><br><span class=\"line\">nodevolume</span><br><span class=\"line\">[root@manager43 _data]# ln -s /var/lib/docker/volumes/testvolume/_data /zjz</span><br><span class=\"line\">[root@manager43 _data]# cd /zjz/</span><br><span class=\"line\">[root@manager43 zjz]# ls</span><br><span class=\"line\">docker.txt</span><br><span class=\"line\">[root@manager43 zjz]# echo &quot;123&quot; &gt; 1.txt  </span><br><span class=\"line\">[root@manager43 zjz]# ll</span><br><span class=\"line\"> 8</span><br><span class=\"line\">-rw-r--r-- 1 root root  4 10 21 11:04 1.txt</span><br><span class=\"line\">-rw-r--r-- 1 root root 18 10 21 11:00 docker.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 zjz]# docker exec -it 63451219cb4e /bin/bash</span><br><span class=\"line\">root@63451219cb4e:/# cd /zjz/</span><br><span class=\"line\">root@63451219cb4e:/zjz# ls</span><br><span class=\"line\">1.txt  docker.txt</span><br><span class=\"line\">root@63451219cb4e:/zjz# cat 1.txt</span><br><span class=\"line\">123</span><br><span class=\"line\">root@63451219cb4e:/zjz# cat docker.txt</span><br><span class=\"line\">gen wo xue docker</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\"></span><br><span class=\"line\">docker service create --mount type=bind,target=/container_data/,source=/host_data/</span><br><span class=\"line\">targetsource</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 ~]# docker service create --replicas 1 --mount type=bind,target=/usr/share/nginx/html/,source=/opt/web/ --network nginx_net --name zjz_nginx -p 8880:80 nginx</span><br></pre></td></tr></table></figure>\n\n<p>5Swarm</p>\n<p>nginx<br>docker compose docker-compose.ymlcomposeswarm(<a href=\"https://www.cnblogs.com/zhujingzhi/p/9786622.html\">docker compose</a>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">(nginxvisualizerportainer)  GUI </span><br><span class=\"line\">docker servicedocker stack</span><br><span class=\"line\"> </span><br><span class=\"line\">1) docker-compose.yml</span><br><span class=\"line\">[root@manager43 ~]# mkdir testswarm</span><br><span class=\"line\">[root@manager43 ~]# cd testswarm/</span><br><span class=\"line\">[root@manager43 testswarm]# cat docker-compose.yml</span><br><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  nginx:</span><br><span class=\"line\">    image: nginx</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - 8888:80</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      mode: replicated</span><br><span class=\"line\">      replocas: 3</span><br><span class=\"line\"> </span><br><span class=\"line\">  visualizer:</span><br><span class=\"line\">    image: dockersamples/visualizer</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8080:8080&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      replicas: 1</span><br><span class=\"line\">      placement:</span><br><span class=\"line\">        constraints: [node.role == manager]</span><br><span class=\"line\"> </span><br><span class=\"line\">  portainer:</span><br><span class=\"line\">    image: portainer/portainer</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;9000:9000&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class=\"line\">    deploy:</span><br><span class=\"line\">      replicas: 1</span><br><span class=\"line\">      placement:</span><br><span class=\"line\">        constraints: [node.role == manager]</span><br><span class=\"line\"> </span><br><span class=\"line\">2) yml</span><br><span class=\"line\">[root@manager43 testswarm]# docker stack deploy -c docker-compose.yml deploy_deamon</span><br><span class=\"line\">Creating network deploy_deamon_default</span><br><span class=\"line\">Creating service deploy_deamon_portainer</span><br><span class=\"line\">Creating service deploy_deamon_nginx</span><br><span class=\"line\">Creating service deploy_deamon_visualizer</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ls</span><br><span class=\"line\">ID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS</span><br><span class=\"line\">xj2f1t5ax3nm        deploy_deamon_nginx        replicated          3/3                 nginx:latest                      *:8888-&gt;80/tcp</span><br><span class=\"line\">ky9qpldr5abb        deploy_deamon_portainer    replicated          1/1                 portainer/portainer:latest        *:9000-&gt;9000/tcp</span><br><span class=\"line\">r47ff177x1ir        deploy_deamon_visualizer   replicated          1/1                 dockersamples/visualizer:latest   *:8080-&gt;8080/tcp</span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_nginx</span><br><span class=\"line\">ID                  NAME                    IMAGE               NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">z3v4uc1ujsnq        deploy_deamon_nginx.1   nginx:latest        node139             Running             Running about a minute ago                      </span><br><span class=\"line\">jhg3ups0cko5        deploy_deamon_nginx.2   nginx:latest        manager43           Running             Running about a minute ago                      </span><br><span class=\"line\">3e6guv791x21        deploy_deamon_nginx.3   nginx:latest        node188             Running             Running about a minute ago        </span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_portainer</span><br><span class=\"line\">ID                  NAME                        IMAGE                        NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class=\"line\">whyuvy82cvvw        deploy_deamon_portainer.1   portainer/portainer:latest   manager43           Running             Running about a minute ago                      </span><br><span class=\"line\"> </span><br><span class=\"line\">[root@manager43 testswarm]# docker service ps deploy_deamon_visualizer</span><br><span class=\"line\">ID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class=\"line\">wge5w1eqykg3        deploy_deamon_visualizer.1   dockersamples/visualizer:latest   manager43           Running             Starting 7 seconds ago                     </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-7.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-8.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-9.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-10.png\" alt=\"img\"></p>\n<p><img src=\"/images/docker-swarm/docker-swarm-11.png\" alt=\"img\"></p>\n<h2 id=\"Docker-Swarm-\"><a href=\"#Docker-Swarm-\" class=\"headerlink\" title=\"Docker Swarm \"></a>Docker Swarm </h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Docker1.12swarm(overlay networks)</span><br><span class=\"line\">ping</span><br><span class=\"line\">   </span><br><span class=\"line\">swarm</span><br><span class=\"line\">1</span><br><span class=\"line\">2service discoveryswarmIP(vip)DNS</span><br><span class=\"line\">3DNSVIP</span><br><span class=\"line\">4swarmswarmswarm</span><br><span class=\"line\">5TCP/UDP7946  </span><br><span class=\"line\">6UDP4789  </span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\">-----------Swarmoverlay------------</span><br><span class=\"line\">[root@manager-node ~]# docker network create --driver overlay --opt encrypted --subnet 10.10.19.0/24 ngx_net</span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\">opt encrypted  swarmopt encryptedvxlan</span><br><span class=\"line\">--subnet overlayswarm</span><br><span class=\"line\">   </span><br><span class=\"line\">[root@manager-node ~]# docker network ls</span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">d7aa48d3e485        bridge              bridge              local            </span><br><span class=\"line\">9e637a97a3b9        docker_gwbridge     bridge              local            </span><br><span class=\"line\">b5a41c8c71e7        host                host                local            </span><br><span class=\"line\">7f4fx3jf4dbr        ingress             overlay             swarm            </span><br><span class=\"line\">3x2wgugr6zmn        ngx_net             overlay             swarm            </span><br><span class=\"line\">0808a5c72a0a        none                null                local</span><br><span class=\"line\">   </span><br><span class=\"line\">Swarm2&quot;ngx_net&quot;&quot;ingress&quot;</span><br><span class=\"line\">Swarm  ingress </span><br><span class=\"line\">managerSCOPE swarm Swarm</span><br><span class=\"line\">Swarmworkerworkerswarm</span><br><span class=\"line\">worker</span><br><span class=\"line\">   </span><br><span class=\"line\">------------------overlay-------------------</span><br><span class=\"line\">[root@manager-node ~]# docker service create --replicas 5 --network ngx_net --name my-test -p 80:80 nginx</span><br><span class=\"line\">   </span><br><span class=\"line\">&quot;my-test&quot;3taskoverlaySwarmRunning</span><br><span class=\"line\">[root@manager-node ~]# docker service ls</span><br><span class=\"line\">ID            NAME     REPLICAS  IMAGE  COMMAND</span><br><span class=\"line\">dsaxs6v463g9  my-test  5/5       nginx</span><br><span class=\"line\">   </span><br><span class=\"line\">manager-noderunning</span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-test</span><br><span class=\"line\">ID                         NAME       IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR</span><br><span class=\"line\">8433fuiy7vpu0p80arl7vggfe  my-test.1  nginx  node2         Running        Running 2 minutes ago</span><br><span class=\"line\">f1h7a0vtojv18zrsiw8j0rzaw  my-test.2  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">ex73ifk3jvzw8ukurl8yu7fyq  my-test.3  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">cyu73jd8psupfhken23vvmpud  my-test.4  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">btorxekfix4hcqh4v83dr0tzw  my-test.5  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">   </span><br><span class=\"line\">runningmy-network</span><br><span class=\"line\">   </span><br><span class=\"line\">my-network</span><br><span class=\"line\">[root@manager-node ~]# docker network inspect ngx_net</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;Name&quot;: &quot;ngx_net&quot;,</span><br><span class=\"line\">        &quot;Id&quot;: &quot;3x2wgugr6zmn1mcyf9k1du27p&quot;,</span><br><span class=\"line\">        &quot;Scope&quot;: &quot;swarm&quot;,</span><br><span class=\"line\">        &quot;Driver&quot;: &quot;overlay&quot;,</span><br><span class=\"line\">        &quot;EnableIPv6&quot;: false,</span><br><span class=\"line\">        &quot;IPAM&quot;: &#123;</span><br><span class=\"line\">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class=\"line\">            &quot;Options&quot;: null,</span><br><span class=\"line\">            &quot;Config&quot;: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    &quot;Subnet&quot;: &quot;10.10.19.0/24&quot;,</span><br><span class=\"line\">                    &quot;Gateway&quot;: &quot;10.10.19.1&quot;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Internal&quot;: false,</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;00f47e38deea76269eb03ba13695ec0b0c740601c85019546d6a9a17fd434663&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.5.btorxekfix4hcqh4v83dr0tzw&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;ea962d07eee150b263ae631b8a7f8c1950337c11ef2c3d488a7c3717defd8601&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:03&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.3/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;957620c6f7abb44ad8dd2d842d333f5e5c1655034dc43e49abbbd680de3a5341&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.4.cyu73jd8psupfhken23vvmpud&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;f33a6e9ddf1dd01bcfc43ffefd19e19514658f001cdf9b2fbe23bc3fdf56a42a&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:07&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.7/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Options&quot;: &#123;</span><br><span class=\"line\">            &quot;com.docker.network.driver.overlay.vxlanid_list&quot;: &quot;257&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;Labels&quot;: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">   </span><br><span class=\"line\">manager-nodemy-testmy-test.5.btorxekfix4hcqh4v83dr0tzw</span><br><span class=\"line\">my-test.4.cyu73jd8psupfhken23vvmpudtaskngx_netnode1node2</span><br><span class=\"line\">[root@node1 ~]# docker network inspect ngx_net</span><br><span class=\"line\">.......</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;7d9986fad5a7d834676ba76ae75aff2258f840953f1dc633c3ef3c0efd2b2501&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.3.ex73ifk3jvzw8ukurl8yu7fyq&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;957ca19f3d5480762dbd14fd9a6a1cd01a8deac3e8e35b23d1350f480a7b2f37&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:06&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.6/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;9e50fceada1d7c653a886ca29d2bf2606debafe8c8a97f2d79104faf3ecf8a46&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.2.f1h7a0vtojv18zrsiw8j0rzaw&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;b1c209c7b68634e88e0bf5e100fe03435b3096054da6555c61e6c207ac651ac2&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:05&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.5/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">.........</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 web]# docker network inspect ngx_net</span><br><span class=\"line\">........</span><br><span class=\"line\">        &quot;Containers&quot;: &#123;</span><br><span class=\"line\">            &quot;4bdcce0ee63edc08d943cf4a049eac027719ff2dc14b7c3aa85fdddc5d1da968&quot;: &#123;</span><br><span class=\"line\">                &quot;Name&quot;: &quot;my-test.1.8433fuiy7vpu0p80arl7vggfe&quot;,</span><br><span class=\"line\">                &quot;EndpointID&quot;: &quot;df58de85b0a0e4d128bf332fc783f6528d1f179b0f9f3b7aa70ebc832640d3bc&quot;,</span><br><span class=\"line\">                &quot;MacAddress&quot;: &quot;02:42:0a:0a:13:04&quot;,</span><br><span class=\"line\">                &quot;IPv4Address&quot;: &quot;10.10.19.4/24&quot;,</span><br><span class=\"line\">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">   </span><br><span class=\"line\">IP</span><br><span class=\"line\">[root@manager-node ~]# docker service inspect --format=&#x27;&#123;&#123;json .Endpoint.VirtualIPs&#125;&#125;&#x27; my-test</span><br><span class=\"line\">[&#123;&quot;NetworkID&quot;:&quot;7f4fx3jf4dbrp97aioc05pul4&quot;,&quot;Addr&quot;:&quot;10.255.0.6/16&quot;&#125;,&#123;&quot;NetworkID&quot;:&quot;3x2wgugr6zmn1mcyf9k1du27p&quot;,&quot;Addr&quot;:&quot;10.10.19.2/24&quot;&#125;]</span><br><span class=\"line\">   </span><br><span class=\"line\">10.10.19.2swarmvip</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/docker-swarm/docker-swarm-12.png\" alt=\"img\"></p>\n<p>ngx_netIP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID    IMAGE           COMMAND                  CREATED         STATUS             PORTS    NAMES</span><br><span class=\"line\">4bdcce0ee63e    nginx:latest    &quot;nginx -g &#x27;daemon off&quot;   22 minutes ago  Up 22 minutes      80/tcp   my-test.1.8433fuiy7vpu0p80arl7vggfe</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 ~]# docker exec -ti 4bdcce0ee63e /bin/bash</span><br><span class=\"line\">root@4bdcce0ee63e:/# ip addr                                                                                          </span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">    inet 127.0.0.1/8 scope host lo</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 ::1/128 scope host</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1786: eth0@if1787: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:0a:ff:00:08 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class=\"line\">    inet 10.255.0.8/16 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet 10.255.0.6/32 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:aff:feff:8/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1788: eth1@if1789: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class=\"line\">    inet 172.18.0.3/16 scope global eth1</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:acff:fe12:3/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">1791: eth2@if1792: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class=\"line\">    link/ether 02:42:0a:0a:13:04 brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class=\"line\">    inet 10.10.19.4/24 scope global eth2</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet 10.10.19.2/32 scope global eth2</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">    inet6 fe80::42:aff:fe0a:1304/64 scope link</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\">  </span><br><span class=\"line\">root@4bdcce0ee63e:/# ping 10.10.19.3</span><br><span class=\"line\">PING 10.10.19.3 (10.10.19.3): 56 data bytes</span><br><span class=\"line\">64 bytes from 10.10.19.3: icmp_seq=0 ttl=64 time=0.890 ms</span><br><span class=\"line\">64 bytes from 10.10.19.3: icmp_seq=1 ttl=64 time=0.622 ms</span><br><span class=\"line\">.....-</span><br><span class=\"line\">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class=\"line\">round-trip min/avg/max/stddev = 0.622/0.756/0.890/0.134 ms</span><br><span class=\"line\">  </span><br><span class=\"line\">root@4bdcce0ee63e:/# ping 10.10.19.6</span><br><span class=\"line\">PING 10.10.19.6 (10.10.19.6): 56 data bytes</span><br><span class=\"line\">64 bytes from 10.10.19.6: icmp_seq=0 ttl=64 time=0.939 ms</span><br><span class=\"line\">64 bytes from 10.10.19.6: icmp_seq=1 ttl=64 time=0.590 ms</span><br><span class=\"line\">  </span><br><span class=\"line\">----------------------------swarm--------------------------</span><br><span class=\"line\">swarmVIPVIPDNSDNS</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">overlaySwarmVIP</span><br><span class=\"line\">activetask</span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">centosmy-testnginx</span><br><span class=\"line\">[root@manager-node ~]# docker service create --name my-centos --network ngx_net centos       </span><br><span class=\"line\">  </span><br><span class=\"line\">centoscentos</span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-centos</span><br><span class=\"line\">ID                         NAME             IMAGE   NODE   DESIRED STATE  CURRENT STATE            ERROR</span><br><span class=\"line\">e03pqgkjs3l1qizc6v4aqaune  my-centos.1      centos  node2  Running        Preparing 4 seconds ago</span><br><span class=\"line\">  </span><br><span class=\"line\">centosnode2centosshell</span><br><span class=\"line\">[root@node2 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS            NAMES</span><br><span class=\"line\">e4554490d891        centos:latest            &quot;/bin/bash&quot;             About an hour ago   Up About an hour   my-centos.1.9yk5ie28gwk9mw1h1jovb68ki</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@node2 ~]# docker exec -ti my-centos.1.9yk5ie28gwk9mw1h1jovb68ki /bin/bash</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup my-test</span><br><span class=\"line\">Server: 127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name: my-test</span><br><span class=\"line\">Address 1: 10.10.19.2 10.10.19.2</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">centos DNSmy-testIP</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup tasks.my-test</span><br><span class=\"line\">Server: 127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name: tasks.my-test</span><br><span class=\"line\">Address 1: 10.10.19.4 my-test.1.8433fuiy7vpu0p80arl7vggfe</span><br><span class=\"line\">Address 2: 10.10.19.5 my-test.2.f1h7a0vtojv18zrsiw8j0rzaw</span><br><span class=\"line\">Address 3: 10.10.19.6 my-test.3.ex73ifk3jvzw8ukurl8yu7fyq</span><br><span class=\"line\">Address 2: 10.10.19.7 my-test.4.cyu73jd8psupfhken23vvmpud</span><br><span class=\"line\">Address 3: 10.10.19.3 my-test.5.btorxekfix4hcqh4v83dr0tzw</span><br><span class=\"line\">  </span><br><span class=\"line\">centoswgetmy-testnginx</span><br><span class=\"line\">root@4bdcce0ee63e:/# wget -O- my-test     </span><br><span class=\"line\">Connecting to my-test (10.10.19.2:80)</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class=\"line\">...</span><br><span class=\"line\">  </span><br><span class=\"line\">SwarmHTTPVIPactivetaskround-robinactivetask</span><br><span class=\"line\">  </span><br><span class=\"line\">-----------------------------------DNS round-robin-----------------------------</span><br><span class=\"line\">DNS round-robinVIP --endpoint-mode dnsrr </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">DNS round-robin-p</span><br><span class=\"line\">[root@manager-node ~]# docker service create --replicas 3 --name my-dnsrr-nginx --network ngx_net --endpoint-mode dnsrr nginx</span><br><span class=\"line\">  </span><br><span class=\"line\">[root@manager-node ~]# docker service ps my-dnsrr-nginx</span><br><span class=\"line\">ID                         NAME              IMAGE  NODE          DESIRED STATE  CURRENT STATE          ERROR</span><br><span class=\"line\">65li2zbhxvvoaesndmwjokouj  my-dnsrr-nginx.1  nginx  node1         Running        Running 2 minutes ago</span><br><span class=\"line\">5hjw7wm4xr877879m0ewjciuj  my-dnsrr-nginx.2  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">afo7acduge2qfy60e87liz557  my-dnsrr-nginx.3  nginx  manager-node  Running        Running 2 minutes ago</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">DNSDNSIP</span><br><span class=\"line\">root@4bdcce0ee63e:/# nslookup my-dnsrr-nginx</span><br><span class=\"line\">Server:    127.0.0.11</span><br><span class=\"line\">Address 1: 127.0.0.11</span><br><span class=\"line\">  </span><br><span class=\"line\">Name:      my-dnsrr-nginx</span><br><span class=\"line\">Address 1: 10.10.19.10 my-dnsrr-nginx.3.0sm1n9o8hygzarv5t5eq46okn.my-network</span><br><span class=\"line\">Address 2: 10.10.19.9  my-dnsrr-nginx.2.b3o1uoa8m003b2kk0ytl9lawh.my-network</span><br><span class=\"line\">Address 3: 10.10.19.8  my-dnsrr-nginx.1.55za4c83jq9846rle6eigiq15.my-network</span><br><span class=\"line\">  </span><br><span class=\"line\">VIP</span><br><span class=\"line\">DockerdignslookupDNSDNSVIPIPpingVIP</span><br></pre></td></tr></table></figure>\n\n\n\n<p><a href=\"https://www.cnblogs.com/zhujingzhi/p/9792432.html\">https://www.cnblogs.com/zhujingzhi/p/9792432.html</a></p>\n"},{"title":"git .git","date":"2021-05-07T12:10:51.000Z","_content":"\n```\n# Check out to a temporary branch:\ngit checkout --orphan TEMP_BRANCH\n\n# Add all the files:\ngit add -A\n\n# Commit the changes:\ngit commit -am \"Initial commit\"\n\n# Delete the old branch:\ngit branch -D master\n\n# Rename the temporary branch to master:\ngit branch -m master\n\n# Finally, force update to our repository:\ngit push -f origin master\n```\n\n .git  .git ","source":"_posts/git/git-delete-history-log.md","raw":"---\ntitle: git .git\ndate: 2021-05-07 20:10:51\ncategories:\n  - git\ntags:\n  - git\n---\n\n```\n# Check out to a temporary branch:\ngit checkout --orphan TEMP_BRANCH\n\n# Add all the files:\ngit add -A\n\n# Commit the changes:\ngit commit -am \"Initial commit\"\n\n# Delete the old branch:\ngit branch -D master\n\n# Rename the temporary branch to master:\ngit branch -m master\n\n# Finally, force update to our repository:\ngit push -f origin master\n```\n\n .git  .git ","slug":"git/git-delete-history-log","published":1,"updated":"2022-05-10T08:25:56.387Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4os000axklo8adw1e2r","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Check out to a temporary branch:</span><br><span class=\"line\">git checkout --orphan TEMP_BRANCH</span><br><span class=\"line\"></span><br><span class=\"line\"># Add all the files:</span><br><span class=\"line\">git add -A</span><br><span class=\"line\"></span><br><span class=\"line\"># Commit the changes:</span><br><span class=\"line\">git commit -am &quot;Initial commit&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Delete the old branch:</span><br><span class=\"line\">git branch -D master</span><br><span class=\"line\"></span><br><span class=\"line\"># Rename the temporary branch to master:</span><br><span class=\"line\">git branch -m master</span><br><span class=\"line\"></span><br><span class=\"line\"># Finally, force update to our repository:</span><br><span class=\"line\">git push -f origin master</span><br></pre></td></tr></table></figure>\n\n<p> .git  .git </p>\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Check out to a temporary branch:</span><br><span class=\"line\">git checkout --orphan TEMP_BRANCH</span><br><span class=\"line\"></span><br><span class=\"line\"># Add all the files:</span><br><span class=\"line\">git add -A</span><br><span class=\"line\"></span><br><span class=\"line\"># Commit the changes:</span><br><span class=\"line\">git commit -am &quot;Initial commit&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># Delete the old branch:</span><br><span class=\"line\">git branch -D master</span><br><span class=\"line\"></span><br><span class=\"line\"># Rename the temporary branch to master:</span><br><span class=\"line\">git branch -m master</span><br><span class=\"line\"></span><br><span class=\"line\"># Finally, force update to our repository:</span><br><span class=\"line\">git push -f origin master</span><br></pre></td></tr></table></figure>\n\n<p> .git  .git </p>\n"},{"title":"Dockerfile ","date":"2021-05-08T06:34:11.000Z","_content":"\n- FROM #\n- MAINTAINER #\n- RUN #\n- ADD #tomcattomcat\n- WORKDIR #\n- VOLUME #\n- EXPOST #\n- CMD #\n- ENTRYPOINT #\n- ONBUILD # Dockerfile  ONBUILD \n- COPY #ADD\n- ENV #\n\n---\n\nADDCOPY\n\n- ADDCOPY\n- COPY","source":"_posts/docker/dockerFile.md","raw":"---\ntitle: Dockerfile \ndate: 2021-05-08 14:34:11\ncategories: docker\ntags:\n  - docker\n  - Dockerfile\n---\n\n- FROM #\n- MAINTAINER #\n- RUN #\n- ADD #tomcattomcat\n- WORKDIR #\n- VOLUME #\n- EXPOST #\n- CMD #\n- ENTRYPOINT #\n- ONBUILD # Dockerfile  ONBUILD \n- COPY #ADD\n- ENV #\n\n---\n\nADDCOPY\n\n- ADDCOPY\n- COPY","slug":"docker/dockerFile","published":1,"updated":"2022-05-10T08:25:56.385Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ot000dxklobneofipm","content":"<ul>\n<li>FROM #</li>\n<li>MAINTAINER #</li>\n<li>RUN #</li>\n<li>ADD #tomcattomcat</li>\n<li>WORKDIR #</li>\n<li>VOLUME #</li>\n<li>EXPOST #</li>\n<li>CMD #</li>\n<li>ENTRYPOINT #</li>\n<li>ONBUILD # Dockerfile  ONBUILD </li>\n<li>COPY #ADD</li>\n<li>ENV #</li>\n</ul>\n<hr>\n<p>ADDCOPY</p>\n<ul>\n<li>ADDCOPY</li>\n<li>COPY</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>FROM #</li>\n<li>MAINTAINER #</li>\n<li>RUN #</li>\n<li>ADD #tomcattomcat</li>\n<li>WORKDIR #</li>\n<li>VOLUME #</li>\n<li>EXPOST #</li>\n<li>CMD #</li>\n<li>ENTRYPOINT #</li>\n<li>ONBUILD # Dockerfile  ONBUILD </li>\n<li>COPY #ADD</li>\n<li>ENV #</li>\n</ul>\n<hr>\n<p>ADDCOPY</p>\n<ul>\n<li>ADDCOPY</li>\n<li>COPY</li>\n</ul>\n"},{"title":"git ssh ","date":"2021-05-07T12:15:53.000Z","_content":"\n```\n$ ssh-keygen -o\nGenerating public/private rsa key pair.\nEnter file in which to save the key (directory/id_rsa):\nCreated directory 'directory'.\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in directory/id_rsa.\nYour public key has been saved in directory/id_rsa.pub.\nThe key fingerprint is:\nxxx\n```\n\n","source":"_posts/git/git-ssh-generate.md","raw":"---\ntitle: git ssh \ndate: 2021-05-07 20:15:53\ncategories:\n  - git\ntags:\n  - git\n  - ssh\n---\n\n```\n$ ssh-keygen -o\nGenerating public/private rsa key pair.\nEnter file in which to save the key (directory/id_rsa):\nCreated directory 'directory'.\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in directory/id_rsa.\nYour public key has been saved in directory/id_rsa.pub.\nThe key fingerprint is:\nxxx\n```\n\n","slug":"git/git-ssh-generate","published":1,"updated":"2022-05-10T08:25:56.388Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ot000exklofen81yq1","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -o</span><br><span class=\"line\">Generating public/private rsa key pair.</span><br><span class=\"line\">Enter file in which to save the key (directory/id_rsa):</span><br><span class=\"line\">Created directory &#x27;directory&#x27;.</span><br><span class=\"line\">Enter passphrase (empty for no passphrase):</span><br><span class=\"line\">Enter same passphrase again:</span><br><span class=\"line\">Your identification has been saved in directory/id_rsa.</span><br><span class=\"line\">Your public key has been saved in directory/id_rsa.pub.</span><br><span class=\"line\">The key fingerprint is:</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh-keygen -o</span><br><span class=\"line\">Generating public/private rsa key pair.</span><br><span class=\"line\">Enter file in which to save the key (directory/id_rsa):</span><br><span class=\"line\">Created directory &#x27;directory&#x27;.</span><br><span class=\"line\">Enter passphrase (empty for no passphrase):</span><br><span class=\"line\">Enter same passphrase again:</span><br><span class=\"line\">Your identification has been saved in directory/id_rsa.</span><br><span class=\"line\">Your public key has been saved in directory/id_rsa.pub.</span><br><span class=\"line\">The key fingerprint is:</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n"},{"title":"hexomarkdownflowchart","date":"2021-05-11T02:20:17.000Z","_content":"\n\n\nhexoflowchart  hexo hexoMarkdown flowchart\n\n\n\n```shell\nnpm install --save hexo-filter-flowchart\n```\n\n### Flow\n\nflow \n\n#### \n\nX=>Y: Z\nX YZXY=>\nXZY\n\n|  |  |\n| :----: | :----: |\n| start |  |\n| end |  |\n| operation |  |\n| subroutine |  |\n| condition |  |\n| inputoutput |  |\n\n#### \n\n\nflow->\n\n```\n a->b->cabc\n```\n\n\n\n\n```\na->b\nb->c\n```\n\n\nconditionyesno\n\n```\ncond(yes)->outconditionout\ncond(no)->opconditionop\n```\n\n#### \n\n- \n\n````\n(top)\n(bottom)\n(left)\n(right)\n````\n\n- \n\n````\n# yesno\n# yesno\ncond(yes,right)\ncond(no,bottom)\n````\n\n\n\nhttps://blog.csdn.net/zywvvd/article/details/110150617","source":"_posts/hexo/hexo-support-flow-chart.md","raw":"---\ntitle: hexomarkdownflowchart\ndate: 2021-05-11 10:20:17\ncategories:\n  - markdown\ntags:\n  - markdown\n---\n\n\n\nhexoflowchart  hexo hexoMarkdown flowchart\n\n\n\n```shell\nnpm install --save hexo-filter-flowchart\n```\n\n### Flow\n\nflow \n\n#### \n\nX=>Y: Z\nX YZXY=>\nXZY\n\n|  |  |\n| :----: | :----: |\n| start |  |\n| end |  |\n| operation |  |\n| subroutine |  |\n| condition |  |\n| inputoutput |  |\n\n#### \n\n\nflow->\n\n```\n a->b->cabc\n```\n\n\n\n\n```\na->b\nb->c\n```\n\n\nconditionyesno\n\n```\ncond(yes)->outconditionout\ncond(no)->opconditionop\n```\n\n#### \n\n- \n\n````\n(top)\n(bottom)\n(left)\n(right)\n````\n\n- \n\n````\n# yesno\n# yesno\ncond(yes,right)\ncond(no,bottom)\n````\n\n\n\nhttps://blog.csdn.net/zywvvd/article/details/110150617","slug":"hexo/hexo-support-flow-chart","published":1,"updated":"2022-05-10T08:25:56.389Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ou000ixklofxue7mhs","content":"<p>hexoflowchart  hexo hexoMarkdown flowchart</p>\n<p></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-filter-flowchart</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Flow\"><a href=\"#Flow\" class=\"headerlink\" title=\"Flow\"></a>Flow</h3><p>flow </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>X&#x3D;&gt;Y: Z<br>X YZXY&#x3D;&gt;<br>XZY</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">start</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">end</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">operation</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">subroutine</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">condition</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">inputoutput</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br>flow-&gt;</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> a-&gt;b-&gt;cabc</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a-&gt;b</span><br><span class=\"line\">b-&gt;c</span><br></pre></td></tr></table></figure>\n\n\n<p>conditionyesno</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cond(yes)-&gt;outconditionout</span><br><span class=\"line\">cond(no)-&gt;opconditionop</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(top)</span><br><span class=\"line\">(bottom)</span><br><span class=\"line\">(left)</span><br><span class=\"line\">(right)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yesno</span><br><span class=\"line\"># yesno</span><br><span class=\"line\">cond(yes,right)</span><br><span class=\"line\">cond(no,bottom)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/zywvvd/article/details/110150617\">https://blog.csdn.net/zywvvd/article/details/110150617</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>hexoflowchart  hexo hexoMarkdown flowchart</p>\n<p></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-filter-flowchart</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Flow\"><a href=\"#Flow\" class=\"headerlink\" title=\"Flow\"></a>Flow</h3><p>flow </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>X&#x3D;&gt;Y: Z<br>X YZXY&#x3D;&gt;<br>XZY</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">start</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">end</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">operation</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">subroutine</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">condition</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">inputoutput</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br>flow-&gt;</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> a-&gt;b-&gt;cabc</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a-&gt;b</span><br><span class=\"line\">b-&gt;c</span><br></pre></td></tr></table></figure>\n\n\n<p>conditionyesno</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cond(yes)-&gt;outconditionout</span><br><span class=\"line\">cond(no)-&gt;opconditionop</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(top)</span><br><span class=\"line\">(bottom)</span><br><span class=\"line\">(left)</span><br><span class=\"line\">(right)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yesno</span><br><span class=\"line\"># yesno</span><br><span class=\"line\">cond(yes,right)</span><br><span class=\"line\">cond(no,bottom)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/zywvvd/article/details/110150617\">https://blog.csdn.net/zywvvd/article/details/110150617</a></p>\n"},{"title":"QLExpress","date":"2021-07-19T03:21:21.000Z","_content":"\n 2012\n\nQLExpress:\n\n- 1threadlocal\n- 2groovy\n- 3groovyjavascript\n- 4,api\n- 5250kjarjavaandroidpos\n\n\n\nQLExpressRunner\n![image](/images/qlexpress.jpg)\n\ngit https://github.com/alibaba/QLExpress\n\n\n\n","source":"_posts/java/QLExpress.md","raw":"---\ntitle: QLExpress\ndate: 2021-07-19 11:21:21\ncategories:\n  - java\ntags:\n  - java\n---\n\n 2012\n\nQLExpress:\n\n- 1threadlocal\n- 2groovy\n- 3groovyjavascript\n- 4,api\n- 5250kjarjavaandroidpos\n\n\n\nQLExpressRunner\n![image](/images/qlexpress.jpg)\n\ngit https://github.com/alibaba/QLExpress\n\n\n\n","slug":"java/QLExpress","published":1,"updated":"2022-05-10T08:25:56.389Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ov000jxklo7qe9etni","content":"<p> 2012</p>\n<p>QLExpress:</p>\n<ul>\n<li>1threadlocal</li>\n<li>2groovy</li>\n<li>3groovyjavascript</li>\n<li>4,api</li>\n<li>5250kjarjavaandroidpos</li>\n</ul>\n<p>QLExpressRunner<br><img src=\"/images/qlexpress.jpg\" alt=\"image\"></p>\n<p>git <a href=\"https://github.com/alibaba/QLExpress\">https://github.com/alibaba/QLExpress</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> 2012</p>\n<p>QLExpress:</p>\n<ul>\n<li>1threadlocal</li>\n<li>2groovy</li>\n<li>3groovyjavascript</li>\n<li>4,api</li>\n<li>5250kjarjavaandroidpos</li>\n</ul>\n<p>QLExpressRunner<br><img src=\"/images/qlexpress.jpg\" alt=\"image\"></p>\n<p>git <a href=\"https://github.com/alibaba/QLExpress\">https://github.com/alibaba/QLExpress</a></p>\n"},{"title":"git ","date":"2021-05-07T12:15:41.000Z","_content":"\n## \n\n Git      \n\n**Node:**\n\n**  **\n\n### \n\n `git remote`    origin  Git \n\n```console\n$ git clone https://github.com/schacon/ticgit\nCloning into 'ticgit'...\nremote: Reusing existing pack: 1857, done.\nremote: Total 1857 (delta 0), reused 0 (delta 0)\nReceiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, done.\nResolving deltas: 100% (772/772), done.\nChecking connectivity... done.\n$ cd ticgit\n$ git remote\norigin\n```\n\n `-v` Git  URL\n\n```console\n$ git remote -v\norigin\thttps://github.com/schacon/ticgit (fetch)\norigin\thttps://github.com/schacon/ticgit (push)\n```\n\n \n\n```console\n$ cd grit\n$ git remote -v\nbakkdoor  https://github.com/bakkdoor/grit (fetch)\nbakkdoor  https://github.com/bakkdoor/grit (push)\ncho45     https://github.com/cho45/grit (fetch)\ncho45     https://github.com/cho45/grit (push)\ndefunkt   https://github.com/defunkt/grit (fetch)\ndefunkt   https://github.com/defunkt/grit (push)\nkoke      git://github.com/koke/grit.git (fetch)\nkoke      git://github.com/koke/grit.git (push)\norigin    git@github.com:mojombo/grit.git (fetch)\norigin    git@github.com:mojombo/grit.git (push)\n```\n\n\n\n [ Git](https://git-scm.com/book/zh/v2/ch00/_getting_git_on_a_server) \n\n### \n\n `git clone`    `git remote add <shortname> <url>`  Git \n\n```console\n$ git remote\norigin\n$ git remote add pb https://github.com/paulboone/ticgit\n$ git remote -v\norigin\thttps://github.com/schacon/ticgit (fetch)\norigin\thttps://github.com/schacon/ticgit (push)\npb\thttps://github.com/paulboone/ticgit (fetch)\npb\thttps://github.com/paulboone/ticgit (push)\n```\n\n `pb`  URL  Paul  `git fetch pb`\n\n```console\n$ git fetch pb\nremote: Counting objects: 43, done.\nremote: Compressing objects: 100% (36/36), done.\nremote: Total 43 (delta 10), reused 31 (delta 5)\nUnpacking objects: 100% (43/43), done.\nFrom https://github.com/paulboone/ticgit\n * [new branch]      master     -> pb/master\n * [new branch]      ticgit     -> pb/ticgit\n```\n\n Paul  master  `pb/master`    [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching) \n\n### \n\n\n\n```console\n$ git fetch <remote>\n```\n\n \n\n `clone`  origin  `git fetch origin`   `git fetch`  \n\n [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching)   `git pull`  `git clone`  master  `master`   `git pull` \n\n### \n\n `git push <remote> <branch>`  `master`  `origin`  \n\n```console\n$ git push origin master\n```\n\n    [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching) \n\n### \n\n `git remote show <remote>`   `origin`\n\n```console\n$ git remote show origin\n* remote origin\n  Fetch URL: https://github.com/schacon/ticgit\n  Push  URL: https://github.com/schacon/ticgit\n  HEAD branch: master\n  Remote branches:\n    master                               tracked\n    dev-branch                           tracked\n  Local branch configured for 'git pull':\n    master merges with remote master\n  Local ref configured for 'git push':\n    master pushes to master (up to date)\n```\n\n URL   `master`  `git pull`  `master`  `master`  \n\n  Git  `git remote show` \n\n```console\n$ git remote show origin\n* remote origin\n  URL: https://github.com/my-org/complex-project\n  Fetch URL: https://github.com/my-org/complex-project\n  Push  URL: https://github.com/my-org/complex-project\n  HEAD branch: master\n  Remote branches:\n    master                           tracked\n    dev-branch                       tracked\n    markdown-strip                   tracked\n    issue-43                         new (next fetch will store in remotes/origin)\n    issue-45                         new (next fetch will store in remotes/origin)\n    refs/remotes/origin/issue-11     stale (use 'git remote prune' to remove)\n  Local branches configured for 'git pull':\n    dev-branch merges with remote dev-branch\n    master     merges with remote master\n  Local refs configured for 'git push':\n    dev-branch                     pushes to dev-branch                     (up to date)\n    markdown-strip                 pushes to markdown-strip                 (up to date)\n    master                         pushes to master                         (up to date)\n```\n\n `git push`    `git pull` \n\n### \n\n `git remote rename`   `pb`  `paul` `git remote rename` \n\n```console\n$ git remote rename pb paul\n$ git remote\norigin\npaul\n```\n\n  `pb/master`  `paul/master`\n\n  `git remote remove`  `git remote rm` \n\n```console\n$ git remote remove paul\n$ git remote\norigin\n```\n\n\n\n\n\n\n\n[Git  - ](https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8)","source":"_posts/git/git-remote.md","raw":"---\ntitle: git \ndate: 2021-05-07 20:15:41\ncategories: \n  - git\ntags:\n  - git\n---\n\n## \n\n Git      \n\n**Node:**\n\n**  **\n\n### \n\n `git remote`    origin  Git \n\n```console\n$ git clone https://github.com/schacon/ticgit\nCloning into 'ticgit'...\nremote: Reusing existing pack: 1857, done.\nremote: Total 1857 (delta 0), reused 0 (delta 0)\nReceiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, done.\nResolving deltas: 100% (772/772), done.\nChecking connectivity... done.\n$ cd ticgit\n$ git remote\norigin\n```\n\n `-v` Git  URL\n\n```console\n$ git remote -v\norigin\thttps://github.com/schacon/ticgit (fetch)\norigin\thttps://github.com/schacon/ticgit (push)\n```\n\n \n\n```console\n$ cd grit\n$ git remote -v\nbakkdoor  https://github.com/bakkdoor/grit (fetch)\nbakkdoor  https://github.com/bakkdoor/grit (push)\ncho45     https://github.com/cho45/grit (fetch)\ncho45     https://github.com/cho45/grit (push)\ndefunkt   https://github.com/defunkt/grit (fetch)\ndefunkt   https://github.com/defunkt/grit (push)\nkoke      git://github.com/koke/grit.git (fetch)\nkoke      git://github.com/koke/grit.git (push)\norigin    git@github.com:mojombo/grit.git (fetch)\norigin    git@github.com:mojombo/grit.git (push)\n```\n\n\n\n [ Git](https://git-scm.com/book/zh/v2/ch00/_getting_git_on_a_server) \n\n### \n\n `git clone`    `git remote add <shortname> <url>`  Git \n\n```console\n$ git remote\norigin\n$ git remote add pb https://github.com/paulboone/ticgit\n$ git remote -v\norigin\thttps://github.com/schacon/ticgit (fetch)\norigin\thttps://github.com/schacon/ticgit (push)\npb\thttps://github.com/paulboone/ticgit (fetch)\npb\thttps://github.com/paulboone/ticgit (push)\n```\n\n `pb`  URL  Paul  `git fetch pb`\n\n```console\n$ git fetch pb\nremote: Counting objects: 43, done.\nremote: Compressing objects: 100% (36/36), done.\nremote: Total 43 (delta 10), reused 31 (delta 5)\nUnpacking objects: 100% (43/43), done.\nFrom https://github.com/paulboone/ticgit\n * [new branch]      master     -> pb/master\n * [new branch]      ticgit     -> pb/ticgit\n```\n\n Paul  master  `pb/master`    [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching) \n\n### \n\n\n\n```console\n$ git fetch <remote>\n```\n\n \n\n `clone`  origin  `git fetch origin`   `git fetch`  \n\n [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching)   `git pull`  `git clone`  master  `master`   `git pull` \n\n### \n\n `git push <remote> <branch>`  `master`  `origin`  \n\n```console\n$ git push origin master\n```\n\n    [Git ](https://git-scm.com/book/zh/v2/ch00/ch03-git-branching) \n\n### \n\n `git remote show <remote>`   `origin`\n\n```console\n$ git remote show origin\n* remote origin\n  Fetch URL: https://github.com/schacon/ticgit\n  Push  URL: https://github.com/schacon/ticgit\n  HEAD branch: master\n  Remote branches:\n    master                               tracked\n    dev-branch                           tracked\n  Local branch configured for 'git pull':\n    master merges with remote master\n  Local ref configured for 'git push':\n    master pushes to master (up to date)\n```\n\n URL   `master`  `git pull`  `master`  `master`  \n\n  Git  `git remote show` \n\n```console\n$ git remote show origin\n* remote origin\n  URL: https://github.com/my-org/complex-project\n  Fetch URL: https://github.com/my-org/complex-project\n  Push  URL: https://github.com/my-org/complex-project\n  HEAD branch: master\n  Remote branches:\n    master                           tracked\n    dev-branch                       tracked\n    markdown-strip                   tracked\n    issue-43                         new (next fetch will store in remotes/origin)\n    issue-45                         new (next fetch will store in remotes/origin)\n    refs/remotes/origin/issue-11     stale (use 'git remote prune' to remove)\n  Local branches configured for 'git pull':\n    dev-branch merges with remote dev-branch\n    master     merges with remote master\n  Local refs configured for 'git push':\n    dev-branch                     pushes to dev-branch                     (up to date)\n    markdown-strip                 pushes to markdown-strip                 (up to date)\n    master                         pushes to master                         (up to date)\n```\n\n `git push`    `git pull` \n\n### \n\n `git remote rename`   `pb`  `paul` `git remote rename` \n\n```console\n$ git remote rename pb paul\n$ git remote\norigin\npaul\n```\n\n  `pb/master`  `paul/master`\n\n  `git remote remove`  `git remote rm` \n\n```console\n$ git remote remove paul\n$ git remote\norigin\n```\n\n\n\n\n\n\n\n[Git  - ](https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8)","slug":"git/git-remote","published":1,"updated":"2022-05-10T08:25:56.388Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ox000nxklo3x8o2ibc","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Git      </p>\n<p><strong>Node:</strong></p>\n<p><strong>  </strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote</code>    origin  Git </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git <span class=\"built_in\">clone</span> https://github.com/schacon/ticgit</span></span><br><span class=\"line\">Cloning into &#x27;ticgit&#x27;...</span><br><span class=\"line\">remote: Reusing existing pack: 1857, done.</span><br><span class=\"line\">remote: Total 1857 (delta 0), reused 0 (delta 0)</span><br><span class=\"line\">Receiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, done.</span><br><span class=\"line\">Resolving deltas: 100% (772/772), done.</span><br><span class=\"line\">Checking connectivity... done.</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> ticgit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br></pre></td></tr></table></figure>\n\n<p> <code>-v</code> Git  URL</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (fetch)</span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (push)</span><br></pre></td></tr></table></figure>\n\n<p> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> grit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">bakkdoor  https://github.com/bakkdoor/grit (fetch)</span><br><span class=\"line\">bakkdoor  https://github.com/bakkdoor/grit (push)</span><br><span class=\"line\">cho45     https://github.com/cho45/grit (fetch)</span><br><span class=\"line\">cho45     https://github.com/cho45/grit (push)</span><br><span class=\"line\">defunkt   https://github.com/defunkt/grit (fetch)</span><br><span class=\"line\">defunkt   https://github.com/defunkt/grit (push)</span><br><span class=\"line\">koke      git://github.com/koke/grit.git (fetch)</span><br><span class=\"line\">koke      git://github.com/koke/grit.git (push)</span><br><span class=\"line\">origin    git@github.com:mojombo/grit.git (fetch)</span><br><span class=\"line\">origin    git@github.com:mojombo/grit.git (push)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p> <a href=\"https://git-scm.com/book/zh/v2/ch00/_getting_git_on_a_server\"> Git</a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git clone</code>    <code>git remote add &lt;shortname&gt; &lt;url&gt;</code>  Git </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote add pb https://github.com/paulboone/ticgit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (fetch)</span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (push)</span><br><span class=\"line\">pb\thttps://github.com/paulboone/ticgit (fetch)</span><br><span class=\"line\">pb\thttps://github.com/paulboone/ticgit (push)</span><br></pre></td></tr></table></figure>\n\n<p> <code>pb</code>  URL  Paul  <code>git fetch pb</code></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git fetch pb</span></span><br><span class=\"line\">remote: Counting objects: 43, done.</span><br><span class=\"line\">remote: Compressing objects: 100% (36/36), done.</span><br><span class=\"line\">remote: Total 43 (delta 10), reused 31 (delta 5)</span><br><span class=\"line\">Unpacking objects: 100% (43/43), done.</span><br><span class=\"line\">From https://github.com/paulboone/ticgit</span><br><span class=\"line\"> * [new branch]      master     -&gt; pb/master</span><br><span class=\"line\"> * [new branch]      ticgit     -&gt; pb/ticgit</span><br></pre></td></tr></table></figure>\n\n<p> Paul  master  <code>pb/master</code>    <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git fetch &lt;remote&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p> </p>\n<p> <code>clone</code>  origin  <code>git fetch origin</code>   <code>git fetch</code>  </p>\n<p> <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a>   <code>git pull</code>  <code>git clone</code>  master  <code>master</code>   <code>git pull</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git push &lt;remote&gt; &lt;branch&gt;</code>  <code>master</code>  <code>origin</code>  </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git push origin master</span></span><br></pre></td></tr></table></figure>\n\n<p>    <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote show &lt;remote&gt;</code>   <code>origin</code></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote show origin</span></span><br><span class=\"line\">* remote origin</span><br><span class=\"line\">  Fetch URL: https://github.com/schacon/ticgit</span><br><span class=\"line\">  Push  URL: https://github.com/schacon/ticgit</span><br><span class=\"line\">  HEAD branch: master</span><br><span class=\"line\">  Remote branches:</span><br><span class=\"line\">    master                               tracked</span><br><span class=\"line\">    dev-branch                           tracked</span><br><span class=\"line\">  Local branch configured for &#x27;git pull&#x27;:</span><br><span class=\"line\">    master merges with remote master</span><br><span class=\"line\">  Local ref configured for &#x27;git push&#x27;:</span><br><span class=\"line\">    master pushes to master (up to date)</span><br></pre></td></tr></table></figure>\n\n<p> URL   <code>master</code>  <code>git pull</code>  <code>master</code>  <code>master</code>  </p>\n<p>  Git  <code>git remote show</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote show origin</span></span><br><span class=\"line\">* remote origin</span><br><span class=\"line\">  URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  Fetch URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  Push  URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  HEAD branch: master</span><br><span class=\"line\">  Remote branches:</span><br><span class=\"line\">    master                           tracked</span><br><span class=\"line\">    dev-branch                       tracked</span><br><span class=\"line\">    markdown-strip                   tracked</span><br><span class=\"line\">    issue-43                         new (next fetch will store in remotes/origin)</span><br><span class=\"line\">    issue-45                         new (next fetch will store in remotes/origin)</span><br><span class=\"line\">    refs/remotes/origin/issue-11     stale (use &#x27;git remote prune&#x27; to remove)</span><br><span class=\"line\">  Local branches configured for &#x27;git pull&#x27;:</span><br><span class=\"line\">    dev-branch merges with remote dev-branch</span><br><span class=\"line\">    master     merges with remote master</span><br><span class=\"line\">  Local refs configured for &#x27;git push&#x27;:</span><br><span class=\"line\">    dev-branch                     pushes to dev-branch                     (up to date)</span><br><span class=\"line\">    markdown-strip                 pushes to markdown-strip                 (up to date)</span><br><span class=\"line\">    master                         pushes to master                         (up to date)</span><br></pre></td></tr></table></figure>\n\n<p> <code>git push</code>    <code>git pull</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote rename</code>   <code>pb</code>  <code>paul</code> <code>git remote rename</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote rename pb paul</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br><span class=\"line\">paul</span><br></pre></td></tr></table></figure>\n\n<p>  <code>pb/master</code>  <code>paul/master</code></p>\n<p>  <code>git remote remove</code>  <code>git remote rm</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote remove paul</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p></p>\n<p><a href=\"https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8\">Git  - </a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Git      </p>\n<p><strong>Node:</strong></p>\n<p><strong>  </strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote</code>    origin  Git </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git <span class=\"built_in\">clone</span> https://github.com/schacon/ticgit</span></span><br><span class=\"line\">Cloning into &#x27;ticgit&#x27;...</span><br><span class=\"line\">remote: Reusing existing pack: 1857, done.</span><br><span class=\"line\">remote: Total 1857 (delta 0), reused 0 (delta 0)</span><br><span class=\"line\">Receiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, done.</span><br><span class=\"line\">Resolving deltas: 100% (772/772), done.</span><br><span class=\"line\">Checking connectivity... done.</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> ticgit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br></pre></td></tr></table></figure>\n\n<p> <code>-v</code> Git  URL</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (fetch)</span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (push)</span><br></pre></td></tr></table></figure>\n\n<p> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> grit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">bakkdoor  https://github.com/bakkdoor/grit (fetch)</span><br><span class=\"line\">bakkdoor  https://github.com/bakkdoor/grit (push)</span><br><span class=\"line\">cho45     https://github.com/cho45/grit (fetch)</span><br><span class=\"line\">cho45     https://github.com/cho45/grit (push)</span><br><span class=\"line\">defunkt   https://github.com/defunkt/grit (fetch)</span><br><span class=\"line\">defunkt   https://github.com/defunkt/grit (push)</span><br><span class=\"line\">koke      git://github.com/koke/grit.git (fetch)</span><br><span class=\"line\">koke      git://github.com/koke/grit.git (push)</span><br><span class=\"line\">origin    git@github.com:mojombo/grit.git (fetch)</span><br><span class=\"line\">origin    git@github.com:mojombo/grit.git (push)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p> <a href=\"https://git-scm.com/book/zh/v2/ch00/_getting_git_on_a_server\"> Git</a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git clone</code>    <code>git remote add &lt;shortname&gt; &lt;url&gt;</code>  Git </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote add pb https://github.com/paulboone/ticgit</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote -v</span></span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (fetch)</span><br><span class=\"line\">origin\thttps://github.com/schacon/ticgit (push)</span><br><span class=\"line\">pb\thttps://github.com/paulboone/ticgit (fetch)</span><br><span class=\"line\">pb\thttps://github.com/paulboone/ticgit (push)</span><br></pre></td></tr></table></figure>\n\n<p> <code>pb</code>  URL  Paul  <code>git fetch pb</code></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git fetch pb</span></span><br><span class=\"line\">remote: Counting objects: 43, done.</span><br><span class=\"line\">remote: Compressing objects: 100% (36/36), done.</span><br><span class=\"line\">remote: Total 43 (delta 10), reused 31 (delta 5)</span><br><span class=\"line\">Unpacking objects: 100% (43/43), done.</span><br><span class=\"line\">From https://github.com/paulboone/ticgit</span><br><span class=\"line\"> * [new branch]      master     -&gt; pb/master</span><br><span class=\"line\"> * [new branch]      ticgit     -&gt; pb/ticgit</span><br></pre></td></tr></table></figure>\n\n<p> Paul  master  <code>pb/master</code>    <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git fetch &lt;remote&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p> </p>\n<p> <code>clone</code>  origin  <code>git fetch origin</code>   <code>git fetch</code>  </p>\n<p> <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a>   <code>git pull</code>  <code>git clone</code>  master  <code>master</code>   <code>git pull</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git push &lt;remote&gt; &lt;branch&gt;</code>  <code>master</code>  <code>origin</code>  </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git push origin master</span></span><br></pre></td></tr></table></figure>\n\n<p>    <a href=\"https://git-scm.com/book/zh/v2/ch00/ch03-git-branching\">Git </a> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote show &lt;remote&gt;</code>   <code>origin</code></p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote show origin</span></span><br><span class=\"line\">* remote origin</span><br><span class=\"line\">  Fetch URL: https://github.com/schacon/ticgit</span><br><span class=\"line\">  Push  URL: https://github.com/schacon/ticgit</span><br><span class=\"line\">  HEAD branch: master</span><br><span class=\"line\">  Remote branches:</span><br><span class=\"line\">    master                               tracked</span><br><span class=\"line\">    dev-branch                           tracked</span><br><span class=\"line\">  Local branch configured for &#x27;git pull&#x27;:</span><br><span class=\"line\">    master merges with remote master</span><br><span class=\"line\">  Local ref configured for &#x27;git push&#x27;:</span><br><span class=\"line\">    master pushes to master (up to date)</span><br></pre></td></tr></table></figure>\n\n<p> URL   <code>master</code>  <code>git pull</code>  <code>master</code>  <code>master</code>  </p>\n<p>  Git  <code>git remote show</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote show origin</span></span><br><span class=\"line\">* remote origin</span><br><span class=\"line\">  URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  Fetch URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  Push  URL: https://github.com/my-org/complex-project</span><br><span class=\"line\">  HEAD branch: master</span><br><span class=\"line\">  Remote branches:</span><br><span class=\"line\">    master                           tracked</span><br><span class=\"line\">    dev-branch                       tracked</span><br><span class=\"line\">    markdown-strip                   tracked</span><br><span class=\"line\">    issue-43                         new (next fetch will store in remotes/origin)</span><br><span class=\"line\">    issue-45                         new (next fetch will store in remotes/origin)</span><br><span class=\"line\">    refs/remotes/origin/issue-11     stale (use &#x27;git remote prune&#x27; to remove)</span><br><span class=\"line\">  Local branches configured for &#x27;git pull&#x27;:</span><br><span class=\"line\">    dev-branch merges with remote dev-branch</span><br><span class=\"line\">    master     merges with remote master</span><br><span class=\"line\">  Local refs configured for &#x27;git push&#x27;:</span><br><span class=\"line\">    dev-branch                     pushes to dev-branch                     (up to date)</span><br><span class=\"line\">    markdown-strip                 pushes to markdown-strip                 (up to date)</span><br><span class=\"line\">    master                         pushes to master                         (up to date)</span><br></pre></td></tr></table></figure>\n\n<p> <code>git push</code>    <code>git pull</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>git remote rename</code>   <code>pb</code>  <code>paul</code> <code>git remote rename</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote rename pb paul</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br><span class=\"line\">paul</span><br></pre></td></tr></table></figure>\n\n<p>  <code>pb/master</code>  <code>paul/master</code></p>\n<p>  <code>git remote remove</code>  <code>git remote rm</code> </p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote remove paul</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">git remote</span></span><br><span class=\"line\">origin</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p></p>\n<p><a href=\"https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8\">Git  - </a></p>\n"},{"title":"Hexo ","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)","source":"_posts/hexo/hexo-quick-start.md","raw":"---\ntitle: Hexo \ntags:\n  - help\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)","slug":"hexo/hexo-quick-start","published":1,"date":"2022-05-10T08:25:56.388Z","updated":"2022-05-10T08:25:56.388Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4oy000qxklo4jgbdzpy","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"markdown","date":"2021-05-10T11:41:23.000Z","_content":"\nMarkdown\n\n\n\nWYSIWYG\n\n****\n\n1. Markdown\n2. :WYSIWYGMarkdown#\n\n****\n\n1. \n2. Markdown\n\n# \n\n#\n\n#\n\n#\n\n**#**\n\n```\n\n# \n## \n### \n#### \n##### \n###### \n```\n\n\n\n# \n\n## \n\n### \n\n#### \n\n##### \n\n###### \n\n---\n\n# \n\n- \n  - *\n\n- \n  - *\n  \n- \n  - *\n  \n- \n  - ~~\n  \n  ```\n  \n  ****\n  **`\n  ******\n  ~~~~\n  ```\n  \n  \n  \n  ****\n  \n  **\n  \n  ******\n  \n  ~~~~\n\n# \n\n>>>>>>\n\n```\n\n>\n>>\n>>>>>>>>>>\n```\n\n\n\n> \n\n> > \n\n> > > > > > > > > > \n\n# \n\n -  * \n\n```\n\n---\n----\n***\n*****\n```\n\n\n\n---\n\n-----\n\n***\n\n*****\n\n# \n\n```\n![alt]( \"title\")\n\nalt\ntitletitle\n```\n\n# \n\n```\n[]( \"title\")\ntitle\n```\n\n```\n\n[](http://jianshu.com)\n[](http://baidu.com)\n```\n\n\n\n[](http://jianshu.com)\n\n[](http://baidu.com)\n\n# \n\n1. \n\n```\n - + * \n- \n+ \n* \n\n- + * \n```\n\n\n\n- \n\n+ \n\n* \n\n2. \n\n```\n\n1. \n2. \n3. \n\n```\n\n\n\n1. \n2. \n3. \n\n\n\n****\n\n- \n   - \n   - \n   - \n- \n   1. \n   2. \n   3. \n1. \n   - \n   - \n   - \n2. \n   1. \n   2. \n   3. \n\n# \n\n```\n\n||\n---|:--:|---:\n||\n||\n\n\n- \n\n-\n-\n | \n```\n\n```\n\n||\n--|:--:|--:\n||\n||\n||\n```\n\n\n\n|  |  |  |\n| ---- | :--: | ---: |\n|  |    |  |\n|  |    |  |\n|  |    |  |\n\n\n\n# \n\n```\n\n``\n\n```\n...\n...\n...\n```\n\n\n\n`create database hero;`\n\n(```)\nfunction fun(){\necho \"\";\n}\nfun();\n(```)\n\n\ncreate database hero;\n\nfunction fun(){\necho \"\";\n}\nfun();\n```\n\n# \n\n```\n\ntag=>type: content:>url\ntag\ntype6\n  1. start # \n  2. end # \n  3. operation # \n  4. subroutine # \n  5. condition # \n  6. inputoutput # \ncontenttype\nurl\n->: \ncondition\nc2(yes)->io->e \nc2(no)->op2->e\n```\n\n\n\nflow\nst=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e\n\n\n\n```flow\nst=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e\n```\n\n\n\nhttps://www.jianshu.com/p/02a5a1bf1096\n\nhttps://www.jianshu.com/p/191d1e21f7ed","source":"_posts/markdown/markdown-base-grammar.md","raw":"---\ntitle: markdown\ndate: 2021-05-10 19:41:23\ncategories:\n  - markdown\ntags:\n  - markdown\n---\n\nMarkdown\n\n\n\nWYSIWYG\n\n****\n\n1. Markdown\n2. :WYSIWYGMarkdown#\n\n****\n\n1. \n2. Markdown\n\n# \n\n#\n\n#\n\n#\n\n**#**\n\n```\n\n# \n## \n### \n#### \n##### \n###### \n```\n\n\n\n# \n\n## \n\n### \n\n#### \n\n##### \n\n###### \n\n---\n\n# \n\n- \n  - *\n\n- \n  - *\n  \n- \n  - *\n  \n- \n  - ~~\n  \n  ```\n  \n  ****\n  **`\n  ******\n  ~~~~\n  ```\n  \n  \n  \n  ****\n  \n  **\n  \n  ******\n  \n  ~~~~\n\n# \n\n>>>>>>\n\n```\n\n>\n>>\n>>>>>>>>>>\n```\n\n\n\n> \n\n> > \n\n> > > > > > > > > > \n\n# \n\n -  * \n\n```\n\n---\n----\n***\n*****\n```\n\n\n\n---\n\n-----\n\n***\n\n*****\n\n# \n\n```\n![alt]( \"title\")\n\nalt\ntitletitle\n```\n\n# \n\n```\n[]( \"title\")\ntitle\n```\n\n```\n\n[](http://jianshu.com)\n[](http://baidu.com)\n```\n\n\n\n[](http://jianshu.com)\n\n[](http://baidu.com)\n\n# \n\n1. \n\n```\n - + * \n- \n+ \n* \n\n- + * \n```\n\n\n\n- \n\n+ \n\n* \n\n2. \n\n```\n\n1. \n2. \n3. \n\n```\n\n\n\n1. \n2. \n3. \n\n\n\n****\n\n- \n   - \n   - \n   - \n- \n   1. \n   2. \n   3. \n1. \n   - \n   - \n   - \n2. \n   1. \n   2. \n   3. \n\n# \n\n```\n\n||\n---|:--:|---:\n||\n||\n\n\n- \n\n-\n-\n | \n```\n\n```\n\n||\n--|:--:|--:\n||\n||\n||\n```\n\n\n\n|  |  |  |\n| ---- | :--: | ---: |\n|  |    |  |\n|  |    |  |\n|  |    |  |\n\n\n\n# \n\n```\n\n``\n\n```\n...\n...\n...\n```\n\n\n\n`create database hero;`\n\n(```)\nfunction fun(){\necho \"\";\n}\nfun();\n(```)\n\n\ncreate database hero;\n\nfunction fun(){\necho \"\";\n}\nfun();\n```\n\n# \n\n```\n\ntag=>type: content:>url\ntag\ntype6\n  1. start # \n  2. end # \n  3. operation # \n  4. subroutine # \n  5. condition # \n  6. inputoutput # \ncontenttype\nurl\n->: \ncondition\nc2(yes)->io->e \nc2(no)->op2->e\n```\n\n\n\nflow\nst=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e\n\n\n\n```flow\nst=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e\n```\n\n\n\nhttps://www.jianshu.com/p/02a5a1bf1096\n\nhttps://www.jianshu.com/p/191d1e21f7ed","slug":"markdown/markdown-base-grammar","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4oz000vxklo5by87kj9","content":"<p>Markdown</p>\n<p></p>\n<p>WYSIWYG</p>\n<p><strong></strong></p>\n<ol>\n<li>Markdown</li>\n<li>:WYSIWYGMarkdown#</li>\n</ol>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li>Markdown</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>#</p>\n<p>#</p>\n<p>#</p>\n<p><strong>#</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">## </span><br><span class=\"line\">### </span><br><span class=\"line\">#### </span><br><span class=\"line\">##### </span><br><span class=\"line\">###### </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h6 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h6><hr>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>~~</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">****</span><br><span class=\"line\">**`</span><br><span class=\"line\">******</span><br><span class=\"line\">~~~~</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><strong></strong></p>\n<p><em></em></p>\n<p><em><strong></strong></em></p>\n<p><del></del></p>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>&gt;&gt;&gt;&gt;&gt;&gt;</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt;&gt;</span><br><span class=\"line\">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> -  * </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">----</span><br><span class=\"line\">***</span><br><span class=\"line\">*****</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<hr>\n<hr>\n<hr>\n<hr>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">![alt]( &quot;title&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">alt</span><br><span class=\"line\">titletitle</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[]( &quot;title&quot;)</span><br><span class=\"line\">title</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[](http://jianshu.com)</span><br><span class=\"line\">[](http://baidu.com)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"http://jianshu.com/\"></a></p>\n<p><a href=\"http://baidu.com/\"></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> - + * </span><br><span class=\"line\">- </span><br><span class=\"line\">+ </span><br><span class=\"line\">* </span><br><span class=\"line\"></span><br><span class=\"line\">- + * </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li></li>\n</ul>\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">1. </span><br><span class=\"line\">2. </span><br><span class=\"line\">3. </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p><strong></strong></p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ul>\n<ol>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">||</span><br><span class=\"line\">---|:--:|---:</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">- </span><br><span class=\"line\"></span><br><span class=\"line\">-</span><br><span class=\"line\">-</span><br><span class=\"line\"> | </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">||</span><br><span class=\"line\">--|:--:|--:</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"center\"></th>\n<th align=\"right\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n</tbody></table>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">``</span><br><span class=\"line\"></span><br><span class=\"line\">```</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">```</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">`create database hero;`</span><br><span class=\"line\"></span><br><span class=\"line\">(```)</span><br><span class=\"line\">function fun()&#123;</span><br><span class=\"line\">echo &quot;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fun();</span><br><span class=\"line\">(```)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">create database hero;</span><br><span class=\"line\"></span><br><span class=\"line\">function fun()&#123;</span><br><span class=\"line\">echo &quot;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fun();</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tag=&gt;type: content:&gt;url</span><br><span class=\"line\">tag</span><br><span class=\"line\">type6</span><br><span class=\"line\">  1. start # </span><br><span class=\"line\">  2. end # </span><br><span class=\"line\">  3. operation # </span><br><span class=\"line\">  4. subroutine # </span><br><span class=\"line\">  5. condition # </span><br><span class=\"line\">  6. inputoutput # </span><br><span class=\"line\">contenttype</span><br><span class=\"line\">url</span><br><span class=\"line\">-&gt;: </span><br><span class=\"line\">condition</span><br><span class=\"line\">c2(yes)-&gt;io-&gt;e </span><br><span class=\"line\">c2(no)-&gt;op2-&gt;e</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>flow<br>st&#x3D;&gt;start: Start|past:&gt;<a href=\"http://www.google.com[blank]\">http://www.google.com[blank]</a><br>e&#x3D;&gt;end: End:&gt;<a href=\"http://www.google.com/\">http://www.google.com</a><br>op1&#x3D;&gt;operation: get_hotel_ids|past<br>op2&#x3D;&gt;operation: get_proxy|current<br>sub1&#x3D;&gt;subroutine: get_proxy|current<br>op3&#x3D;&gt;operation: save_comment|current<br>op4&#x3D;&gt;operation: set_sentiment|current<br>op5&#x3D;&gt;operation: set_record|current</p>\n<p>cond1&#x3D;&gt;condition: ids_remain?<br>cond2&#x3D;&gt;condition: proxy_list?<br>cond3&#x3D;&gt;condition: ids_got?<br>cond4&#x3D;&gt;condition: ??<br>cond5&#x3D;&gt;condition: ids_remain?</p>\n<p>io1&#x3D;&gt;inputoutput: ids-remain<br>io2&#x3D;&gt;inputoutput: proxy_list<br>io3&#x3D;&gt;inputoutput: ids-got</p>\n<p>st-&gt;op1(right)-&gt;io1-&gt;cond1<br>cond1(yes)-&gt;sub1-&gt;io2-&gt;cond2<br>cond2(no)-&gt;op3<br>cond2(yes)-&gt;sub1<br>cond1(no)-&gt;op3-&gt;cond4<br>cond4(yes)-&gt;io3-&gt;cond3<br>cond4(no)-&gt;io1<br>cond3(no)-&gt;op4<br>cond3(yes, right)-&gt;cond5<br>cond5(yes)-&gt;op5<br>cond5(no)-&gt;cond3<br>op5-&gt;e</p>\n<p></p>\n<div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<p></p>\n<p><a href=\"https://www.jianshu.com/p/02a5a1bf1096\">https://www.jianshu.com/p/02a5a1bf1096</a></p>\n<p><a href=\"https://www.jianshu.com/p/191d1e21f7ed\">https://www.jianshu.com/p/191d1e21f7ed</a><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">st=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Markdown</p>\n<p></p>\n<p>WYSIWYG</p>\n<p><strong></strong></p>\n<ol>\n<li>Markdown</li>\n<li>:WYSIWYGMarkdown#</li>\n</ol>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li>Markdown</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>#</p>\n<p>#</p>\n<p>#</p>\n<p><strong>#</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">## </span><br><span class=\"line\">### </span><br><span class=\"line\">#### </span><br><span class=\"line\">##### </span><br><span class=\"line\">###### </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h6 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h6><hr>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>*</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>~~</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">****</span><br><span class=\"line\">**`</span><br><span class=\"line\">******</span><br><span class=\"line\">~~~~</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><strong></strong></p>\n<p><em></em></p>\n<p><em><strong></strong></em></p>\n<p><del></del></p>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>&gt;&gt;&gt;&gt;&gt;&gt;</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&gt;&gt;</span><br><span class=\"line\">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<blockquote>\n<p></p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p></p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> -  * </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">----</span><br><span class=\"line\">***</span><br><span class=\"line\">*****</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<hr>\n<hr>\n<hr>\n<hr>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">![alt]( &quot;title&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">alt</span><br><span class=\"line\">titletitle</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[]( &quot;title&quot;)</span><br><span class=\"line\">title</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[](http://jianshu.com)</span><br><span class=\"line\">[](http://baidu.com)</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"http://jianshu.com/\"></a></p>\n<p><a href=\"http://baidu.com/\"></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> - + * </span><br><span class=\"line\">- </span><br><span class=\"line\">+ </span><br><span class=\"line\">* </span><br><span class=\"line\"></span><br><span class=\"line\">- + * </span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li></li>\n</ul>\n<ul>\n<li></li>\n</ul>\n<ol start=\"2\">\n<li></li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">1. </span><br><span class=\"line\">2. </span><br><span class=\"line\">3. </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p><strong></strong></p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ul>\n<ol>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">||</span><br><span class=\"line\">---|:--:|---:</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">- </span><br><span class=\"line\"></span><br><span class=\"line\">-</span><br><span class=\"line\">-</span><br><span class=\"line\"> | </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">||</span><br><span class=\"line\">--|:--:|--:</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br><span class=\"line\">||</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th align=\"center\"></th>\n<th align=\"right\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n<tr>\n<td></td>\n<td align=\"center\"></td>\n<td align=\"right\"></td>\n</tr>\n</tbody></table>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">``</span><br><span class=\"line\"></span><br><span class=\"line\">```</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">...</span><br><span class=\"line\">```</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">`create database hero;`</span><br><span class=\"line\"></span><br><span class=\"line\">(```)</span><br><span class=\"line\">function fun()&#123;</span><br><span class=\"line\">echo &quot;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fun();</span><br><span class=\"line\">(```)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">create database hero;</span><br><span class=\"line\"></span><br><span class=\"line\">function fun()&#123;</span><br><span class=\"line\">echo &quot;&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fun();</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">tag=&gt;type: content:&gt;url</span><br><span class=\"line\">tag</span><br><span class=\"line\">type6</span><br><span class=\"line\">  1. start # </span><br><span class=\"line\">  2. end # </span><br><span class=\"line\">  3. operation # </span><br><span class=\"line\">  4. subroutine # </span><br><span class=\"line\">  5. condition # </span><br><span class=\"line\">  6. inputoutput # </span><br><span class=\"line\">contenttype</span><br><span class=\"line\">url</span><br><span class=\"line\">-&gt;: </span><br><span class=\"line\">condition</span><br><span class=\"line\">c2(yes)-&gt;io-&gt;e </span><br><span class=\"line\">c2(no)-&gt;op2-&gt;e</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>flow<br>st&#x3D;&gt;start: Start|past:&gt;<a href=\"http://www.google.com[blank]\">http://www.google.com[blank]</a><br>e&#x3D;&gt;end: End:&gt;<a href=\"http://www.google.com/\">http://www.google.com</a><br>op1&#x3D;&gt;operation: get_hotel_ids|past<br>op2&#x3D;&gt;operation: get_proxy|current<br>sub1&#x3D;&gt;subroutine: get_proxy|current<br>op3&#x3D;&gt;operation: save_comment|current<br>op4&#x3D;&gt;operation: set_sentiment|current<br>op5&#x3D;&gt;operation: set_record|current</p>\n<p>cond1&#x3D;&gt;condition: ids_remain?<br>cond2&#x3D;&gt;condition: proxy_list?<br>cond3&#x3D;&gt;condition: ids_got?<br>cond4&#x3D;&gt;condition: ??<br>cond5&#x3D;&gt;condition: ids_remain?</p>\n<p>io1&#x3D;&gt;inputoutput: ids-remain<br>io2&#x3D;&gt;inputoutput: proxy_list<br>io3&#x3D;&gt;inputoutput: ids-got</p>\n<p>st-&gt;op1(right)-&gt;io1-&gt;cond1<br>cond1(yes)-&gt;sub1-&gt;io2-&gt;cond2<br>cond2(no)-&gt;op3<br>cond2(yes)-&gt;sub1<br>cond1(no)-&gt;op3-&gt;cond4<br>cond4(yes)-&gt;io3-&gt;cond3<br>cond4(no)-&gt;io1<br>cond3(no)-&gt;op4<br>cond3(yes, right)-&gt;cond5<br>cond5(yes)-&gt;op5<br>cond5(no)-&gt;cond3<br>op5-&gt;e</p>\n<p></p>\n<div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<p></p>\n<p><a href=\"https://www.jianshu.com/p/02a5a1bf1096\">https://www.jianshu.com/p/02a5a1bf1096</a></p>\n<p><a href=\"https://www.jianshu.com/p/191d1e21f7ed\">https://www.jianshu.com/p/191d1e21f7ed</a><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">st=>start: Start|past:>http://www.google.com[blank]\ne=>end: End:>http://www.google.com\nop1=>operation: get_hotel_ids|past\nop2=>operation: get_proxy|current\nsub1=>subroutine: get_proxy|current\nop3=>operation: save_comment|current\nop4=>operation: set_sentiment|current\nop5=>operation: set_record|current\n\ncond1=>condition: ids_remain?\ncond2=>condition: proxy_list?\ncond3=>condition: ids_got?\ncond4=>condition: ??\ncond5=>condition: ids_remain?\n\nio1=>inputoutput: ids-remain\nio2=>inputoutput: proxy_list\nio3=>inputoutput: ids-got\n\nst->op1(right)->io1->cond1\ncond1(yes)->sub1->io2->cond2\ncond2(no)->op3\ncond2(yes)->sub1\ncond1(no)->op3->cond4\ncond4(yes)->io3->cond3\ncond4(no)->io1\ncond3(no)->op4\ncond3(yes, right)->cond5\ncond5(yes)->op5\ncond5(no)->cond3\nop5->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script></p>\n"},{"title":"linuxdockerselenium","date":"2021-05-10T13:21:26.000Z","_content":"\n1. vim /etc/yum.repos.d/google.repo\n   \\# \n\n   ```\n   [google]\n   name=Google-x86_64\n   baseurl=http://dl.google.com/linux/rpm/stable/x86_64\n   enabled=1\n   gpgcheck=0\n   gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub\n   ```\n\n2. sudo yum makecache\n\n3. sudo yum install google-chrome-stable -y\n\n4. google-chrome --version\n\n5. chromedriver\n\n   http://npm.taobao.org/mirrors/chromedriver/\n\n   miniconda bin\n   \n\n   chrome_options.add_argument('--no-sandbox')\n\ndocker selenium--privileged\n\ndocker run -itd --privileged spider-executor /bin/bash ","source":"_posts/python/use-selenium-on-linux.md","raw":"---\ntitle: linuxdockerselenium\ndate: 2021-05-10 21:21:26\ncategories:\n  - selenium\ntags:\n  - selenium\n  - linux selenium\n  - docker selenium\n---\n\n1. vim /etc/yum.repos.d/google.repo\n   \\# \n\n   ```\n   [google]\n   name=Google-x86_64\n   baseurl=http://dl.google.com/linux/rpm/stable/x86_64\n   enabled=1\n   gpgcheck=0\n   gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub\n   ```\n\n2. sudo yum makecache\n\n3. sudo yum install google-chrome-stable -y\n\n4. google-chrome --version\n\n5. chromedriver\n\n   http://npm.taobao.org/mirrors/chromedriver/\n\n   miniconda bin\n   \n\n   chrome_options.add_argument('--no-sandbox')\n\ndocker selenium--privileged\n\ndocker run -itd --privileged spider-executor /bin/bash ","slug":"python/use-selenium-on-linux","published":1,"updated":"2022-05-10T08:25:56.400Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p1000xxklofkiscvlc","content":"<ol>\n<li><p>vim &#x2F;etc&#x2F;yum.repos.d&#x2F;google.repo<br># </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[google]</span><br><span class=\"line\">name=Google-x86_64</span><br><span class=\"line\">baseurl=http://dl.google.com/linux/rpm/stable/x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>sudo yum makecache</p>\n</li>\n<li><p>sudo yum install google-chrome-stable -y</p>\n</li>\n<li><p>google-chrome version</p>\n</li>\n<li><p>chromedriver</p>\n<p><a href=\"http://npm.taobao.org/mirrors/chromedriver/\">http://npm.taobao.org/mirrors/chromedriver/</a></p>\n<p>miniconda bin<br></p>\n<p>chrome_options.add_argument(no-sandbox)</p>\n</li>\n</ol>\n<p>docker seleniumprivileged</p>\n<p>docker run -itd privileged spider-executor &#x2F;bin&#x2F;bash </p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>vim &#x2F;etc&#x2F;yum.repos.d&#x2F;google.repo<br># </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[google]</span><br><span class=\"line\">name=Google-x86_64</span><br><span class=\"line\">baseurl=http://dl.google.com/linux/rpm/stable/x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>sudo yum makecache</p>\n</li>\n<li><p>sudo yum install google-chrome-stable -y</p>\n</li>\n<li><p>google-chrome version</p>\n</li>\n<li><p>chromedriver</p>\n<p><a href=\"http://npm.taobao.org/mirrors/chromedriver/\">http://npm.taobao.org/mirrors/chromedriver/</a></p>\n<p>miniconda bin<br></p>\n<p>chrome_options.add_argument(no-sandbox)</p>\n</li>\n</ol>\n<p>docker seleniumprivileged</p>\n<p>docker run -itd privileged spider-executor &#x2F;bin&#x2F;bash </p>\n"},{"title":"python+opencv","date":"2021-05-10T11:35:37.000Z","typora-root-url":"..","_content":"\n1. HSV\n2. HSV\n3. inRange\n4. imShow\n\n\n\n```python\nimport cv2\nimport numpy as np\nsrc = cv2.imread(\"D:\\\\myCode\\\\picture\\\\cards.png\")\ncv2.namedWindow(\"input\", cv2.WINDOW_AUTOSIZE)\ncv2.imshow(\"input\", src)\n\"\"\"\n\n\"\"\"\nhsv = cv2.cvtColor(src, cv2.COLOR_BGR2HSV)\nlow_hsv = np.array([0,43,46])\nhigh_hsv = np.array([10,255,255])\nmask = cv2.inRange(hsv,lowerb=low_hsv,upperb=high_hsv)\ncv2.imshow(\"test\",mask)\ncv2.waitKey(0)\ncv2.destroyAllWindows()\n# hminsminvmin04346 hmaxsmaxvmax10255255.\n```\n\n![Image](/images/python-opencv-get-coler-in-img.png)\n\n","source":"_posts/python/python-opencv-get-coler-in-img.md","raw":"---\ntitle: python+opencv\ndate: 2021-05-10 19:35:37\ncategories:\n  - python\ntags:\n  - python\n  - opencv\n  - \ntypora-root-url: ..\n---\n\n1. HSV\n2. HSV\n3. inRange\n4. imShow\n\n\n\n```python\nimport cv2\nimport numpy as np\nsrc = cv2.imread(\"D:\\\\myCode\\\\picture\\\\cards.png\")\ncv2.namedWindow(\"input\", cv2.WINDOW_AUTOSIZE)\ncv2.imshow(\"input\", src)\n\"\"\"\n\n\"\"\"\nhsv = cv2.cvtColor(src, cv2.COLOR_BGR2HSV)\nlow_hsv = np.array([0,43,46])\nhigh_hsv = np.array([10,255,255])\nmask = cv2.inRange(hsv,lowerb=low_hsv,upperb=high_hsv)\ncv2.imshow(\"test\",mask)\ncv2.waitKey(0)\ncv2.destroyAllWindows()\n# hminsminvmin04346 hmaxsmaxvmax10255255.\n```\n\n![Image](/images/python-opencv-get-coler-in-img.png)\n\n","slug":"python/python-opencv-get-coler-in-img","published":1,"updated":"2022-05-10T08:25:56.399Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p10010xklo16af1t1u","content":"<ol>\n<li>HSV</li>\n<li>HSV</li>\n<li>inRange</li>\n<li>imShow</li>\n</ol>\n<p></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">src = cv2.imread(<span class=\"string\">&quot;D:\\\\myCode\\\\picture\\\\cards.png&quot;</span>)</span><br><span class=\"line\">cv2.namedWindow(<span class=\"string\">&quot;input&quot;</span>, cv2.WINDOW_AUTOSIZE)</span><br><span class=\"line\">cv2.imshow(<span class=\"string\">&quot;input&quot;</span>, src)</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\">hsv = cv2.cvtColor(src, cv2.COLOR_BGR2HSV)</span><br><span class=\"line\">low_hsv = np.array([<span class=\"number\">0</span>,<span class=\"number\">43</span>,<span class=\"number\">46</span>])</span><br><span class=\"line\">high_hsv = np.array([<span class=\"number\">10</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>])</span><br><span class=\"line\">mask = cv2.inRange(hsv,lowerb=low_hsv,upperb=high_hsv)</span><br><span class=\"line\">cv2.imshow(<span class=\"string\">&quot;test&quot;</span>,mask)</span><br><span class=\"line\">cv2.waitKey(<span class=\"number\">0</span>)</span><br><span class=\"line\">cv2.destroyAllWindows()</span><br><span class=\"line\"><span class=\"comment\"># hminsminvmin04346 hmaxsmaxvmax10255255.</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/python-opencv-get-coler-in-img.png\" alt=\"Image\"></p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li>HSV</li>\n<li>HSV</li>\n<li>inRange</li>\n<li>imShow</li>\n</ol>\n<p></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">src = cv2.imread(<span class=\"string\">&quot;D:\\\\myCode\\\\picture\\\\cards.png&quot;</span>)</span><br><span class=\"line\">cv2.namedWindow(<span class=\"string\">&quot;input&quot;</span>, cv2.WINDOW_AUTOSIZE)</span><br><span class=\"line\">cv2.imshow(<span class=\"string\">&quot;input&quot;</span>, src)</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\">hsv = cv2.cvtColor(src, cv2.COLOR_BGR2HSV)</span><br><span class=\"line\">low_hsv = np.array([<span class=\"number\">0</span>,<span class=\"number\">43</span>,<span class=\"number\">46</span>])</span><br><span class=\"line\">high_hsv = np.array([<span class=\"number\">10</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>])</span><br><span class=\"line\">mask = cv2.inRange(hsv,lowerb=low_hsv,upperb=high_hsv)</span><br><span class=\"line\">cv2.imshow(<span class=\"string\">&quot;test&quot;</span>,mask)</span><br><span class=\"line\">cv2.waitKey(<span class=\"number\">0</span>)</span><br><span class=\"line\">cv2.destroyAllWindows()</span><br><span class=\"line\"><span class=\"comment\"># hminsminvmin04346 hmaxsmaxvmax10255255.</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/python-opencv-get-coler-in-img.png\" alt=\"Image\"></p>\n"},{"layout":"hexo","title":"hexouml","date":"2022-05-10T11:38:53.000Z","_content":"\n1. \n\n```shell\nnpm install hexo-tag-plantuml --save\n```\n\n2. _config.yml\n\n```yml\nmermaid:\n  enable: true\n```\n","source":"_posts/hexo/uml.md","raw":"---\nlayout: hexo\ntitle: hexouml\ndate: 2022-05-10 19:38:53\ntags:\n---\n\n1. \n\n```shell\nnpm install hexo-tag-plantuml --save\n```\n\n2. _config.yml\n\n```yml\nmermaid:\n  enable: true\n```\n","slug":"hexo/uml","published":1,"updated":"2022-05-10T12:08:00.798Z","comments":1,"photos":[],"link":"","_id":"cl3k7f4p20013xklo2f44ebfj","content":"<ol>\n<li></li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-tag-plantuml --save</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>_config.yml</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mermaid:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li></li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install hexo-tag-plantuml --save</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>_config.yml</li>\n</ol>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mermaid:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n"},{"title":"elasticsearch","date":"2022-05-11T07:07:19.000Z","_content":"\n## \n\nElasticsearchElastic StackLogstashBeatsElasticsearchKibanaElasticsearch\n\nElasticsearchElasticsearch\n\nElasticsearch \n\n- \n- \n- \n- \n-  (GIS) \n- \n- \n\n## \n\nElasticsearch  JSON  \n\nElasticsearch \n\n********************Elasticsearch  BKD  Elasticsearch \n\nElasticsearch ()Elasticsearch Elasticsearch  Elasticsearch \n\n\n\n\n\n- \n- \n- \n- \n-  geo_pointgeo_shape\n- - \n\n## \n\nElasticsearch  Apache Lucene  REST API Kibana JavaJavaScriptGo.NETPHPPerlPython  Ruby\n\n### \n\nElasticsearch REST API  SQL\n Elasticsearch  JSON  ( Query DSL ) \n\n### \n\nElasticsearch \n\n- \n- \n- \n- \n- \n\n\n\n[](https://www.elastic.co/cn/elasticsearch/)\n[](https://www.elastic.co/guide/index.html)\n[java](https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html)\n","source":"_posts/elasticsearch/elasticsearchbase.md","raw":"---\ntitle: elasticsearch\ndate: 2022-05-11 15:07:19\ncategories:\n  - elasticsearch\ntags:\n  - elasticsearch\n---\n\n## \n\nElasticsearchElastic StackLogstashBeatsElasticsearchKibanaElasticsearch\n\nElasticsearchElasticsearch\n\nElasticsearch \n\n- \n- \n- \n- \n-  (GIS) \n- \n- \n\n## \n\nElasticsearch  JSON  \n\nElasticsearch \n\n********************Elasticsearch  BKD  Elasticsearch \n\nElasticsearch ()Elasticsearch Elasticsearch  Elasticsearch \n\n\n\n\n\n- \n- \n- \n- \n-  geo_pointgeo_shape\n- - \n\n## \n\nElasticsearch  Apache Lucene  REST API Kibana JavaJavaScriptGo.NETPHPPerlPython  Ruby\n\n### \n\nElasticsearch REST API  SQL\n Elasticsearch  JSON  ( Query DSL ) \n\n### \n\nElasticsearch \n\n- \n- \n- \n- \n- \n\n\n\n[](https://www.elastic.co/cn/elasticsearch/)\n[](https://www.elastic.co/guide/index.html)\n[java](https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html)\n","slug":"elasticsearch/elasticsearchbase","published":1,"updated":"2022-05-11T12:07:10.224Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p30017xklo7f0q6vu5","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ElasticsearchElastic StackLogstashBeatsElasticsearchKibanaElasticsearch</p>\n<p>ElasticsearchElasticsearch</p>\n<p>Elasticsearch </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> (GIS) </li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Elasticsearch  JSON  </p>\n<p>Elasticsearch </p>\n<p><strong></strong><strong></strong><strong></strong><strong></strong><strong></strong>Elasticsearch  BKD  Elasticsearch </p>\n<p>Elasticsearch ()Elasticsearch Elasticsearch  Elasticsearch </p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> geo_pointgeo_shape</li>\n<li>- </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Elasticsearch  Apache Lucene  REST API Kibana JavaJavaScriptGo.NETPHPPerlPython  Ruby</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Elasticsearch REST API  SQL<br> Elasticsearch  JSON  ( Query DSL ) </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Elasticsearch </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><a href=\"https://www.elastic.co/cn/elasticsearch/\"></a><br><a href=\"https://www.elastic.co/guide/index.html\"></a><br><a href=\"https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html\">java</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>ElasticsearchElastic StackLogstashBeatsElasticsearchKibanaElasticsearch</p>\n<p>ElasticsearchElasticsearch</p>\n<p>Elasticsearch </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> (GIS) </li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Elasticsearch  JSON  </p>\n<p>Elasticsearch </p>\n<p><strong></strong><strong></strong><strong></strong><strong></strong><strong></strong>Elasticsearch  BKD  Elasticsearch </p>\n<p>Elasticsearch ()Elasticsearch Elasticsearch  Elasticsearch </p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> geo_pointgeo_shape</li>\n<li>- </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Elasticsearch  Apache Lucene  REST API Kibana JavaJavaScriptGo.NETPHPPerlPython  Ruby</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Elasticsearch REST API  SQL<br> Elasticsearch  JSON  ( Query DSL ) </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Elasticsearch </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><a href=\"https://www.elastic.co/cn/elasticsearch/\"></a><br><a href=\"https://www.elastic.co/guide/index.html\"></a><br><a href=\"https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html\">java</a></p>\n"},{"title":"mysql","date":"2022-05-24T07:49:29.000Z","_content":"\n## \n\nMySQLWEBMySQLRDBMS(Relational Database Management System) \nMySQL\n\n## \n\n- \n\n|  |  |  |\n| -- | -- | -- |\n| tinyint | 1 | -128 ~ 127 |\n| smallint | 2 | -2 ^ 15 ~ 2 ^ 15 -1 |\n| int | 4 | -2 ^ 31 ~ 2 ^ 31 -1 |\n\n- \n\n|  |  |\n| -- | -- |\n| float | 4 |\n| double | 8 |\n\n- decimal(M,D)\n\n- \n\n|  |  |  |  |  |  |\n| -- | -- | -- | -- | -- | -- |\n| YEAR |  | 1 | YYYY/YY| 1901 | 2155 |\n| TIME |  | 3 | HH:MM:SS | -838:59:59 | 838:59:59 |\n| DATE |  | 3 | YYYY-MM-DD | 1000-01-01 | 9999-12-31 |\n| DATETIME |  | 8 | YYYY-MM-DD HH:MM:SS | 1000-01-01 00:00:00 | 9999-12-31 23:59:59 |\n| TIMESTAMP |  | 4 | YYYY-MM-DD HH:MM:SS | 1970-01-01 00:00:00 UTC | 2038-01-19 03:14:07 UTC |\n\n- \n\n|  |  |\n| -- | -- |\n| CHAR(M) | 0 - 255 |\n| VARCHAR(M) | 0 - 65535 |\n| TEXT | 0 - 65535 |\n| LONGTEXT | 0 - 4294967295 |\n\n- ENUM \n- JSON \n\n\n[](https://dev.mysql.com/)\n[](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html)\n","source":"_posts/database/mysql/mysql-base.md","raw":"---\ntitle: mysql\ndate: 2022-05-24 15:49:29\ncategories:\n  - database\n  - mysql\ntags:\n  - mysql\n  - base\n---\n\n## \n\nMySQLWEBMySQLRDBMS(Relational Database Management System) \nMySQL\n\n## \n\n- \n\n|  |  |  |\n| -- | -- | -- |\n| tinyint | 1 | -128 ~ 127 |\n| smallint | 2 | -2 ^ 15 ~ 2 ^ 15 -1 |\n| int | 4 | -2 ^ 31 ~ 2 ^ 31 -1 |\n\n- \n\n|  |  |\n| -- | -- |\n| float | 4 |\n| double | 8 |\n\n- decimal(M,D)\n\n- \n\n|  |  |  |  |  |  |\n| -- | -- | -- | -- | -- | -- |\n| YEAR |  | 1 | YYYY/YY| 1901 | 2155 |\n| TIME |  | 3 | HH:MM:SS | -838:59:59 | 838:59:59 |\n| DATE |  | 3 | YYYY-MM-DD | 1000-01-01 | 9999-12-31 |\n| DATETIME |  | 8 | YYYY-MM-DD HH:MM:SS | 1000-01-01 00:00:00 | 9999-12-31 23:59:59 |\n| TIMESTAMP |  | 4 | YYYY-MM-DD HH:MM:SS | 1970-01-01 00:00:00 UTC | 2038-01-19 03:14:07 UTC |\n\n- \n\n|  |  |\n| -- | -- |\n| CHAR(M) | 0 - 255 |\n| VARCHAR(M) | 0 - 65535 |\n| TEXT | 0 - 65535 |\n| LONGTEXT | 0 - 4294967295 |\n\n- ENUM \n- JSON \n\n\n[](https://dev.mysql.com/)\n[](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html)\n","slug":"database/mysql/mysql-base","published":1,"updated":"2022-05-24T13:39:20.339Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p3001axklo1i9daoc2","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQLWEBMySQLRDBMS(Relational Database Management System) <br>MySQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>tinyint</td>\n<td>1</td>\n<td>-128 ~ 127</td>\n</tr>\n<tr>\n<td>smallint</td>\n<td>2</td>\n<td>-2 ^ 15 ~ 2 ^ 15 -1</td>\n</tr>\n<tr>\n<td>int</td>\n<td>4</td>\n<td>-2 ^ 31 ~ 2 ^ 31 -1</td>\n</tr>\n</tbody></table>\n<ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>float</td>\n<td>4</td>\n</tr>\n<tr>\n<td>double</td>\n<td>8</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>decimal(M,D)</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>YEAR</td>\n<td></td>\n<td>1</td>\n<td>YYYY&#x2F;YY</td>\n<td>1901</td>\n<td>2155</td>\n</tr>\n<tr>\n<td>TIME</td>\n<td></td>\n<td>3</td>\n<td>HH:MM:SS</td>\n<td>-838:59:59</td>\n<td>838:59:59</td>\n</tr>\n<tr>\n<td>DATE</td>\n<td></td>\n<td>3</td>\n<td>YYYY-MM-DD</td>\n<td>1000-01-01</td>\n<td>9999-12-31</td>\n</tr>\n<tr>\n<td>DATETIME</td>\n<td></td>\n<td>8</td>\n<td>YYYY-MM-DD HH:MM:SS</td>\n<td>1000-01-01 00:00:00</td>\n<td>9999-12-31 23:59:59</td>\n</tr>\n<tr>\n<td>TIMESTAMP</td>\n<td></td>\n<td>4</td>\n<td>YYYY-MM-DD HH:MM:SS</td>\n<td>1970-01-01 00:00:00 UTC</td>\n<td>2038-01-19 03:14:07 UTC</td>\n</tr>\n</tbody></table>\n<ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CHAR(M)</td>\n<td>0 - 255</td>\n</tr>\n<tr>\n<td>VARCHAR(M)</td>\n<td>0 - 65535</td>\n</tr>\n<tr>\n<td>TEXT</td>\n<td>0 - 65535</td>\n</tr>\n<tr>\n<td>LONGTEXT</td>\n<td>0 - 4294967295</td>\n</tr>\n</tbody></table>\n<ul>\n<li>ENUM </li>\n<li>JSON </li>\n</ul>\n<p><a href=\"https://dev.mysql.com/\"></a><br><a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQLWEBMySQLRDBMS(Relational Database Management System) <br>MySQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>tinyint</td>\n<td>1</td>\n<td>-128 ~ 127</td>\n</tr>\n<tr>\n<td>smallint</td>\n<td>2</td>\n<td>-2 ^ 15 ~ 2 ^ 15 -1</td>\n</tr>\n<tr>\n<td>int</td>\n<td>4</td>\n<td>-2 ^ 31 ~ 2 ^ 31 -1</td>\n</tr>\n</tbody></table>\n<ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>float</td>\n<td>4</td>\n</tr>\n<tr>\n<td>double</td>\n<td>8</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>decimal(M,D)</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>YEAR</td>\n<td></td>\n<td>1</td>\n<td>YYYY&#x2F;YY</td>\n<td>1901</td>\n<td>2155</td>\n</tr>\n<tr>\n<td>TIME</td>\n<td></td>\n<td>3</td>\n<td>HH:MM:SS</td>\n<td>-838:59:59</td>\n<td>838:59:59</td>\n</tr>\n<tr>\n<td>DATE</td>\n<td></td>\n<td>3</td>\n<td>YYYY-MM-DD</td>\n<td>1000-01-01</td>\n<td>9999-12-31</td>\n</tr>\n<tr>\n<td>DATETIME</td>\n<td></td>\n<td>8</td>\n<td>YYYY-MM-DD HH:MM:SS</td>\n<td>1000-01-01 00:00:00</td>\n<td>9999-12-31 23:59:59</td>\n</tr>\n<tr>\n<td>TIMESTAMP</td>\n<td></td>\n<td>4</td>\n<td>YYYY-MM-DD HH:MM:SS</td>\n<td>1970-01-01 00:00:00 UTC</td>\n<td>2038-01-19 03:14:07 UTC</td>\n</tr>\n</tbody></table>\n<ul>\n<li></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CHAR(M)</td>\n<td>0 - 255</td>\n</tr>\n<tr>\n<td>VARCHAR(M)</td>\n<td>0 - 65535</td>\n</tr>\n<tr>\n<td>TEXT</td>\n<td>0 - 65535</td>\n</tr>\n<tr>\n<td>LONGTEXT</td>\n<td>0 - 4294967295</td>\n</tr>\n</tbody></table>\n<ul>\n<li>ENUM </li>\n<li>JSON </li>\n</ul>\n<p><a href=\"https://dev.mysql.com/\"></a><br><a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html\"></a></p>\n"},{"title":"mysql","date":"2021-04-28T07:19:09.000Z","_content":"\n# \n1. ### \n\n   \t\t\n2. ###  MySQL \n   \t\t \n   \t\t \n   \t\tNULL MySQL \n\n\n\n# \n\n1. ### SQL\n   1. CONCAT(A, B)  \n   2. FORMAT(X, D)-  X  D \n   3. CURRDATE(), CURRTIME()- \n   4. NOW  \n   5. MONTHDAYYEARWEEKWEEKDAY  \n   6. HOURMINUTESECOND  \n   7. DATEDIFFAB  \n   8. SUBTIMESAB  \n   9. FROMDAYSINT  \n\n\n\n# \n\n1. ### ?\n   \t\ttransaction\n   \n   \t\t SQL  ACID \n   \n   \n   \n   1. \n   2. \n   3. \n   4. \n\n\n\n# \n\n1. ###  MySQL  MyISAM  InnoDB \n   1. #### MyISAM\n      1. \n      2. \n      3. \n      4.  MYISAM \n      5. \n   2. #### InnoDb\n      1.  ACID \n      2. \n      3. \n      4.  InnoDb  2G\n      5.  B+\n\n2. ### \n   1. \n   2.  + null\n   3.  + null+ \n   4. \n3. ### \n   1. ****\n      \n      , , \n      \n   2. ****\n      \n      \n      \n   3. ****\n       \n       \n       \n4. ### \n   1. SHOW INDEX FROM <tablename>;\n5. ### \n   1. #### \n      \n      \n      \n      \n   2. #### \n      \n   3. #### ?\n      \n      \n   4. #### \n      \n      text\n6. ###  MySQL \n   1. (InnoDB )\n   2. ( KEY  INDEX )\n   3.  UNIQUE \n   4.  PRIMARY KEY \n   5.  INDEX(columnA, columnB)\n   6. \n7. ### \n   1. B+ B+\n   2.  InnoDB \n8. ### \n   1. % LIKE \n   2. OR \n   3.  varchar  int \n9. ### LIKE _\n   1.  0 _ LIKE \n\n\n\n# \n\n1. ### \n   \n   \n2. ### MySQL \n   1.  \n   2.  \n   3.  \n\n\n\n# \n\n1. ###  SQL \n   1.  Where where  Where  Where .HAVING \n   2.   EXISTS  IN NOT EXISTS  NOT IN\n   3.  \n   4.   IS NULL  IS NOT NULL\n   5.   where  order by \n   6.   where  null \n   7.   where \n2. ### \n   1.  NOTNULL ENUM\n   2. (JOIN)\n   3. (UNION)\n   4. \n   5. \n   6. \n   7. \n   8. \n\n\n\n# \n\n1. ### \n   1. \n   2. \n   3. \n   4. \n\n\n\n# \n\n1. ### \n   1. 1NF \n   2. 2NF \n   3. 3NF \n2. ### :\n   1. :\n   2. :\n3. #### :\n   1. :\n   2. :\n\n\n\n# \n\n1. ### SQL \n   SQL  sql  POST  GET  sql \n    SQL \n   \n   1.  magic_quotes_gpc  magic_quotes_runtime \n   2.  sql  addslashes  sql \n   3. Sql \n   4.  sql updateinsertdeleteselect * \n   5. ","source":"_posts/database/mysql/mysql-Interview-questions.md","raw":"---\ntitle: mysql\ndate: 2021-04-28 15:19:09\ncategories: \n  - database\n  - mysql\ntags: \n  - mysql\n  - \n---\n\n# \n1. ### \n\n   \t\t\n2. ###  MySQL \n   \t\t \n   \t\t \n   \t\tNULL MySQL \n\n\n\n# \n\n1. ### SQL\n   1. CONCAT(A, B)  \n   2. FORMAT(X, D)-  X  D \n   3. CURRDATE(), CURRTIME()- \n   4. NOW  \n   5. MONTHDAYYEARWEEKWEEKDAY  \n   6. HOURMINUTESECOND  \n   7. DATEDIFFAB  \n   8. SUBTIMESAB  \n   9. FROMDAYSINT  \n\n\n\n# \n\n1. ### ?\n   \t\ttransaction\n   \n   \t\t SQL  ACID \n   \n   \n   \n   1. \n   2. \n   3. \n   4. \n\n\n\n# \n\n1. ###  MySQL  MyISAM  InnoDB \n   1. #### MyISAM\n      1. \n      2. \n      3. \n      4.  MYISAM \n      5. \n   2. #### InnoDb\n      1.  ACID \n      2. \n      3. \n      4.  InnoDb  2G\n      5.  B+\n\n2. ### \n   1. \n   2.  + null\n   3.  + null+ \n   4. \n3. ### \n   1. ****\n      \n      , , \n      \n   2. ****\n      \n      \n      \n   3. ****\n       \n       \n       \n4. ### \n   1. SHOW INDEX FROM <tablename>;\n5. ### \n   1. #### \n      \n      \n      \n      \n   2. #### \n      \n   3. #### ?\n      \n      \n   4. #### \n      \n      text\n6. ###  MySQL \n   1. (InnoDB )\n   2. ( KEY  INDEX )\n   3.  UNIQUE \n   4.  PRIMARY KEY \n   5.  INDEX(columnA, columnB)\n   6. \n7. ### \n   1. B+ B+\n   2.  InnoDB \n8. ### \n   1. % LIKE \n   2. OR \n   3.  varchar  int \n9. ### LIKE _\n   1.  0 _ LIKE \n\n\n\n# \n\n1. ### \n   \n   \n2. ### MySQL \n   1.  \n   2.  \n   3.  \n\n\n\n# \n\n1. ###  SQL \n   1.  Where where  Where  Where .HAVING \n   2.   EXISTS  IN NOT EXISTS  NOT IN\n   3.  \n   4.   IS NULL  IS NOT NULL\n   5.   where  order by \n   6.   where  null \n   7.   where \n2. ### \n   1.  NOTNULL ENUM\n   2. (JOIN)\n   3. (UNION)\n   4. \n   5. \n   6. \n   7. \n   8. \n\n\n\n# \n\n1. ### \n   1. \n   2. \n   3. \n   4. \n\n\n\n# \n\n1. ### \n   1. 1NF \n   2. 2NF \n   3. 3NF \n2. ### :\n   1. :\n   2. :\n3. #### :\n   1. :\n   2. :\n\n\n\n# \n\n1. ### SQL \n   SQL  sql  POST  GET  sql \n    SQL \n   \n   1.  magic_quotes_gpc  magic_quotes_runtime \n   2.  sql  addslashes  sql \n   3. Sql \n   4.  sql updateinsertdeleteselect * \n   5. ","slug":"database/mysql/mysql-Interview-questions","published":1,"updated":"2022-05-10T08:25:56.380Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p4001dxklo9tar226s","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>\t\t</li>\n<li><h3 id=\"-MySQL-\"><a href=\"#-MySQL-\" class=\"headerlink\" title=\" MySQL \"></a> MySQL </h3>\t\t <br>\t\t <br>\t\tNULL MySQL </li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h3><ol>\n<li>CONCAT(A, B)  </li>\n<li>FORMAT(X, D)-  X  D </li>\n<li>CURRDATE(), CURRTIME()- </li>\n<li>NOW  </li>\n<li>MONTHDAYYEARWEEKWEEKDAY  </li>\n<li>HOURMINUTESECOND  </li>\n<li>DATEDIFFAB  </li>\n<li>SUBTIMESAB  </li>\n<li>FROMDAYSINT  </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"?\"></a>?</h3><p>\t\ttransaction</p>\n<p>\t\t SQL  ACID </p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"-MySQL--MyISAM--InnoDB-\"><a href=\"#-MySQL--MyISAM--InnoDB-\" class=\"headerlink\" title=\" MySQL  MyISAM  InnoDB \"></a> MySQL  MyISAM  InnoDB </h3><ol>\n<li><h4 id=\"MyISAM\"><a href=\"#MyISAM\" class=\"headerlink\" title=\"MyISAM\"></a>MyISAM</h4><ol>\n<li></li>\n<li></li>\n<li></li>\n<li> MYISAM </li>\n<li></li>\n</ol>\n</li>\n<li><h4 id=\"InnoDb\"><a href=\"#InnoDb\" class=\"headerlink\" title=\"InnoDb\"></a>InnoDb</h4><ol>\n<li> ACID </li>\n<li></li>\n<li></li>\n<li> InnoDb  2G</li>\n<li> B+</li>\n</ol>\n</li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li></li>\n<li> + null</li>\n<li> + null+ </li>\n<li></li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><strong></strong><br><br>, , <br></li>\n<li><strong></strong><br><br><br></li>\n<li><strong></strong><br> <br> <br> </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>SHOW INDEX FROM <tablename>;</li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><br><br><br></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"?\"></a>?</h4><br></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><br>text</li>\n</ol>\n</li>\n<li><h3 id=\"-MySQL-\"><a href=\"#-MySQL-\" class=\"headerlink\" title=\" MySQL \"></a> MySQL </h3><ol>\n<li>(InnoDB )</li>\n<li>( KEY  INDEX )</li>\n<li> UNIQUE </li>\n<li> PRIMARY KEY </li>\n<li> INDEX(columnA, columnB)</li>\n<li></li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>B+ B+</li>\n<li> InnoDB </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>% LIKE </li>\n<li>OR </li>\n<li> varchar  int </li>\n</ol>\n</li>\n<li><h3 id=\"LIKE--\"><a href=\"#LIKE--\" class=\"headerlink\" title=\"LIKE _\"></a>LIKE _</h3><ol>\n<li> 0 _ LIKE </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><br></li>\n<li><h3 id=\"MySQL-\"><a href=\"#MySQL-\" class=\"headerlink\" title=\"MySQL \"></a>MySQL </h3><ol>\n<li> </li>\n<li> </li>\n<li> </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"-SQL-\"><a href=\"#-SQL-\" class=\"headerlink\" title=\" SQL \"></a> SQL </h3><ol>\n<li>Where where  Where  Where .HAVING </li>\n<li> EXISTS  IN NOT EXISTS  NOT IN</li>\n<li></li>\n<li> IS NULL  IS NOT NULL</li>\n<li> where  order by </li>\n<li> where  null </li>\n<li> where </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> NOTNULL ENUM</li>\n<li>(JOIN)</li>\n<li>(UNION)</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>1NF </li>\n<li>2NF </li>\n<li>3NF </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><ol>\n<li>:</li>\n<li>:</li>\n</ol>\n</li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h4><ol>\n<li>:</li>\n<li>:</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"SQL-\"><a href=\"#SQL-\" class=\"headerlink\" title=\"SQL \"></a>SQL </h3><p>SQL  sql  POST  GET  sql <br> SQL </p>\n<ol>\n<li> magic_quotes_gpc  magic_quotes_runtime </li>\n<li> sql  addslashes  sql </li>\n<li>Sql </li>\n<li> sql updateinsertdeleteselect * </li>\n<li></li>\n</ol>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>\t\t</li>\n<li><h3 id=\"-MySQL-\"><a href=\"#-MySQL-\" class=\"headerlink\" title=\" MySQL \"></a> MySQL </h3>\t\t <br>\t\t <br>\t\tNULL MySQL </li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h3><ol>\n<li>CONCAT(A, B)  </li>\n<li>FORMAT(X, D)-  X  D </li>\n<li>CURRDATE(), CURRTIME()- </li>\n<li>NOW  </li>\n<li>MONTHDAYYEARWEEKWEEKDAY  </li>\n<li>HOURMINUTESECOND  </li>\n<li>DATEDIFFAB  </li>\n<li>SUBTIMESAB  </li>\n<li>FROMDAYSINT  </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"?\"></a>?</h3><p>\t\ttransaction</p>\n<p>\t\t SQL  ACID </p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"-MySQL--MyISAM--InnoDB-\"><a href=\"#-MySQL--MyISAM--InnoDB-\" class=\"headerlink\" title=\" MySQL  MyISAM  InnoDB \"></a> MySQL  MyISAM  InnoDB </h3><ol>\n<li><h4 id=\"MyISAM\"><a href=\"#MyISAM\" class=\"headerlink\" title=\"MyISAM\"></a>MyISAM</h4><ol>\n<li></li>\n<li></li>\n<li></li>\n<li> MYISAM </li>\n<li></li>\n</ol>\n</li>\n<li><h4 id=\"InnoDb\"><a href=\"#InnoDb\" class=\"headerlink\" title=\"InnoDb\"></a>InnoDb</h4><ol>\n<li> ACID </li>\n<li></li>\n<li></li>\n<li> InnoDb  2G</li>\n<li> B+</li>\n</ol>\n</li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li></li>\n<li> + null</li>\n<li> + null+ </li>\n<li></li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><strong></strong><br><br>, , <br></li>\n<li><strong></strong><br><br><br></li>\n<li><strong></strong><br> <br> <br> </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>SHOW INDEX FROM <tablename>;</li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><br><br><br></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"?\"></a>?</h4><br></li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><br>text</li>\n</ol>\n</li>\n<li><h3 id=\"-MySQL-\"><a href=\"#-MySQL-\" class=\"headerlink\" title=\" MySQL \"></a> MySQL </h3><ol>\n<li>(InnoDB )</li>\n<li>( KEY  INDEX )</li>\n<li> UNIQUE </li>\n<li> PRIMARY KEY </li>\n<li> INDEX(columnA, columnB)</li>\n<li></li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>B+ B+</li>\n<li> InnoDB </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>% LIKE </li>\n<li>OR </li>\n<li> varchar  int </li>\n</ol>\n</li>\n<li><h3 id=\"LIKE--\"><a href=\"#LIKE--\" class=\"headerlink\" title=\"LIKE _\"></a>LIKE _</h3><ol>\n<li> 0 _ LIKE </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><br></li>\n<li><h3 id=\"MySQL-\"><a href=\"#MySQL-\" class=\"headerlink\" title=\"MySQL \"></a>MySQL </h3><ol>\n<li> </li>\n<li> </li>\n<li> </li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"-SQL-\"><a href=\"#-SQL-\" class=\"headerlink\" title=\" SQL \"></a> SQL </h3><ol>\n<li>Where where  Where  Where .HAVING </li>\n<li> EXISTS  IN NOT EXISTS  NOT IN</li>\n<li></li>\n<li> IS NULL  IS NOT NULL</li>\n<li> where  order by </li>\n<li> where  null </li>\n<li> where </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> NOTNULL ENUM</li>\n<li>(JOIN)</li>\n<li>(UNION)</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>1NF </li>\n<li>2NF </li>\n<li>3NF </li>\n</ol>\n</li>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><ol>\n<li>:</li>\n<li>:</li>\n</ol>\n</li>\n<li><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h4><ol>\n<li>:</li>\n<li>:</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li><h3 id=\"SQL-\"><a href=\"#SQL-\" class=\"headerlink\" title=\"SQL \"></a>SQL </h3><p>SQL  sql  POST  GET  sql <br> SQL </p>\n<ol>\n<li> magic_quotes_gpc  magic_quotes_runtime </li>\n<li> sql  addslashes  sql </li>\n<li>Sql </li>\n<li> sql updateinsertdeleteselect * </li>\n<li></li>\n</ol>\n</li>\n</ol>\n"},{"title":"mysql","date":"2021-04-28T12:44:07.000Z","typora-root-url":"..","_content":"\n# \n\n![image](/images/mysql-lock/mysql-lock.png \"\")\n\n# 1.\n\n## 1.1\n\n:javaLock,synchronized\n\n## 1.2?\n\nDQL(select),DML(insert,update,delete)\n\nJavaPMspring,springmvc,mybatissqlsqlspring\n\n,\n\nmysql-insert-deadlock-deleteSQLMysql\n\n# 2.InnoDB\n\n## 2.1mysql\n\nMysql:\n\n ![](/images/mysql-lock/mysql-lock-1.webp) \n\nMysqlsql \n\nmysqlMysql:\n\n```\nshow engines \\G;\n```\n\n\n\n:\n\n```\nshow variables like '%storage_engine%';\n```\n\n![](/images/mysql-lock/mysql-lock-2.webp):InnoDB,MyIsAM,?:\n\n|    | InnoDB                         | MyIsAM       |\n| :------- | :----------------------------- | :----------- |\n|      |                            |        |\n|        | MVCC                   |          |\n|      |                            |        |\n|  |  |        |\n|  | updateInsert       | select |\n\nInnoDBMyIsAMInnoDB\n\n## 2.2\n\n\n\n### 2.2.1 \n\n ?\n\n|  | A                            | B                                       |\n| :----- | :------------------------------- | :------------------------------------------ |\n| 1      | begin;                           |                                             |\n| 2      | select * from user where id = 1; | begin;                                      |\n| 3      |                                  | update user set namm = 'test' where id = 1; |\n| 4      | select * from user where id = 1; |                                             |\n| 5      | commit;                          | commit;                                     |\n\nABA24userid=1B3A4B\n\n### 2.2.2 \n\n\n\n|  | A                            | B                                       |\n| :----- | :------------------------------- | :------------------------------------------ |\n| 1      | begin;                           |                                             |\n| 2      | select * from user where id = 1; | begin;                                      |\n| 3      |                                  | update user set namm = 'test' where id = 1; |\n| 4      |                                  | commit;                                     |\n| 5      | select * from user where id = 1; |                                             |\n| 6      | commit;                          |                                             |\n|        |                                  |                                             |\n\nBAB\n\n### 2.2.3 \n\ninsert\n\n|  | A                            | B                 |\n| :----- | :------------------------------- | :-------------------- |\n| 1      | begin;                           |                       |\n| 2      | select * from user where id > 1; | begin;                |\n| 3      |                                  | insert user select 2; |\n| 4      |                                  | commit;               |\n| 5      | select * from user where id > 1; |                       |\n| 6      | commit;                          |                       |\n\nAid1id1BId=2AB\n\n:\n\n|       |  |  |  |\n| :------------ | :--- | :--------- | :--- |\n| (RUC) | NO   | NO         | NO   |\n| (RC)  | YES  | NO         | NO   |\n| (RR)  | YES  | YES        | NO   |\n|       | YES  | YES        | YES  |\n\nInnoDBInnoDB:InnoDB\n\n## 2.3 InnoDB\n\nMysql:\n\n### 2.3.1 S or X\n\nInnoDb:\n\n- S-\n- X-: \n\n> :AB\n\n\n\n| .    | X    | S    |\n| :--- | :--- | :--- |\n| X    |  |  |\n| S    |  |  |\n\n### 2.3.2 \n\nInnoDB,:\n\n- :\n- :\n\n \n\nInnoDBInnboDB\n\n| .    | IX   | IS   | X    | S    |\n| :--- | :--- | :--- | :--- | :--- |\n| IX   |  |  |  |  |\n| IS   |  |  |  |  |\n| X    |  |  |  |  |\n| S    |  |  |  |  |\n\n### 2.3.3 \n\n:\n\n- sql\n- Insert...select\n- \n\nMySQL5.1.2MySQL5.7,:\n\n```sql\nmysql> show variables like 'innodb_autoinc_lock_mode';\n+--------------------------+-------+\n| Variable_name            | Value |\n+--------------------------+-------+\n| innodb_autoinc_lock_mode | 2     |\n+--------------------------+-------+\n1 row in set (0.01 sec)\n```\n\nMySQLinnodbautoinclock_mode3012, , \n\n1. :\n2. :\n3. :\n\n## 2.4InnoDB\n\nInnoDB\n\n### 2.4.1 (Record-Lock)\n\n\n\n- .\n- ()\n- \n\n### 2.4.2 \n\ngapgap\n\n![](/images/mysql-lock/mysql-lock-3.webp)\n\n### 2.4.3 next-key\n\ngapRR(InnoDB)Innodb? \n\n> MysqlRR\n\n### 2.4.4 \n\nMysql:\n\n> An insert intention lock is a type of gap lock set by INSERT operations prior to row insertion. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.\n\n,47564-7\n\n> \n\n## 2.5 MVCC\n\nMVCCInnoDB\n\nMVCC:\n\n- :selectMVCCMVCCundo\n- :,update,insert,delete,select...for update\n\nRRbeginsnapshotselectsnapshotselect\n\nRC\n\n> Undologundolog\n\n# 3.\n\nmysql:\n\n```sql\nCREATE TABLE `user` (\n`id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n`name` varchar(11) CHARACTER SET utf8mb4 DEFAULT NULL,\n`comment` varchar(11) CHARACTER SET utf8 DEFAULT NULL, \nPRIMARY KEY (`id`),  \nKEY `index_name` (`name`)\n) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;\n```\n\n:\n\n```sql\ninsert user select 20,333,333;\ninsert user select 25,555,555;\ninsert user select 20,999,999;\n```\n\nRR\n\n## 3.1 1\n\n1.\n\n|  | A                                             | B                                                        |\n| :----- | :------------------------------------------------ | :----------------------------------------------------------- |\n| 1      | begin;                                            |                                                              |\n| 2      | select * from user where name = '555' for update; | begin;                                                       |\n| 3      |                                                   | insert user select 31,'556','556';                           |\n| 4      |                                                   | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n\nBname = 555name=556:\n\n```sql\nselect * from information_schema.INNODB_LOCKS\n```\n\nA555Next-keyB: ![](/images/mysql-lock/mysql-lock-4.jpg)B\n\n## 3.2 2\n\n:\n\n|  | A                                        | B                               |\n| :----- | :------------------------------------------- | :---------------------------------- |\n| 1      | begin;                                       |                                     |\n| 2      | select * from user where id = 25 for update; | begin;                              |\n| 3      |                                              | insert user select 26,'666','666';  |\n| 4      |                                              | Query OK, 1 row affected (0.00 sec) |\n|        |                                              |                                     |\n\nRecords: 1 Duplicates: 0 Warnings: 0\n\nB125-30X:next-key\n\n![](/images/mysql-lock/mysql-lock-5.webp)\n\n## 3.3 3\n\n\n\n|  | A                                                | B                                                        |\n| :----- | :--------------------------------------------------- | :----------------------------------------------------------- |\n| 1      | begin;                                               |                                                              |\n| 2      | select * from user where comment = '555' for update; | begin;                                                       |\n| 3      |                                                      | insert user select 26,'666','666';                           |\n| 4      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n| 5      |                                                      | insert user select 31,'3131','3131';                         |\n| 6      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n| 7      |                                                      | insert user select 10,'100','100';                           |\n| 8      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n|        |                                                      |                                                              |\n\n1\n\nnext-key\n\n![](/images/mysql-lock/mysql-lock-6.webp)\n\n\n\n# 4.\n\n## 4.1 \n\n\n\n:\n\n:\n\n1. :\n2. (wait-for-graph): :\n\n![](/images/mysql-lock/mysql-lock-7.webp) InnoDBundo\n\n## 4.2 \n\n:\n\n|  | A                                                        | B                                                        |\n| :----- | :----------------------------------------------------------- | :----------------------------------------------------------- |\n| 1      | begin;                                                       | begin;                                                       |\n| 2      | delete from user where name = '777';                         | delete from user where name = '666';                         |\n| 3      | insert user select 27,'777','777';                           | insert user select 26,'666','666';                           |\n| 4      | ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction | Query OK, 1 row affected (14.32 sec) Records: 1 Duplicates: 0 Warnings: 0 |\n\nAB ?\n\n2:Aname = '777'777next-Key555-999B555-999\n\n3:AInsert555-999ABBAA->B,B->A\n\n4:AB\n\n![](/images/mysql-lock/mysql-lock-8.jpg)\n\n## 4.3 BUG\n\n:\n\n- :RCRCRC\n- :\n- :\n- :()2\n\nBug\n\n## 4.4 \n\n:\n\n- \n- \n- (4.3)RRRCgap\n- \n\n\n\n\n\n\n\nhttps://learnku.com/articles/39212\n\nhttps://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw","source":"_posts/database/mysql/mysql-lock-overview.md","raw":"---\ntitle: mysql\ndate: 2021-04-28 20:44:07\ncategories: \n  - database\n  - mysql\ntags: \n  - mysql\n  - \ntypora-root-url: ..\n---\n\n# \n\n![image](/images/mysql-lock/mysql-lock.png \"\")\n\n# 1.\n\n## 1.1\n\n:javaLock,synchronized\n\n## 1.2?\n\nDQL(select),DML(insert,update,delete)\n\nJavaPMspring,springmvc,mybatissqlsqlspring\n\n,\n\nmysql-insert-deadlock-deleteSQLMysql\n\n# 2.InnoDB\n\n## 2.1mysql\n\nMysql:\n\n ![](/images/mysql-lock/mysql-lock-1.webp) \n\nMysqlsql \n\nmysqlMysql:\n\n```\nshow engines \\G;\n```\n\n\n\n:\n\n```\nshow variables like '%storage_engine%';\n```\n\n![](/images/mysql-lock/mysql-lock-2.webp):InnoDB,MyIsAM,?:\n\n|    | InnoDB                         | MyIsAM       |\n| :------- | :----------------------------- | :----------- |\n|      |                            |        |\n|        | MVCC                   |          |\n|      |                            |        |\n|  |  |        |\n|  | updateInsert       | select |\n\nInnoDBMyIsAMInnoDB\n\n## 2.2\n\n\n\n### 2.2.1 \n\n ?\n\n|  | A                            | B                                       |\n| :----- | :------------------------------- | :------------------------------------------ |\n| 1      | begin;                           |                                             |\n| 2      | select * from user where id = 1; | begin;                                      |\n| 3      |                                  | update user set namm = 'test' where id = 1; |\n| 4      | select * from user where id = 1; |                                             |\n| 5      | commit;                          | commit;                                     |\n\nABA24userid=1B3A4B\n\n### 2.2.2 \n\n\n\n|  | A                            | B                                       |\n| :----- | :------------------------------- | :------------------------------------------ |\n| 1      | begin;                           |                                             |\n| 2      | select * from user where id = 1; | begin;                                      |\n| 3      |                                  | update user set namm = 'test' where id = 1; |\n| 4      |                                  | commit;                                     |\n| 5      | select * from user where id = 1; |                                             |\n| 6      | commit;                          |                                             |\n|        |                                  |                                             |\n\nBAB\n\n### 2.2.3 \n\ninsert\n\n|  | A                            | B                 |\n| :----- | :------------------------------- | :-------------------- |\n| 1      | begin;                           |                       |\n| 2      | select * from user where id > 1; | begin;                |\n| 3      |                                  | insert user select 2; |\n| 4      |                                  | commit;               |\n| 5      | select * from user where id > 1; |                       |\n| 6      | commit;                          |                       |\n\nAid1id1BId=2AB\n\n:\n\n|       |  |  |  |\n| :------------ | :--- | :--------- | :--- |\n| (RUC) | NO   | NO         | NO   |\n| (RC)  | YES  | NO         | NO   |\n| (RR)  | YES  | YES        | NO   |\n|       | YES  | YES        | YES  |\n\nInnoDBInnoDB:InnoDB\n\n## 2.3 InnoDB\n\nMysql:\n\n### 2.3.1 S or X\n\nInnoDb:\n\n- S-\n- X-: \n\n> :AB\n\n\n\n| .    | X    | S    |\n| :--- | :--- | :--- |\n| X    |  |  |\n| S    |  |  |\n\n### 2.3.2 \n\nInnoDB,:\n\n- :\n- :\n\n \n\nInnoDBInnboDB\n\n| .    | IX   | IS   | X    | S    |\n| :--- | :--- | :--- | :--- | :--- |\n| IX   |  |  |  |  |\n| IS   |  |  |  |  |\n| X    |  |  |  |  |\n| S    |  |  |  |  |\n\n### 2.3.3 \n\n:\n\n- sql\n- Insert...select\n- \n\nMySQL5.1.2MySQL5.7,:\n\n```sql\nmysql> show variables like 'innodb_autoinc_lock_mode';\n+--------------------------+-------+\n| Variable_name            | Value |\n+--------------------------+-------+\n| innodb_autoinc_lock_mode | 2     |\n+--------------------------+-------+\n1 row in set (0.01 sec)\n```\n\nMySQLinnodbautoinclock_mode3012, , \n\n1. :\n2. :\n3. :\n\n## 2.4InnoDB\n\nInnoDB\n\n### 2.4.1 (Record-Lock)\n\n\n\n- .\n- ()\n- \n\n### 2.4.2 \n\ngapgap\n\n![](/images/mysql-lock/mysql-lock-3.webp)\n\n### 2.4.3 next-key\n\ngapRR(InnoDB)Innodb? \n\n> MysqlRR\n\n### 2.4.4 \n\nMysql:\n\n> An insert intention lock is a type of gap lock set by INSERT operations prior to row insertion. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.\n\n,47564-7\n\n> \n\n## 2.5 MVCC\n\nMVCCInnoDB\n\nMVCC:\n\n- :selectMVCCMVCCundo\n- :,update,insert,delete,select...for update\n\nRRbeginsnapshotselectsnapshotselect\n\nRC\n\n> Undologundolog\n\n# 3.\n\nmysql:\n\n```sql\nCREATE TABLE `user` (\n`id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n`name` varchar(11) CHARACTER SET utf8mb4 DEFAULT NULL,\n`comment` varchar(11) CHARACTER SET utf8 DEFAULT NULL, \nPRIMARY KEY (`id`),  \nKEY `index_name` (`name`)\n) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;\n```\n\n:\n\n```sql\ninsert user select 20,333,333;\ninsert user select 25,555,555;\ninsert user select 20,999,999;\n```\n\nRR\n\n## 3.1 1\n\n1.\n\n|  | A                                             | B                                                        |\n| :----- | :------------------------------------------------ | :----------------------------------------------------------- |\n| 1      | begin;                                            |                                                              |\n| 2      | select * from user where name = '555' for update; | begin;                                                       |\n| 3      |                                                   | insert user select 31,'556','556';                           |\n| 4      |                                                   | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n\nBname = 555name=556:\n\n```sql\nselect * from information_schema.INNODB_LOCKS\n```\n\nA555Next-keyB: ![](/images/mysql-lock/mysql-lock-4.jpg)B\n\n## 3.2 2\n\n:\n\n|  | A                                        | B                               |\n| :----- | :------------------------------------------- | :---------------------------------- |\n| 1      | begin;                                       |                                     |\n| 2      | select * from user where id = 25 for update; | begin;                              |\n| 3      |                                              | insert user select 26,'666','666';  |\n| 4      |                                              | Query OK, 1 row affected (0.00 sec) |\n|        |                                              |                                     |\n\nRecords: 1 Duplicates: 0 Warnings: 0\n\nB125-30X:next-key\n\n![](/images/mysql-lock/mysql-lock-5.webp)\n\n## 3.3 3\n\n\n\n|  | A                                                | B                                                        |\n| :----- | :--------------------------------------------------- | :----------------------------------------------------------- |\n| 1      | begin;                                               |                                                              |\n| 2      | select * from user where comment = '555' for update; | begin;                                                       |\n| 3      |                                                      | insert user select 26,'666','666';                           |\n| 4      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n| 5      |                                                      | insert user select 31,'3131','3131';                         |\n| 6      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n| 7      |                                                      | insert user select 10,'100','100';                           |\n| 8      |                                                      | ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction |\n|        |                                                      |                                                              |\n\n1\n\nnext-key\n\n![](/images/mysql-lock/mysql-lock-6.webp)\n\n\n\n# 4.\n\n## 4.1 \n\n\n\n:\n\n:\n\n1. :\n2. (wait-for-graph): :\n\n![](/images/mysql-lock/mysql-lock-7.webp) InnoDBundo\n\n## 4.2 \n\n:\n\n|  | A                                                        | B                                                        |\n| :----- | :----------------------------------------------------------- | :----------------------------------------------------------- |\n| 1      | begin;                                                       | begin;                                                       |\n| 2      | delete from user where name = '777';                         | delete from user where name = '666';                         |\n| 3      | insert user select 27,'777','777';                           | insert user select 26,'666','666';                           |\n| 4      | ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction | Query OK, 1 row affected (14.32 sec) Records: 1 Duplicates: 0 Warnings: 0 |\n\nAB ?\n\n2:Aname = '777'777next-Key555-999B555-999\n\n3:AInsert555-999ABBAA->B,B->A\n\n4:AB\n\n![](/images/mysql-lock/mysql-lock-8.jpg)\n\n## 4.3 BUG\n\n:\n\n- :RCRCRC\n- :\n- :\n- :()2\n\nBug\n\n## 4.4 \n\n:\n\n- \n- \n- (4.3)RRRCgap\n- \n\n\n\n\n\n\n\nhttps://learnku.com/articles/39212\n\nhttps://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw","slug":"database/mysql/mysql-lock-overview","published":1,"updated":"2022-05-10T08:25:56.382Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p4001fxklo0c8ygwgy","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/mysql-lock/mysql-lock.png\" alt=\"image\" title=\"\"></p>\n<h1 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1.\"></a>1.</h1><h2 id=\"1-1\"><a href=\"#1-1\" class=\"headerlink\" title=\"1.1\"></a>1.1</h2><p>:javaLock,synchronized</p>\n<h2 id=\"1-2\"><a href=\"#1-2\" class=\"headerlink\" title=\"1.2?\"></a>1.2?</h2><p>DQL(select),DML(insert,update,delete)</p>\n<p>JavaPMspring,springmvc,mybatissqlsqlspring</p>\n<p>,</p>\n<p>mysql-insert-deadlock-deleteSQLMysql</p>\n<h1 id=\"2-InnoDB\"><a href=\"#2-InnoDB\" class=\"headerlink\" title=\"2.InnoDB\"></a>2.InnoDB</h1><h2 id=\"2-1mysql\"><a href=\"#2-1mysql\" class=\"headerlink\" title=\"2.1mysql\"></a>2.1mysql</h2><p>Mysql:</p>\n<p> <img src=\"/images/mysql-lock/mysql-lock-1.webp\" alt=\"\"> </p>\n<p>Mysqlsql </p>\n<p>mysqlMysql:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show engines \\G;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;%storage_engine%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/mysql-lock/mysql-lock-2.webp\" alt=\"\">:InnoDB,MyIsAM,?:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">InnoDB</th>\n<th align=\"left\">MyIsAM</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">MVCC</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">updateInsert</td>\n<td align=\"left\">select</td>\n</tr>\n</tbody></table>\n<p>InnoDBMyIsAMInnoDB</p>\n<h2 id=\"2-2\"><a href=\"#2-2\" class=\"headerlink\" title=\"2.2\"></a>2.2</h2><p></p>\n<h3 id=\"2-2-1-\"><a href=\"#2-2-1-\" class=\"headerlink\" title=\"2.2.1 \"></a>2.2.1 </h3><p> ?</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">update user set namm &#x3D; test where id &#x3D; 1;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\">commit;</td>\n</tr>\n</tbody></table>\n<p>ABA24userid&#x3D;1B3A4B</p>\n<h3 id=\"2-2-2-\"><a href=\"#2-2-2-\" class=\"headerlink\" title=\"2.2.2 \"></a>2.2.2 </h3><p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">update user set namm &#x3D; test where id &#x3D; 1;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">commit;</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>BAB</p>\n<h3 id=\"2-2-3-\"><a href=\"#2-2-3-\" class=\"headerlink\" title=\"2.2.3 \"></a>2.2.3 </h3><p>insert</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &gt; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 2;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">commit;</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">select * from user where id &gt; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>Aid1id1BId&#x3D;2AB</p>\n<p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">(RUC)</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\">(RC)</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\">(RR)</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n</tr>\n</tbody></table>\n<p>InnoDBInnoDB:InnoDB</p>\n<h2 id=\"2-3-InnoDB\"><a href=\"#2-3-InnoDB\" class=\"headerlink\" title=\"2.3 InnoDB\"></a>2.3 InnoDB</h2><p>Mysql:</p>\n<h3 id=\"2-3-1-S-or-X\"><a href=\"#2-3-1-S-or-X\" class=\"headerlink\" title=\"2.3.1 S or X\"></a>2.3.1 S or X</h3><p>InnoDb:</p>\n<ul>\n<li>S-</li>\n<li>X-: </li>\n</ul>\n<blockquote>\n<p>:AB</p>\n</blockquote>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">.</th>\n<th align=\"left\">X</th>\n<th align=\"left\">S</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">X</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"2-3-2-\"><a href=\"#2-3-2-\" class=\"headerlink\" title=\"2.3.2 \"></a>2.3.2 </h3><p>InnoDB,:</p>\n<ul>\n<li>:</li>\n<li>:</li>\n</ul>\n<p> </p>\n<p>InnoDBInnboDB</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">.</th>\n<th align=\"left\">IX</th>\n<th align=\"left\">IS</th>\n<th align=\"left\">X</th>\n<th align=\"left\">S</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">IX</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">IS</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">X</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"2-3-3-\"><a href=\"#2-3-3-\" class=\"headerlink\" title=\"2.3.3 \"></a>2.3.3 </h3><p>:</p>\n<ul>\n<li>sql</li>\n<li>Insertselect</li>\n<li></li>\n</ul>\n<p>MySQL5.1.2MySQL5.7,:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;innodb_autoinc_lock_mode&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name            <span class=\"operator\">|</span> <span class=\"keyword\">Value</span> <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> innodb_autoinc_lock_mode <span class=\"operator\">|</span> <span class=\"number\">2</span>     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.01</span> sec)</span><br></pre></td></tr></table></figure>\n\n<p>MySQLinnodbautoinclock_mode3012, , </p>\n<ol>\n<li>:</li>\n<li>:</li>\n<li>:</li>\n</ol>\n<h2 id=\"2-4InnoDB\"><a href=\"#2-4InnoDB\" class=\"headerlink\" title=\"2.4InnoDB\"></a>2.4InnoDB</h2><p>InnoDB</p>\n<h3 id=\"2-4-1--Record-Lock\"><a href=\"#2-4-1--Record-Lock\" class=\"headerlink\" title=\"2.4.1 (Record-Lock)\"></a>2.4.1 (Record-Lock)</h3><p></p>\n<ul>\n<li>.</li>\n<li>()</li>\n<li></li>\n</ul>\n<h3 id=\"2-4-2-\"><a href=\"#2-4-2-\" class=\"headerlink\" title=\"2.4.2 \"></a>2.4.2 </h3><p>gapgap</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-3.webp\" alt=\"\"></p>\n<h3 id=\"2-4-3-next-key\"><a href=\"#2-4-3-next-key\" class=\"headerlink\" title=\"2.4.3 next-key\"></a>2.4.3 next-key</h3><p>gapRR(InnoDB)Innodb? </p>\n<blockquote>\n<p>MysqlRR</p>\n</blockquote>\n<h3 id=\"2-4-4-\"><a href=\"#2-4-4-\" class=\"headerlink\" title=\"2.4.4 \"></a>2.4.4 </h3><p>Mysql:</p>\n<blockquote>\n<p>An insert intention lock is a type of gap lock set by INSERT operations prior to row insertion. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.</p>\n</blockquote>\n<p>,47564-7</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"2-5-MVCC\"><a href=\"#2-5-MVCC\" class=\"headerlink\" title=\"2.5 MVCC\"></a>2.5 MVCC</h2><p>MVCCInnoDB</p>\n<p>MVCC:</p>\n<ul>\n<li>:selectMVCCMVCCundo</li>\n<li>:,update,insert,delete,selectfor update</li>\n</ul>\n<p>RRbeginsnapshotselectsnapshotselect</p>\n<p>RC</p>\n<blockquote>\n<p>Undologundolog</p>\n</blockquote>\n<h1 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3.\"></a>3.</h1><p>mysql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `<span class=\"keyword\">user</span>` (</span><br><span class=\"line\">`id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) unsigned <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">`name` <span class=\"type\">varchar</span>(<span class=\"number\">11</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8mb4 <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">`comment` <span class=\"type\">varchar</span>(<span class=\"number\">11</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>, </span><br><span class=\"line\"><span class=\"keyword\">PRIMARY</span> KEY (`id`),  </span><br><span class=\"line\">KEY `index_name` (`name`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"operator\">=</span><span class=\"number\">0</span> <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>utf8mb4 <span class=\"keyword\">COLLATE</span><span class=\"operator\">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">20</span>,<span class=\"number\">333</span>,<span class=\"number\">333</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">25</span>,<span class=\"number\">555</span>,<span class=\"number\">555</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">20</span>,<span class=\"number\">999</span>,<span class=\"number\">999</span>;</span><br></pre></td></tr></table></figure>\n\n<p>RR</p>\n<h2 id=\"3-1-1\"><a href=\"#3-1-1\" class=\"headerlink\" title=\"3.1 1\"></a>3.1 1</h2><p>1.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where name &#x3D; 555 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 31,556,556;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n</tbody></table>\n<p>Bname &#x3D; 555name&#x3D;556:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.INNODB_LOCKS</span><br></pre></td></tr></table></figure>\n\n<p>A555Next-keyB: <img src=\"/images/mysql-lock/mysql-lock-4.jpg\" alt=\"\">B</p>\n<h2 id=\"3-2-2\"><a href=\"#3-2-2\" class=\"headerlink\" title=\"3.2 2\"></a>3.2 2</h2><p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 25 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">Query OK, 1 row affected (0.00 sec)</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>Records: 1 Duplicates: 0 Warnings: 0</p>\n<p>B125-30X:next-key</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-5.webp\" alt=\"\"></p>\n<h2 id=\"3-3-3\"><a href=\"#3-3-3\" class=\"headerlink\" title=\"3.3 3\"></a>3.3 3</h2><p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where comment &#x3D; 555 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 31,3131,3131;</td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\">7</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 10,100,100;</td>\n</tr>\n<tr>\n<td align=\"left\">8</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>1</p>\n<p>next-key</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-6.webp\" alt=\"\"></p>\n<p></p>\n<h1 id=\"4-\"><a href=\"#4-\" class=\"headerlink\" title=\"4.\"></a>4.</h1><h2 id=\"4-1-\"><a href=\"#4-1-\" class=\"headerlink\" title=\"4.1 \"></a>4.1 </h2><p></p>\n<p>:</p>\n<p>:</p>\n<ol>\n<li>:</li>\n<li>(wait-for-graph): :</li>\n</ol>\n<p><img src=\"/images/mysql-lock/mysql-lock-7.webp\" alt=\"\"> InnoDBundo</p>\n<h2 id=\"4-2-\"><a href=\"#4-2-\" class=\"headerlink\" title=\"4.2 \"></a>4.2 </h2><p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">delete from user where name &#x3D; 777;</td>\n<td align=\"left\">delete from user where name &#x3D; 666;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\">insert user select 27,777,777;</td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</td>\n<td align=\"left\">Query OK, 1 row affected (14.32 sec) Records: 1 Duplicates: 0 Warnings: 0</td>\n</tr>\n</tbody></table>\n<p>AB ?</p>\n<p>2:Aname &#x3D; 777777next-Key555-999B555-999</p>\n<p>3:AInsert555-999ABBAA-&gt;B,B-&gt;A</p>\n<p>4:AB</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-8.jpg\" alt=\"\"></p>\n<h2 id=\"4-3-BUG\"><a href=\"#4-3-BUG\" class=\"headerlink\" title=\"4.3 BUG\"></a>4.3 BUG</h2><p>:</p>\n<ul>\n<li>:RCRCRC</li>\n<li>:</li>\n<li>:</li>\n<li>:()2</li>\n</ul>\n<p>Bug</p>\n<h2 id=\"4-4-\"><a href=\"#4-4-\" class=\"headerlink\" title=\"4.4 \"></a>4.4 </h2><p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li>(4.3)RRRCgap</li>\n<li></li>\n</ul>\n<p></p>\n<p><a href=\"https://learnku.com/articles/39212\">https://learnku.com/articles/39212</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw\">https://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/mysql-lock/mysql-lock.png\" alt=\"image\" title=\"\"></p>\n<h1 id=\"1-\"><a href=\"#1-\" class=\"headerlink\" title=\"1.\"></a>1.</h1><h2 id=\"1-1\"><a href=\"#1-1\" class=\"headerlink\" title=\"1.1\"></a>1.1</h2><p>:javaLock,synchronized</p>\n<h2 id=\"1-2\"><a href=\"#1-2\" class=\"headerlink\" title=\"1.2?\"></a>1.2?</h2><p>DQL(select),DML(insert,update,delete)</p>\n<p>JavaPMspring,springmvc,mybatissqlsqlspring</p>\n<p>,</p>\n<p>mysql-insert-deadlock-deleteSQLMysql</p>\n<h1 id=\"2-InnoDB\"><a href=\"#2-InnoDB\" class=\"headerlink\" title=\"2.InnoDB\"></a>2.InnoDB</h1><h2 id=\"2-1mysql\"><a href=\"#2-1mysql\" class=\"headerlink\" title=\"2.1mysql\"></a>2.1mysql</h2><p>Mysql:</p>\n<p> <img src=\"/images/mysql-lock/mysql-lock-1.webp\" alt=\"\"> </p>\n<p>Mysqlsql </p>\n<p>mysqlMysql:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show engines \\G;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;%storage_engine%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/mysql-lock/mysql-lock-2.webp\" alt=\"\">:InnoDB,MyIsAM,?:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">InnoDB</th>\n<th align=\"left\">MyIsAM</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">MVCC</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">updateInsert</td>\n<td align=\"left\">select</td>\n</tr>\n</tbody></table>\n<p>InnoDBMyIsAMInnoDB</p>\n<h2 id=\"2-2\"><a href=\"#2-2\" class=\"headerlink\" title=\"2.2\"></a>2.2</h2><p></p>\n<h3 id=\"2-2-1-\"><a href=\"#2-2-1-\" class=\"headerlink\" title=\"2.2.1 \"></a>2.2.1 </h3><p> ?</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">update user set namm &#x3D; test where id &#x3D; 1;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\">commit;</td>\n</tr>\n</tbody></table>\n<p>ABA24userid&#x3D;1B3A4B</p>\n<h3 id=\"2-2-2-\"><a href=\"#2-2-2-\" class=\"headerlink\" title=\"2.2.2 \"></a>2.2.2 </h3><p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">update user set namm &#x3D; test where id &#x3D; 1;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">commit;</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">select * from user where id &#x3D; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>BAB</p>\n<h3 id=\"2-2-3-\"><a href=\"#2-2-3-\" class=\"headerlink\" title=\"2.2.3 \"></a>2.2.3 </h3><p>insert</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &gt; 1;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 2;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">commit;</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\">select * from user where id &gt; 1;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\">commit;</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>Aid1id1BId&#x3D;2AB</p>\n<p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">(RUC)</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\">(RC)</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">NO</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\">(RR)</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">NO</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n<td align=\"left\">YES</td>\n</tr>\n</tbody></table>\n<p>InnoDBInnoDB:InnoDB</p>\n<h2 id=\"2-3-InnoDB\"><a href=\"#2-3-InnoDB\" class=\"headerlink\" title=\"2.3 InnoDB\"></a>2.3 InnoDB</h2><p>Mysql:</p>\n<h3 id=\"2-3-1-S-or-X\"><a href=\"#2-3-1-S-or-X\" class=\"headerlink\" title=\"2.3.1 S or X\"></a>2.3.1 S or X</h3><p>InnoDb:</p>\n<ul>\n<li>S-</li>\n<li>X-: </li>\n</ul>\n<blockquote>\n<p>:AB</p>\n</blockquote>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">.</th>\n<th align=\"left\">X</th>\n<th align=\"left\">S</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">X</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"2-3-2-\"><a href=\"#2-3-2-\" class=\"headerlink\" title=\"2.3.2 \"></a>2.3.2 </h3><p>InnoDB,:</p>\n<ul>\n<li>:</li>\n<li>:</li>\n</ul>\n<p> </p>\n<p>InnoDBInnboDB</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">.</th>\n<th align=\"left\">IX</th>\n<th align=\"left\">IS</th>\n<th align=\"left\">X</th>\n<th align=\"left\">S</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">IX</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">IS</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">X</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"2-3-3-\"><a href=\"#2-3-3-\" class=\"headerlink\" title=\"2.3.3 \"></a>2.3.3 </h3><p>:</p>\n<ul>\n<li>sql</li>\n<li>Insertselect</li>\n<li></li>\n</ul>\n<p>MySQL5.1.2MySQL5.7,:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;innodb_autoinc_lock_mode&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Variable_name            <span class=\"operator\">|</span> <span class=\"keyword\">Value</span> <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> innodb_autoinc_lock_mode <span class=\"operator\">|</span> <span class=\"number\">2</span>     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------------------+-------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.01</span> sec)</span><br></pre></td></tr></table></figure>\n\n<p>MySQLinnodbautoinclock_mode3012, , </p>\n<ol>\n<li>:</li>\n<li>:</li>\n<li>:</li>\n</ol>\n<h2 id=\"2-4InnoDB\"><a href=\"#2-4InnoDB\" class=\"headerlink\" title=\"2.4InnoDB\"></a>2.4InnoDB</h2><p>InnoDB</p>\n<h3 id=\"2-4-1--Record-Lock\"><a href=\"#2-4-1--Record-Lock\" class=\"headerlink\" title=\"2.4.1 (Record-Lock)\"></a>2.4.1 (Record-Lock)</h3><p></p>\n<ul>\n<li>.</li>\n<li>()</li>\n<li></li>\n</ul>\n<h3 id=\"2-4-2-\"><a href=\"#2-4-2-\" class=\"headerlink\" title=\"2.4.2 \"></a>2.4.2 </h3><p>gapgap</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-3.webp\" alt=\"\"></p>\n<h3 id=\"2-4-3-next-key\"><a href=\"#2-4-3-next-key\" class=\"headerlink\" title=\"2.4.3 next-key\"></a>2.4.3 next-key</h3><p>gapRR(InnoDB)Innodb? </p>\n<blockquote>\n<p>MysqlRR</p>\n</blockquote>\n<h3 id=\"2-4-4-\"><a href=\"#2-4-4-\" class=\"headerlink\" title=\"2.4.4 \"></a>2.4.4 </h3><p>Mysql:</p>\n<blockquote>\n<p>An insert intention lock is a type of gap lock set by INSERT operations prior to row insertion. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.</p>\n</blockquote>\n<p>,47564-7</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"2-5-MVCC\"><a href=\"#2-5-MVCC\" class=\"headerlink\" title=\"2.5 MVCC\"></a>2.5 MVCC</h2><p>MVCCInnoDB</p>\n<p>MVCC:</p>\n<ul>\n<li>:selectMVCCMVCCundo</li>\n<li>:,update,insert,delete,selectfor update</li>\n</ul>\n<p>RRbeginsnapshotselectsnapshotselect</p>\n<p>RC</p>\n<blockquote>\n<p>Undologundolog</p>\n</blockquote>\n<h1 id=\"3-\"><a href=\"#3-\" class=\"headerlink\" title=\"3.\"></a>3.</h1><p>mysql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `<span class=\"keyword\">user</span>` (</span><br><span class=\"line\">`id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) unsigned <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">`name` <span class=\"type\">varchar</span>(<span class=\"number\">11</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8mb4 <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">`comment` <span class=\"type\">varchar</span>(<span class=\"number\">11</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>, </span><br><span class=\"line\"><span class=\"keyword\">PRIMARY</span> KEY (`id`),  </span><br><span class=\"line\">KEY `index_name` (`name`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"operator\">=</span><span class=\"number\">0</span> <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>utf8mb4 <span class=\"keyword\">COLLATE</span><span class=\"operator\">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">20</span>,<span class=\"number\">333</span>,<span class=\"number\">333</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">25</span>,<span class=\"number\">555</span>,<span class=\"number\">555</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">user</span> <span class=\"keyword\">select</span> <span class=\"number\">20</span>,<span class=\"number\">999</span>,<span class=\"number\">999</span>;</span><br></pre></td></tr></table></figure>\n\n<p>RR</p>\n<h2 id=\"3-1-1\"><a href=\"#3-1-1\" class=\"headerlink\" title=\"3.1 1\"></a>3.1 1</h2><p>1.</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where name &#x3D; 555 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 31,556,556;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n</tbody></table>\n<p>Bname &#x3D; 555name&#x3D;556:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.INNODB_LOCKS</span><br></pre></td></tr></table></figure>\n\n<p>A555Next-keyB: <img src=\"/images/mysql-lock/mysql-lock-4.jpg\" alt=\"\">B</p>\n<h2 id=\"3-2-2\"><a href=\"#3-2-2\" class=\"headerlink\" title=\"3.2 2\"></a>3.2 2</h2><p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where id &#x3D; 25 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">Query OK, 1 row affected (0.00 sec)</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>Records: 1 Duplicates: 0 Warnings: 0</p>\n<p>B125-30X:next-key</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-5.webp\" alt=\"\"></p>\n<h2 id=\"3-3-3\"><a href=\"#3-3-3\" class=\"headerlink\" title=\"3.3 3\"></a>3.3 3</h2><p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">select * from user where comment &#x3D; 555 for update;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\">5</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 31,3131,3131;</td>\n</tr>\n<tr>\n<td align=\"left\">6</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\">7</td>\n<td align=\"left\"></td>\n<td align=\"left\">insert user select 10,100,100;</td>\n</tr>\n<tr>\n<td align=\"left\">8</td>\n<td align=\"left\"></td>\n<td align=\"left\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>1</p>\n<p>next-key</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-6.webp\" alt=\"\"></p>\n<p></p>\n<h1 id=\"4-\"><a href=\"#4-\" class=\"headerlink\" title=\"4.\"></a>4.</h1><h2 id=\"4-1-\"><a href=\"#4-1-\" class=\"headerlink\" title=\"4.1 \"></a>4.1 </h2><p></p>\n<p>:</p>\n<p>:</p>\n<ol>\n<li>:</li>\n<li>(wait-for-graph): :</li>\n</ol>\n<p><img src=\"/images/mysql-lock/mysql-lock-7.webp\" alt=\"\"> InnoDBundo</p>\n<h2 id=\"4-2-\"><a href=\"#4-2-\" class=\"headerlink\" title=\"4.2 \"></a>4.2 </h2><p>:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\">A</th>\n<th align=\"left\">B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">1</td>\n<td align=\"left\">begin;</td>\n<td align=\"left\">begin;</td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">delete from user where name &#x3D; 777;</td>\n<td align=\"left\">delete from user where name &#x3D; 666;</td>\n</tr>\n<tr>\n<td align=\"left\">3</td>\n<td align=\"left\">insert user select 27,777,777;</td>\n<td align=\"left\">insert user select 26,666,666;</td>\n</tr>\n<tr>\n<td align=\"left\">4</td>\n<td align=\"left\">ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</td>\n<td align=\"left\">Query OK, 1 row affected (14.32 sec) Records: 1 Duplicates: 0 Warnings: 0</td>\n</tr>\n</tbody></table>\n<p>AB ?</p>\n<p>2:Aname &#x3D; 777777next-Key555-999B555-999</p>\n<p>3:AInsert555-999ABBAA-&gt;B,B-&gt;A</p>\n<p>4:AB</p>\n<p><img src=\"/images/mysql-lock/mysql-lock-8.jpg\" alt=\"\"></p>\n<h2 id=\"4-3-BUG\"><a href=\"#4-3-BUG\" class=\"headerlink\" title=\"4.3 BUG\"></a>4.3 BUG</h2><p>:</p>\n<ul>\n<li>:RCRCRC</li>\n<li>:</li>\n<li>:</li>\n<li>:()2</li>\n</ul>\n<p>Bug</p>\n<h2 id=\"4-4-\"><a href=\"#4-4-\" class=\"headerlink\" title=\"4.4 \"></a>4.4 </h2><p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li>(4.3)RRRCgap</li>\n<li></li>\n</ul>\n<p></p>\n<p><a href=\"https://learnku.com/articles/39212\">https://learnku.com/articles/39212</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw\">https://mp.weixin.qq.com/s/yzXbbutzVJ1hIZgVszIBgw</a></p>\n"},{"title":"mysql ","date":"2021-05-13T03:54:26.000Z","_content":"\nEnjoyMoving\n[](https://zhuanlan.zhihu.com/p/29118331)\n\n\n\n\n![image](/images/mysql-index/mysql-index-1.jpg)\n\n# \n\n## \n- \n- \n- IOIO\n- InnoDBMySQL5.1InnoDBMySQLInnoDB InnoDBInnoDBInnoDBMySQLInnoDBWHEREMySQL\n- InnoDBInnoDB\n## \n- INSERTUPDATEDELETEMySQL\n- \n- \n- \nMySQL\n\nMySQL16\n\n# \n## B-Tree\nInnoDBB+Tree\nB+Tree\nB-Tree\nB-Tree<<==>>=BETWEENINLIKE\n### \nB-Tree(leftmost prefix of the index)\n![image](/images/mysql-index/mysql-index-2.jpg)\n\n```sql\nCREATE TABLE People (\n  last_name varchar(50) not null,\n  first_name varchar(50) not null,\n  dob date not null,\n  gender enum('m', 'f') not null,\n  key(last_name, first_name, dob)\n);\n```\n\nlast_namefirst_namedob\n![image](/images/mysql-index/mysql-index-3.jpg)\n(leftmost prefix of the index)\n\n1. \n2. last nameSmith\n3. WHERE last_name=\"Smith\" AND first_name LIKE 'J%' AND dob='1976-12-23'LIKE\n\n1. (Match the full value)1960-01-01Cuba Allen\n2. (Match a leftmost prefix)last nameAllen1\n3. (Match a column prefix)last nameJ1\n4. (Match a range of values)last nameAllenBarrymore1\n5. (Match one part exactly and match a range on another part)last nameAllenfirst nameK\n6. (Index-only queries)I/O()\n\n### \nB-TreeORDER BYORDER BY(leftmost prefix of the index)\n\nMySQL\n\n- filesort\n- \n\nexplaintypeindexMYSQL\n\n#### \n\n\n- ORDER BY\n- ORDER BYORDER BYWHEREJOIN\n\n![image](/images/mysql-index/mysql-index-4.png)\n\n- ORDER BYfilesort\n\n#### filesort\nMySQL()(sort buffer)\n\n\n\nfilesortMySQL\n\n   - ##### (Two passes)\n      sort_buffer_sizeColumns\n      MySQL4.1I/O\n   \n   - ##### (single pass)\n      Columns\n      MySQL4.1I/OColumns\n       MySQL 4.1  max_length_for_sort_data  MySQL  max_length_for_sort_data MySQL \n      ORDER BYMySQLfilesortEXPLAINUsing filesortMySQLfilesortEXPLAINUsing temporary;Using filesort\n       Query  Columns \n\n\n## (cluster index)\n\n\nsolidDBInnoDBMyISAMDBMSMySQL\n\n### InnoDB\n1. InnoDB\n2. InnoDB\n3. InnoDB\n\nInnoDBInnoDB(surrogate key)AUTO_INCREMENTprimary key\n\nDBMS\n\n- primary\n- second\n\n### \n\n\n\n\n\n![image](/images/mysql-index/mysql-index-5.jpg)\n\n\n\n1. \n2. B-Tree\n\nInnoDBInnoDB\n\n**InnoDBMyISAM**\n```sql\nCREATE TABLE layout_test (\n  col1 int NOT NULL,\n  col2 int NOT NULL,\n  PRIMARY KEY(col1),\n  KEY(col2)\n);\n```\n\n- **MyISAM**\n\nMyISAM\n\n(row number)0MyISAM\n\n![image](/images/mysql-index/mysql-index-6.png)\n\nMyISAM\n\ncol1\n\nMyISAM(row number)col1\n\n![image](/images/mysql-index/mysql-index-7.jpg)\n\ncol2\n\nMyISAMprimary keyPrimary keyPRIMARYcol2\n\n![image](/images/mysql-index/mysql-index-8.jpg)\n\n- **InnoDB**\n\ncol1\n\nIDMVCC(col2)\n\n![image](/images/mysql-index/mysql-index-9.jpg)\n\ncol2\n\nInnoDB(row pointers)InnoDB\n\n![image](/images/mysql-index/mysql-index-10.jpg)\n\n- **+   **\n\n![image](/images/mysql-index/mysql-index-11.jpg)\n\n## Hash\n\n\n\n\n\nMySQLMemoryhashMemoryMemoryB-Tree\n\nMemoryhashhash codehash\n\n\n\n```sql\nCREATE TABLE testhash (\n  fname VARCHAR(50) NOT NULL,\n  lname VARCHAR(50) NOT NULL,\n  KEY USING HASH(fname)\n) ENGINE=MEMORY;\n```\n\n\n\n![image](/images/mysql-index/mysql-index-12.jpg)\n\nhashf( )\n\n```\nf('Arjen') = 2323\nf('Baron') = 7437\nf('Peter') = 8784\nf('Vadim') = 2458\n```\n\n\n\n![image](/images/mysql-index/mysql-index-13.png)\n\n+\n\n SELECT lname FROM testhash WHERE fname='Peter'; MySQLPeterhashf('Peter') = 8784MySQL87843\n\n### Hash\n\n- hash codeMySQL\n- hash\n- Hashhash\n- Hash=IN( )<=>WHERE price>100\n- Hash\n- \n\nInnoDBMysqlDBAinnodb_adaptive_hash_index\n\nInnoDBB+ TreeB-Tree\n\n- = <=>in \n- \n\nInnoDB25\n\n## (R-Tree)\n\nMyISAMGEOMETRY\n\n## (Full-text)\nMyISAM\n\nMySQL InnoDB5.6InnoDB[12.9.5 Full-Text Restrictions](https://dev.mysql.com/doc/refman/5.7/en/fulltext-restrictions.html)\n\n\n# MySQL\n\n- \n- \n\n\n\n## \n\nKEYINDEX(WHERE column = )(ORDER BY column)\n\n\n\n### \n\nCREATE INDEX indexName ON mytable(username(length));\n\nCHARVARCHARlengthBLOBTEXT length\n\n### \n\nALTER mytable ADD INDEX [indexName] ON (username(length))\n\n### \n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, INDEX [indexName] (username(length)) );\n\n### \n\nDROP INDEX [indexName] ON mytable;\n\n## \n\n\n\n\n\n### \n\nCREATE UNIQUE INDEX indexName ON mytable(username(length))\n\n### \n\nALTER mytable ADD UNIQUE [indexName] ON (username(length))\n\n### \n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, UNIQUE [indexName] (username(length)) );\n\n## \n\n\n\n\n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, PRIMARY KEY(ID) );  ALTER \n\n\n\nMySQL\n\n## \n\n\n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, city VARCHAR(50) NOT NULL, age INT NOT NULL );\n\nMySQL name, city, age\n\nALTER TABLE mytable ADD INDEX name_city_age (name(10),city,age);\n\nusernname 16 1010INSERT\n\n\n\nusernname,city,age\n\nusernname,city\n\nusernname\n\n cityageMySQLSQL\n\nSELECT * FROM mytable WHREE username=\"admin\" AND city=\"\"\n\nSELECT * FROM mytable WHREE username=\"admin\"\n\n\n\nSELECT * FROM mytable WHREE age=20 AND city=\"\"\n\nSELECT * FROM mytable WHREE city=\"\"\n\n usernnamecityage3MySQL\n\n# \n\nWHEREJOINMySQLB-Tree<<==>>=BETWEENINLIKE\n\n\n\nSELECT t.Name FROM mytable t LEFT JOIN mytable m ON t.Name=m.username WHERE m.age=20 AND m.city=''\n\ncityagemytableuserameJOIN\n\n# \n\nB-Tree\n\n## \n\n- ### \n\n\n\n- ### NULL\n\nMySQL\n\nNULLNULLNULL\n\nNULLNOT NULLNULL0\n\n- ### \n\n\n\nBLOBTEXTVARCHARMYSQL\n\nMySQLorder bygroup by\n\n\n\nCHAR(255)1020\n\nI/O10~15\n\n\n\nMYSQL1\n\n\n\n\n\nselect count(*) as cnt,city from sakila.city_demo group by city order by cnt desc limit 10;\n\nselect count(*) as cnt,left(city,7) as perf from sakila.city_demo group by city order by cnt desc limit 10;\n\n\n\n\n\nselect count(distinct city)/count(*) from sakila.city_demo;\n\nselect count(distinct left(city,7))/count(*) from sakila.city_demo;\n\n- ### \n\n\n\n M F\n\n- ### \n\nMySQLexplainMySQL\n\n- ### /\n\nMySQL\n\n/\n\n## \n\n-  like %%\n- like\n\nLIKE%_MySQLlikeInnoDB\n\n\n\nSELECT * FROM mytable WHERE username like'admin%'\n\n\n\nSELECT * FROM mytable WHEREt Name like'%admin'\n\n- \n\n\n\n\n\n1.  select actor_id from sakila.actor where actor_id+1=5;\n2. select ... where TO_DAYS(CURRENT_DATE) - TO_DAYS(date_col)<=10;\n\n- NOT IN<>!= \n\n where !=<>\n\nnot innot exists+ exists  in  select num from a where num in(select num from b)  select num from a where exists(select 1 from b where num=a.num)\n\n<>a<>0  a>0 or a<0\n\n- or\n\n or   or   \n\n where  or  num1num2select id from t where num1=10 or num2=20 select id from t where num1=10 union all select id from t where num2=20num2num1\n\n- '\n\n\n\n\n\n```sql\nCREATE TABLE People (\n  last_name varchar(50) not null,\n  first_name varchar(50) not null,\n  birthday date not null,\n  gender enum('m', 'f') not null,\n  key(last_name, first_name, birthday)\n);\n```\n\n1. \n2. last nameSmith\n3. WHERE last_name=\"Smith\" AND first_name LIKE 'J%' AND dob='1976-12-23'LIKE\n\n- ORDER BY\n\n1. ORDER BY\n2. ORDER BYORDER BYWHEREJOIN\n3. ORDER BYfilesort\n\n![image](/images/mysql-index/mysql-index-14.png)\n\n-  where MySQL MySQL  \n\n![image](/images/mysql-index/mysql-index-15.jpg)\n\n![image](/images/mysql-index/mysql-index-16.jpg)\n\n-  select * from t *\n-  MySQL ,sexmalefemalesex\n\n# \n\n1000 MySQL\n\nEXPLAIN SELECTSELECTEXPLAINMySQLSELECTMySQL()\n\n## \n\n- Handler_read_key \n- Handler_read_rnd_next  Handler_read_rnd_next \n\n\n\n![image](/images/mysql-index/mysql-index-17.png)\n\n MySQL \n\n","source":"_posts/database/mysql/mysql-index.md","raw":"---\ntitle: mysql \ndate: 2021-05-13 11:54:26\ncategories:\n  - database\n  - mysql\ntags:\n  - mysql\n---\n\nEnjoyMoving\n[](https://zhuanlan.zhihu.com/p/29118331)\n\n\n\n\n![image](/images/mysql-index/mysql-index-1.jpg)\n\n# \n\n## \n- \n- \n- IOIO\n- InnoDBMySQL5.1InnoDBMySQLInnoDB InnoDBInnoDBInnoDBMySQLInnoDBWHEREMySQL\n- InnoDBInnoDB\n## \n- INSERTUPDATEDELETEMySQL\n- \n- \n- \nMySQL\n\nMySQL16\n\n# \n## B-Tree\nInnoDBB+Tree\nB+Tree\nB-Tree\nB-Tree<<==>>=BETWEENINLIKE\n### \nB-Tree(leftmost prefix of the index)\n![image](/images/mysql-index/mysql-index-2.jpg)\n\n```sql\nCREATE TABLE People (\n  last_name varchar(50) not null,\n  first_name varchar(50) not null,\n  dob date not null,\n  gender enum('m', 'f') not null,\n  key(last_name, first_name, dob)\n);\n```\n\nlast_namefirst_namedob\n![image](/images/mysql-index/mysql-index-3.jpg)\n(leftmost prefix of the index)\n\n1. \n2. last nameSmith\n3. WHERE last_name=\"Smith\" AND first_name LIKE 'J%' AND dob='1976-12-23'LIKE\n\n1. (Match the full value)1960-01-01Cuba Allen\n2. (Match a leftmost prefix)last nameAllen1\n3. (Match a column prefix)last nameJ1\n4. (Match a range of values)last nameAllenBarrymore1\n5. (Match one part exactly and match a range on another part)last nameAllenfirst nameK\n6. (Index-only queries)I/O()\n\n### \nB-TreeORDER BYORDER BY(leftmost prefix of the index)\n\nMySQL\n\n- filesort\n- \n\nexplaintypeindexMYSQL\n\n#### \n\n\n- ORDER BY\n- ORDER BYORDER BYWHEREJOIN\n\n![image](/images/mysql-index/mysql-index-4.png)\n\n- ORDER BYfilesort\n\n#### filesort\nMySQL()(sort buffer)\n\n\n\nfilesortMySQL\n\n   - ##### (Two passes)\n      sort_buffer_sizeColumns\n      MySQL4.1I/O\n   \n   - ##### (single pass)\n      Columns\n      MySQL4.1I/OColumns\n       MySQL 4.1  max_length_for_sort_data  MySQL  max_length_for_sort_data MySQL \n      ORDER BYMySQLfilesortEXPLAINUsing filesortMySQLfilesortEXPLAINUsing temporary;Using filesort\n       Query  Columns \n\n\n## (cluster index)\n\n\nsolidDBInnoDBMyISAMDBMSMySQL\n\n### InnoDB\n1. InnoDB\n2. InnoDB\n3. InnoDB\n\nInnoDBInnoDB(surrogate key)AUTO_INCREMENTprimary key\n\nDBMS\n\n- primary\n- second\n\n### \n\n\n\n\n\n![image](/images/mysql-index/mysql-index-5.jpg)\n\n\n\n1. \n2. B-Tree\n\nInnoDBInnoDB\n\n**InnoDBMyISAM**\n```sql\nCREATE TABLE layout_test (\n  col1 int NOT NULL,\n  col2 int NOT NULL,\n  PRIMARY KEY(col1),\n  KEY(col2)\n);\n```\n\n- **MyISAM**\n\nMyISAM\n\n(row number)0MyISAM\n\n![image](/images/mysql-index/mysql-index-6.png)\n\nMyISAM\n\ncol1\n\nMyISAM(row number)col1\n\n![image](/images/mysql-index/mysql-index-7.jpg)\n\ncol2\n\nMyISAMprimary keyPrimary keyPRIMARYcol2\n\n![image](/images/mysql-index/mysql-index-8.jpg)\n\n- **InnoDB**\n\ncol1\n\nIDMVCC(col2)\n\n![image](/images/mysql-index/mysql-index-9.jpg)\n\ncol2\n\nInnoDB(row pointers)InnoDB\n\n![image](/images/mysql-index/mysql-index-10.jpg)\n\n- **+   **\n\n![image](/images/mysql-index/mysql-index-11.jpg)\n\n## Hash\n\n\n\n\n\nMySQLMemoryhashMemoryMemoryB-Tree\n\nMemoryhashhash codehash\n\n\n\n```sql\nCREATE TABLE testhash (\n  fname VARCHAR(50) NOT NULL,\n  lname VARCHAR(50) NOT NULL,\n  KEY USING HASH(fname)\n) ENGINE=MEMORY;\n```\n\n\n\n![image](/images/mysql-index/mysql-index-12.jpg)\n\nhashf( )\n\n```\nf('Arjen') = 2323\nf('Baron') = 7437\nf('Peter') = 8784\nf('Vadim') = 2458\n```\n\n\n\n![image](/images/mysql-index/mysql-index-13.png)\n\n+\n\n SELECT lname FROM testhash WHERE fname='Peter'; MySQLPeterhashf('Peter') = 8784MySQL87843\n\n### Hash\n\n- hash codeMySQL\n- hash\n- Hashhash\n- Hash=IN( )<=>WHERE price>100\n- Hash\n- \n\nInnoDBMysqlDBAinnodb_adaptive_hash_index\n\nInnoDBB+ TreeB-Tree\n\n- = <=>in \n- \n\nInnoDB25\n\n## (R-Tree)\n\nMyISAMGEOMETRY\n\n## (Full-text)\nMyISAM\n\nMySQL InnoDB5.6InnoDB[12.9.5 Full-Text Restrictions](https://dev.mysql.com/doc/refman/5.7/en/fulltext-restrictions.html)\n\n\n# MySQL\n\n- \n- \n\n\n\n## \n\nKEYINDEX(WHERE column = )(ORDER BY column)\n\n\n\n### \n\nCREATE INDEX indexName ON mytable(username(length));\n\nCHARVARCHARlengthBLOBTEXT length\n\n### \n\nALTER mytable ADD INDEX [indexName] ON (username(length))\n\n### \n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, INDEX [indexName] (username(length)) );\n\n### \n\nDROP INDEX [indexName] ON mytable;\n\n## \n\n\n\n\n\n### \n\nCREATE UNIQUE INDEX indexName ON mytable(username(length))\n\n### \n\nALTER mytable ADD UNIQUE [indexName] ON (username(length))\n\n### \n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, UNIQUE [indexName] (username(length)) );\n\n## \n\n\n\n\n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, PRIMARY KEY(ID) );  ALTER \n\n\n\nMySQL\n\n## \n\n\n\nCREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, city VARCHAR(50) NOT NULL, age INT NOT NULL );\n\nMySQL name, city, age\n\nALTER TABLE mytable ADD INDEX name_city_age (name(10),city,age);\n\nusernname 16 1010INSERT\n\n\n\nusernname,city,age\n\nusernname,city\n\nusernname\n\n cityageMySQLSQL\n\nSELECT * FROM mytable WHREE username=\"admin\" AND city=\"\"\n\nSELECT * FROM mytable WHREE username=\"admin\"\n\n\n\nSELECT * FROM mytable WHREE age=20 AND city=\"\"\n\nSELECT * FROM mytable WHREE city=\"\"\n\n usernnamecityage3MySQL\n\n# \n\nWHEREJOINMySQLB-Tree<<==>>=BETWEENINLIKE\n\n\n\nSELECT t.Name FROM mytable t LEFT JOIN mytable m ON t.Name=m.username WHERE m.age=20 AND m.city=''\n\ncityagemytableuserameJOIN\n\n# \n\nB-Tree\n\n## \n\n- ### \n\n\n\n- ### NULL\n\nMySQL\n\nNULLNULLNULL\n\nNULLNOT NULLNULL0\n\n- ### \n\n\n\nBLOBTEXTVARCHARMYSQL\n\nMySQLorder bygroup by\n\n\n\nCHAR(255)1020\n\nI/O10~15\n\n\n\nMYSQL1\n\n\n\n\n\nselect count(*) as cnt,city from sakila.city_demo group by city order by cnt desc limit 10;\n\nselect count(*) as cnt,left(city,7) as perf from sakila.city_demo group by city order by cnt desc limit 10;\n\n\n\n\n\nselect count(distinct city)/count(*) from sakila.city_demo;\n\nselect count(distinct left(city,7))/count(*) from sakila.city_demo;\n\n- ### \n\n\n\n M F\n\n- ### \n\nMySQLexplainMySQL\n\n- ### /\n\nMySQL\n\n/\n\n## \n\n-  like %%\n- like\n\nLIKE%_MySQLlikeInnoDB\n\n\n\nSELECT * FROM mytable WHERE username like'admin%'\n\n\n\nSELECT * FROM mytable WHEREt Name like'%admin'\n\n- \n\n\n\n\n\n1.  select actor_id from sakila.actor where actor_id+1=5;\n2. select ... where TO_DAYS(CURRENT_DATE) - TO_DAYS(date_col)<=10;\n\n- NOT IN<>!= \n\n where !=<>\n\nnot innot exists+ exists  in  select num from a where num in(select num from b)  select num from a where exists(select 1 from b where num=a.num)\n\n<>a<>0  a>0 or a<0\n\n- or\n\n or   or   \n\n where  or  num1num2select id from t where num1=10 or num2=20 select id from t where num1=10 union all select id from t where num2=20num2num1\n\n- '\n\n\n\n\n\n```sql\nCREATE TABLE People (\n  last_name varchar(50) not null,\n  first_name varchar(50) not null,\n  birthday date not null,\n  gender enum('m', 'f') not null,\n  key(last_name, first_name, birthday)\n);\n```\n\n1. \n2. last nameSmith\n3. WHERE last_name=\"Smith\" AND first_name LIKE 'J%' AND dob='1976-12-23'LIKE\n\n- ORDER BY\n\n1. ORDER BY\n2. ORDER BYORDER BYWHEREJOIN\n3. ORDER BYfilesort\n\n![image](/images/mysql-index/mysql-index-14.png)\n\n-  where MySQL MySQL  \n\n![image](/images/mysql-index/mysql-index-15.jpg)\n\n![image](/images/mysql-index/mysql-index-16.jpg)\n\n-  select * from t *\n-  MySQL ,sexmalefemalesex\n\n# \n\n1000 MySQL\n\nEXPLAIN SELECTSELECTEXPLAINMySQLSELECTMySQL()\n\n## \n\n- Handler_read_key \n- Handler_read_rnd_next  Handler_read_rnd_next \n\n\n\n![image](/images/mysql-index/mysql-index-17.png)\n\n MySQL \n\n","slug":"database/mysql/mysql-index","published":1,"updated":"2022-05-10T08:25:56.382Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p5001hxklo1j5q486s","content":"<p>EnjoyMoving<br><a href=\"https://zhuanlan.zhihu.com/p/29118331\"></a><br></p>\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-1.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>IOIO</li>\n<li>InnoDBMySQL5.1InnoDBMySQLInnoDB InnoDBInnoDBInnoDBMySQLInnoDBWHEREMySQL</li>\n<li>InnoDBInnoDB<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2></li>\n<li>INSERTUPDATEDELETEMySQL</li>\n<li></li>\n<li></li>\n<li><br>MySQL<br><br>MySQL16</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"B-Tree\"><a href=\"#B-Tree\" class=\"headerlink\" title=\"B-Tree\"></a>B-Tree</h2><p>InnoDBB+Tree<br>B+Tree<br>B-Tree<br>B-Tree&lt;&lt;&#x3D;&#x3D;&gt;&gt;&#x3D;BETWEENINLIKE</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B-Tree(leftmost prefix of the index)<br><img src=\"/images/mysql-index/mysql-index-2.jpg\" alt=\"image\"><br></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> People (</span><br><span class=\"line\">  last_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  first_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  dob <span class=\"type\">date</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  gender enum(<span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  key(last_name, first_name, dob)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>last_namefirst_namedob<br><img src=\"/images/mysql-index/mysql-index-3.jpg\" alt=\"image\"><br>(leftmost prefix of the index)</p>\n<ol>\n<li><p></p>\n</li>\n<li><p>last nameSmith</p>\n</li>\n<li><p>WHERE last_name&#x3D;Smith AND first_name LIKE J% AND dob&#x3D;1976-12-23LIKE</p>\n</li>\n<li><p>(Match the full value)1960-01-01Cuba Allen</p>\n</li>\n<li><p>(Match a leftmost prefix)last nameAllen1</p>\n</li>\n<li><p>(Match a column prefix)last nameJ1</p>\n</li>\n<li><p>(Match a range of values)last nameAllenBarrymore1</p>\n</li>\n<li><p>(Match one part exactly and match a range on another part)last nameAllenfirst nameK</p>\n</li>\n<li><p>(Index-only queries)I&#x2F;O()</p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B-TreeORDER BYORDER BY(leftmost prefix of the index)</p>\n<p>MySQL</p>\n<ul>\n<li>filesort</li>\n<li></li>\n</ul>\n<p>explaintypeindexMYSQL</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ul>\n<li>ORDER BY</li>\n<li>ORDER BYORDER BYWHEREJOIN</li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-4.png\" alt=\"image\"></p>\n<ul>\n<li>ORDER BYfilesort</li>\n</ul>\n<h4 id=\"filesort\"><a href=\"#filesort\" class=\"headerlink\" title=\"filesort\"></a>filesort</h4><p>MySQL()(sort buffer)</p>\n<p></p>\n<p>filesortMySQL</p>\n<ul>\n<li><h5 id=\"-Two-passes\"><a href=\"#-Two-passes\" class=\"headerlink\" title=\"(Two passes)\"></a>(Two passes)</h5><p> sort_buffer_sizeColumns<br> MySQL4.1I&#x2F;O</p>\n</li>\n<li><h5 id=\"-single-pass\"><a href=\"#-single-pass\" class=\"headerlink\" title=\"(single pass)\"></a>(single pass)</h5><p> Columns<br> MySQL4.1I&#x2F;OColumns<br>  MySQL 4.1  max_length_for_sort_data  MySQL  max_length_for_sort_data MySQL <br> ORDER BYMySQLfilesortEXPLAINUsing filesortMySQLfilesortEXPLAINUsing temporary;Using filesort<br>  Query  Columns </p>\n</li>\n</ul>\n<h2 id=\"-cluster-index\"><a href=\"#-cluster-index\" class=\"headerlink\" title=\"(cluster index)\"></a>(cluster index)</h2><p></p>\n<p>solidDBInnoDBMyISAMDBMSMySQL</p>\n<h3 id=\"InnoDB\"><a href=\"#InnoDB\" class=\"headerlink\" title=\"InnoDB\"></a>InnoDB</h3><ol>\n<li>InnoDB</li>\n<li>InnoDB</li>\n<li>InnoDB</li>\n</ol>\n<p>InnoDBInnoDB(surrogate key)AUTO_INCREMENTprimary key</p>\n<p>DBMS</p>\n<ul>\n<li>primary</li>\n<li>second</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><br></p>\n<p><img src=\"/images/mysql-index/mysql-index-5.jpg\" alt=\"image\"></p>\n<p><br></p>\n<ol>\n<li></li>\n<li>B-Tree</li>\n</ol>\n<p>InnoDBInnoDB</p>\n<p><strong>InnoDBMyISAM</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> layout_test (</span><br><span class=\"line\">  col1 <span class=\"type\">int</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  col2 <span class=\"type\">int</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY(col1),</span><br><span class=\"line\">  KEY(col2)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>MyISAM</strong></li>\n</ul>\n<p>MyISAM</p>\n<p>(row number)0MyISAM</p>\n<p><img src=\"/images/mysql-index/mysql-index-6.png\" alt=\"image\"></p>\n<p>MyISAM</p>\n<p>col1</p>\n<p>MyISAM(row number)col1</p>\n<p><img src=\"/images/mysql-index/mysql-index-7.jpg\" alt=\"image\"></p>\n<p>col2</p>\n<p>MyISAMprimary keyPrimary keyPRIMARYcol2</p>\n<p><img src=\"/images/mysql-index/mysql-index-8.jpg\" alt=\"image\"></p>\n<ul>\n<li><strong>InnoDB</strong></li>\n</ul>\n<p>col1</p>\n<p>IDMVCC(col2)</p>\n<p><img src=\"/images/mysql-index/mysql-index-9.jpg\" alt=\"image\"></p>\n<p>col2</p>\n<p>InnoDB(row pointers)InnoDB</p>\n<p><img src=\"/images/mysql-index/mysql-index-10.jpg\" alt=\"image\"></p>\n<ul>\n<li><strong>+   </strong></li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-11.jpg\" alt=\"image\"></p>\n<h2 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h2><p></p>\n<p></p>\n<p>MySQLMemoryhashMemoryMemoryB-Tree</p>\n<p>Memoryhashhash codehash</p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> testhash (</span><br><span class=\"line\">  fname <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  lname <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  KEY <span class=\"keyword\">USING</span> HASH(fname)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>MEMORY;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-12.jpg\" alt=\"image\"></p>\n<p>hashf( )</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f(&#x27;Arjen&#x27;) = 2323</span><br><span class=\"line\">f(&#x27;Baron&#x27;) = 7437</span><br><span class=\"line\">f(&#x27;Peter&#x27;) = 8784</span><br><span class=\"line\">f(&#x27;Vadim&#x27;) = 2458</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-13.png\" alt=\"image\"></p>\n<p>+</p>\n<p> SELECT lname FROM testhash WHERE fname&#x3D;Peter; MySQLPeterhashf(Peter) &#x3D; 8784MySQL87843</p>\n<h3 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h3><ul>\n<li>hash codeMySQL</li>\n<li>hash</li>\n<li>Hashhash</li>\n<li>Hash&#x3D;IN( )&lt;&#x3D;&gt;WHERE price&gt;100</li>\n<li>Hash</li>\n<li></li>\n</ul>\n<p>InnoDBMysqlDBAinnodb_adaptive_hash_index</p>\n<p>InnoDBB+ TreeB-Tree</p>\n<ul>\n<li>&#x3D; &lt;&#x3D;&gt;in </li>\n<li></li>\n</ul>\n<p>InnoDB25</p>\n<h2 id=\"-R-Tree-\"><a href=\"#-R-Tree-\" class=\"headerlink\" title=\"(R-Tree)\"></a>(R-Tree)</h2><p>MyISAMGEOMETRY</p>\n<h2 id=\"-Full-text-\"><a href=\"#-Full-text-\" class=\"headerlink\" title=\"(Full-text)\"></a>(Full-text)</h2><p>MyISAM</p>\n<p>MySQL InnoDB5.6InnoDB<a href=\"https://dev.mysql.com/doc/refman/5.7/en/fulltext-restrictions.html\">12.9.5 Full-Text Restrictions</a></p>\n<h1 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h1><ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>KEYINDEX(WHERE column &#x3D; )(ORDER BY column)</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE INDEX indexName ON mytable(username(length));</p>\n<p>CHARVARCHARlengthBLOBTEXT length</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ALTER mytable ADD INDEX [indexName] ON (username(length))</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, INDEX [indexName] (username(length)) );</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>DROP INDEX [indexName] ON mytable;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE UNIQUE INDEX indexName ON mytable(username(length))</p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>ALTER mytable ADD UNIQUE [indexName] ON (username(length))</p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, UNIQUE [indexName] (username(length)) );</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, PRIMARY KEY(ID) );  ALTER </p>\n<p></p>\n<p>MySQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, city VARCHAR(50) NOT NULL, age INT NOT NULL );</p>\n<p>MySQL name, city, age</p>\n<p>ALTER TABLE mytable ADD INDEX name_city_age (name(10),city,age);</p>\n<p>usernname 16 1010INSERT</p>\n<p></p>\n<p>usernname,city,age</p>\n<p>usernname,city</p>\n<p>usernname</p>\n<p> cityageMySQLSQL</p>\n<p>SELECT * FROM mytable WHREE username&#x3D;admin AND city&#x3D;</p>\n<p>SELECT * FROM mytable WHREE username&#x3D;admin</p>\n<p></p>\n<p>SELECT * FROM mytable WHREE age&#x3D;20 AND city&#x3D;</p>\n<p>SELECT * FROM mytable WHREE city&#x3D;</p>\n<p> usernnamecityage3MySQL</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>WHEREJOINMySQLB-Tree&lt;&lt;&#x3D;&#x3D;&gt;&gt;&#x3D;BETWEENINLIKE</p>\n<p></p>\n<p>SELECT t.Name FROM mytable t LEFT JOIN mytable m ON t.Name&#x3D;m.username WHERE m.age&#x3D;20 AND m.city&#x3D;</p>\n<p>cityagemytableuserameJOIN</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>B-Tree</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<ul>\n<li><h3 id=\"NULL\"><a href=\"#NULL\" class=\"headerlink\" title=\"NULL\"></a>NULL</h3></li>\n</ul>\n<p>MySQL</p>\n<p>NULLNULLNULL</p>\n<p>NULLNOT NULLNULL0</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<p>BLOBTEXTVARCHARMYSQL</p>\n<p>MySQLorder bygroup by</p>\n<p></p>\n<p>CHAR(255)1020</p>\n<p>I&#x2F;O10~15</p>\n<p></p>\n<p>MYSQL1</p>\n<p></p>\n<p></p>\n<p>select count(*) as cnt,city from sakila.city_demo group by city order by cnt desc limit 10;</p>\n<p>select count(*) as cnt,left(city,7) as perf from sakila.city_demo group by city order by cnt desc limit 10;</p>\n<p></p>\n<p></p>\n<p>select count(distinct city)&#x2F;count(*) from sakila.city_demo;</p>\n<p>select count(distinct left(city,7))&#x2F;count(*) from sakila.city_demo;</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<p> M F</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p>MySQLexplainMySQL</p>\n<ul>\n<li><h3 id=\"-x2F-\"><a href=\"#-x2F-\" class=\"headerlink\" title=\"&#x2F;\"></a>&#x2F;</h3></li>\n</ul>\n<p>MySQL</p>\n<p>&#x2F;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> like %%</li>\n<li>like</li>\n</ul>\n<p>LIKE%_MySQLlikeInnoDB</p>\n<p></p>\n<p>SELECT * FROM mytable WHERE username likeadmin%</p>\n<p></p>\n<p>SELECT * FROM mytable WHEREt Name like%admin</p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<ol>\n<li> select actor_id from sakila.actor where actor_id+1&#x3D;5;</li>\n<li>select  where TO_DAYS(CURRENT_DATE) - TO_DAYS(date_col)&lt;&#x3D;10;</li>\n</ol>\n<ul>\n<li>NOT IN&lt;&gt;!&#x3D; </li>\n</ul>\n<p> where !&#x3D;&lt;&gt;</p>\n<p>not innot exists+ exists  in  select num from a where num in(select num from b)  select num from a where exists(select 1 from b where num&#x3D;a.num)</p>\n<p>&lt;&gt;a&lt;&gt;0  a&gt;0 or a&lt;0</p>\n<ul>\n<li>or</li>\n</ul>\n<p> or   or   </p>\n<p> where  or  num1num2select id from t where num1&#x3D;10 or num2&#x3D;20 select id from t where num1&#x3D;10 union all select id from t where num2&#x3D;20num2num1</p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> People (</span><br><span class=\"line\">  last_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  first_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  birthday <span class=\"type\">date</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  gender enum(<span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  key(last_name, first_name, birthday)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li></li>\n<li>last nameSmith</li>\n<li>WHERE last_name&#x3D;Smith AND first_name LIKE J% AND dob&#x3D;1976-12-23LIKE</li>\n</ol>\n<ul>\n<li>ORDER BY</li>\n</ul>\n<ol>\n<li>ORDER BY</li>\n<li>ORDER BYORDER BYWHEREJOIN</li>\n<li>ORDER BYfilesort</li>\n</ol>\n<p><img src=\"/images/mysql-index/mysql-index-14.png\" alt=\"image\"></p>\n<ul>\n<li> where MySQL MySQL  </li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-15.jpg\" alt=\"image\"></p>\n<p><img src=\"/images/mysql-index/mysql-index-16.jpg\" alt=\"image\"></p>\n<ul>\n<li> select * from t *</li>\n<li> MySQL ,sexmalefemalesex</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>1000 MySQL</p>\n<p>EXPLAIN SELECTSELECTEXPLAINMySQLSELECTMySQL()</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>Handler_read_key </li>\n<li>Handler_read_rnd_next  Handler_read_rnd_next </li>\n</ul>\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-17.png\" alt=\"image\"></p>\n<p> MySQL </p>\n","site":{"data":{}},"excerpt":"","more":"<p>EnjoyMoving<br><a href=\"https://zhuanlan.zhihu.com/p/29118331\"></a><br></p>\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-1.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>IOIO</li>\n<li>InnoDBMySQL5.1InnoDBMySQLInnoDB InnoDBInnoDBInnoDBMySQLInnoDBWHEREMySQL</li>\n<li>InnoDBInnoDB<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2></li>\n<li>INSERTUPDATEDELETEMySQL</li>\n<li></li>\n<li></li>\n<li><br>MySQL<br><br>MySQL16</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"B-Tree\"><a href=\"#B-Tree\" class=\"headerlink\" title=\"B-Tree\"></a>B-Tree</h2><p>InnoDBB+Tree<br>B+Tree<br>B-Tree<br>B-Tree&lt;&lt;&#x3D;&#x3D;&gt;&gt;&#x3D;BETWEENINLIKE</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B-Tree(leftmost prefix of the index)<br><img src=\"/images/mysql-index/mysql-index-2.jpg\" alt=\"image\"><br></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> People (</span><br><span class=\"line\">  last_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  first_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  dob <span class=\"type\">date</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  gender enum(<span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  key(last_name, first_name, dob)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>last_namefirst_namedob<br><img src=\"/images/mysql-index/mysql-index-3.jpg\" alt=\"image\"><br>(leftmost prefix of the index)</p>\n<ol>\n<li><p></p>\n</li>\n<li><p>last nameSmith</p>\n</li>\n<li><p>WHERE last_name&#x3D;Smith AND first_name LIKE J% AND dob&#x3D;1976-12-23LIKE</p>\n</li>\n<li><p>(Match the full value)1960-01-01Cuba Allen</p>\n</li>\n<li><p>(Match a leftmost prefix)last nameAllen1</p>\n</li>\n<li><p>(Match a column prefix)last nameJ1</p>\n</li>\n<li><p>(Match a range of values)last nameAllenBarrymore1</p>\n</li>\n<li><p>(Match one part exactly and match a range on another part)last nameAllenfirst nameK</p>\n</li>\n<li><p>(Index-only queries)I&#x2F;O()</p>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B-TreeORDER BYORDER BY(leftmost prefix of the index)</p>\n<p>MySQL</p>\n<ul>\n<li>filesort</li>\n<li></li>\n</ul>\n<p>explaintypeindexMYSQL</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ul>\n<li>ORDER BY</li>\n<li>ORDER BYORDER BYWHEREJOIN</li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-4.png\" alt=\"image\"></p>\n<ul>\n<li>ORDER BYfilesort</li>\n</ul>\n<h4 id=\"filesort\"><a href=\"#filesort\" class=\"headerlink\" title=\"filesort\"></a>filesort</h4><p>MySQL()(sort buffer)</p>\n<p></p>\n<p>filesortMySQL</p>\n<ul>\n<li><h5 id=\"-Two-passes\"><a href=\"#-Two-passes\" class=\"headerlink\" title=\"(Two passes)\"></a>(Two passes)</h5><p> sort_buffer_sizeColumns<br> MySQL4.1I&#x2F;O</p>\n</li>\n<li><h5 id=\"-single-pass\"><a href=\"#-single-pass\" class=\"headerlink\" title=\"(single pass)\"></a>(single pass)</h5><p> Columns<br> MySQL4.1I&#x2F;OColumns<br>  MySQL 4.1  max_length_for_sort_data  MySQL  max_length_for_sort_data MySQL <br> ORDER BYMySQLfilesortEXPLAINUsing filesortMySQLfilesortEXPLAINUsing temporary;Using filesort<br>  Query  Columns </p>\n</li>\n</ul>\n<h2 id=\"-cluster-index\"><a href=\"#-cluster-index\" class=\"headerlink\" title=\"(cluster index)\"></a>(cluster index)</h2><p></p>\n<p>solidDBInnoDBMyISAMDBMSMySQL</p>\n<h3 id=\"InnoDB\"><a href=\"#InnoDB\" class=\"headerlink\" title=\"InnoDB\"></a>InnoDB</h3><ol>\n<li>InnoDB</li>\n<li>InnoDB</li>\n<li>InnoDB</li>\n</ol>\n<p>InnoDBInnoDB(surrogate key)AUTO_INCREMENTprimary key</p>\n<p>DBMS</p>\n<ul>\n<li>primary</li>\n<li>second</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><br></p>\n<p><img src=\"/images/mysql-index/mysql-index-5.jpg\" alt=\"image\"></p>\n<p><br></p>\n<ol>\n<li></li>\n<li>B-Tree</li>\n</ol>\n<p>InnoDBInnoDB</p>\n<p><strong>InnoDBMyISAM</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> layout_test (</span><br><span class=\"line\">  col1 <span class=\"type\">int</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  col2 <span class=\"type\">int</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY(col1),</span><br><span class=\"line\">  KEY(col2)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>MyISAM</strong></li>\n</ul>\n<p>MyISAM</p>\n<p>(row number)0MyISAM</p>\n<p><img src=\"/images/mysql-index/mysql-index-6.png\" alt=\"image\"></p>\n<p>MyISAM</p>\n<p>col1</p>\n<p>MyISAM(row number)col1</p>\n<p><img src=\"/images/mysql-index/mysql-index-7.jpg\" alt=\"image\"></p>\n<p>col2</p>\n<p>MyISAMprimary keyPrimary keyPRIMARYcol2</p>\n<p><img src=\"/images/mysql-index/mysql-index-8.jpg\" alt=\"image\"></p>\n<ul>\n<li><strong>InnoDB</strong></li>\n</ul>\n<p>col1</p>\n<p>IDMVCC(col2)</p>\n<p><img src=\"/images/mysql-index/mysql-index-9.jpg\" alt=\"image\"></p>\n<p>col2</p>\n<p>InnoDB(row pointers)InnoDB</p>\n<p><img src=\"/images/mysql-index/mysql-index-10.jpg\" alt=\"image\"></p>\n<ul>\n<li><strong>+   </strong></li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-11.jpg\" alt=\"image\"></p>\n<h2 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h2><p></p>\n<p></p>\n<p>MySQLMemoryhashMemoryMemoryB-Tree</p>\n<p>Memoryhashhash codehash</p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> testhash (</span><br><span class=\"line\">  fname <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  lname <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  KEY <span class=\"keyword\">USING</span> HASH(fname)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>MEMORY;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-12.jpg\" alt=\"image\"></p>\n<p>hashf( )</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">f(&#x27;Arjen&#x27;) = 2323</span><br><span class=\"line\">f(&#x27;Baron&#x27;) = 7437</span><br><span class=\"line\">f(&#x27;Peter&#x27;) = 8784</span><br><span class=\"line\">f(&#x27;Vadim&#x27;) = 2458</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-13.png\" alt=\"image\"></p>\n<p>+</p>\n<p> SELECT lname FROM testhash WHERE fname&#x3D;Peter; MySQLPeterhashf(Peter) &#x3D; 8784MySQL87843</p>\n<h3 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h3><ul>\n<li>hash codeMySQL</li>\n<li>hash</li>\n<li>Hashhash</li>\n<li>Hash&#x3D;IN( )&lt;&#x3D;&gt;WHERE price&gt;100</li>\n<li>Hash</li>\n<li></li>\n</ul>\n<p>InnoDBMysqlDBAinnodb_adaptive_hash_index</p>\n<p>InnoDBB+ TreeB-Tree</p>\n<ul>\n<li>&#x3D; &lt;&#x3D;&gt;in </li>\n<li></li>\n</ul>\n<p>InnoDB25</p>\n<h2 id=\"-R-Tree-\"><a href=\"#-R-Tree-\" class=\"headerlink\" title=\"(R-Tree)\"></a>(R-Tree)</h2><p>MyISAMGEOMETRY</p>\n<h2 id=\"-Full-text-\"><a href=\"#-Full-text-\" class=\"headerlink\" title=\"(Full-text)\"></a>(Full-text)</h2><p>MyISAM</p>\n<p>MySQL InnoDB5.6InnoDB<a href=\"https://dev.mysql.com/doc/refman/5.7/en/fulltext-restrictions.html\">12.9.5 Full-Text Restrictions</a></p>\n<h1 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h1><ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>KEYINDEX(WHERE column &#x3D; )(ORDER BY column)</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE INDEX indexName ON mytable(username(length));</p>\n<p>CHARVARCHARlengthBLOBTEXT length</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ALTER mytable ADD INDEX [indexName] ON (username(length))</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, INDEX [indexName] (username(length)) );</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>DROP INDEX [indexName] ON mytable;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE UNIQUE INDEX indexName ON mytable(username(length))</p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>ALTER mytable ADD UNIQUE [indexName] ON (username(length))</p>\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, UNIQUE [indexName] (username(length)) );</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, PRIMARY KEY(ID) );  ALTER </p>\n<p></p>\n<p>MySQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>CREATE TABLE mytable( ID INT NOT NULL, username VARCHAR(16) NOT NULL, city VARCHAR(50) NOT NULL, age INT NOT NULL );</p>\n<p>MySQL name, city, age</p>\n<p>ALTER TABLE mytable ADD INDEX name_city_age (name(10),city,age);</p>\n<p>usernname 16 1010INSERT</p>\n<p></p>\n<p>usernname,city,age</p>\n<p>usernname,city</p>\n<p>usernname</p>\n<p> cityageMySQLSQL</p>\n<p>SELECT * FROM mytable WHREE username&#x3D;admin AND city&#x3D;</p>\n<p>SELECT * FROM mytable WHREE username&#x3D;admin</p>\n<p></p>\n<p>SELECT * FROM mytable WHREE age&#x3D;20 AND city&#x3D;</p>\n<p>SELECT * FROM mytable WHREE city&#x3D;</p>\n<p> usernnamecityage3MySQL</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>WHEREJOINMySQLB-Tree&lt;&lt;&#x3D;&#x3D;&gt;&gt;&#x3D;BETWEENINLIKE</p>\n<p></p>\n<p>SELECT t.Name FROM mytable t LEFT JOIN mytable m ON t.Name&#x3D;m.username WHERE m.age&#x3D;20 AND m.city&#x3D;</p>\n<p>cityagemytableuserameJOIN</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>B-Tree</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<ul>\n<li><h3 id=\"NULL\"><a href=\"#NULL\" class=\"headerlink\" title=\"NULL\"></a>NULL</h3></li>\n</ul>\n<p>MySQL</p>\n<p>NULLNULLNULL</p>\n<p>NULLNOT NULLNULL0</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<p>BLOBTEXTVARCHARMYSQL</p>\n<p>MySQLorder bygroup by</p>\n<p></p>\n<p>CHAR(255)1020</p>\n<p>I&#x2F;O10~15</p>\n<p></p>\n<p>MYSQL1</p>\n<p></p>\n<p></p>\n<p>select count(*) as cnt,city from sakila.city_demo group by city order by cnt desc limit 10;</p>\n<p>select count(*) as cnt,left(city,7) as perf from sakila.city_demo group by city order by cnt desc limit 10;</p>\n<p></p>\n<p></p>\n<p>select count(distinct city)&#x2F;count(*) from sakila.city_demo;</p>\n<p>select count(distinct left(city,7))&#x2F;count(*) from sakila.city_demo;</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p></p>\n<p> M F</p>\n<ul>\n<li><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3></li>\n</ul>\n<p>MySQLexplainMySQL</p>\n<ul>\n<li><h3 id=\"-x2F-\"><a href=\"#-x2F-\" class=\"headerlink\" title=\"&#x2F;\"></a>&#x2F;</h3></li>\n</ul>\n<p>MySQL</p>\n<p>&#x2F;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> like %%</li>\n<li>like</li>\n</ul>\n<p>LIKE%_MySQLlikeInnoDB</p>\n<p></p>\n<p>SELECT * FROM mytable WHERE username likeadmin%</p>\n<p></p>\n<p>SELECT * FROM mytable WHEREt Name like%admin</p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<ol>\n<li> select actor_id from sakila.actor where actor_id+1&#x3D;5;</li>\n<li>select  where TO_DAYS(CURRENT_DATE) - TO_DAYS(date_col)&lt;&#x3D;10;</li>\n</ol>\n<ul>\n<li>NOT IN&lt;&gt;!&#x3D; </li>\n</ul>\n<p> where !&#x3D;&lt;&gt;</p>\n<p>not innot exists+ exists  in  select num from a where num in(select num from b)  select num from a where exists(select 1 from b where num&#x3D;a.num)</p>\n<p>&lt;&gt;a&lt;&gt;0  a&gt;0 or a&lt;0</p>\n<ul>\n<li>or</li>\n</ul>\n<p> or   or   </p>\n<p> where  or  num1num2select id from t where num1&#x3D;10 or num2&#x3D;20 select id from t where num1&#x3D;10 union all select id from t where num2&#x3D;20num2num1</p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> People (</span><br><span class=\"line\">  last_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  first_name <span class=\"type\">varchar</span>(<span class=\"number\">50</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  birthday <span class=\"type\">date</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  gender enum(<span class=\"string\">&#x27;m&#x27;</span>, <span class=\"string\">&#x27;f&#x27;</span>) <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>,</span><br><span class=\"line\">  key(last_name, first_name, birthday)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li></li>\n<li>last nameSmith</li>\n<li>WHERE last_name&#x3D;Smith AND first_name LIKE J% AND dob&#x3D;1976-12-23LIKE</li>\n</ol>\n<ul>\n<li>ORDER BY</li>\n</ul>\n<ol>\n<li>ORDER BY</li>\n<li>ORDER BYORDER BYWHEREJOIN</li>\n<li>ORDER BYfilesort</li>\n</ol>\n<p><img src=\"/images/mysql-index/mysql-index-14.png\" alt=\"image\"></p>\n<ul>\n<li> where MySQL MySQL  </li>\n</ul>\n<p><img src=\"/images/mysql-index/mysql-index-15.jpg\" alt=\"image\"></p>\n<p><img src=\"/images/mysql-index/mysql-index-16.jpg\" alt=\"image\"></p>\n<ul>\n<li> select * from t *</li>\n<li> MySQL ,sexmalefemalesex</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>1000 MySQL</p>\n<p>EXPLAIN SELECTSELECTEXPLAINMySQLSELECTMySQL()</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>Handler_read_key </li>\n<li>Handler_read_rnd_next  Handler_read_rnd_next </li>\n</ul>\n<p></p>\n<p><img src=\"/images/mysql-index/mysql-index-17.png\" alt=\"image\"></p>\n<p> MySQL </p>\n"},{"title":"redis ","date":"2022-05-11T07:05:48.000Z","_content":"\nRedis BSD Redis \n\n- \n- \n- \n- \n- \n- \n- \n- \n\n  \n\n- \n- /\n- Lua \n- \n- LRU \n- \n\nRedis Lua LRU Redis SentinelRedis Cluster\n\nRedis \n\n[redis](https://redis.io/)\n","source":"_posts/database/redis/redisbase.md","raw":"---\ntitle: redis \ndate: 2022-05-11 15:05:48\ncategories: \n  - database\n  - redis\ntags:\n  - redis\n  - cache\n---\n\nRedis BSD Redis \n\n- \n- \n- \n- \n- \n- \n- \n- \n\n  \n\n- \n- /\n- Lua \n- \n- LRU \n- \n\nRedis Lua LRU Redis SentinelRedis Cluster\n\nRedis \n\n[redis](https://redis.io/)\n","slug":"database/redis/redisbase","published":1,"updated":"2022-05-11T08:52:44.210Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p6001kxklo1qk7dtw3","content":"<p>Redis BSD Redis </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>  </p>\n<ul>\n<li></li>\n<li>&#x2F;</li>\n<li>Lua </li>\n<li></li>\n<li>LRU </li>\n<li></li>\n</ul>\n<p>Redis Lua LRU Redis SentinelRedis Cluster</p>\n<p>Redis </p>\n<p><a href=\"https://redis.io/\">redis</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Redis BSD Redis </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>  </p>\n<ul>\n<li></li>\n<li>&#x2F;</li>\n<li>Lua </li>\n<li></li>\n<li>LRU </li>\n<li></li>\n</ul>\n<p>Redis Lua LRU Redis SentinelRedis Cluster</p>\n<p>Redis </p>\n<p><a href=\"https://redis.io/\">redis</a></p>\n"},{"title":"mysql  MVCC","date":"2021-05-13T03:54:00.000Z","_content":"\n# mysql\n\n-  MySQL  Innodb \n-  SQL \n- 4ACIDAtomicityConsistencyIsolationDurability\n- mysql\n\n****\n\ntransactionRollback\n\n****\n\n\n\n****\n\nRead uncommittedread committedrepeatable readSerializable\n\n****\n\n\n\n## \n\n### READ UNCOMMITTED\n\nREAD UNCOMMITTED\n\n![image](/images/mysql-transaction/mysql-transaction-1.png)\n\nSession ASession BSession Bid1c''Session Aid1''Session BSession A\n\n![image](/images/mysql-transaction/mysql-transaction-2.png)\n\nREAD UNCOMMITTED\n\n### Read committed\n\nREAD COMMITTED\n\n![image](/images/mysql-transaction/mysql-transaction-3.png)\n\n4Session BSession A''6Session BSession B''\n\n\n\n![image](/images/mysql-transaction/mysql-transaction-4.png)\n\nSession Bid1cSession A\n\n### Repeatable read\n\nREPEATABLE READ\n\n![image](/images/mysql-transaction/mysql-transaction-5.png)\n\nSession Aid1c''Session BSession Ac''\n\n### Serializable \n\n3-----SERIALIZABLE\n\n![image](/images/mysql-transaction/mysql-transaction-6.png)\n\nSession Bid1Session ASession BSession A\n\n\n|  | (Dirty Read) |  (NonRepeatable Read) |  (Phantom Read) |\n| :--: | :--: | :--: | :--: |\n| Read uncommitted |  |  |  |\n| Read committed |  |  |  |\n| Repeatable read |  |  |  |\n| Serializable  |  |  |  |\n\nInnoDB\n\n- : \n- :\n- :\n\n\n\n# (MVCC)\n\nInnoDBrow_idNULLrow_id\n\n- trx_ididtrx_id\n- roll_pointerundo\n\nt\n```\nmysql> SELECT * FROM t;\n+----+--------+\n| id | c      |\n+----+--------+\n|  1 |    |\n+----+--------+\n1 row in set (0.01 sec)\n```\n\nid80\n\n![image](/images/mysql-transaction/mysql-transaction-7.png)\n\nid100200UPDATE\n\n![image](/images/mysql-transaction/mysql-transaction-8.png)\n\n>  \n\nundoundoroll_pointerINSERTundoundo\n\n![image](/images/mysql-transaction/mysql-transaction-9.png)\n\nundoroll_pointerid\n\n## ReadView\n\nREAD UNCOMMITTEDSERIALIZABLEREAD COMMITTEDREPEATABLE READInnoDBReadViewReadViewidm_ids\n\n- trx_idm_idsidReadView\n- trx_idm_idsidReadView\n- trx_idm_idsididtrx_idm_idsReadViewReadView\n\n\n\nMySQLREAD COMMITTEDREPEATABLE READReadView\n\n###  COMMITTED --- ReadView\n\nid100200\n\n```sql\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n\n```\n\n>  INSERTDELETEUPDATEidid\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-10.png)\n\nREAD COMMITTED\n\n```sql\n\n# READ COMMITTED\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT1\n\n1. SELECTReadViewReadViewm_ids[100, 200]\n2. c''trx_id100m_idsroll_pointer\n3. c''trx_id100m_ids\n4. c''trx_id80m_idsid100c''\n\nid100\n\n```sql\n\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nCOMMIT;\n```\n\nid200tid1\n\n```sql\n# Transaction 200\nBEGIN;\n \n# \n...\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-11.png)\n\nREAD COMMITTEDid1\n\n```sql\n\n# READ COMMITTED\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n \n# SELECT2Transaction 100Transaction 200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT2\n\n1. SELECTReadViewReadViewm_ids[200]id100\n2. c''trx_id200m_idsroll_pointer\n3. c''trx_id200m_ids\n4. c''trx_id100m_idsid200c''\n\n### REPEATABLE READ ---ReadView\n\nREPEATABLE READReadView\n\nid100200\n\n```sql\n\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-12.png)\n\nREPEATABLE READ\n\n```sql\n\n# REPEATABLE READ\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT1\n\n1. SELECTReadViewReadViewm_ids[100, 200]\n2. c''trx_id100m_idsroll_pointer\n3. c''trx_id100m_ids\n4. c''trx_id80m_idsid100c''\n\nid100\n\n```sql\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nCOMMIT;\n```\n\nid200tid1\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-13.png)\n\nREPEATABLE READid1\n\n```sql\n# REPEATABLE READ\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n \n# SELECT2Transaction 100Transaction 200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT2\n\n1. ReadViewReadViewReadViewm_ids[100, 200]\n2. c''trx_id200m_idsroll_pointer\n3. c''trx_id200m_ids\n4. c''trx_id100m_ids100idc''\n5. c''trx_id8080m_idsid100c''\n\nSELECTc''id200REPEATABLE READid1''\n\n### MVCC\n\nMVCCMulti-Version Concurrency Control READ COMMITTDREPEATABLE READSEELCT--READ COMMITTDREPEATABLE READReadViewREAD COMMITTDSELECTReadViewREPEATABLE READSELECTReadViewReadView\n\n\n\n1. https://www.cnblogs.com/personsiglewine/p/11507866.html\n2. https://blog.csdn.net/qq_38538733/article/details/88902979","source":"_posts/database/mysql/mysql-transaction.md","raw":"---\ntitle: mysql  MVCC\ndate: 2021-05-13 11:54:00\ncategories:\n  - database\n  - mysql\ntags:\n  - mysql\n---\n\n# mysql\n\n-  MySQL  Innodb \n-  SQL \n- 4ACIDAtomicityConsistencyIsolationDurability\n- mysql\n\n****\n\ntransactionRollback\n\n****\n\n\n\n****\n\nRead uncommittedread committedrepeatable readSerializable\n\n****\n\n\n\n## \n\n### READ UNCOMMITTED\n\nREAD UNCOMMITTED\n\n![image](/images/mysql-transaction/mysql-transaction-1.png)\n\nSession ASession BSession Bid1c''Session Aid1''Session BSession A\n\n![image](/images/mysql-transaction/mysql-transaction-2.png)\n\nREAD UNCOMMITTED\n\n### Read committed\n\nREAD COMMITTED\n\n![image](/images/mysql-transaction/mysql-transaction-3.png)\n\n4Session BSession A''6Session BSession B''\n\n\n\n![image](/images/mysql-transaction/mysql-transaction-4.png)\n\nSession Bid1cSession A\n\n### Repeatable read\n\nREPEATABLE READ\n\n![image](/images/mysql-transaction/mysql-transaction-5.png)\n\nSession Aid1c''Session BSession Ac''\n\n### Serializable \n\n3-----SERIALIZABLE\n\n![image](/images/mysql-transaction/mysql-transaction-6.png)\n\nSession Bid1Session ASession BSession A\n\n\n|  | (Dirty Read) |  (NonRepeatable Read) |  (Phantom Read) |\n| :--: | :--: | :--: | :--: |\n| Read uncommitted |  |  |  |\n| Read committed |  |  |  |\n| Repeatable read |  |  |  |\n| Serializable  |  |  |  |\n\nInnoDB\n\n- : \n- :\n- :\n\n\n\n# (MVCC)\n\nInnoDBrow_idNULLrow_id\n\n- trx_ididtrx_id\n- roll_pointerundo\n\nt\n```\nmysql> SELECT * FROM t;\n+----+--------+\n| id | c      |\n+----+--------+\n|  1 |    |\n+----+--------+\n1 row in set (0.01 sec)\n```\n\nid80\n\n![image](/images/mysql-transaction/mysql-transaction-7.png)\n\nid100200UPDATE\n\n![image](/images/mysql-transaction/mysql-transaction-8.png)\n\n>  \n\nundoundoroll_pointerINSERTundoundo\n\n![image](/images/mysql-transaction/mysql-transaction-9.png)\n\nundoroll_pointerid\n\n## ReadView\n\nREAD UNCOMMITTEDSERIALIZABLEREAD COMMITTEDREPEATABLE READInnoDBReadViewReadViewidm_ids\n\n- trx_idm_idsidReadView\n- trx_idm_idsidReadView\n- trx_idm_idsididtrx_idm_idsReadViewReadView\n\n\n\nMySQLREAD COMMITTEDREPEATABLE READReadView\n\n###  COMMITTED --- ReadView\n\nid100200\n\n```sql\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n\n```\n\n>  INSERTDELETEUPDATEidid\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-10.png)\n\nREAD COMMITTED\n\n```sql\n\n# READ COMMITTED\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT1\n\n1. SELECTReadViewReadViewm_ids[100, 200]\n2. c''trx_id100m_idsroll_pointer\n3. c''trx_id100m_ids\n4. c''trx_id80m_idsid100c''\n\nid100\n\n```sql\n\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nCOMMIT;\n```\n\nid200tid1\n\n```sql\n# Transaction 200\nBEGIN;\n \n# \n...\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-11.png)\n\nREAD COMMITTEDid1\n\n```sql\n\n# READ COMMITTED\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n \n# SELECT2Transaction 100Transaction 200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT2\n\n1. SELECTReadViewReadViewm_ids[200]id100\n2. c''trx_id200m_idsroll_pointer\n3. c''trx_id200m_ids\n4. c''trx_id100m_idsid200c''\n\n### REPEATABLE READ ---ReadView\n\nREPEATABLE READReadView\n\nid100200\n\n```sql\n\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-12.png)\n\nREPEATABLE READ\n\n```sql\n\n# REPEATABLE READ\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT1\n\n1. SELECTReadViewReadViewm_ids[100, 200]\n2. c''trx_id100m_idsroll_pointer\n3. c''trx_id100m_ids\n4. c''trx_id80m_idsid100c''\n\nid100\n\n```sql\n# Transaction 100\nBEGIN;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n \nCOMMIT;\n```\n\nid200tid1\n\n```sql\n\n# Transaction 200\nBEGIN;\n \n# \n...\n \nUPDATE t SET c = '' WHERE id = 1;\n \nUPDATE t SET c = '' WHERE id = 1;\n```\n\ntid1\n\n![image](/images/mysql-transaction/mysql-transaction-13.png)\n\nREPEATABLE READid1\n\n```sql\n# REPEATABLE READ\nBEGIN;\n \n# SELECT1Transaction 100200\nSELECT * FROM t WHERE id = 1; # c''\n \n# SELECT2Transaction 100Transaction 200\nSELECT * FROM t WHERE id = 1; # c''\n```\n\nSELECT2\n\n1. ReadViewReadViewReadViewm_ids[100, 200]\n2. c''trx_id200m_idsroll_pointer\n3. c''trx_id200m_ids\n4. c''trx_id100m_ids100idc''\n5. c''trx_id8080m_idsid100c''\n\nSELECTc''id200REPEATABLE READid1''\n\n### MVCC\n\nMVCCMulti-Version Concurrency Control READ COMMITTDREPEATABLE READSEELCT--READ COMMITTDREPEATABLE READReadViewREAD COMMITTDSELECTReadViewREPEATABLE READSELECTReadViewReadView\n\n\n\n1. https://www.cnblogs.com/personsiglewine/p/11507866.html\n2. https://blog.csdn.net/qq_38538733/article/details/88902979","slug":"database/mysql/mysql-transaction","published":1,"updated":"2022-05-10T08:25:56.383Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p6001mxklob2yn48t8","content":"<h1 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h1><ul>\n<li> MySQL  Innodb </li>\n<li> SQL </li>\n<li>4ACIDAtomicityConsistencyIsolationDurability</li>\n<li>mysql</li>\n</ul>\n<p><strong></strong></p>\n<p>transactionRollback</p>\n<p><strong></strong></p>\n<p></p>\n<p><strong></strong></p>\n<p>Read uncommittedread committedrepeatable readSerializable</p>\n<p><strong></strong></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"READ-UNCOMMITTED\"><a href=\"#READ-UNCOMMITTED\" class=\"headerlink\" title=\"READ UNCOMMITTED\"></a>READ UNCOMMITTED</h3><p>READ UNCOMMITTED</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-1.png\" alt=\"image\"></p>\n<p>Session ASession BSession Bid1cSession Aid1Session BSession A</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-2.png\" alt=\"image\"></p>\n<p>READ UNCOMMITTED</p>\n<h3 id=\"Read-committed\"><a href=\"#Read-committed\" class=\"headerlink\" title=\"Read committed\"></a>Read committed</h3><p>READ COMMITTED</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-3.png\" alt=\"image\"></p>\n<p>4Session BSession A6Session BSession B</p>\n<p></p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-4.png\" alt=\"image\"></p>\n<p>Session Bid1cSession A</p>\n<h3 id=\"Repeatable-read\"><a href=\"#Repeatable-read\" class=\"headerlink\" title=\"Repeatable read\"></a>Repeatable read</h3><p>REPEATABLE READ</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-5.png\" alt=\"image\"></p>\n<p>Session Aid1cSession BSession Ac</p>\n<h3 id=\"Serializable-\"><a href=\"#Serializable-\" class=\"headerlink\" title=\"Serializable \"></a>Serializable </h3><p>3-----SERIALIZABLE</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-6.png\" alt=\"image\"></p>\n<p>Session Bid1Session ASession BSession A</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">(Dirty Read)</th>\n<th align=\"center\"> (NonRepeatable Read)</th>\n<th align=\"center\"> (Phantom Read)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Read uncommitted</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Read committed</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Repeatable read</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Serializable </td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p>InnoDB</p>\n<ul>\n<li>: </li>\n<li>:</li>\n<li>:</li>\n</ul>\n<p></p>\n<h1 id=\"-MVCC\"><a href=\"#-MVCC\" class=\"headerlink\" title=\"(MVCC)\"></a>(MVCC)</h1><p>InnoDBrow_idNULLrow_id</p>\n<ul>\n<li>trx_ididtrx_id</li>\n<li>roll_pointerundo</li>\n</ul>\n<p>t</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SELECT * FROM t;</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">| id | c      |</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">|  1 |    |</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<p>id80</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-7.png\" alt=\"image\"></p>\n<p>id100200UPDATE</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-8.png\" alt=\"image\"></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>undoundoroll_pointerINSERTundoundo</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-9.png\" alt=\"image\"></p>\n<p>undoroll_pointerid</p>\n<h2 id=\"ReadView\"><a href=\"#ReadView\" class=\"headerlink\" title=\"ReadView\"></a>ReadView</h2><p>READ UNCOMMITTEDSERIALIZABLEREAD COMMITTEDREPEATABLE READInnoDBReadViewReadViewidm_ids</p>\n<ul>\n<li>trx_idm_idsidReadView</li>\n<li>trx_idm_idsidReadView</li>\n<li>trx_idm_idsididtrx_idm_idsReadViewReadView</li>\n</ul>\n<p></p>\n<p>MySQLREAD COMMITTEDREPEATABLE READReadView</p>\n<h3 id=\"COMMITTED--ReadView\"><a href=\"#COMMITTED--ReadView\" class=\"headerlink\" title=\"COMMITTED  ReadView\"></a>COMMITTED  ReadView</h3><p>id100200</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> INSERTDELETEUPDATEidid</p>\n</blockquote>\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-10.png\" alt=\"image\"></p>\n<p>READ COMMITTED</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># READ COMMITTED</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT1</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id100m_idsroll_pointer</li>\n<li>ctrx_id100m_ids</li>\n<li>ctrx_id80m_idsid100c</li>\n</ol>\n<p>id100</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">COMMIT</span>;</span><br></pre></td></tr></table></figure>\n\n<p>id200tid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-11.png\" alt=\"image\"></p>\n<p>READ COMMITTEDid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># READ COMMITTED</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT2Transaction <span class=\"number\">100</span>Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT2</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[200]id100</li>\n<li>ctrx_id200m_idsroll_pointer</li>\n<li>ctrx_id200m_ids</li>\n<li>ctrx_id100m_idsid200c</li>\n</ol>\n<h3 id=\"REPEATABLE-READ-ReadView\"><a href=\"#REPEATABLE-READ-ReadView\" class=\"headerlink\" title=\"REPEATABLE READ ReadView\"></a>REPEATABLE READ ReadView</h3><p>REPEATABLE READReadView</p>\n<p>id100200</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-12.png\" alt=\"image\"></p>\n<p>REPEATABLE READ</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># REPEATABLE READ</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT1</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id100m_idsroll_pointer</li>\n<li>ctrx_id100m_ids</li>\n<li>ctrx_id80m_idsid100c</li>\n</ol>\n<p>id100</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">COMMIT</span>;</span><br></pre></td></tr></table></figure>\n\n<p>id200tid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-13.png\" alt=\"image\"></p>\n<p>REPEATABLE READid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># REPEATABLE READ</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT2Transaction <span class=\"number\">100</span>Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT2</p>\n<ol>\n<li>ReadViewReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id200m_idsroll_pointer</li>\n<li>ctrx_id200m_ids</li>\n<li>ctrx_id100m_ids100idc</li>\n<li>ctrx_id8080m_idsid100c</li>\n</ol>\n<p>SELECTcid200REPEATABLE READid1</p>\n<h3 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h3><p>MVCCMulti-Version Concurrency Control READ COMMITTDREPEATABLE READSEELCT--READ COMMITTDREPEATABLE READReadViewREAD COMMITTDSELECTReadViewREPEATABLE READSELECTReadViewReadView</p>\n<p></p>\n<ol>\n<li><a href=\"https://www.cnblogs.com/personsiglewine/p/11507866.html\">https://www.cnblogs.com/personsiglewine/p/11507866.html</a></li>\n<li><a href=\"https://blog.csdn.net/qq_38538733/article/details/88902979\">https://blog.csdn.net/qq_38538733/article/details/88902979</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h1><ul>\n<li> MySQL  Innodb </li>\n<li> SQL </li>\n<li>4ACIDAtomicityConsistencyIsolationDurability</li>\n<li>mysql</li>\n</ul>\n<p><strong></strong></p>\n<p>transactionRollback</p>\n<p><strong></strong></p>\n<p></p>\n<p><strong></strong></p>\n<p>Read uncommittedread committedrepeatable readSerializable</p>\n<p><strong></strong></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"READ-UNCOMMITTED\"><a href=\"#READ-UNCOMMITTED\" class=\"headerlink\" title=\"READ UNCOMMITTED\"></a>READ UNCOMMITTED</h3><p>READ UNCOMMITTED</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-1.png\" alt=\"image\"></p>\n<p>Session ASession BSession Bid1cSession Aid1Session BSession A</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-2.png\" alt=\"image\"></p>\n<p>READ UNCOMMITTED</p>\n<h3 id=\"Read-committed\"><a href=\"#Read-committed\" class=\"headerlink\" title=\"Read committed\"></a>Read committed</h3><p>READ COMMITTED</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-3.png\" alt=\"image\"></p>\n<p>4Session BSession A6Session BSession B</p>\n<p></p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-4.png\" alt=\"image\"></p>\n<p>Session Bid1cSession A</p>\n<h3 id=\"Repeatable-read\"><a href=\"#Repeatable-read\" class=\"headerlink\" title=\"Repeatable read\"></a>Repeatable read</h3><p>REPEATABLE READ</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-5.png\" alt=\"image\"></p>\n<p>Session Aid1cSession BSession Ac</p>\n<h3 id=\"Serializable-\"><a href=\"#Serializable-\" class=\"headerlink\" title=\"Serializable \"></a>Serializable </h3><p>3-----SERIALIZABLE</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-6.png\" alt=\"image\"></p>\n<p>Session Bid1Session ASession BSession A</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">(Dirty Read)</th>\n<th align=\"center\"> (NonRepeatable Read)</th>\n<th align=\"center\"> (Phantom Read)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Read uncommitted</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Read committed</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Repeatable read</td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Serializable </td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p>InnoDB</p>\n<ul>\n<li>: </li>\n<li>:</li>\n<li>:</li>\n</ul>\n<p></p>\n<h1 id=\"-MVCC\"><a href=\"#-MVCC\" class=\"headerlink\" title=\"(MVCC)\"></a>(MVCC)</h1><p>InnoDBrow_idNULLrow_id</p>\n<ul>\n<li>trx_ididtrx_id</li>\n<li>roll_pointerundo</li>\n</ul>\n<p>t</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SELECT * FROM t;</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">| id | c      |</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">|  1 |    |</span><br><span class=\"line\">+----+--------+</span><br><span class=\"line\">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<p>id80</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-7.png\" alt=\"image\"></p>\n<p>id100200UPDATE</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-8.png\" alt=\"image\"></p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>undoundoroll_pointerINSERTundoundo</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-9.png\" alt=\"image\"></p>\n<p>undoroll_pointerid</p>\n<h2 id=\"ReadView\"><a href=\"#ReadView\" class=\"headerlink\" title=\"ReadView\"></a>ReadView</h2><p>READ UNCOMMITTEDSERIALIZABLEREAD COMMITTEDREPEATABLE READInnoDBReadViewReadViewidm_ids</p>\n<ul>\n<li>trx_idm_idsidReadView</li>\n<li>trx_idm_idsidReadView</li>\n<li>trx_idm_idsididtrx_idm_idsReadViewReadView</li>\n</ul>\n<p></p>\n<p>MySQLREAD COMMITTEDREPEATABLE READReadView</p>\n<h3 id=\"COMMITTED--ReadView\"><a href=\"#COMMITTED--ReadView\" class=\"headerlink\" title=\"COMMITTED  ReadView\"></a>COMMITTED  ReadView</h3><p>id100200</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> INSERTDELETEUPDATEidid</p>\n</blockquote>\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-10.png\" alt=\"image\"></p>\n<p>READ COMMITTED</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># READ COMMITTED</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT1</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id100m_idsroll_pointer</li>\n<li>ctrx_id100m_ids</li>\n<li>ctrx_id80m_idsid100c</li>\n</ol>\n<p>id100</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">COMMIT</span>;</span><br></pre></td></tr></table></figure>\n\n<p>id200tid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-11.png\" alt=\"image\"></p>\n<p>READ COMMITTEDid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># READ COMMITTED</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT2Transaction <span class=\"number\">100</span>Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT2</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[200]id100</li>\n<li>ctrx_id200m_idsroll_pointer</li>\n<li>ctrx_id200m_ids</li>\n<li>ctrx_id100m_idsid200c</li>\n</ol>\n<h3 id=\"REPEATABLE-READ-ReadView\"><a href=\"#REPEATABLE-READ-ReadView\" class=\"headerlink\" title=\"REPEATABLE READ ReadView\"></a>REPEATABLE READ ReadView</h3><p>REPEATABLE READReadView</p>\n<p>id100200</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-12.png\" alt=\"image\"></p>\n<p>REPEATABLE READ</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># REPEATABLE READ</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT1</p>\n<ol>\n<li>SELECTReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id100m_idsroll_pointer</li>\n<li>ctrx_id100m_ids</li>\n<li>ctrx_id80m_idsid100c</li>\n</ol>\n<p>id100</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Transaction <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">COMMIT</span>;</span><br></pre></td></tr></table></figure>\n\n<p>id200tid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> t <span class=\"keyword\">SET</span> c <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>tid1</p>\n<p><img src=\"/images/mysql-transaction/mysql-transaction-13.png\" alt=\"image\"></p>\n<p>REPEATABLE READid1</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># REPEATABLE READ</span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT1Transaction <span class=\"number\">100</span><span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"># SELECT2Transaction <span class=\"number\">100</span>Transaction <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t <span class=\"keyword\">WHERE</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span>; # c<span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>SELECT2</p>\n<ol>\n<li>ReadViewReadViewReadViewm_ids[100, 200]</li>\n<li>ctrx_id200m_idsroll_pointer</li>\n<li>ctrx_id200m_ids</li>\n<li>ctrx_id100m_ids100idc</li>\n<li>ctrx_id8080m_idsid100c</li>\n</ol>\n<p>SELECTcid200REPEATABLE READid1</p>\n<h3 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h3><p>MVCCMulti-Version Concurrency Control READ COMMITTDREPEATABLE READSEELCT--READ COMMITTDREPEATABLE READReadViewREAD COMMITTDSELECTReadViewREPEATABLE READSELECTReadViewReadView</p>\n<p></p>\n<ol>\n<li><a href=\"https://www.cnblogs.com/personsiglewine/p/11507866.html\">https://www.cnblogs.com/personsiglewine/p/11507866.html</a></li>\n<li><a href=\"https://blog.csdn.net/qq_38538733/article/details/88902979\">https://blog.csdn.net/qq_38538733/article/details/88902979</a></li>\n</ol>\n"},{"title":"mysql","date":"2021-05-13T03:54:54.000Z","_content":"\n# \n\n\n\n## \n\n\n\nSQL\n\n## \n\n\n\n### \n\n\n\n### \n\n\n\n1. \n2. \n3. \n\n### \n\n\n\n1. \n2. \n3. \n4. \n\n# \n\n\n\n## \n\nCREATE VIEWSELECTSELECT\n\n```sql\nSELECT Select_priv,Create_view_priv FROM mysql.user WHERE user='';\n```\n\n\n\n1. Select_privSELECTYSELECTN\n2. Create_view_privCREATE VIEW\n3. mysql.userMySQLuser\n4. \n\n****MySQLroot\n\n```sql\nSELECT * FROM mysql.user WHERE user='root';\n```\n\n## \n\nMySQLCREATE VIEW\n\n```sql\nCREATE [OR REPLACE] [ALGORITHM={UNDEFINED|MERGE|TEMPTABLE}]\nVIEW [()]\nAS SELECT\n[WITH [CASCADED|LOCAL] CHECK OPTION];\n```\n\n\n\n1. ALGORITHM\n2. \n3. SELECT\n4. SELECT\n5. WITH CHECK OPTION\n\n****\n\n```sql\nCREATE OR REPLACE VIEW view_user\nAS\n\tSELECT id,name FROM tb_user;\n```\n\n****\n\n```sql\nCREATE OR REPLACE VIEW view_user (a_id,a_name)\nAS\n\tSELECT id,name FROM tb_user;\n```\n\n\n\n1. create view[or replace]drop view\n2. selectfrom\n3. select\n4. select\n5. \n6. check table\n7. temporarytemporary\n8. \n9. \n10. order byorder by\n\n# \n\nMySQLCREATE OR REPLACE VIEWALTER VIEW\n\n****\n\n```sql\nALTER VIEW view_user\nAS\n\tSELECT id,name FROM tb_user where id  in (select id from tb_user);\n```\n\n****ALTER VIEWCREATE OR REPLACE VIEW\n\n# \n\nMySQLDROP VIEWDROP\n\n****\n\n```sql\nDROP VIEW IF EXISTS view_user;\n```\n\n# MySQLIFCASE\n\nMySQLIFCASE\n\n****MySQLIFCASE\n\n1. \n\n   ```sql\n   -- \n   DROP TABLE IF EXISTS tb_staff;\n    \n   -- \n   CREATE TABLE IF NOT EXISTS tb_staff\n   ( \n   \tid INT AUTO_INCREMENT PRIMARY KEY COMMENT '',\n   \tNAME VARCHAR(50) NOT NULL COMMENT '',\n   \tsex INT COMMENT '12',\n   \tdept_code VARCHAR(10) COMMENT '',\n   \tis_post BIT COMMENT '01'\n   ) COMMENT = '';\n   ```\n\n2. IFCASE\n\n   ```sql\n   -- \n   CREATE OR REPLACE VIEW view_staff\n   AS\n   \tSELECT id \n   \t,NAME\n   \t,IF(sex=1,'','') AS sex_name\n   \t,CASE dept_code\n   \t\tWHEN '1001' THEN ''\n   \t\tWHEN '1002' THEN ''\n   \t\tWHEN '1003' THEN ''\n   \t\tELSE ''\n   \tEND AS dept_name\n   \t,IF(is_post,'','') AS is_post_name\n   \tFROM tb_staff\n   ;\n   ```\n\nhttps://blog.csdn.net/pan_junbiao/article/details/86132535\n","source":"_posts/database/mysql/mysql-view.md","raw":"---\ntitle: mysql\ndate: 2021-05-13 11:54:54\ncategories:\n  - database\n  - mysql\ntags:\n  - mysql\n---\n\n# \n\n\n\n## \n\n\n\nSQL\n\n## \n\n\n\n### \n\n\n\n### \n\n\n\n1. \n2. \n3. \n\n### \n\n\n\n1. \n2. \n3. \n4. \n\n# \n\n\n\n## \n\nCREATE VIEWSELECTSELECT\n\n```sql\nSELECT Select_priv,Create_view_priv FROM mysql.user WHERE user='';\n```\n\n\n\n1. Select_privSELECTYSELECTN\n2. Create_view_privCREATE VIEW\n3. mysql.userMySQLuser\n4. \n\n****MySQLroot\n\n```sql\nSELECT * FROM mysql.user WHERE user='root';\n```\n\n## \n\nMySQLCREATE VIEW\n\n```sql\nCREATE [OR REPLACE] [ALGORITHM={UNDEFINED|MERGE|TEMPTABLE}]\nVIEW [()]\nAS SELECT\n[WITH [CASCADED|LOCAL] CHECK OPTION];\n```\n\n\n\n1. ALGORITHM\n2. \n3. SELECT\n4. SELECT\n5. WITH CHECK OPTION\n\n****\n\n```sql\nCREATE OR REPLACE VIEW view_user\nAS\n\tSELECT id,name FROM tb_user;\n```\n\n****\n\n```sql\nCREATE OR REPLACE VIEW view_user (a_id,a_name)\nAS\n\tSELECT id,name FROM tb_user;\n```\n\n\n\n1. create view[or replace]drop view\n2. selectfrom\n3. select\n4. select\n5. \n6. check table\n7. temporarytemporary\n8. \n9. \n10. order byorder by\n\n# \n\nMySQLCREATE OR REPLACE VIEWALTER VIEW\n\n****\n\n```sql\nALTER VIEW view_user\nAS\n\tSELECT id,name FROM tb_user where id  in (select id from tb_user);\n```\n\n****ALTER VIEWCREATE OR REPLACE VIEW\n\n# \n\nMySQLDROP VIEWDROP\n\n****\n\n```sql\nDROP VIEW IF EXISTS view_user;\n```\n\n# MySQLIFCASE\n\nMySQLIFCASE\n\n****MySQLIFCASE\n\n1. \n\n   ```sql\n   -- \n   DROP TABLE IF EXISTS tb_staff;\n    \n   -- \n   CREATE TABLE IF NOT EXISTS tb_staff\n   ( \n   \tid INT AUTO_INCREMENT PRIMARY KEY COMMENT '',\n   \tNAME VARCHAR(50) NOT NULL COMMENT '',\n   \tsex INT COMMENT '12',\n   \tdept_code VARCHAR(10) COMMENT '',\n   \tis_post BIT COMMENT '01'\n   ) COMMENT = '';\n   ```\n\n2. IFCASE\n\n   ```sql\n   -- \n   CREATE OR REPLACE VIEW view_staff\n   AS\n   \tSELECT id \n   \t,NAME\n   \t,IF(sex=1,'','') AS sex_name\n   \t,CASE dept_code\n   \t\tWHEN '1001' THEN ''\n   \t\tWHEN '1002' THEN ''\n   \t\tWHEN '1003' THEN ''\n   \t\tELSE ''\n   \tEND AS dept_name\n   \t,IF(is_post,'','') AS is_post_name\n   \tFROM tb_staff\n   ;\n   ```\n\nhttps://blog.csdn.net/pan_junbiao/article/details/86132535\n","slug":"database/mysql/mysql-view","published":1,"updated":"2022-05-10T08:25:56.383Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p7001qxklo3qdcd659","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>SQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CREATE VIEWSELECTSELECT</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> Select_priv,Create_view_priv <span class=\"keyword\">FROM</span> mysql.user <span class=\"keyword\">WHERE</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>Select_privSELECTYSELECTN</li>\n<li>Create_view_privCREATE VIEW</li>\n<li>mysql.userMySQLuser</li>\n<li></li>\n</ol>\n<p><strong></strong>MySQLroot</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> mysql.user <span class=\"keyword\">WHERE</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2><p>MySQLCREATE VIEW</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">OR</span> REPLACE] [ALGORITHM<span class=\"operator\">=</span>&#123;UNDEFINED<span class=\"operator\">|</span><span class=\"keyword\">MERGE</span><span class=\"operator\">|</span>TEMPTABLE&#125;]</span><br><span class=\"line\"><span class=\"keyword\">VIEW</span> [()]</span><br><span class=\"line\"><span class=\"keyword\">AS</span> <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">[<span class=\"keyword\">WITH</span> [<span class=\"keyword\">CASCADED</span><span class=\"operator\">|</span><span class=\"keyword\">LOCAL</span>] <span class=\"keyword\">CHECK</span> OPTION];</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>ALGORITHM</li>\n<li></li>\n<li>SELECT</li>\n<li>SELECT</li>\n<li>WITH CHECK OPTION</li>\n</ol>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_user</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_user (a_id,a_name)</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>create view[or replace]drop view</li>\n<li>selectfrom</li>\n<li>select</li>\n<li>select</li>\n<li></li>\n<li>check table</li>\n<li>temporarytemporary</li>\n<li></li>\n<li></li>\n<li>order byorder by</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MySQLCREATE OR REPLACE VIEWALTER VIEW</p>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">VIEW</span> view_user</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user <span class=\"keyword\">where</span> id  <span class=\"keyword\">in</span> (<span class=\"keyword\">select</span> id <span class=\"keyword\">from</span> tb_user);</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>ALTER VIEWCREATE OR REPLACE VIEW</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MySQLDROP VIEWDROP</p>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">VIEW</span> IF <span class=\"keyword\">EXISTS</span> view_user;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"MySQLIFCASE\"><a href=\"#MySQLIFCASE\" class=\"headerlink\" title=\"MySQLIFCASE\"></a>MySQLIFCASE</h1><p>MySQLIFCASE</p>\n<p><strong></strong>MySQLIFCASE</p>\n<ol>\n<li><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> tb_staff;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> tb_staff</span><br><span class=\"line\">( </span><br><span class=\"line\">\tid <span class=\"type\">INT</span> AUTO_INCREMENT <span class=\"keyword\">PRIMARY</span> KEY COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tNAME <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tsex <span class=\"type\">INT</span> COMMENT <span class=\"string\">&#x27;12&#x27;</span>,</span><br><span class=\"line\">\tdept_code <span class=\"type\">VARCHAR</span>(<span class=\"number\">10</span>) COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tis_post BIT COMMENT <span class=\"string\">&#x27;01&#x27;</span></span><br><span class=\"line\">) COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>IFCASE</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_staff</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id </span><br><span class=\"line\">\t,NAME</span><br><span class=\"line\">\t,IF(sex<span class=\"operator\">=</span><span class=\"number\">1</span>,<span class=\"string\">&#x27;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> sex_name</span><br><span class=\"line\">\t,<span class=\"keyword\">CASE</span> dept_code</span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1001&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1002&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1003&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">ELSE</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t<span class=\"keyword\">END</span> <span class=\"keyword\">AS</span> dept_name</span><br><span class=\"line\">\t,IF(is_post,<span class=\"string\">&#x27;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> is_post_name</span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span> tb_staff</span><br><span class=\"line\">;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><a href=\"https://blog.csdn.net/pan_junbiao/article/details/86132535\">https://blog.csdn.net/pan_junbiao/article/details/86132535</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>SQL</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CREATE VIEWSELECTSELECT</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> Select_priv,Create_view_priv <span class=\"keyword\">FROM</span> mysql.user <span class=\"keyword\">WHERE</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>Select_privSELECTYSELECTN</li>\n<li>Create_view_privCREATE VIEW</li>\n<li>mysql.userMySQLuser</li>\n<li></li>\n</ol>\n<p><strong></strong>MySQLroot</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> mysql.user <span class=\"keyword\">WHERE</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2><p>MySQLCREATE VIEW</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">OR</span> REPLACE] [ALGORITHM<span class=\"operator\">=</span>&#123;UNDEFINED<span class=\"operator\">|</span><span class=\"keyword\">MERGE</span><span class=\"operator\">|</span>TEMPTABLE&#125;]</span><br><span class=\"line\"><span class=\"keyword\">VIEW</span> [()]</span><br><span class=\"line\"><span class=\"keyword\">AS</span> <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">[<span class=\"keyword\">WITH</span> [<span class=\"keyword\">CASCADED</span><span class=\"operator\">|</span><span class=\"keyword\">LOCAL</span>] <span class=\"keyword\">CHECK</span> OPTION];</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>ALGORITHM</li>\n<li></li>\n<li>SELECT</li>\n<li>SELECT</li>\n<li>WITH CHECK OPTION</li>\n</ol>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_user</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user;</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_user (a_id,a_name)</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li>create view[or replace]drop view</li>\n<li>selectfrom</li>\n<li>select</li>\n<li>select</li>\n<li></li>\n<li>check table</li>\n<li>temporarytemporary</li>\n<li></li>\n<li></li>\n<li>order byorder by</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MySQLCREATE OR REPLACE VIEWALTER VIEW</p>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">VIEW</span> view_user</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id,name <span class=\"keyword\">FROM</span> tb_user <span class=\"keyword\">where</span> id  <span class=\"keyword\">in</span> (<span class=\"keyword\">select</span> id <span class=\"keyword\">from</span> tb_user);</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong>ALTER VIEWCREATE OR REPLACE VIEW</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>MySQLDROP VIEWDROP</p>\n<p><strong></strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">VIEW</span> IF <span class=\"keyword\">EXISTS</span> view_user;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"MySQLIFCASE\"><a href=\"#MySQLIFCASE\" class=\"headerlink\" title=\"MySQLIFCASE\"></a>MySQLIFCASE</h1><p>MySQLIFCASE</p>\n<p><strong></strong>MySQLIFCASE</p>\n<ol>\n<li><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">EXISTS</span> tb_staff;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> IF <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> tb_staff</span><br><span class=\"line\">( </span><br><span class=\"line\">\tid <span class=\"type\">INT</span> AUTO_INCREMENT <span class=\"keyword\">PRIMARY</span> KEY COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tNAME <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tsex <span class=\"type\">INT</span> COMMENT <span class=\"string\">&#x27;12&#x27;</span>,</span><br><span class=\"line\">\tdept_code <span class=\"type\">VARCHAR</span>(<span class=\"number\">10</span>) COMMENT <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">\tis_post BIT COMMENT <span class=\"string\">&#x27;01&#x27;</span></span><br><span class=\"line\">) COMMENT <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>IFCASE</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- </span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">OR</span> REPLACE <span class=\"keyword\">VIEW</span> view_staff</span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id </span><br><span class=\"line\">\t,NAME</span><br><span class=\"line\">\t,IF(sex<span class=\"operator\">=</span><span class=\"number\">1</span>,<span class=\"string\">&#x27;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> sex_name</span><br><span class=\"line\">\t,<span class=\"keyword\">CASE</span> dept_code</span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1001&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1002&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">WHEN</span> <span class=\"string\">&#x27;1003&#x27;</span> <span class=\"keyword\">THEN</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">ELSE</span> <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">\t<span class=\"keyword\">END</span> <span class=\"keyword\">AS</span> dept_name</span><br><span class=\"line\">\t,IF(is_post,<span class=\"string\">&#x27;&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">AS</span> is_post_name</span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span> tb_staff</span><br><span class=\"line\">;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><a href=\"https://blog.csdn.net/pan_junbiao/article/details/86132535\">https://blog.csdn.net/pan_junbiao/article/details/86132535</a></p>\n"},{"title":"java CurrencHashMap ","date":"2021-05-14T06:55:09.000Z","_content":"\n### \n\nJavaHashMapHashTableConcurrentHashMapConcurrentHashmap\n\n#### ConcurrentHashMap\n\n- HashMapputHashMapnextnullCPU100%HashMap\n\n- HashTablesynchronizedHashTable\n\n- ConcurrentHashMap\n\n###  \n\nConcurrentHashMap\n\nThe primary design goal of this hash table is to maintain concurrent readability(typically method get(), but also iterators and related methods) while minimizing update contention. Secondary goals are to keep space consumption about the same or better than java.util.HashMap, and to support high initial insertion rates on an empty table by many threads.\n\n ConcurrentHashMapget()HashMap\n\n####  Java7Java8ConcurrentHashMap\n\nConcurrentHashMap\n\nJava7ConcurrentHashMapSegmentHashEntrySegmentSegmentHashEntryHashEntrySegmentConcurrentHashMap\n\nJava8ConcurrentHashMapSegmentCASsynchronizedJava 8(8)O(N)O(long(N)))\n\n#### Java8ConcurrentHashMap\n\nJava8ConcurrentHashMapSegmentSegmentConcurrentHashMapNode(key-value)NodeNodeTreeNodes8TreeBinsTreeNodesTreeNodeConcurrentHashMapTreeBintreeNodeForwordingNodesConcurrentHashMapnextTable\n\n```java\nstatic class Node<K,V> implements Map.Entry<K,V> {\n        final int hash;\n        final K key;\n        volatile V val;  //volatile\n        volatile Node<K,V> next;  //volatile\n\n        Node(int hash, K key, V val) {\n            this.hash = hash;\n            this.key = key;\n            this.val = val;\n        }\n        Node(int hash, K key, V val, Node<K,V> next) {\n            this(hash, key, val);\n            this.next = next;\n        }\n        public final K getKey()     { return key; }\n        public final V getValue()   { return val; }\n        public final int hashCode() { return key.hashCode() ^ val.hashCode(); }\n        public final String toString() {...}\n        public final V setValue(V value) {...}\n\n        public final boolean equals(Object o) {...}\n\n        /**\n         * Virtualized support for map.get(); overridden in subclasses.\n         */\n        Node<K,V> find(int h, Object k) {...}\n    }\n```\n\nNodeNodeForwardingNodesForwardingNodesConcurrentHashMap\n\n```java\n /**\n     * A node inserted at head of bins during transfer operations.\n     */\n    static final class ForwardingNode<K,V> extends Node<K,V> {\n        final Node<K,V>[] nextTable;\n        ForwardingNode(Node<K,V>[] tab) {\n\t        //hashMOVED(-1)\n            super(MOVED, null, null);\n            this.nextTable = tab;\n        }\n\n        Node<K,V> find(int h, Object k) {\n            // loop to avoid arbitrarily deep recursion on forwarding nodes\n            //nextTablenextTablehash\n            outer: for (Node<K,V>[] tab = nextTable;;) {\n                Node<K,V> e; int n;\n                if (k == null || tab == null || (n = tab.length) == 0 ||\n                    (e = tabAt(tab, (n - 1) & h)) == null)\n                    return null;\n                for (;;) {\n                    int eh; K ek;\n                    if ((eh = e.hash) == h &&\n                        ((ek = e.key) == k || (ek != null && k.equals(ek))))\n                        return e;\n                    if (eh < 0) {\n                        if (e instanceof ForwardingNode) {\n                            tab = ((ForwardingNode<K,V>)e).nextTable;\n                            continue outer;\n                        }\n                        else\n                            return e.find(h, k);\n                    }\n                    if ((e = e.next) == null)\n                        return null;\n                }\n            }\n        }\n    }\n```\n\n### ConcurrentHashMap\n\nConcurrentHashMapConcurrentHashMap\n\n```java\nstatic final <K,V> Node<K,V> tabAt(Node<K,V>[] tab, int i) {\n        return (Node<K,V>)U.getObjectAcquire(tab, ((long)i << ASHIFT) + ABASE);\n    }\n\n    static final <K,V> boolean casTabAt(Node<K,V>[] tab, int i,\n                                        Node<K,V> c, Node<K,V> v) {\n        return U.compareAndSetObject(tab, ((long)i << ASHIFT) + ABASE, c, v);\n    }\n\n    static final <K,V> void setTabAt(Node<K,V>[] tab, int i, Node<K,V> v) {\n        U.putObjectRelease(tab, ((long)i << ASHIFT) + ABASE, v);\n    }\n```\n\n### ConcurrentHashMap\n\n**1.ConcurrentHashMap**\n\nsizeCtl\n\n```java\n /**\n     * Table initialization and resizing control.  When negative,the\n     * table is being initialized or resized: -1 for initialization,\n     * else -(1 + the number of active resizing threads). Otherwise,\n     * when table is null, holds the initial table size to use upon\n     * creation, or 0 for default. After initialization, holds the\n     * next element count value upon which to resize the table.\n     * HashHash;\n     * (-1,-NN-1)\n     * null0;\n     * \n     */\n    private transient volatile int sizeCtl;\n```\n\nConcurrentHashMap ConcurrentHashMapHashHashsizeCtlsizeCtl < 0SIZECTL-1HashsizeCtl\n\n```java\n/**\n     * Initializes table, using the size recorded in sizeCtl.\n     */\n    private final Node<K,V>[] initTable() {\n        Node<K,V>[] tab; int sc;\n        while ((tab = table) == null || tab.length == 0) {\n\t        //sizeCtl0\n            if ((sc = sizeCtl) < 0)\n                //yield()CPU\n                Thread.yield(); // lost initialization race; just spin\n            //SIZECTL-1\n            else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) {\n                try {\n                    if ((tab = table) == null || tab.length == 0) {\n                        int n = (sc > 0) ? sc : DEFAULT_CAPACITY;\n                        @SuppressWarnings(\"unchecked\")\n                        Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                        table = tab = nt;\n                        sc = n - (n >>> 2); //n-(1/4)n,(n * loadFactor)\n                    }\n                } finally {\n                    sizeCtl = sc; //sizeCtl\n                }\n                break;\n            }\n        }\n        return tab;\n    }\n```\n\n**2.Hash**\n\nhashConcurrentHashMap \n\n```java\nstatic final int spread(int h) {\n        return (h ^ (h >>> 16)) & HASH_BITS; \n    }\n```\n\n(length-1) & (h ^ (h >>> 16)) & HASH_BITS);\n\n### ConcurrentHashMapput\n\n- keyvaluenull\n\n- tablenulltable0tableinitTable()\n\n- Hashnull(CAS)\n\n- hash-1ForwaringNodes\n\n- nullJava88\n\n```java\n\t/** Implementation for put and putIfAbsent */\n\tfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n\t\t//\n        if (key == null || value == null) throw new NullPointerException();\n        //hash\n        int hash = spread(key.hashCode());\n        int binCount = 0; //\n        for (Node<K,V>[] tab = table;;) {\n            Node<K,V> f; int n, i, fh; K fk; V fv;\n            if (tab == null || (n = tab.length) == 0)\n                tab = initTable(); //Hash\n            else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n\t            //CASHash\n                if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value)))\n                    break;  // no lock when adding to empty bin(null)\n            }\n            else if ((fh = f.hash) == MOVED) //f.hash == -1 \n\t            //\n                tab = helpTransfer(tab, f);\n            else if (onlyIfAbsent && fh == hash &&  // check first node\n                     ((fk = f.key) == key || fk != null && key.equals(fk)) &&\n                     (fv = f.val) != null)\n                return fv;\n            else {\n                V oldVal = null;\n                //\n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        if (fh >= 0) {\n                            binCount = 1;\n                            for (Node<K,V> e = f;; ++binCount) {\n                                K ek;\n                                //hashhash\n                                if (e.hash == hash &&\n                                    ((ek = e.key) == key ||\n                                     (ek != null && key.equals(ek)))) {\n                                    oldVal = e.val;\n                                    if (!onlyIfAbsent)\n\t                                    //\n                                        e.val = value;\n                                    break;\n                                }\n                                Node<K,V> pred = e;\n                                //\n                                if ((e = e.next) == null) {\n                                    pred.next = new Node<K,V>(hash, key, value);\n                                    break;\n                                }\n                            }\n                        }\n                        //\n                        else if (f instanceof TreeBin) {\n                            Node<K,V> p;\n                            binCount = 2;\n                            if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                           value)) != null) {\n                                oldVal = p.val;\n                                if (!onlyIfAbsent)\n\t                                //\n                                    p.val = value;\n                            }\n                        }\n                        else if (f instanceof ReservationNode)\n                            throw new IllegalStateException(\"Recursive update\");\n                    }\n                }\n                if (binCount != 0) {\n\t                //8,\n                    if (binCount >= TREEIFY_THRESHOLD)\n                        treeifyBin(tab, i);\n                    if (oldVal != null)\n                        return oldVal; \n                    break;\n                }\n            }\n        }\n        addCount(1L, binCount);\n        return null;\n    }\n```\n\n### ConcurrentHashMap\n\nConcurrentHashMapcap * loadFactortransfer()puthelpTransfer()ConcurrentHashMap\n\n- (16)CPU(stride = (NCPU > 1) ? (n >>> 3) / NCPU : n)16\n\n- HashnextTablenextTablenullnextTable2\n\n- Hash(compareAndSetInt)while\n\n- HashForwardingNodes\n\n- hashMOVED(f.hash == -1)ForwardingNodes\n\n- HashMaphash&01i+nHash\n\n- \n\n```java\n/**\n     * Moves and/or copies the nodes in each bin to new table. See\n     * above for explanation.\n     */\n    private final void transfer(Node<K,V>[] tab, Node<K,V>[] nextTab) {\n        int n = tab.length, stride;\n        //CPU16\n        if ((stride = (NCPU > 1) ? (n >>> 3) / NCPU : n) < MIN_TRANSFER_STRIDE)\n            stride = MIN_TRANSFER_STRIDE; // subdivide range\n        if (nextTab == null) {            // initiating\n            try {\n                @SuppressWarnings(\"unchecked\")\n                //Hash2\n                Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n << 1];\n                nextTab = nt;\n            } catch (Throwable ex) {      // try to cope with OOME\n                sizeCtl = Integer.MAX_VALUE;\n                return;\n            }\n            nextTable = nextTab;\n            transferIndex = n;\n        }\n        int nextn = nextTab.length;\n        //ForwardingNodes\n        ForwardingNode<K,V> fwd = new ForwardingNode<K,V>(nextTab);\n        boolean advance = true; //\n        boolean finishing = false; // to ensure sweep before committing nextTab\n        for (int i = 0, bound = 0;;) {\n            Node<K,V> f; int fh;\n            //\n            while (advance) {\n                int nextIndex, nextBound;\n                //\n                if (--i >= bound || finishing)\n                    advance = false;\n                else if ((nextIndex = transferIndex) <= 0) {\n                //\n                    i = -1;\n                    advance = false;\n                }\n                else if (U.compareAndSetInt\n                         (this, TRANSFERINDEX, nextIndex,\n                          nextBound = (nextIndex > stride ?\n                                       nextIndex - stride : 0))) {\n                //transferIndex,\n                    bound = nextBound;\n                    i = nextIndex - 1;\n                    advance = false;\n                }\n            }\n            //\n            if (i < 0 || i >= n || i + n >= nextn) {\n                int sc;\n                //\n                if (finishing) {\n                    nextTable = null;\n                    table = nextTab;\n                    //sizeCtl\n                    sizeCtl = (n << 1) - (n >>> 1);\n                    return;\n                }\n                //\n                if (U.compareAndSetInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n                    if ((sc - 2) != resizeStamp(n) << RESIZE_STAMP_SHIFT)\n                        return;\n                    finishing = advance = true;\n                    i = n; // recheck before commit\n                }\n            }\n            //null,\n            else if ((f = tabAt(tab, i)) == null)\n                advance = casTabAt(tab, i, null, fwd);\n            //hash-1ForwardingNodes\n            else if ((fh = f.hash) == MOVED)\n                advance = true; // already processed\n            else {\n\t            //\n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        Node<K,V> ln, hn;\n                        if (fh >= 0) {\n\t                        //\n                            int runBit = fh & n;\n                            Node<K,V> lastRun = f; //\n                            for (Node<K,V> p = f.next; p != null; p = p.next) {\n                                int b = p.hash & n;\n                                //\n                                if (b != runBit) {\n                                    runBit = b;\n                                    lastRun = p;\n                                }\n                            }\n                            //runBit = 0,\n                            if (runBit == 0) {\n                                ln = lastRun;\n                                hn = null;\n                            }\n                            //runBit = 1,i+n\n                            else {\n                                hn = lastRun;\n                                ln = null;\n                            }\n                            //\n                            for (Node<K,V> p = f; p != lastRun; p = p.next) {\n                                int ph = p.hash; K pk = p.key; V pv = p.val;\n                                //()\n                                if ((ph & n) == 0)\n                                    ln = new Node<K,V>(ph, pk, pv, ln);\n                                    //(i+n)\n                                else\n                                    hn = new Node<K,V>(ph, pk, pv, hn);\n                            }\n                            //Hash\n                            setTabAt(nextTab, i, ln);\n                            setTabAt(nextTab, i + n, hn);\n                            //HashForwardingNodes\n                            setTabAt(tab, i, fwd);\n                            advance = true;\n                        }\n                        //\n                        else if (f instanceof TreeBin) {\n                            TreeBin<K,V> t = (TreeBin<K,V>)f;\n                            TreeNode<K,V> lo = null, loTail = null;\n                            TreeNode<K,V> hi = null, hiTail = null;\n                            int lc = 0, hc = 0;\n                            for (Node<K,V> e = t.first; e != null; e = e.next) {\n                                int h = e.hash;\n                                TreeNode<K,V> p = new TreeNode<K,V>\n                                    (h, e.key, e.val, null, null);\n                                //\n                                if ((h & n) == 0) {\n\t                                //\n                                    if ((p.prev = loTail) == null)\n                                        lo = p;\n                                    else\n                                        loTail.next = p;\n                                    loTail = p;\n                                    ++lc;\n                                }\n                                else {\n                                //\n                                    if ((p.prev = hiTail) == null)\n                                        hi = p;\n                                    else\n                                        hiTail.next = p;\n                                    hiTail = p;\n                                    ++hc;\n                                }\n                            }\n                            //\n                            ln = (lc <= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n                                (hc != 0) ? new TreeBin<K,V>(lo) : t;\n                            //\n                            hn = (hc <= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n                                (lc != 0) ? new TreeBin<K,V>(hi) : t;\n                            //Hash\n                            setTabAt(nextTab, i, ln);\n                            setTabAt(nextTab, i + n, hn);\n                            //HashForwardingNodes\n                            setTabAt(tab, i, fwd);\n                            advance = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n\n### ConcurrentHashMapget\n\nConcurrentHashMapgetHash\n\n- hash\n\n- hash0 ForwardingNodesfind\n\n- \n\n```java\n/**\n     * Returns the value to which the specified key is mapped,\n     * or {@code null} if this map contains no mapping for the key.\n     *\n     * <p>More formally, if this map contains a mapping from a key\n     * {@code k} to a value {@code v} such that {@code key.equals(k)},\n     * then this method returns {@code v}; otherwise it returns\n     * {@code null}.  (There can be at most one such mapping.)\n     *\n     * @throws NullPointerException if the specified key is null\n     */\n    public V get(Object key) {\n        Node<K,V>[] tab; Node<K,V> e, p; int n, eh; K ek;\n        int h = spread(key.hashCode());\n        //\n        if ((tab = table) != null && (n = tab.length) > 0 &&\n            (e = tabAt(tab, (n - 1) & h)) != null) {\n            if ((eh = e.hash) == h) {\n                if ((ek = e.key) == key || (ek != null && key.equals(ek)))\n                    return e.val;\n            }\n            //e.hash<0\n            else if (eh < 0)\n                return (p = e.find(h, key)) != null ? p.val : null;\n            //\n            while ((e = e.next) != null) {\n                if (e.hash == h &&\n                    ((ek = e.key) == key || (ek != null && key.equals(ek))))\n                    return e.val;\n            }\n        }\n        return null;\n    }\n```\n\n\n\n\nhttps://blog.csdn.net/programerxiaoer/article/details/80040090\n\n","source":"_posts/java/container/java-currenchashmap.md","raw":"---\ntitle: java CurrencHashMap \ndate: 2021-05-14 14:55:09\ncategories:\n  - java\n  - container\ntags:\n  - java\n  - Map\n---\n\n### \n\nJavaHashMapHashTableConcurrentHashMapConcurrentHashmap\n\n#### ConcurrentHashMap\n\n- HashMapputHashMapnextnullCPU100%HashMap\n\n- HashTablesynchronizedHashTable\n\n- ConcurrentHashMap\n\n###  \n\nConcurrentHashMap\n\nThe primary design goal of this hash table is to maintain concurrent readability(typically method get(), but also iterators and related methods) while minimizing update contention. Secondary goals are to keep space consumption about the same or better than java.util.HashMap, and to support high initial insertion rates on an empty table by many threads.\n\n ConcurrentHashMapget()HashMap\n\n####  Java7Java8ConcurrentHashMap\n\nConcurrentHashMap\n\nJava7ConcurrentHashMapSegmentHashEntrySegmentSegmentHashEntryHashEntrySegmentConcurrentHashMap\n\nJava8ConcurrentHashMapSegmentCASsynchronizedJava 8(8)O(N)O(long(N)))\n\n#### Java8ConcurrentHashMap\n\nJava8ConcurrentHashMapSegmentSegmentConcurrentHashMapNode(key-value)NodeNodeTreeNodes8TreeBinsTreeNodesTreeNodeConcurrentHashMapTreeBintreeNodeForwordingNodesConcurrentHashMapnextTable\n\n```java\nstatic class Node<K,V> implements Map.Entry<K,V> {\n        final int hash;\n        final K key;\n        volatile V val;  //volatile\n        volatile Node<K,V> next;  //volatile\n\n        Node(int hash, K key, V val) {\n            this.hash = hash;\n            this.key = key;\n            this.val = val;\n        }\n        Node(int hash, K key, V val, Node<K,V> next) {\n            this(hash, key, val);\n            this.next = next;\n        }\n        public final K getKey()     { return key; }\n        public final V getValue()   { return val; }\n        public final int hashCode() { return key.hashCode() ^ val.hashCode(); }\n        public final String toString() {...}\n        public final V setValue(V value) {...}\n\n        public final boolean equals(Object o) {...}\n\n        /**\n         * Virtualized support for map.get(); overridden in subclasses.\n         */\n        Node<K,V> find(int h, Object k) {...}\n    }\n```\n\nNodeNodeForwardingNodesForwardingNodesConcurrentHashMap\n\n```java\n /**\n     * A node inserted at head of bins during transfer operations.\n     */\n    static final class ForwardingNode<K,V> extends Node<K,V> {\n        final Node<K,V>[] nextTable;\n        ForwardingNode(Node<K,V>[] tab) {\n\t        //hashMOVED(-1)\n            super(MOVED, null, null);\n            this.nextTable = tab;\n        }\n\n        Node<K,V> find(int h, Object k) {\n            // loop to avoid arbitrarily deep recursion on forwarding nodes\n            //nextTablenextTablehash\n            outer: for (Node<K,V>[] tab = nextTable;;) {\n                Node<K,V> e; int n;\n                if (k == null || tab == null || (n = tab.length) == 0 ||\n                    (e = tabAt(tab, (n - 1) & h)) == null)\n                    return null;\n                for (;;) {\n                    int eh; K ek;\n                    if ((eh = e.hash) == h &&\n                        ((ek = e.key) == k || (ek != null && k.equals(ek))))\n                        return e;\n                    if (eh < 0) {\n                        if (e instanceof ForwardingNode) {\n                            tab = ((ForwardingNode<K,V>)e).nextTable;\n                            continue outer;\n                        }\n                        else\n                            return e.find(h, k);\n                    }\n                    if ((e = e.next) == null)\n                        return null;\n                }\n            }\n        }\n    }\n```\n\n### ConcurrentHashMap\n\nConcurrentHashMapConcurrentHashMap\n\n```java\nstatic final <K,V> Node<K,V> tabAt(Node<K,V>[] tab, int i) {\n        return (Node<K,V>)U.getObjectAcquire(tab, ((long)i << ASHIFT) + ABASE);\n    }\n\n    static final <K,V> boolean casTabAt(Node<K,V>[] tab, int i,\n                                        Node<K,V> c, Node<K,V> v) {\n        return U.compareAndSetObject(tab, ((long)i << ASHIFT) + ABASE, c, v);\n    }\n\n    static final <K,V> void setTabAt(Node<K,V>[] tab, int i, Node<K,V> v) {\n        U.putObjectRelease(tab, ((long)i << ASHIFT) + ABASE, v);\n    }\n```\n\n### ConcurrentHashMap\n\n**1.ConcurrentHashMap**\n\nsizeCtl\n\n```java\n /**\n     * Table initialization and resizing control.  When negative,the\n     * table is being initialized or resized: -1 for initialization,\n     * else -(1 + the number of active resizing threads). Otherwise,\n     * when table is null, holds the initial table size to use upon\n     * creation, or 0 for default. After initialization, holds the\n     * next element count value upon which to resize the table.\n     * HashHash;\n     * (-1,-NN-1)\n     * null0;\n     * \n     */\n    private transient volatile int sizeCtl;\n```\n\nConcurrentHashMap ConcurrentHashMapHashHashsizeCtlsizeCtl < 0SIZECTL-1HashsizeCtl\n\n```java\n/**\n     * Initializes table, using the size recorded in sizeCtl.\n     */\n    private final Node<K,V>[] initTable() {\n        Node<K,V>[] tab; int sc;\n        while ((tab = table) == null || tab.length == 0) {\n\t        //sizeCtl0\n            if ((sc = sizeCtl) < 0)\n                //yield()CPU\n                Thread.yield(); // lost initialization race; just spin\n            //SIZECTL-1\n            else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) {\n                try {\n                    if ((tab = table) == null || tab.length == 0) {\n                        int n = (sc > 0) ? sc : DEFAULT_CAPACITY;\n                        @SuppressWarnings(\"unchecked\")\n                        Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n];\n                        table = tab = nt;\n                        sc = n - (n >>> 2); //n-(1/4)n,(n * loadFactor)\n                    }\n                } finally {\n                    sizeCtl = sc; //sizeCtl\n                }\n                break;\n            }\n        }\n        return tab;\n    }\n```\n\n**2.Hash**\n\nhashConcurrentHashMap \n\n```java\nstatic final int spread(int h) {\n        return (h ^ (h >>> 16)) & HASH_BITS; \n    }\n```\n\n(length-1) & (h ^ (h >>> 16)) & HASH_BITS);\n\n### ConcurrentHashMapput\n\n- keyvaluenull\n\n- tablenulltable0tableinitTable()\n\n- Hashnull(CAS)\n\n- hash-1ForwaringNodes\n\n- nullJava88\n\n```java\n\t/** Implementation for put and putIfAbsent */\n\tfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n\t\t//\n        if (key == null || value == null) throw new NullPointerException();\n        //hash\n        int hash = spread(key.hashCode());\n        int binCount = 0; //\n        for (Node<K,V>[] tab = table;;) {\n            Node<K,V> f; int n, i, fh; K fk; V fv;\n            if (tab == null || (n = tab.length) == 0)\n                tab = initTable(); //Hash\n            else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n\t            //CASHash\n                if (casTabAt(tab, i, null, new Node<K,V>(hash, key, value)))\n                    break;  // no lock when adding to empty bin(null)\n            }\n            else if ((fh = f.hash) == MOVED) //f.hash == -1 \n\t            //\n                tab = helpTransfer(tab, f);\n            else if (onlyIfAbsent && fh == hash &&  // check first node\n                     ((fk = f.key) == key || fk != null && key.equals(fk)) &&\n                     (fv = f.val) != null)\n                return fv;\n            else {\n                V oldVal = null;\n                //\n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        if (fh >= 0) {\n                            binCount = 1;\n                            for (Node<K,V> e = f;; ++binCount) {\n                                K ek;\n                                //hashhash\n                                if (e.hash == hash &&\n                                    ((ek = e.key) == key ||\n                                     (ek != null && key.equals(ek)))) {\n                                    oldVal = e.val;\n                                    if (!onlyIfAbsent)\n\t                                    //\n                                        e.val = value;\n                                    break;\n                                }\n                                Node<K,V> pred = e;\n                                //\n                                if ((e = e.next) == null) {\n                                    pred.next = new Node<K,V>(hash, key, value);\n                                    break;\n                                }\n                            }\n                        }\n                        //\n                        else if (f instanceof TreeBin) {\n                            Node<K,V> p;\n                            binCount = 2;\n                            if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                           value)) != null) {\n                                oldVal = p.val;\n                                if (!onlyIfAbsent)\n\t                                //\n                                    p.val = value;\n                            }\n                        }\n                        else if (f instanceof ReservationNode)\n                            throw new IllegalStateException(\"Recursive update\");\n                    }\n                }\n                if (binCount != 0) {\n\t                //8,\n                    if (binCount >= TREEIFY_THRESHOLD)\n                        treeifyBin(tab, i);\n                    if (oldVal != null)\n                        return oldVal; \n                    break;\n                }\n            }\n        }\n        addCount(1L, binCount);\n        return null;\n    }\n```\n\n### ConcurrentHashMap\n\nConcurrentHashMapcap * loadFactortransfer()puthelpTransfer()ConcurrentHashMap\n\n- (16)CPU(stride = (NCPU > 1) ? (n >>> 3) / NCPU : n)16\n\n- HashnextTablenextTablenullnextTable2\n\n- Hash(compareAndSetInt)while\n\n- HashForwardingNodes\n\n- hashMOVED(f.hash == -1)ForwardingNodes\n\n- HashMaphash&01i+nHash\n\n- \n\n```java\n/**\n     * Moves and/or copies the nodes in each bin to new table. See\n     * above for explanation.\n     */\n    private final void transfer(Node<K,V>[] tab, Node<K,V>[] nextTab) {\n        int n = tab.length, stride;\n        //CPU16\n        if ((stride = (NCPU > 1) ? (n >>> 3) / NCPU : n) < MIN_TRANSFER_STRIDE)\n            stride = MIN_TRANSFER_STRIDE; // subdivide range\n        if (nextTab == null) {            // initiating\n            try {\n                @SuppressWarnings(\"unchecked\")\n                //Hash2\n                Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n << 1];\n                nextTab = nt;\n            } catch (Throwable ex) {      // try to cope with OOME\n                sizeCtl = Integer.MAX_VALUE;\n                return;\n            }\n            nextTable = nextTab;\n            transferIndex = n;\n        }\n        int nextn = nextTab.length;\n        //ForwardingNodes\n        ForwardingNode<K,V> fwd = new ForwardingNode<K,V>(nextTab);\n        boolean advance = true; //\n        boolean finishing = false; // to ensure sweep before committing nextTab\n        for (int i = 0, bound = 0;;) {\n            Node<K,V> f; int fh;\n            //\n            while (advance) {\n                int nextIndex, nextBound;\n                //\n                if (--i >= bound || finishing)\n                    advance = false;\n                else if ((nextIndex = transferIndex) <= 0) {\n                //\n                    i = -1;\n                    advance = false;\n                }\n                else if (U.compareAndSetInt\n                         (this, TRANSFERINDEX, nextIndex,\n                          nextBound = (nextIndex > stride ?\n                                       nextIndex - stride : 0))) {\n                //transferIndex,\n                    bound = nextBound;\n                    i = nextIndex - 1;\n                    advance = false;\n                }\n            }\n            //\n            if (i < 0 || i >= n || i + n >= nextn) {\n                int sc;\n                //\n                if (finishing) {\n                    nextTable = null;\n                    table = nextTab;\n                    //sizeCtl\n                    sizeCtl = (n << 1) - (n >>> 1);\n                    return;\n                }\n                //\n                if (U.compareAndSetInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n                    if ((sc - 2) != resizeStamp(n) << RESIZE_STAMP_SHIFT)\n                        return;\n                    finishing = advance = true;\n                    i = n; // recheck before commit\n                }\n            }\n            //null,\n            else if ((f = tabAt(tab, i)) == null)\n                advance = casTabAt(tab, i, null, fwd);\n            //hash-1ForwardingNodes\n            else if ((fh = f.hash) == MOVED)\n                advance = true; // already processed\n            else {\n\t            //\n                synchronized (f) {\n                    if (tabAt(tab, i) == f) {\n                        Node<K,V> ln, hn;\n                        if (fh >= 0) {\n\t                        //\n                            int runBit = fh & n;\n                            Node<K,V> lastRun = f; //\n                            for (Node<K,V> p = f.next; p != null; p = p.next) {\n                                int b = p.hash & n;\n                                //\n                                if (b != runBit) {\n                                    runBit = b;\n                                    lastRun = p;\n                                }\n                            }\n                            //runBit = 0,\n                            if (runBit == 0) {\n                                ln = lastRun;\n                                hn = null;\n                            }\n                            //runBit = 1,i+n\n                            else {\n                                hn = lastRun;\n                                ln = null;\n                            }\n                            //\n                            for (Node<K,V> p = f; p != lastRun; p = p.next) {\n                                int ph = p.hash; K pk = p.key; V pv = p.val;\n                                //()\n                                if ((ph & n) == 0)\n                                    ln = new Node<K,V>(ph, pk, pv, ln);\n                                    //(i+n)\n                                else\n                                    hn = new Node<K,V>(ph, pk, pv, hn);\n                            }\n                            //Hash\n                            setTabAt(nextTab, i, ln);\n                            setTabAt(nextTab, i + n, hn);\n                            //HashForwardingNodes\n                            setTabAt(tab, i, fwd);\n                            advance = true;\n                        }\n                        //\n                        else if (f instanceof TreeBin) {\n                            TreeBin<K,V> t = (TreeBin<K,V>)f;\n                            TreeNode<K,V> lo = null, loTail = null;\n                            TreeNode<K,V> hi = null, hiTail = null;\n                            int lc = 0, hc = 0;\n                            for (Node<K,V> e = t.first; e != null; e = e.next) {\n                                int h = e.hash;\n                                TreeNode<K,V> p = new TreeNode<K,V>\n                                    (h, e.key, e.val, null, null);\n                                //\n                                if ((h & n) == 0) {\n\t                                //\n                                    if ((p.prev = loTail) == null)\n                                        lo = p;\n                                    else\n                                        loTail.next = p;\n                                    loTail = p;\n                                    ++lc;\n                                }\n                                else {\n                                //\n                                    if ((p.prev = hiTail) == null)\n                                        hi = p;\n                                    else\n                                        hiTail.next = p;\n                                    hiTail = p;\n                                    ++hc;\n                                }\n                            }\n                            //\n                            ln = (lc <= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n                                (hc != 0) ? new TreeBin<K,V>(lo) : t;\n                            //\n                            hn = (hc <= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n                                (lc != 0) ? new TreeBin<K,V>(hi) : t;\n                            //Hash\n                            setTabAt(nextTab, i, ln);\n                            setTabAt(nextTab, i + n, hn);\n                            //HashForwardingNodes\n                            setTabAt(tab, i, fwd);\n                            advance = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n\n### ConcurrentHashMapget\n\nConcurrentHashMapgetHash\n\n- hash\n\n- hash0 ForwardingNodesfind\n\n- \n\n```java\n/**\n     * Returns the value to which the specified key is mapped,\n     * or {@code null} if this map contains no mapping for the key.\n     *\n     * <p>More formally, if this map contains a mapping from a key\n     * {@code k} to a value {@code v} such that {@code key.equals(k)},\n     * then this method returns {@code v}; otherwise it returns\n     * {@code null}.  (There can be at most one such mapping.)\n     *\n     * @throws NullPointerException if the specified key is null\n     */\n    public V get(Object key) {\n        Node<K,V>[] tab; Node<K,V> e, p; int n, eh; K ek;\n        int h = spread(key.hashCode());\n        //\n        if ((tab = table) != null && (n = tab.length) > 0 &&\n            (e = tabAt(tab, (n - 1) & h)) != null) {\n            if ((eh = e.hash) == h) {\n                if ((ek = e.key) == key || (ek != null && key.equals(ek)))\n                    return e.val;\n            }\n            //e.hash<0\n            else if (eh < 0)\n                return (p = e.find(h, key)) != null ? p.val : null;\n            //\n            while ((e = e.next) != null) {\n                if (e.hash == h &&\n                    ((ek = e.key) == key || (ek != null && key.equals(ek))))\n                    return e.val;\n            }\n        }\n        return null;\n    }\n```\n\n\n\n\nhttps://blog.csdn.net/programerxiaoer/article/details/80040090\n\n","slug":"java/container/java-currenchashmap","published":1,"updated":"2022-05-10T08:25:56.390Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p8001sxkloh7tsdu6y","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JavaHashMapHashTableConcurrentHashMapConcurrentHashmap</p>\n<h4 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h4><ul>\n<li><p>HashMapputHashMapnextnullCPU100%HashMap</p>\n</li>\n<li><p>HashTablesynchronizedHashTable</p>\n</li>\n<li><p>ConcurrentHashMap</p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ConcurrentHashMap</p>\n<p>The primary design goal of this hash table is to maintain concurrent readability(typically method get(), but also iterators and related methods) while minimizing update contention. Secondary goals are to keep space consumption about the same or better than java.util.HashMap, and to support high initial insertion rates on an empty table by many threads.</p>\n<p> ConcurrentHashMapget()HashMap</p>\n<h4 id=\"Java7Java8ConcurrentHashMap\"><a href=\"#Java7Java8ConcurrentHashMap\" class=\"headerlink\" title=\"Java7Java8ConcurrentHashMap\"></a>Java7Java8ConcurrentHashMap</h4><p>ConcurrentHashMap</p>\n<p>Java7ConcurrentHashMapSegmentHashEntrySegmentSegmentHashEntryHashEntrySegmentConcurrentHashMap</p>\n<p>Java8ConcurrentHashMapSegmentCASsynchronizedJava 8(8)O(N)O(long(N)))</p>\n<h4 id=\"Java8ConcurrentHashMap\"><a href=\"#Java8ConcurrentHashMap\" class=\"headerlink\" title=\"Java8ConcurrentHashMap\"></a>Java8ConcurrentHashMap</h4><p>Java8ConcurrentHashMapSegmentSegmentConcurrentHashMapNode(key-value)NodeNodeTreeNodes8TreeBinsTreeNodesTreeNodeConcurrentHashMapTreeBintreeNodeForwordingNodesConcurrentHashMapnextTable</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> hash;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">        <span class=\"keyword\">volatile</span> V val;  <span class=\"comment\">//volatile</span></span><br><span class=\"line\">        <span class=\"keyword\">volatile</span> Node&lt;K,V&gt; next;  <span class=\"comment\">//volatile</span></span><br><span class=\"line\"></span><br><span class=\"line\">        Node(<span class=\"type\">int</span> hash, K key, V val) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hash = hash;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.val = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Node(<span class=\"type\">int</span> hash, K key, V val, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>(hash, key, val);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.next = next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title function_\">getKey</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">getValue</span><span class=\"params\">()</span>   &#123; <span class=\"keyword\">return</span> val; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hashCode</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> key.hashCode() ^ val.hashCode(); &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;...&#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">setValue</span><span class=\"params\">(V value)</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object o)</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Virtualized support for map.get(); overridden in subclasses.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        Node&lt;K,V&gt; <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">int</span> h, Object k)</span> &#123;...&#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>NodeNodeForwardingNodesForwardingNodesConcurrentHashMap</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * A node inserted at head of bins during transfer operations.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ForwardingNode</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; &#123;</span><br><span class=\"line\">       <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class=\"line\">       ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//hashMOVED(-1)</span></span><br><span class=\"line\">           <span class=\"built_in\">super</span>(MOVED, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">           <span class=\"built_in\">this</span>.nextTable = tab;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       Node&lt;K,V&gt; <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">int</span> h, Object k)</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// loop to avoid arbitrarily deep recursion on forwarding nodes</span></span><br><span class=\"line\">           <span class=\"comment\">//nextTablenextTablehash</span></span><br><span class=\"line\">           outer: <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = nextTable;;) &#123;</span><br><span class=\"line\">               Node&lt;K,V&gt; e; <span class=\"type\">int</span> n;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (k == <span class=\"literal\">null</span> || tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span> ||</span><br><span class=\"line\">                   (e = tabAt(tab, (n - <span class=\"number\">1</span>) &amp; h)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                   <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                   <span class=\"type\">int</span> eh; K ek;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> ((eh = e.hash) == h &amp;&amp;</span><br><span class=\"line\">                       ((ek = e.key) == k || (ek != <span class=\"literal\">null</span> &amp;&amp; k.equals(ek))))</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (eh &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                       <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> ForwardingNode) &#123;</span><br><span class=\"line\">                           tab = ((ForwardingNode&lt;K,V&gt;)e).nextTable;</span><br><span class=\"line\">                           <span class=\"keyword\">continue</span> outer;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"keyword\">else</span></span><br><span class=\"line\">                           <span class=\"keyword\">return</span> e.find(h, k);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p>ConcurrentHashMapConcurrentHashMap</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; Node&lt;K,V&gt; <span class=\"title function_\">tabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Node&lt;K,V&gt;)U.getObjectAcquire(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; <span class=\"type\">boolean</span> <span class=\"title function_\">casTabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i,</span></span><br><span class=\"line\"><span class=\"params\">                                        Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> U.compareAndSetObject(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setTabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i, Node&lt;K,V&gt; v)</span> &#123;</span><br><span class=\"line\">        U.putObjectRelease(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE, v);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p><strong>1.ConcurrentHashMap</strong></p>\n<p>sizeCtl</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * Table initialization and resizing control.  When negative,the</span></span><br><span class=\"line\"><span class=\"comment\">    * table is being initialized or resized: -1 for initialization,</span></span><br><span class=\"line\"><span class=\"comment\">    * else -(1 + the number of active resizing threads). Otherwise,</span></span><br><span class=\"line\"><span class=\"comment\">    * when table is null, holds the initial table size to use upon</span></span><br><span class=\"line\"><span class=\"comment\">    * creation, or 0 for default. After initialization, holds the</span></span><br><span class=\"line\"><span class=\"comment\">    * next element count value upon which to resize the table.</span></span><br><span class=\"line\"><span class=\"comment\">    * HashHash;</span></span><br><span class=\"line\"><span class=\"comment\">    * (-1,-NN-1)</span></span><br><span class=\"line\"><span class=\"comment\">    * null0;</span></span><br><span class=\"line\"><span class=\"comment\">    * </span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> sizeCtl;</span><br></pre></td></tr></table></figure>\n\n<p>ConcurrentHashMap ConcurrentHashMapHashHashsizeCtlsizeCtl &lt; 0SIZECTL-1HashsizeCtl</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Initializes table, using the size recorded in sizeCtl.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; <span class=\"type\">int</span> sc;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((tab = table) == <span class=\"literal\">null</span> || tab.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t        <span class=\"comment\">//sizeCtl0</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((sc = sizeCtl) &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"comment\">//yield()CPU</span></span><br><span class=\"line\">                Thread.yield(); <span class=\"comment\">// lost initialization race; just spin</span></span><br><span class=\"line\">            <span class=\"comment\">//SIZECTL-1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSetInt(<span class=\"built_in\">this</span>, SIZECTL, sc, -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || tab.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> (sc &gt; <span class=\"number\">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class=\"line\">                        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n];</span><br><span class=\"line\">                        table = tab = nt;</span><br><span class=\"line\">                        sc = n - (n &gt;&gt;&gt; <span class=\"number\">2</span>); <span class=\"comment\">//n-(1/4)n,(n * loadFactor)</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    sizeCtl = sc; <span class=\"comment\">//sizeCtl</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> tab;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2.Hash</strong></p>\n<p>hashConcurrentHashMap </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">spread</span><span class=\"params\">(<span class=\"type\">int</span> h)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (h ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>)) &amp; HASH_BITS; </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>(length-1) &amp; (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS);</p>\n<h3 id=\"ConcurrentHashMapput\"><a href=\"#ConcurrentHashMapput\" class=\"headerlink\" title=\"ConcurrentHashMapput\"></a>ConcurrentHashMapput</h3><ul>\n<li><p>keyvaluenull</p>\n</li>\n<li><p>tablenulltable0tableinitTable()</p>\n</li>\n<li><p>Hashnull(CAS)</p>\n</li>\n<li><p>hash-1ForwaringNodes</p>\n</li>\n<li><p>nullJava88</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** Implementation for put and putIfAbsent */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || value == <span class=\"literal\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">       <span class=\"comment\">//hash</span></span><br><span class=\"line\">       <span class=\"type\">int</span> <span class=\"variable\">hash</span> <span class=\"operator\">=</span> spread(key.hashCode());</span><br><span class=\"line\">       <span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">       <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class=\"line\">           Node&lt;K,V&gt; f; <span class=\"type\">int</span> n, i, fh; K fk; V fv;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">               tab = initTable(); <span class=\"comment\">//Hash</span></span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i = (n - <span class=\"number\">1</span>) &amp; hash)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//CASHash</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span> (casTabAt(tab, i, <span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value)))</span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;  <span class=\"comment\">// no lock when adding to empty bin(null)</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED) <span class=\"comment\">//f.hash == -1 </span></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">               tab = helpTransfer(tab, f);</span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (onlyIfAbsent &amp;&amp; fh == hash &amp;&amp;  <span class=\"comment\">// check first node</span></span><br><span class=\"line\">                    ((fk = f.key) == key || fk != <span class=\"literal\">null</span> &amp;&amp; key.equals(fk)) &amp;&amp;</span><br><span class=\"line\">                    (fv = f.val) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">               <span class=\"keyword\">return</span> fv;</span><br><span class=\"line\">           <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               <span class=\"type\">V</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               <span class=\"comment\">//</span></span><br><span class=\"line\">               <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                       <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                           binCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">                           <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class=\"line\">                               K ek;</span><br><span class=\"line\">                               <span class=\"comment\">//hashhash</span></span><br><span class=\"line\">                               <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                                   ((ek = e.key) == key ||</span><br><span class=\"line\">                                    (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class=\"line\">                                   oldVal = e.val;</span><br><span class=\"line\">                                   <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                    <span class=\"comment\">//</span></span><br><span class=\"line\">                                       e.val = value;</span><br><span class=\"line\">                                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                               &#125;</span><br><span class=\"line\">                               Node&lt;K,V&gt; pred = e;</span><br><span class=\"line\">                               <span class=\"comment\">//</span></span><br><span class=\"line\">                               <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                                   pred.next = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value);</span><br><span class=\"line\">                                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                               &#125;</span><br><span class=\"line\">                           &#125;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"comment\">//</span></span><br><span class=\"line\">                       <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;</span><br><span class=\"line\">                           Node&lt;K,V&gt; p;</span><br><span class=\"line\">                           binCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">                           <span class=\"keyword\">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class=\"line\">                                                          value)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                               oldVal = p.val;</span><br><span class=\"line\">                               <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                   p.val = value;</span><br><span class=\"line\">                           &#125;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> ReservationNode)</span><br><span class=\"line\">                           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Recursive update&quot;</span>);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (binCount != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//8,</span></span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class=\"line\">                       treeifyBin(tab, i);</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (oldVal != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> oldVal; </span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       addCount(<span class=\"number\">1L</span>, binCount);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p>ConcurrentHashMapcap * loadFactortransfer()puthelpTransfer()ConcurrentHashMap</p>\n<ul>\n<li><p>(16)CPU(stride &#x3D; (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) &#x2F; NCPU : n)16</p>\n</li>\n<li><p>HashnextTablenextTablenullnextTable2</p>\n</li>\n<li><p>Hash(compareAndSetInt)while</p>\n</li>\n<li><p>HashForwardingNodes</p>\n</li>\n<li><p>hashMOVED(f.hash &#x3D;&#x3D; -1)ForwardingNodes</p>\n</li>\n<li><p>HashMaphash&amp;01i+nHash</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Moves and/or copies the nodes in each bin to new table. See</span></span><br><span class=\"line\"><span class=\"comment\">     * above for explanation.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">transfer</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> tab.length, stride;</span><br><span class=\"line\">        <span class=\"comment\">//CPU16</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((stride = (NCPU &gt; <span class=\"number\">1</span>) ? (n &gt;&gt;&gt; <span class=\"number\">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)</span><br><span class=\"line\">            stride = MIN_TRANSFER_STRIDE; <span class=\"comment\">// subdivide range</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nextTab == <span class=\"literal\">null</span>) &#123;            <span class=\"comment\">// initiating</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"comment\">//Hash2</span></span><br><span class=\"line\">                Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n &lt;&lt; <span class=\"number\">1</span>];</span><br><span class=\"line\">                nextTab = nt;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;      <span class=\"comment\">// try to cope with OOME</span></span><br><span class=\"line\">                sizeCtl = Integer.MAX_VALUE;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            nextTable = nextTab;</span><br><span class=\"line\">            transferIndex = n;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">nextn</span> <span class=\"operator\">=</span> nextTab.length;</span><br><span class=\"line\">        <span class=\"comment\">//ForwardingNodes</span></span><br><span class=\"line\">        ForwardingNode&lt;K,V&gt; fwd = <span class=\"keyword\">new</span> <span class=\"title class_\">ForwardingNode</span>&lt;K,V&gt;(nextTab);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">advance</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">finishing</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>; <span class=\"comment\">// to ensure sweep before committing nextTab</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, bound = <span class=\"number\">0</span>;;) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; f; <span class=\"type\">int</span> fh;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (advance) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> nextIndex, nextBound;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (--i &gt;= bound || finishing)</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((nextIndex = transferIndex) &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                    i = -<span class=\"number\">1</span>;</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSetInt</span><br><span class=\"line\">                         (<span class=\"built_in\">this</span>, TRANSFERINDEX, nextIndex,</span><br><span class=\"line\">                          nextBound = (nextIndex &gt; stride ?</span><br><span class=\"line\">                                       nextIndex - stride : <span class=\"number\">0</span>))) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//transferIndex,</span></span><br><span class=\"line\">                    bound = nextBound;</span><br><span class=\"line\">                    i = nextIndex - <span class=\"number\">1</span>;</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i &lt; <span class=\"number\">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> sc;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (finishing) &#123;</span><br><span class=\"line\">                    nextTable = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    table = nextTab;</span><br><span class=\"line\">                    <span class=\"comment\">//sizeCtl</span></span><br><span class=\"line\">                    sizeCtl = (n &lt;&lt; <span class=\"number\">1</span>) - (n &gt;&gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (U.compareAndSetInt(<span class=\"built_in\">this</span>, SIZECTL, sc = sizeCtl, sc - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((sc - <span class=\"number\">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    finishing = advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    i = n; <span class=\"comment\">// recheck before commit</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//null,</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                advance = casTabAt(tab, i, <span class=\"literal\">null</span>, fwd);</span><br><span class=\"line\">            <span class=\"comment\">//hash-1ForwardingNodes</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED)</span><br><span class=\"line\">                advance = <span class=\"literal\">true</span>; <span class=\"comment\">// already processed</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t            <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                        Node&lt;K,V&gt; ln, hn;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t                        <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"type\">int</span> <span class=\"variable\">runBit</span> <span class=\"operator\">=</span> fh &amp; n;</span><br><span class=\"line\">                            Node&lt;K,V&gt; lastRun = f; <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class=\"literal\">null</span>; p = p.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> p.hash &amp; n;</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (b != runBit) &#123;</span><br><span class=\"line\">                                    runBit = b;</span><br><span class=\"line\">                                    lastRun = p;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//runBit = 0,</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (runBit == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                                ln = lastRun;</span><br><span class=\"line\">                                hn = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//runBit = 1,i+n</span></span><br><span class=\"line\">                            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                hn = lastRun;</span><br><span class=\"line\">                                ln = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">ph</span> <span class=\"operator\">=</span> p.hash; <span class=\"type\">K</span> <span class=\"variable\">pk</span> <span class=\"operator\">=</span> p.key; <span class=\"type\">V</span> <span class=\"variable\">pv</span> <span class=\"operator\">=</span> p.val;</span><br><span class=\"line\">                                <span class=\"comment\">//()</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((ph &amp; n) == <span class=\"number\">0</span>)</span><br><span class=\"line\">                                    ln = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(ph, pk, pv, ln);</span><br><span class=\"line\">                                    <span class=\"comment\">//(i+n)</span></span><br><span class=\"line\">                                <span class=\"keyword\">else</span></span><br><span class=\"line\">                                    hn = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(ph, pk, pv, hn);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//Hash</span></span><br><span class=\"line\">                            setTabAt(nextTab, i, ln);</span><br><span class=\"line\">                            setTabAt(nextTab, i + n, hn);</span><br><span class=\"line\">                            <span class=\"comment\">//HashForwardingNodes</span></span><br><span class=\"line\">                            setTabAt(tab, i, fwd);</span><br><span class=\"line\">                            advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;</span><br><span class=\"line\">                            TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;</span><br><span class=\"line\">                            TreeNode&lt;K,V&gt; lo = <span class=\"literal\">null</span>, loTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            TreeNode&lt;K,V&gt; hi = <span class=\"literal\">null</span>, hiTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            <span class=\"type\">int</span> <span class=\"variable\">lc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, hc = <span class=\"number\">0</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> e.hash;</span><br><span class=\"line\">                                TreeNode&lt;K,V&gt; p = <span class=\"keyword\">new</span> <span class=\"title class_\">TreeNode</span>&lt;K,V&gt;</span><br><span class=\"line\">                                    (h, e.key, e.val, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((h &amp; n) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> ((p.prev = loTail) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                        lo = p;</span><br><span class=\"line\">                                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                                        loTail.next = p;</span><br><span class=\"line\">                                    loTail = p;</span><br><span class=\"line\">                                    ++lc;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> ((p.prev = hiTail) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                        hi = p;</span><br><span class=\"line\">                                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                                        hiTail.next = p;</span><br><span class=\"line\">                                    hiTail = p;</span><br><span class=\"line\">                                    ++hc;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :</span><br><span class=\"line\">                                (hc != <span class=\"number\">0</span>) ? <span class=\"keyword\">new</span> <span class=\"title class_\">TreeBin</span>&lt;K,V&gt;(lo) : t;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :</span><br><span class=\"line\">                                (lc != <span class=\"number\">0</span>) ? <span class=\"keyword\">new</span> <span class=\"title class_\">TreeBin</span>&lt;K,V&gt;(hi) : t;</span><br><span class=\"line\">                            <span class=\"comment\">//Hash</span></span><br><span class=\"line\">                            setTabAt(nextTab, i, ln);</span><br><span class=\"line\">                            setTabAt(nextTab, i + n, hn);</span><br><span class=\"line\">                            <span class=\"comment\">//HashForwardingNodes</span></span><br><span class=\"line\">                            setTabAt(tab, i, fwd);</span><br><span class=\"line\">                            advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMapget\"><a href=\"#ConcurrentHashMapget\" class=\"headerlink\" title=\"ConcurrentHashMapget\"></a>ConcurrentHashMapget</h3><p>ConcurrentHashMapgetHash</p>\n<ul>\n<li><p>hash</p>\n</li>\n<li><p>hash0 ForwardingNodesfind</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Returns the value to which the specified key is mapped,</span></span><br><span class=\"line\"><span class=\"comment\">     * or &#123;<span class=\"doctag\">@code</span> null&#125; if this map contains no mapping for the key.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;More formally, if this map contains a mapping from a key</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@code</span> k&#125; to a value &#123;<span class=\"doctag\">@code</span> v&#125; such that &#123;<span class=\"doctag\">@code</span> key.equals(k)&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">     * then this method returns &#123;<span class=\"doctag\">@code</span> v&#125;; otherwise it returns</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@code</span> null&#125;.  (There can be at most one such mapping.)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> NullPointerException if the specified key is null</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class=\"type\">int</span> n, eh; K ek;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> spread(key.hashCode());</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (e = tabAt(tab, (n - <span class=\"number\">1</span>) &amp; h)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((eh = e.hash) == h) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((ek = e.key) == key || (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e.val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//e.hash&lt;0</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (eh &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> (p = e.find(h, key)) != <span class=\"literal\">null</span> ? p.val : <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == h &amp;&amp;</span><br><span class=\"line\">                    ((ek = e.key) == key || (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek))))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e.val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n<p><a href=\"https://blog.csdn.net/programerxiaoer/article/details/80040090\">https://blog.csdn.net/programerxiaoer/article/details/80040090</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>JavaHashMapHashTableConcurrentHashMapConcurrentHashmap</p>\n<h4 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h4><ul>\n<li><p>HashMapputHashMapnextnullCPU100%HashMap</p>\n</li>\n<li><p>HashTablesynchronizedHashTable</p>\n</li>\n<li><p>ConcurrentHashMap</p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ConcurrentHashMap</p>\n<p>The primary design goal of this hash table is to maintain concurrent readability(typically method get(), but also iterators and related methods) while minimizing update contention. Secondary goals are to keep space consumption about the same or better than java.util.HashMap, and to support high initial insertion rates on an empty table by many threads.</p>\n<p> ConcurrentHashMapget()HashMap</p>\n<h4 id=\"Java7Java8ConcurrentHashMap\"><a href=\"#Java7Java8ConcurrentHashMap\" class=\"headerlink\" title=\"Java7Java8ConcurrentHashMap\"></a>Java7Java8ConcurrentHashMap</h4><p>ConcurrentHashMap</p>\n<p>Java7ConcurrentHashMapSegmentHashEntrySegmentSegmentHashEntryHashEntrySegmentConcurrentHashMap</p>\n<p>Java8ConcurrentHashMapSegmentCASsynchronizedJava 8(8)O(N)O(long(N)))</p>\n<h4 id=\"Java8ConcurrentHashMap\"><a href=\"#Java8ConcurrentHashMap\" class=\"headerlink\" title=\"Java8ConcurrentHashMap\"></a>Java8ConcurrentHashMap</h4><p>Java8ConcurrentHashMapSegmentSegmentConcurrentHashMapNode(key-value)NodeNodeTreeNodes8TreeBinsTreeNodesTreeNodeConcurrentHashMapTreeBintreeNodeForwordingNodesConcurrentHashMapnextTable</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">int</span> hash;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">        <span class=\"keyword\">volatile</span> V val;  <span class=\"comment\">//volatile</span></span><br><span class=\"line\">        <span class=\"keyword\">volatile</span> Node&lt;K,V&gt; next;  <span class=\"comment\">//volatile</span></span><br><span class=\"line\"></span><br><span class=\"line\">        Node(<span class=\"type\">int</span> hash, K key, V val) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.hash = hash;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.val = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Node(<span class=\"type\">int</span> hash, K key, V val, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>(hash, key, val);</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.next = next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title function_\">getKey</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">getValue</span><span class=\"params\">()</span>   &#123; <span class=\"keyword\">return</span> val; &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hashCode</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> key.hashCode() ^ val.hashCode(); &#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;...&#125;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">setValue</span><span class=\"params\">(V value)</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object o)</span> &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * Virtualized support for map.get(); overridden in subclasses.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        Node&lt;K,V&gt; <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">int</span> h, Object k)</span> &#123;...&#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>NodeNodeForwardingNodesForwardingNodesConcurrentHashMap</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * A node inserted at head of bins during transfer operations.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ForwardingNode</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; &#123;</span><br><span class=\"line\">       <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class=\"line\">       ForwardingNode(Node&lt;K,V&gt;[] tab) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//hashMOVED(-1)</span></span><br><span class=\"line\">           <span class=\"built_in\">super</span>(MOVED, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">           <span class=\"built_in\">this</span>.nextTable = tab;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       Node&lt;K,V&gt; <span class=\"title function_\">find</span><span class=\"params\">(<span class=\"type\">int</span> h, Object k)</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// loop to avoid arbitrarily deep recursion on forwarding nodes</span></span><br><span class=\"line\">           <span class=\"comment\">//nextTablenextTablehash</span></span><br><span class=\"line\">           outer: <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = nextTable;;) &#123;</span><br><span class=\"line\">               Node&lt;K,V&gt; e; <span class=\"type\">int</span> n;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (k == <span class=\"literal\">null</span> || tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span> ||</span><br><span class=\"line\">                   (e = tabAt(tab, (n - <span class=\"number\">1</span>) &amp; h)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                   <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">                   <span class=\"type\">int</span> eh; K ek;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> ((eh = e.hash) == h &amp;&amp;</span><br><span class=\"line\">                       ((ek = e.key) == k || (ek != <span class=\"literal\">null</span> &amp;&amp; k.equals(ek))))</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (eh &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                       <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> ForwardingNode) &#123;</span><br><span class=\"line\">                           tab = ((ForwardingNode&lt;K,V&gt;)e).nextTable;</span><br><span class=\"line\">                           <span class=\"keyword\">continue</span> outer;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"keyword\">else</span></span><br><span class=\"line\">                           <span class=\"keyword\">return</span> e.find(h, k);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p>ConcurrentHashMapConcurrentHashMap</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; Node&lt;K,V&gt; <span class=\"title function_\">tabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Node&lt;K,V&gt;)U.getObjectAcquire(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; <span class=\"type\">boolean</span> <span class=\"title function_\">casTabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i,</span></span><br><span class=\"line\"><span class=\"params\">                                        Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> U.compareAndSetObject(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> &lt;K,V&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setTabAt</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> i, Node&lt;K,V&gt; v)</span> &#123;</span><br><span class=\"line\">        U.putObjectRelease(tab, ((<span class=\"type\">long</span>)i &lt;&lt; ASHIFT) + ABASE, v);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p><strong>1.ConcurrentHashMap</strong></p>\n<p>sizeCtl</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * Table initialization and resizing control.  When negative,the</span></span><br><span class=\"line\"><span class=\"comment\">    * table is being initialized or resized: -1 for initialization,</span></span><br><span class=\"line\"><span class=\"comment\">    * else -(1 + the number of active resizing threads). Otherwise,</span></span><br><span class=\"line\"><span class=\"comment\">    * when table is null, holds the initial table size to use upon</span></span><br><span class=\"line\"><span class=\"comment\">    * creation, or 0 for default. After initialization, holds the</span></span><br><span class=\"line\"><span class=\"comment\">    * next element count value upon which to resize the table.</span></span><br><span class=\"line\"><span class=\"comment\">    * HashHash;</span></span><br><span class=\"line\"><span class=\"comment\">    * (-1,-NN-1)</span></span><br><span class=\"line\"><span class=\"comment\">    * null0;</span></span><br><span class=\"line\"><span class=\"comment\">    * </span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> sizeCtl;</span><br></pre></td></tr></table></figure>\n\n<p>ConcurrentHashMap ConcurrentHashMapHashHashsizeCtlsizeCtl &lt; 0SIZECTL-1HashsizeCtl</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Initializes table, using the size recorded in sizeCtl.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; <span class=\"type\">int</span> sc;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((tab = table) == <span class=\"literal\">null</span> || tab.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t        <span class=\"comment\">//sizeCtl0</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((sc = sizeCtl) &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"comment\">//yield()CPU</span></span><br><span class=\"line\">                Thread.yield(); <span class=\"comment\">// lost initialization race; just spin</span></span><br><span class=\"line\">            <span class=\"comment\">//SIZECTL-1</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSetInt(<span class=\"built_in\">this</span>, SIZECTL, sc, -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || tab.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> (sc &gt; <span class=\"number\">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class=\"line\">                        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n];</span><br><span class=\"line\">                        table = tab = nt;</span><br><span class=\"line\">                        sc = n - (n &gt;&gt;&gt; <span class=\"number\">2</span>); <span class=\"comment\">//n-(1/4)n,(n * loadFactor)</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    sizeCtl = sc; <span class=\"comment\">//sizeCtl</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> tab;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2.Hash</strong></p>\n<p>hashConcurrentHashMap </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">spread</span><span class=\"params\">(<span class=\"type\">int</span> h)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (h ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>)) &amp; HASH_BITS; </span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>(length-1) &amp; (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS);</p>\n<h3 id=\"ConcurrentHashMapput\"><a href=\"#ConcurrentHashMapput\" class=\"headerlink\" title=\"ConcurrentHashMapput\"></a>ConcurrentHashMapput</h3><ul>\n<li><p>keyvaluenull</p>\n</li>\n<li><p>tablenulltable0tableinitTable()</p>\n</li>\n<li><p>Hashnull(CAS)</p>\n</li>\n<li><p>hash-1ForwaringNodes</p>\n</li>\n<li><p>nullJava88</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** Implementation for put and putIfAbsent */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (key == <span class=\"literal\">null</span> || value == <span class=\"literal\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">       <span class=\"comment\">//hash</span></span><br><span class=\"line\">       <span class=\"type\">int</span> <span class=\"variable\">hash</span> <span class=\"operator\">=</span> spread(key.hashCode());</span><br><span class=\"line\">       <span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">       <span class=\"keyword\">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class=\"line\">           Node&lt;K,V&gt; f; <span class=\"type\">int</span> n, i, fh; K fk; V fv;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">               tab = initTable(); <span class=\"comment\">//Hash</span></span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i = (n - <span class=\"number\">1</span>) &amp; hash)) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//CASHash</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span> (casTabAt(tab, i, <span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value)))</span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;  <span class=\"comment\">// no lock when adding to empty bin(null)</span></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED) <span class=\"comment\">//f.hash == -1 </span></span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">               tab = helpTransfer(tab, f);</span><br><span class=\"line\">           <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (onlyIfAbsent &amp;&amp; fh == hash &amp;&amp;  <span class=\"comment\">// check first node</span></span><br><span class=\"line\">                    ((fk = f.key) == key || fk != <span class=\"literal\">null</span> &amp;&amp; key.equals(fk)) &amp;&amp;</span><br><span class=\"line\">                    (fv = f.val) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">               <span class=\"keyword\">return</span> fv;</span><br><span class=\"line\">           <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               <span class=\"type\">V</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">               <span class=\"comment\">//</span></span><br><span class=\"line\">               <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                       <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                           binCount = <span class=\"number\">1</span>;</span><br><span class=\"line\">                           <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class=\"line\">                               K ek;</span><br><span class=\"line\">                               <span class=\"comment\">//hashhash</span></span><br><span class=\"line\">                               <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                                   ((ek = e.key) == key ||</span><br><span class=\"line\">                                    (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class=\"line\">                                   oldVal = e.val;</span><br><span class=\"line\">                                   <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                    <span class=\"comment\">//</span></span><br><span class=\"line\">                                       e.val = value;</span><br><span class=\"line\">                                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                               &#125;</span><br><span class=\"line\">                               Node&lt;K,V&gt; pred = e;</span><br><span class=\"line\">                               <span class=\"comment\">//</span></span><br><span class=\"line\">                               <span class=\"keyword\">if</span> ((e = e.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                                   pred.next = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(hash, key, value);</span><br><span class=\"line\">                                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                               &#125;</span><br><span class=\"line\">                           &#125;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"comment\">//</span></span><br><span class=\"line\">                       <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;</span><br><span class=\"line\">                           Node&lt;K,V&gt; p;</span><br><span class=\"line\">                           binCount = <span class=\"number\">2</span>;</span><br><span class=\"line\">                           <span class=\"keyword\">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class=\"line\">                                                          value)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                               oldVal = p.val;</span><br><span class=\"line\">                               <span class=\"keyword\">if</span> (!onlyIfAbsent)</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                   p.val = value;</span><br><span class=\"line\">                           &#125;</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                       <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> ReservationNode)</span><br><span class=\"line\">                           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Recursive update&quot;</span>);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (binCount != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//8,</span></span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class=\"line\">                       treeifyBin(tab, i);</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (oldVal != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                       <span class=\"keyword\">return</span> oldVal; </span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       addCount(<span class=\"number\">1L</span>, binCount);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMap\"><a href=\"#ConcurrentHashMap\" class=\"headerlink\" title=\"ConcurrentHashMap\"></a>ConcurrentHashMap</h3><p>ConcurrentHashMapcap * loadFactortransfer()puthelpTransfer()ConcurrentHashMap</p>\n<ul>\n<li><p>(16)CPU(stride &#x3D; (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) &#x2F; NCPU : n)16</p>\n</li>\n<li><p>HashnextTablenextTablenullnextTable2</p>\n</li>\n<li><p>Hash(compareAndSetInt)while</p>\n</li>\n<li><p>HashForwardingNodes</p>\n</li>\n<li><p>hashMOVED(f.hash &#x3D;&#x3D; -1)ForwardingNodes</p>\n</li>\n<li><p>HashMaphash&amp;01i+nHash</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Moves and/or copies the nodes in each bin to new table. See</span></span><br><span class=\"line\"><span class=\"comment\">     * above for explanation.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">transfer</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> tab.length, stride;</span><br><span class=\"line\">        <span class=\"comment\">//CPU16</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((stride = (NCPU &gt; <span class=\"number\">1</span>) ? (n &gt;&gt;&gt; <span class=\"number\">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)</span><br><span class=\"line\">            stride = MIN_TRANSFER_STRIDE; <span class=\"comment\">// subdivide range</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nextTab == <span class=\"literal\">null</span>) &#123;            <span class=\"comment\">// initiating</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"comment\">//Hash2</span></span><br><span class=\"line\">                Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;?,?&gt;[n &lt;&lt; <span class=\"number\">1</span>];</span><br><span class=\"line\">                nextTab = nt;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;      <span class=\"comment\">// try to cope with OOME</span></span><br><span class=\"line\">                sizeCtl = Integer.MAX_VALUE;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            nextTable = nextTab;</span><br><span class=\"line\">            transferIndex = n;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">nextn</span> <span class=\"operator\">=</span> nextTab.length;</span><br><span class=\"line\">        <span class=\"comment\">//ForwardingNodes</span></span><br><span class=\"line\">        ForwardingNode&lt;K,V&gt; fwd = <span class=\"keyword\">new</span> <span class=\"title class_\">ForwardingNode</span>&lt;K,V&gt;(nextTab);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">advance</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>; <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">finishing</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>; <span class=\"comment\">// to ensure sweep before committing nextTab</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, bound = <span class=\"number\">0</span>;;) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; f; <span class=\"type\">int</span> fh;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (advance) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> nextIndex, nextBound;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (--i &gt;= bound || finishing)</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((nextIndex = transferIndex) &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                    i = -<span class=\"number\">1</span>;</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (U.compareAndSetInt</span><br><span class=\"line\">                         (<span class=\"built_in\">this</span>, TRANSFERINDEX, nextIndex,</span><br><span class=\"line\">                          nextBound = (nextIndex &gt; stride ?</span><br><span class=\"line\">                                       nextIndex - stride : <span class=\"number\">0</span>))) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//transferIndex,</span></span><br><span class=\"line\">                    bound = nextBound;</span><br><span class=\"line\">                    i = nextIndex - <span class=\"number\">1</span>;</span><br><span class=\"line\">                    advance = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i &lt; <span class=\"number\">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> sc;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (finishing) &#123;</span><br><span class=\"line\">                    nextTable = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    table = nextTab;</span><br><span class=\"line\">                    <span class=\"comment\">//sizeCtl</span></span><br><span class=\"line\">                    sizeCtl = (n &lt;&lt; <span class=\"number\">1</span>) - (n &gt;&gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (U.compareAndSetInt(<span class=\"built_in\">this</span>, SIZECTL, sc = sizeCtl, sc - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((sc - <span class=\"number\">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    finishing = advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    i = n; <span class=\"comment\">// recheck before commit</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//null,</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((f = tabAt(tab, i)) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                advance = casTabAt(tab, i, <span class=\"literal\">null</span>, fwd);</span><br><span class=\"line\">            <span class=\"comment\">//hash-1ForwardingNodes</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((fh = f.hash) == MOVED)</span><br><span class=\"line\">                advance = <span class=\"literal\">true</span>; <span class=\"comment\">// already processed</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t            <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (f) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class=\"line\">                        Node&lt;K,V&gt; ln, hn;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fh &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t                        <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"type\">int</span> <span class=\"variable\">runBit</span> <span class=\"operator\">=</span> fh &amp; n;</span><br><span class=\"line\">                            Node&lt;K,V&gt; lastRun = f; <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class=\"literal\">null</span>; p = p.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> p.hash &amp; n;</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (b != runBit) &#123;</span><br><span class=\"line\">                                    runBit = b;</span><br><span class=\"line\">                                    lastRun = p;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//runBit = 0,</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (runBit == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                                ln = lastRun;</span><br><span class=\"line\">                                hn = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//runBit = 1,i+n</span></span><br><span class=\"line\">                            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                hn = lastRun;</span><br><span class=\"line\">                                ln = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">ph</span> <span class=\"operator\">=</span> p.hash; <span class=\"type\">K</span> <span class=\"variable\">pk</span> <span class=\"operator\">=</span> p.key; <span class=\"type\">V</span> <span class=\"variable\">pv</span> <span class=\"operator\">=</span> p.val;</span><br><span class=\"line\">                                <span class=\"comment\">//()</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((ph &amp; n) == <span class=\"number\">0</span>)</span><br><span class=\"line\">                                    ln = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(ph, pk, pv, ln);</span><br><span class=\"line\">                                    <span class=\"comment\">//(i+n)</span></span><br><span class=\"line\">                                <span class=\"keyword\">else</span></span><br><span class=\"line\">                                    hn = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;K,V&gt;(ph, pk, pv, hn);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//Hash</span></span><br><span class=\"line\">                            setTabAt(nextTab, i, ln);</span><br><span class=\"line\">                            setTabAt(nextTab, i + n, hn);</span><br><span class=\"line\">                            <span class=\"comment\">//HashForwardingNodes</span></span><br><span class=\"line\">                            setTabAt(tab, i, fwd);</span><br><span class=\"line\">                            advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f <span class=\"keyword\">instanceof</span> TreeBin) &#123;</span><br><span class=\"line\">                            TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;</span><br><span class=\"line\">                            TreeNode&lt;K,V&gt; lo = <span class=\"literal\">null</span>, loTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            TreeNode&lt;K,V&gt; hi = <span class=\"literal\">null</span>, hiTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                            <span class=\"type\">int</span> <span class=\"variable\">lc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, hc = <span class=\"number\">0</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                                <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> e.hash;</span><br><span class=\"line\">                                TreeNode&lt;K,V&gt; p = <span class=\"keyword\">new</span> <span class=\"title class_\">TreeNode</span>&lt;K,V&gt;</span><br><span class=\"line\">                                    (h, e.key, e.val, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                <span class=\"keyword\">if</span> ((h &amp; n) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> ((p.prev = loTail) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                        lo = p;</span><br><span class=\"line\">                                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                                        loTail.next = p;</span><br><span class=\"line\">                                    loTail = p;</span><br><span class=\"line\">                                    ++lc;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"comment\">//</span></span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> ((p.prev = hiTail) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                        hi = p;</span><br><span class=\"line\">                                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                                        hiTail.next = p;</span><br><span class=\"line\">                                    hiTail = p;</span><br><span class=\"line\">                                    ++hc;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :</span><br><span class=\"line\">                                (hc != <span class=\"number\">0</span>) ? <span class=\"keyword\">new</span> <span class=\"title class_\">TreeBin</span>&lt;K,V&gt;(lo) : t;</span><br><span class=\"line\">                            <span class=\"comment\">//</span></span><br><span class=\"line\">                            hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :</span><br><span class=\"line\">                                (lc != <span class=\"number\">0</span>) ? <span class=\"keyword\">new</span> <span class=\"title class_\">TreeBin</span>&lt;K,V&gt;(hi) : t;</span><br><span class=\"line\">                            <span class=\"comment\">//Hash</span></span><br><span class=\"line\">                            setTabAt(nextTab, i, ln);</span><br><span class=\"line\">                            setTabAt(nextTab, i + n, hn);</span><br><span class=\"line\">                            <span class=\"comment\">//HashForwardingNodes</span></span><br><span class=\"line\">                            setTabAt(tab, i, fwd);</span><br><span class=\"line\">                            advance = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ConcurrentHashMapget\"><a href=\"#ConcurrentHashMapget\" class=\"headerlink\" title=\"ConcurrentHashMapget\"></a>ConcurrentHashMapget</h3><p>ConcurrentHashMapgetHash</p>\n<ul>\n<li><p>hash</p>\n</li>\n<li><p>hash0 ForwardingNodesfind</p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Returns the value to which the specified key is mapped,</span></span><br><span class=\"line\"><span class=\"comment\">     * or &#123;<span class=\"doctag\">@code</span> null&#125; if this map contains no mapping for the key.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;More formally, if this map contains a mapping from a key</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@code</span> k&#125; to a value &#123;<span class=\"doctag\">@code</span> v&#125; such that &#123;<span class=\"doctag\">@code</span> key.equals(k)&#125;,</span></span><br><span class=\"line\"><span class=\"comment\">     * then this method returns &#123;<span class=\"doctag\">@code</span> v&#125;; otherwise it returns</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@code</span> null&#125;.  (There can be at most one such mapping.)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> NullPointerException if the specified key is null</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class=\"type\">int</span> n, eh; K ek;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> spread(key.hashCode());</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (e = tabAt(tab, (n - <span class=\"number\">1</span>) &amp; h)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((eh = e.hash) == h) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((ek = e.key) == key || (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek)))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e.val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//e.hash&lt;0</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (eh &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> (p = e.find(h, key)) != <span class=\"literal\">null</span> ? p.val : <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == h &amp;&amp;</span><br><span class=\"line\">                    ((ek = e.key) == key || (ek != <span class=\"literal\">null</span> &amp;&amp; key.equals(ek))))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e.val;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n<p><a href=\"https://blog.csdn.net/programerxiaoer/article/details/80040090\">https://blog.csdn.net/programerxiaoer/article/details/80040090</a></p>\n"},{"title":"java-linkedlist","date":"2021-05-17T13:21:15.000Z","_content":"\nLinkedList\nLinkedList\n\n```java\npublic class LinkedList<E> extends AbstractSequentialList<E> implements List<E>, Deque<E>, Cloneable, java.io.Serializable\n```\n\n\n\n- LinkedList<E>\n- extends AbstractSequentialList<E>\n- AbstractSequentialList AbstractListAbstractSequentialList \n-  AbstractList LinkedList\n- implements List<E>\n- implements Deque<E>DequeDouble ended queueLinkedList\n- implements Cloneableclone()field-for-field\n- implements java.io.Serializable\n\nArrayListLinkedListRandomAccessRandomAccessLinkedList\n\nLinkedList\n\n\n\n![image](/images/java-linkedlist/java-linkedlist-1.jpg)\n\n\n\n### \n\n```java\n/**\n * LinkedList\n */\ntransient int size = 0;\n\n/**\n * \n * Invariant: (first == null && last == null) ||\n *            (first.prev == null && first.item != null)\n */\ntransient Node<E> first;\n\n/**\n * \n * Invariant: (first == null && last == null) ||\n *            (last.next == null && last.item != null)\n */\ntransient Node<E> last;\n```\n\nnode**Node.java**Nodeitemnextprev\n\n### \n\nLinkedListArrayList\n\n1. LinkedList\n\n```java\n/**\n * .\n */\npublic LinkedList() {\n}\n```\n\n2. LinkedList\n\n```java\n/**\n * clinkedListlinkedlistclinkedList\n *\n * @param  c \n * @throws NullPointerException cnull\n */\npublic LinkedList(Collection<? extends E> c) {\n    this();\n    addAll(c);\n}\n```\n\n### \n\n#### ****\n\n##### **linkFirst(E e)**\n\ne\n\n```java\n/**\n * \n */\nprivate void linkFirst(E e) {\n    //f\n    final Node<E> f = first;\n    //newNodenull\n    final Node<E> newNode = new Node<>(null, e, f);\n    //newNode \n    first = newNode;\n    //nullfnewNode\n    if (f == null)\n        last = newNode;\n    else\n        f.prev = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **linkLast(E e)**\n\ne\n\n```java\n/**\n * e\n */\nvoid linkLast(E e) {\n    //l\n    final Node<E> l = last;\n    //newNodelnull\n    final Node<E> newNode = new Node<>(l, e, null);\n    //newNode\n    last = newNode;\n    //nulllnewNode\n    if (l == null)\n        first = newNode;\n    else\n        l.next = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **linkBefore( E e, Node succ)**\n\nsucce\n\n```java\n/**\n * succesuccnull\n */\nvoid linkBefore(E e, Node<E> succ) {\n    // assert succ != null;\n    //\n    final Node<E> pred = succ.prev;\n    //newNodepredsucc\n    final Node<E> newNode = new Node<>(pred, e, succ);\n    //succnewTouch\n    succ.prev = newNode;\n    //nullnewTouchpred\n    if (pred == null)\n        first = newNode;\n    else\n        pred.next = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **unlinkFirst( Node f)**\n\nf\n\n```java\n/**\n * f\n */\nprivate E unlinkFirst( Node<E> f) {\n    // assert f == first && f != null;\n    // \n    final E element = f.item;\n    // \n    final Node<E> next = f.next;\n    //null\n    f.item = null;\n    //null\n    f.next = null; // help GC\n    //next\n    first = next;\n    //nextnullnullnextnull\n    if (next == null)\n        last = null;\n    else\n        next.prev = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **unlinkLast( Node l)**\n\nf\n\n```java\n/**\n * l.\n */\nprivate E unlinkLast(Node<E> l) {\n    // assert l == last && l != null;\n    // \n    final E element = l.item;\n    //prev\n    final Node<E> prev = l.prev;\n    //null\n    l.item = null;\n    //null\n    l.prev = null; // help GC\n    //prev\n    last = prev;\n    //nullnullnull\n    if (prev == null)\n        first = null;\n    else\n        prev.next = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **unlink( Node x)**\n\nx\n\n```java\n/**\n * \n */\nE unlink(Node<E> x) {\n    // assert x != null;\n    // \n    final E element = x.item;\n    // next\n    final Node<E> next = x.next;\n    // prev\n    final Node<E> prev = x.prev;\n    //prevnullnextprevnextxnull\n    if (prev == null) {\n        first = next;\n    } else {\n        prev.next = next;\n        x.prev = null;\n    }\n    //nextnullprevnextprevxnull\n    if (next == null) {\n        last = prev;\n    } else {\n        next.prev = prev;\n        x.next = null;\n    }\n    //xnull\n    x.item = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **getFirst()**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E getFirst() {\n    final Node<E> f = first;\n    if (f == null)\n        throw new NoSuchElementException();\n    return f.item;\n}\n```\n\n##### **getLast()**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E getLast() {\n    final Node<E> l = last;\n    if (l == null)\n        throw new NoSuchElementException();\n    return l.item;\n}\n```\n\n#### ****\n\n##### **removeFirst**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E removeFirst() {\n    final Node<E> f = first;\n    if (f == null)\n        throw new NoSuchElementException();\n    return unlinkFirst(f);\n}\n```\n\n##### **removeLast**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E removeLast() {\n    final Node<E> l = last;\n    if (l == null)\n        throw new NoSuchElementException();\n    return unlinkLast(l);\n}\n```\n\n##### **addFirst( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n */\npublic void addFirst(E e) {\n    linkFirst(e);\n}\n```\n\n##### **addLast( E e)**\n\n```java\n/**\n * .\n * \n * add()\n *\n * @param e \n */ \npublic void addLast(E e) {\n    linkLast(e);\n}\n```\n\n##### **contains( Object o)**\n\n```java\n/**\n * o\n * @param o \n * @return \n */\npublic boolean contains(Object o) {\n    return indexOf(o) != -1;\n}\n```\n\n##### **size()**\n\n```java\n/**\n * \n *\n * @return \n */\npublic int size() {\n    return size;\n}\n```\n\n##### **add( E e)**\n\n```java\n/**\n * .\n *\n * addLast\n *\n * @param e \n * @return true\n */\npublic boolean add(E e) {\n    linkLast(e);\n    return true;\n}\n```\n\n##### **remove(Object o)**\n\n```java\n/**\n * \n *\n * @param o \n * @return otrue\n */\npublic boolean remove(Object o) {\n    //onullnulltruenullootrue\n    if (o == null) {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (x.item == null) {\n                unlink(x);\n                return true;\n            }\n        }\n    } else {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (o.equals(x.item)) {\n                unlink(x);\n                return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\n##### **addAll( Collection<? extends E> c)**\n\n```java\n/**\n * \n *\n * @param c \n * @return true\n * @throws NullPointerException null\n */\npublic boolean addAll(Collection<? extends E> c) {\n    return addAll(size, c);\n}\n```\n\n##### **addAll( int index, Collection<? extends E> c)**\n\n```java\n/**\n * \n *\n * @param index \n * @param c \n * @return true\n * @throws IndexOutOfBoundsException index<0index>size\n * @throws NullPointerException null\n */\npublic boolean addAll(int index, Collection<? extends E> c) {\n    //\n    checkPositionIndex(index);\n\n    Object[] a = c.toArray();\n    int numNew = a.length;\n    if (numNew == 0)\n        return false;//cfalse\n\n    //\n    Node<E> pred, succ;\n    if (index == size) {\n        succ = null;\n        pred = last;\n    } else {\n        succ = node(index);\n        pred = succ.prev;\n    }\n\n    // \n    for (Object o : a) {\n        @SuppressWarnings(\"unchecked\") E e = (E) o;\n        Node<E> newNode = new Node<>(pred, e, null);\n        if (pred == null)\n            first = newNode;\n        else\n            pred.next = newNode;\n        pred = newNode;\n    }\n\n    // \n    if (succ == null) {\n        last = pred;\n    } else {\n        pred.next = succ;\n        succ.prev = pred;\n    }\n\n    size += numNew;\n    modCount++;\n    return true;\n}\n```\n\n##### **clear()**\n\n```java\n/**\n * \n */\npublic void clear() {\n    // Clearing all of the links between nodes is \"unnecessary\", but:\n    // - helps a generational GC if the discarded nodes inhabit\n    //   more than one generation\n    // - is sure to free memory even if there is a reachable Iterator\n    for (Node<E> x = first; x != null; ) {\n        Node<E> next = x.next;\n        x.item = null;\n        x.next = null;\n        x.prev = null;\n        x = next;\n    }\n    first = last = null;\n    size = 0;\n    modCount++;\n}\n```\n\n#### ****\n\n##### **get( int index)**\n\n```java\n/**\n * \n *\n * @param index \n * @return \n * @throws IndexOutOfBoundsException index\n */\npublic E get(int index) {\n    checkElementIndex(index);\n    return node(index).item;\n}\n```\n\n##### **set( int index, E element)**\n\n```java\n/**\n * element\n *\n * @param index \n * @param element \n * @return element\n * @throws IndexOutOfBoundsException \n */\npublic E set(int index, E element) {\n    checkElementIndex(index);\n    Node<E> x = node(index);\n    E oldVal = x.item;\n    x.item = element;\n    return oldVal;\n}\n```\n\n##### **add( int index, E element)**\n\n```java\n/**\n * \n *\n * @param index \n * @param element \n * @throws IndexOutOfBoundsException \n */\npublic void add(int index, E element) {\n    checkPositionIndex(index);\n\n    if (index == size)\n        linkLast(element);\n    else\n        linkBefore(element, node(index));\n}\n```\n\n##### **remove( int index)**\n\n```java\n/**\n * \n *\n * @param \n * @return \n * @throws IndexOutOfBoundsException \n */\npublic E remove(int index) {\n    checkElementIndex(index);\n    return unlink(node(index));\n}\n```\n\n##### **isElementIndex( int index)**\n\n```java\n/**\n * \n */\nprivate boolean isElementIndex(int index) {\n    return index >= 0 && index < size;\n}\n```\n\n##### **isPositionIndex(int index)**\n\n```java\n/**\n * \n */\nprivate boolean isPositionIndex(int index) {\n    return index >= 0 && index <= size;\n}\n```\n\n##### **outOfBoundsMsg( int index)**\n\n```java\n/**\n * \n */\nprivate String outOfBoundsMsg(int index) {\n    return \"Index: \"+index+\", Size: \"+size;\n}\n```\n\n##### **checkElementIndex( int index)**\n\n```java\n/**\n * \n */\nprivate void checkElementIndex(int index) {\n    if (!isElementIndex(index))\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n##### **checkPositionIndex( int index)**\n\n```java\n/**\n * \n */\nprivate void checkPositionIndex(int index) {\n    if (!isPositionIndex(index))\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n##### **node( int index)**\n\n```java\n/**\n * \n */\nNode<E> node(int index) {\n    // assert isElementIndex(index);\n\n    if (index < (size >> 1)) {\n        Node<E> x = first;\n        for (int i = 0; i < index; i++)\n            x = x.next;\n        return x;\n    } else {\n        Node<E> x = last;\n        for (int i = size - 1; i > index; i--)\n            x = x.prev;\n        return x;\n    }\n}\n```\n\n#### ****\n\n##### **indexOf( Object o)**\n\n```java\n/**\n * -1.\n * \n * @param o \n * @return -1\n */\npublic int indexOf(Object o) {\n    int index = 0;\n    if (o == null) {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (x.item == null)\n                return index;\n            index++;\n        }\n    } else {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (o.equals(x.item))\n                return index;\n            index++;\n        }\n    }\n    return -1;\n}\n```\n\n##### **lastIndexOf( Object o)**\n\n```java\n/**\n * -1.\n * \n * @param o \n * @return -1\n */\npublic int lastIndexOf(Object o) {\n    int index = size;\n    if (o == null) {\n        for (Node<E> x = last; x != null; x = x.prev) {\n            index--;\n            if (x.item == null)\n                return index;\n        }\n    } else {\n        for (Node<E> x = last; x != null; x = x.prev) {\n            index--;\n            if (o.equals(x.item))\n                return index;\n        }\n    }\n    return -1;\n}\n```\n\n#### ****\n\n##### **peek()**\n\n```java\n/**\n * null\n *\n * @return null\n * @since 1.5\n */\npublic E peek() {\n    final Node<E> f = first;\n    return (f == null) ? null : f.item;\n}\n```\n\n##### **element()**\n\n```java\n/**\n * \n *\n * @return \n * @throws NoSuchElementException \n * @since 1.5\n */\npublic E element() {\n    return getFirst();\n}\n```\n\n##### **poll()**\n\n```java\n/**\n * null\n *\n * @return null\n * @since 1.5\n */\npublic E poll() {\n    final Node<E> f = first;\n    return (f == null) ? null : unlinkFirst(f);\n}\n```\n\n##### **remove()**\n\n```java\n/**\n * \n *\n * @return \n * @throws NoSuchElementException \n * @since 1.5\n */\npublic E remove() {\n    return removeFirst();\n}\n```\n\n##### **offer(E e)**\n\n```java\n/**\n * \n *\n * @param e \n * @return \n * @since 1.5\n */\npublic boolean offer(E e) {\n    return add(e);\n}\n```\n\n#### ****\n\n##### **offerFirst( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n * @return  true\n * @since 1.6\n */\npublic boolean offerFirst(E e) {\n    addFirst(e);\n    return true;\n}\n```\n\n##### **offerLast( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n * @return  true\n * @since 1.6\n */\npublic boolean offerLast(E e) {\n    addLast(e);\n    return true;\n}\n```\n\n##### **peekFirst()**\n\n```java\n/**\n* \n*\n* @return \n* @since 1.6\n*/\npublic E peekFirst() {\n   final Node<E> f = first;\n   return (f == null) ? null : f.item;\n}\n```\n\n##### **peekLast()**\n\n```java\n/**\n* \n*\n* @return \n* @since 1.6\n*/\npublic E peekLast() {\n    final Node<E> l = last;\n    return (l == null) ? null : l.item;\n}\n```\n\n##### **pollFirst()**\n\n```java\n/**\n * null.\n *\n * @return null.\n * @since 1.6\n */\npublic E pollFirst() {\n    final Node<E> f = first;\n    return (f == null) ? null : unlinkFirst(f);\n}\n```\n\n##### **pollLast()**\n\n```java\n/**\n * null.\n *\n * @return null.\n * @since 1.6\n */\npublic E pollLast() {\n    final Node<E> l = last;\n    return (l == null) ? null : unlinkLast(l);\n}\n```\n\n##### **push( E e)**\n\n```java\n/**\n * \n *\n * addFirst(e)\n *\n * @param e \n * @since 1.6\n */\npublic void push(E e) {\n    addFirst(e);\n}\n```\n\n##### **pop()**\n\n```java\n/**\n * \n *\n * pop()\n *\n * @return \n * @throws NoSuchElementException \n * @since 1.6\n */\npublic E pop() {\n    return removeFirst();\n}\n```\n\n##### **removeFirstOccurrence( Object o)**\n\n```java\n/**\n * \n * \n * @param o \n * @return true \n * @since 1.6\n */\npublic boolean removeFirstOccurrence(Object o) {\n    return remove(o);\n}\n```\n\nhttps://blog.csdn.net/panweiwei1994/article/details/77110354\n","source":"_posts/java/container/java-linkedlist.md","raw":"---\ntitle: java-linkedlist\ndate: 2021-05-17 21:21:15\ncategories:\n  - java\n  - container\ntags:\n  - java\n  - list\n---\n\nLinkedList\nLinkedList\n\n```java\npublic class LinkedList<E> extends AbstractSequentialList<E> implements List<E>, Deque<E>, Cloneable, java.io.Serializable\n```\n\n\n\n- LinkedList<E>\n- extends AbstractSequentialList<E>\n- AbstractSequentialList AbstractListAbstractSequentialList \n-  AbstractList LinkedList\n- implements List<E>\n- implements Deque<E>DequeDouble ended queueLinkedList\n- implements Cloneableclone()field-for-field\n- implements java.io.Serializable\n\nArrayListLinkedListRandomAccessRandomAccessLinkedList\n\nLinkedList\n\n\n\n![image](/images/java-linkedlist/java-linkedlist-1.jpg)\n\n\n\n### \n\n```java\n/**\n * LinkedList\n */\ntransient int size = 0;\n\n/**\n * \n * Invariant: (first == null && last == null) ||\n *            (first.prev == null && first.item != null)\n */\ntransient Node<E> first;\n\n/**\n * \n * Invariant: (first == null && last == null) ||\n *            (last.next == null && last.item != null)\n */\ntransient Node<E> last;\n```\n\nnode**Node.java**Nodeitemnextprev\n\n### \n\nLinkedListArrayList\n\n1. LinkedList\n\n```java\n/**\n * .\n */\npublic LinkedList() {\n}\n```\n\n2. LinkedList\n\n```java\n/**\n * clinkedListlinkedlistclinkedList\n *\n * @param  c \n * @throws NullPointerException cnull\n */\npublic LinkedList(Collection<? extends E> c) {\n    this();\n    addAll(c);\n}\n```\n\n### \n\n#### ****\n\n##### **linkFirst(E e)**\n\ne\n\n```java\n/**\n * \n */\nprivate void linkFirst(E e) {\n    //f\n    final Node<E> f = first;\n    //newNodenull\n    final Node<E> newNode = new Node<>(null, e, f);\n    //newNode \n    first = newNode;\n    //nullfnewNode\n    if (f == null)\n        last = newNode;\n    else\n        f.prev = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **linkLast(E e)**\n\ne\n\n```java\n/**\n * e\n */\nvoid linkLast(E e) {\n    //l\n    final Node<E> l = last;\n    //newNodelnull\n    final Node<E> newNode = new Node<>(l, e, null);\n    //newNode\n    last = newNode;\n    //nulllnewNode\n    if (l == null)\n        first = newNode;\n    else\n        l.next = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **linkBefore( E e, Node succ)**\n\nsucce\n\n```java\n/**\n * succesuccnull\n */\nvoid linkBefore(E e, Node<E> succ) {\n    // assert succ != null;\n    //\n    final Node<E> pred = succ.prev;\n    //newNodepredsucc\n    final Node<E> newNode = new Node<>(pred, e, succ);\n    //succnewTouch\n    succ.prev = newNode;\n    //nullnewTouchpred\n    if (pred == null)\n        first = newNode;\n    else\n        pred.next = newNode;\n    size++;\n    modCount++;\n}\n```\n\n##### **unlinkFirst( Node f)**\n\nf\n\n```java\n/**\n * f\n */\nprivate E unlinkFirst( Node<E> f) {\n    // assert f == first && f != null;\n    // \n    final E element = f.item;\n    // \n    final Node<E> next = f.next;\n    //null\n    f.item = null;\n    //null\n    f.next = null; // help GC\n    //next\n    first = next;\n    //nextnullnullnextnull\n    if (next == null)\n        last = null;\n    else\n        next.prev = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **unlinkLast( Node l)**\n\nf\n\n```java\n/**\n * l.\n */\nprivate E unlinkLast(Node<E> l) {\n    // assert l == last && l != null;\n    // \n    final E element = l.item;\n    //prev\n    final Node<E> prev = l.prev;\n    //null\n    l.item = null;\n    //null\n    l.prev = null; // help GC\n    //prev\n    last = prev;\n    //nullnullnull\n    if (prev == null)\n        first = null;\n    else\n        prev.next = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **unlink( Node x)**\n\nx\n\n```java\n/**\n * \n */\nE unlink(Node<E> x) {\n    // assert x != null;\n    // \n    final E element = x.item;\n    // next\n    final Node<E> next = x.next;\n    // prev\n    final Node<E> prev = x.prev;\n    //prevnullnextprevnextxnull\n    if (prev == null) {\n        first = next;\n    } else {\n        prev.next = next;\n        x.prev = null;\n    }\n    //nextnullprevnextprevxnull\n    if (next == null) {\n        last = prev;\n    } else {\n        next.prev = prev;\n        x.next = null;\n    }\n    //xnull\n    x.item = null;\n    size--;\n    modCount++;\n    //\n    return element;\n}\n```\n\n##### **getFirst()**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E getFirst() {\n    final Node<E> f = first;\n    if (f == null)\n        throw new NoSuchElementException();\n    return f.item;\n}\n```\n\n##### **getLast()**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E getLast() {\n    final Node<E> l = last;\n    if (l == null)\n        throw new NoSuchElementException();\n    return l.item;\n}\n```\n\n#### ****\n\n##### **removeFirst**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E removeFirst() {\n    final Node<E> f = first;\n    if (f == null)\n        throw new NoSuchElementException();\n    return unlinkFirst(f);\n}\n```\n\n##### **removeLast**\n\n```java\n/**\n * .\n *\n * @return \n * @throws NoSuchElementException \n */\npublic E removeLast() {\n    final Node<E> l = last;\n    if (l == null)\n        throw new NoSuchElementException();\n    return unlinkLast(l);\n}\n```\n\n##### **addFirst( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n */\npublic void addFirst(E e) {\n    linkFirst(e);\n}\n```\n\n##### **addLast( E e)**\n\n```java\n/**\n * .\n * \n * add()\n *\n * @param e \n */ \npublic void addLast(E e) {\n    linkLast(e);\n}\n```\n\n##### **contains( Object o)**\n\n```java\n/**\n * o\n * @param o \n * @return \n */\npublic boolean contains(Object o) {\n    return indexOf(o) != -1;\n}\n```\n\n##### **size()**\n\n```java\n/**\n * \n *\n * @return \n */\npublic int size() {\n    return size;\n}\n```\n\n##### **add( E e)**\n\n```java\n/**\n * .\n *\n * addLast\n *\n * @param e \n * @return true\n */\npublic boolean add(E e) {\n    linkLast(e);\n    return true;\n}\n```\n\n##### **remove(Object o)**\n\n```java\n/**\n * \n *\n * @param o \n * @return otrue\n */\npublic boolean remove(Object o) {\n    //onullnulltruenullootrue\n    if (o == null) {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (x.item == null) {\n                unlink(x);\n                return true;\n            }\n        }\n    } else {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (o.equals(x.item)) {\n                unlink(x);\n                return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\n##### **addAll( Collection<? extends E> c)**\n\n```java\n/**\n * \n *\n * @param c \n * @return true\n * @throws NullPointerException null\n */\npublic boolean addAll(Collection<? extends E> c) {\n    return addAll(size, c);\n}\n```\n\n##### **addAll( int index, Collection<? extends E> c)**\n\n```java\n/**\n * \n *\n * @param index \n * @param c \n * @return true\n * @throws IndexOutOfBoundsException index<0index>size\n * @throws NullPointerException null\n */\npublic boolean addAll(int index, Collection<? extends E> c) {\n    //\n    checkPositionIndex(index);\n\n    Object[] a = c.toArray();\n    int numNew = a.length;\n    if (numNew == 0)\n        return false;//cfalse\n\n    //\n    Node<E> pred, succ;\n    if (index == size) {\n        succ = null;\n        pred = last;\n    } else {\n        succ = node(index);\n        pred = succ.prev;\n    }\n\n    // \n    for (Object o : a) {\n        @SuppressWarnings(\"unchecked\") E e = (E) o;\n        Node<E> newNode = new Node<>(pred, e, null);\n        if (pred == null)\n            first = newNode;\n        else\n            pred.next = newNode;\n        pred = newNode;\n    }\n\n    // \n    if (succ == null) {\n        last = pred;\n    } else {\n        pred.next = succ;\n        succ.prev = pred;\n    }\n\n    size += numNew;\n    modCount++;\n    return true;\n}\n```\n\n##### **clear()**\n\n```java\n/**\n * \n */\npublic void clear() {\n    // Clearing all of the links between nodes is \"unnecessary\", but:\n    // - helps a generational GC if the discarded nodes inhabit\n    //   more than one generation\n    // - is sure to free memory even if there is a reachable Iterator\n    for (Node<E> x = first; x != null; ) {\n        Node<E> next = x.next;\n        x.item = null;\n        x.next = null;\n        x.prev = null;\n        x = next;\n    }\n    first = last = null;\n    size = 0;\n    modCount++;\n}\n```\n\n#### ****\n\n##### **get( int index)**\n\n```java\n/**\n * \n *\n * @param index \n * @return \n * @throws IndexOutOfBoundsException index\n */\npublic E get(int index) {\n    checkElementIndex(index);\n    return node(index).item;\n}\n```\n\n##### **set( int index, E element)**\n\n```java\n/**\n * element\n *\n * @param index \n * @param element \n * @return element\n * @throws IndexOutOfBoundsException \n */\npublic E set(int index, E element) {\n    checkElementIndex(index);\n    Node<E> x = node(index);\n    E oldVal = x.item;\n    x.item = element;\n    return oldVal;\n}\n```\n\n##### **add( int index, E element)**\n\n```java\n/**\n * \n *\n * @param index \n * @param element \n * @throws IndexOutOfBoundsException \n */\npublic void add(int index, E element) {\n    checkPositionIndex(index);\n\n    if (index == size)\n        linkLast(element);\n    else\n        linkBefore(element, node(index));\n}\n```\n\n##### **remove( int index)**\n\n```java\n/**\n * \n *\n * @param \n * @return \n * @throws IndexOutOfBoundsException \n */\npublic E remove(int index) {\n    checkElementIndex(index);\n    return unlink(node(index));\n}\n```\n\n##### **isElementIndex( int index)**\n\n```java\n/**\n * \n */\nprivate boolean isElementIndex(int index) {\n    return index >= 0 && index < size;\n}\n```\n\n##### **isPositionIndex(int index)**\n\n```java\n/**\n * \n */\nprivate boolean isPositionIndex(int index) {\n    return index >= 0 && index <= size;\n}\n```\n\n##### **outOfBoundsMsg( int index)**\n\n```java\n/**\n * \n */\nprivate String outOfBoundsMsg(int index) {\n    return \"Index: \"+index+\", Size: \"+size;\n}\n```\n\n##### **checkElementIndex( int index)**\n\n```java\n/**\n * \n */\nprivate void checkElementIndex(int index) {\n    if (!isElementIndex(index))\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n##### **checkPositionIndex( int index)**\n\n```java\n/**\n * \n */\nprivate void checkPositionIndex(int index) {\n    if (!isPositionIndex(index))\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n##### **node( int index)**\n\n```java\n/**\n * \n */\nNode<E> node(int index) {\n    // assert isElementIndex(index);\n\n    if (index < (size >> 1)) {\n        Node<E> x = first;\n        for (int i = 0; i < index; i++)\n            x = x.next;\n        return x;\n    } else {\n        Node<E> x = last;\n        for (int i = size - 1; i > index; i--)\n            x = x.prev;\n        return x;\n    }\n}\n```\n\n#### ****\n\n##### **indexOf( Object o)**\n\n```java\n/**\n * -1.\n * \n * @param o \n * @return -1\n */\npublic int indexOf(Object o) {\n    int index = 0;\n    if (o == null) {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (x.item == null)\n                return index;\n            index++;\n        }\n    } else {\n        for (Node<E> x = first; x != null; x = x.next) {\n            if (o.equals(x.item))\n                return index;\n            index++;\n        }\n    }\n    return -1;\n}\n```\n\n##### **lastIndexOf( Object o)**\n\n```java\n/**\n * -1.\n * \n * @param o \n * @return -1\n */\npublic int lastIndexOf(Object o) {\n    int index = size;\n    if (o == null) {\n        for (Node<E> x = last; x != null; x = x.prev) {\n            index--;\n            if (x.item == null)\n                return index;\n        }\n    } else {\n        for (Node<E> x = last; x != null; x = x.prev) {\n            index--;\n            if (o.equals(x.item))\n                return index;\n        }\n    }\n    return -1;\n}\n```\n\n#### ****\n\n##### **peek()**\n\n```java\n/**\n * null\n *\n * @return null\n * @since 1.5\n */\npublic E peek() {\n    final Node<E> f = first;\n    return (f == null) ? null : f.item;\n}\n```\n\n##### **element()**\n\n```java\n/**\n * \n *\n * @return \n * @throws NoSuchElementException \n * @since 1.5\n */\npublic E element() {\n    return getFirst();\n}\n```\n\n##### **poll()**\n\n```java\n/**\n * null\n *\n * @return null\n * @since 1.5\n */\npublic E poll() {\n    final Node<E> f = first;\n    return (f == null) ? null : unlinkFirst(f);\n}\n```\n\n##### **remove()**\n\n```java\n/**\n * \n *\n * @return \n * @throws NoSuchElementException \n * @since 1.5\n */\npublic E remove() {\n    return removeFirst();\n}\n```\n\n##### **offer(E e)**\n\n```java\n/**\n * \n *\n * @param e \n * @return \n * @since 1.5\n */\npublic boolean offer(E e) {\n    return add(e);\n}\n```\n\n#### ****\n\n##### **offerFirst( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n * @return  true\n * @since 1.6\n */\npublic boolean offerFirst(E e) {\n    addFirst(e);\n    return true;\n}\n```\n\n##### **offerLast( E e)**\n\n```java\n/**\n * .\n *\n * @param e \n * @return  true\n * @since 1.6\n */\npublic boolean offerLast(E e) {\n    addLast(e);\n    return true;\n}\n```\n\n##### **peekFirst()**\n\n```java\n/**\n* \n*\n* @return \n* @since 1.6\n*/\npublic E peekFirst() {\n   final Node<E> f = first;\n   return (f == null) ? null : f.item;\n}\n```\n\n##### **peekLast()**\n\n```java\n/**\n* \n*\n* @return \n* @since 1.6\n*/\npublic E peekLast() {\n    final Node<E> l = last;\n    return (l == null) ? null : l.item;\n}\n```\n\n##### **pollFirst()**\n\n```java\n/**\n * null.\n *\n * @return null.\n * @since 1.6\n */\npublic E pollFirst() {\n    final Node<E> f = first;\n    return (f == null) ? null : unlinkFirst(f);\n}\n```\n\n##### **pollLast()**\n\n```java\n/**\n * null.\n *\n * @return null.\n * @since 1.6\n */\npublic E pollLast() {\n    final Node<E> l = last;\n    return (l == null) ? null : unlinkLast(l);\n}\n```\n\n##### **push( E e)**\n\n```java\n/**\n * \n *\n * addFirst(e)\n *\n * @param e \n * @since 1.6\n */\npublic void push(E e) {\n    addFirst(e);\n}\n```\n\n##### **pop()**\n\n```java\n/**\n * \n *\n * pop()\n *\n * @return \n * @throws NoSuchElementException \n * @since 1.6\n */\npublic E pop() {\n    return removeFirst();\n}\n```\n\n##### **removeFirstOccurrence( Object o)**\n\n```java\n/**\n * \n * \n * @param o \n * @return true \n * @since 1.6\n */\npublic boolean removeFirstOccurrence(Object o) {\n    return remove(o);\n}\n```\n\nhttps://blog.csdn.net/panweiwei1994/article/details/77110354\n","slug":"java/container/java-linkedlist","published":1,"updated":"2022-05-10T08:25:56.393Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p8001xxklo2nfq92l2","content":"<p>LinkedList<br>LinkedList</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LinkedList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSequentialList</span>&lt;E&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>LinkedList<E></li>\n<li>extends AbstractSequentialList<E></li>\n<li>AbstractSequentialList AbstractListAbstractSequentialList </li>\n<li> AbstractList LinkedList</li>\n<li>implements List<E></li>\n<li>implements Deque<E>DequeDouble ended queueLinkedList</li>\n<li>implements Cloneableclone()field-for-field</li>\n<li>implements java.io.Serializable</li>\n</ul>\n<p>ArrayListLinkedListRandomAccessRandomAccessLinkedList</p>\n<p>LinkedList</p>\n<p><img src=\"/images/java-linkedlist/java-linkedlist-1.jpg\" alt=\"image\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * LinkedList</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class=\"line\"><span class=\"comment\"> *            (first.prev == null &amp;&amp; first.item != null)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;E&gt; first;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class=\"line\"><span class=\"comment\"> *            (last.next == null &amp;&amp; last.item != null)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure>\n\n<p>node<strong>Node.java</strong>Nodeitemnextprev</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LinkedListArrayList</p>\n<ol>\n<li>LinkedList</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">LinkedList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>LinkedList</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * clinkedListlinkedlistclinkedList</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException cnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">LinkedList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>();</span><br><span class=\"line\">    addAll(c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"linkFirst-E-e\"><a href=\"#linkFirst-E-e\" class=\"headerlink\" title=\"linkFirst(E e)\"></a><strong>linkFirst(E e)</strong></h5><p>e</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">linkFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//f</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"comment\">//newNodenull</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(<span class=\"literal\">null</span>, e, f);</span><br><span class=\"line\">    <span class=\"comment\">//newNode </span></span><br><span class=\"line\">    first = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nullfnewNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        last = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        f.prev = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"linkLast-E-e\"><a href=\"#linkLast-E-e\" class=\"headerlink\" title=\"linkLast(E e)\"></a><strong>linkLast(E e)</strong></h5><p>e</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * e</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">linkLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//l</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"comment\">//newNodelnull</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(l, e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"comment\">//newNode</span></span><br><span class=\"line\">    last = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nulllnewNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        l.next = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"linkBefore-E-e-Node-succ\"><a href=\"#linkBefore-E-e-Node-succ\" class=\"headerlink\" title=\"linkBefore( E e, Node succ)\"></a><strong>linkBefore( E e, Node succ)</strong></h5><p>succe</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * succesuccnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">linkBefore</span><span class=\"params\">(E e, Node&lt;E&gt; succ)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert succ != null;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; pred = succ.prev;</span><br><span class=\"line\">    <span class=\"comment\">//newNodepredsucc</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(pred, e, succ);</span><br><span class=\"line\">    <span class=\"comment\">//succnewTouch</span></span><br><span class=\"line\">    succ.prev = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nullnewTouchpred</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pred == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        pred.next = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlinkFirst-Node-f\"><a href=\"#unlinkFirst-Node-f\" class=\"headerlink\" title=\"unlinkFirst( Node f)\"></a><strong>unlinkFirst( Node f)</strong></h5><p>f</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * f</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> E <span class=\"title function_\">unlinkFirst</span><span class=\"params\">( Node&lt;E&gt; f)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert f == first &amp;&amp; f != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> f.item;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; next = f.next;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    f.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    f.next = <span class=\"literal\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">    <span class=\"comment\">//next</span></span><br><span class=\"line\">    first = next;</span><br><span class=\"line\">    <span class=\"comment\">//nextnullnullnextnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (next == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        last = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        next.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlinkLast-Node-l\"><a href=\"#unlinkLast-Node-l\" class=\"headerlink\" title=\"unlinkLast( Node l)\"></a><strong>unlinkLast( Node l)</strong></h5><p>f</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * l.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> E <span class=\"title function_\">unlinkLast</span><span class=\"params\">(Node&lt;E&gt; l)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert l == last &amp;&amp; l != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> l.item;</span><br><span class=\"line\">    <span class=\"comment\">//prev</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; prev = l.prev;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    l.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    l.prev = <span class=\"literal\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">    <span class=\"comment\">//prev</span></span><br><span class=\"line\">    last = prev;</span><br><span class=\"line\">    <span class=\"comment\">//nullnullnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prev == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        prev.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlink-Node-x\"><a href=\"#unlink-Node-x\" class=\"headerlink\" title=\"unlink( Node x)\"></a><strong>unlink( Node x)</strong></h5><p>x</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">E <span class=\"title function_\">unlink</span><span class=\"params\">(Node&lt;E&gt; x)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert x != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> x.item;</span><br><span class=\"line\">    <span class=\"comment\">// next</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; next = x.next;</span><br><span class=\"line\">    <span class=\"comment\">// prev</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; prev = x.prev;</span><br><span class=\"line\">    <span class=\"comment\">//prevnullnextprevnextxnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prev == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        first = next;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        prev.next = next;</span><br><span class=\"line\">        x.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//nextnullprevnextprevxnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (next == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        last = prev;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        next.prev = prev;</span><br><span class=\"line\">        x.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//xnull</span></span><br><span class=\"line\">    x.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"getFirst\"><a href=\"#getFirst\" class=\"headerlink\" title=\"getFirst()\"></a><strong>getFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">getFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"getLast\"><a href=\"#getLast\" class=\"headerlink\" title=\"getLast()\"></a><strong>getLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">getLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> l.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"removeFirst\"><a href=\"#removeFirst\" class=\"headerlink\" title=\"removeFirst\"></a><strong>removeFirst</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">removeFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"removeLast\"><a href=\"#removeLast\" class=\"headerlink\" title=\"removeLast\"></a><strong>removeLast</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">removeLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlinkLast(l);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addFirst-E-e\"><a href=\"#addFirst-E-e\" class=\"headerlink\" title=\"addFirst( E e)\"></a><strong>addFirst( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkFirst(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addLast-E-e\"><a href=\"#addLast-E-e\" class=\"headerlink\" title=\"addLast( E e)\"></a><strong>addLast( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * add()</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> */</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkLast(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"contains-Object-o\"><a href=\"#contains-Object-o\" class=\"headerlink\" title=\"contains( Object o)\"></a><strong>contains( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * o</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> indexOf(o) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"size\"><a href=\"#size\" class=\"headerlink\" title=\"size()\"></a><strong>size()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"add-E-e\"><a href=\"#add-E-e\" class=\"headerlink\" title=\"add( E e)\"></a><strong>add( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * addLast</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkLast(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove-Object-o\"><a href=\"#remove-Object-o\" class=\"headerlink\" title=\"remove(Object o)\"></a><strong>remove(Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> otrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//onullnulltruenullootrue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item)) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addAll-Collection-lt-extends-E-gt-c\"><a href=\"#addAll-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"addAll( Collection&lt;? extends E&gt; c)\"></a><strong>addAll( Collection&lt;? extends E&gt; c)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">addAll</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> addAll(size, c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addAll-int-index-Collection-lt-extends-E-gt-c\"><a href=\"#addAll-int-index-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"addAll( int index, Collection&lt;? extends E&gt; c)\"></a><strong>addAll( int index, Collection&lt;? extends E&gt; c)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&lt;0index&gt;size</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">addAll</span><span class=\"params\">(<span class=\"type\">int</span> index, Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    checkPositionIndex(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] a = c.toArray();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">numNew</span> <span class=\"operator\">=</span> a.length;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numNew == <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;<span class=\"comment\">//cfalse</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node&lt;E&gt; pred, succ;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == size) &#123;</span><br><span class=\"line\">        succ = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        pred = last;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        succ = node(index);</span><br><span class=\"line\">        pred = succ.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Object o : a) &#123;</span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class=\"type\">E</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> (E) o;</span><br><span class=\"line\">        Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(pred, e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pred == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            first = newNode;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            pred.next = newNode;</span><br><span class=\"line\">        pred = newNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (succ == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        last = pred;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        pred.next = succ;</span><br><span class=\"line\">        succ.prev = pred;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    size += numNew;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear()\"></a><strong>clear()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Clearing all of the links between nodes is &quot;unnecessary&quot;, but:</span></span><br><span class=\"line\">    <span class=\"comment\">// - helps a generational GC if the discarded nodes inhabit</span></span><br><span class=\"line\">    <span class=\"comment\">//   more than one generation</span></span><br><span class=\"line\">    <span class=\"comment\">// - is sure to free memory even if there is a reachable Iterator</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; ) &#123;</span><br><span class=\"line\">        Node&lt;E&gt; next = x.next;</span><br><span class=\"line\">        x.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    first = last = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size = <span class=\"number\">0</span>;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"get-int-index\"><a href=\"#get-int-index\" class=\"headerlink\" title=\"get( int index)\"></a><strong>get( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node(index).item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"set-int-index-E-element\"><a href=\"#set-int-index-E-element\" class=\"headerlink\" title=\"set( int index, E element)\"></a><strong>set( int index, E element)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * element</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> element</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    Node&lt;E&gt; x = node(index);</span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> x.item;</span><br><span class=\"line\">    x.item = element;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldVal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"add-int-index-E-element\"><a href=\"#add-int-index-E-element\" class=\"headerlink\" title=\"add( int index, E element)\"></a><strong>add( int index, E element)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    checkPositionIndex(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == size)</span><br><span class=\"line\">        linkLast(element);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        linkBefore(element, node(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove-int-index\"><a href=\"#remove-int-index\" class=\"headerlink\" title=\"remove( int index)\"></a><strong>remove( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlink(node(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"isElementIndex-int-index\"><a href=\"#isElementIndex-int-index\" class=\"headerlink\" title=\"isElementIndex( int index)\"></a><strong>isElementIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isElementIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt; size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"isPositionIndex-int-index\"><a href=\"#isPositionIndex-int-index\" class=\"headerlink\" title=\"isPositionIndex(int index)\"></a><strong>isPositionIndex(int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPositionIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"outOfBoundsMsg-int-index\"><a href=\"#outOfBoundsMsg-int-index\" class=\"headerlink\" title=\"outOfBoundsMsg( int index)\"></a><strong>outOfBoundsMsg( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String <span class=\"title function_\">outOfBoundsMsg</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Index: &quot;</span>+index+<span class=\"string\">&quot;, Size: &quot;</span>+size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"checkElementIndex-int-index\"><a href=\"#checkElementIndex-int-index\" class=\"headerlink\" title=\"checkElementIndex( int index)\"></a><strong>checkElementIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">checkElementIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isElementIndex(index))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"checkPositionIndex-int-index\"><a href=\"#checkPositionIndex-int-index\" class=\"headerlink\" title=\"checkPositionIndex( int index)\"></a><strong>checkPositionIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">checkPositionIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isPositionIndex(index))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"node-int-index\"><a href=\"#node-int-index\" class=\"headerlink\" title=\"node( int index)\"></a><strong>node( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Node&lt;E&gt; <span class=\"title function_\">node</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert isElementIndex(index);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &lt; (size &gt;&gt; <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = first;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; index; i++)</span><br><span class=\"line\">            x = x.next;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = last;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> size - <span class=\"number\">1</span>; i &gt; index; i--)</span><br><span class=\"line\">            x = x.prev;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"indexOf-Object-o\"><a href=\"#indexOf-Object-o\" class=\"headerlink\" title=\"indexOf( Object o)\"></a><strong>indexOf( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -1.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> -1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">indexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">            index++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">            index++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lastIndexOf-Object-o\"><a href=\"#lastIndexOf-Object-o\" class=\"headerlink\" title=\"lastIndexOf( Object o)\"></a><strong>lastIndexOf( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -1.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> -1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">lastIndexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> size;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = last; x != <span class=\"literal\">null</span>; x = x.prev) &#123;</span><br><span class=\"line\">            index--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = last; x != <span class=\"literal\">null</span>; x = x.prev) &#123;</span><br><span class=\"line\">            index--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"peek\"><a href=\"#peek\" class=\"headerlink\" title=\"peek()\"></a><strong>peek()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peek</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"element\"><a href=\"#element\" class=\"headerlink\" title=\"element()\"></a><strong>element()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">element</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"poll\"><a href=\"#poll\" class=\"headerlink\" title=\"poll()\"></a><strong>poll()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">poll</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove()\"></a><strong>remove()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"offer-E-e\"><a href=\"#offer-E-e\" class=\"headerlink\" title=\"offer(E e)\"></a><strong>offer(E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offer</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> add(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"offerFirst-E-e\"><a href=\"#offerFirst-E-e\" class=\"headerlink\" title=\"offerFirst( E e)\"></a><strong>offerFirst( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offerFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addFirst(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"offerLast-E-e\"><a href=\"#offerLast-E-e\" class=\"headerlink\" title=\"offerLast( E e)\"></a><strong>offerLast( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offerLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addLast(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"peekFirst\"><a href=\"#peekFirst\" class=\"headerlink\" title=\"peekFirst()\"></a><strong>peekFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peekFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"peekLast\"><a href=\"#peekLast\" class=\"headerlink\" title=\"peekLast()\"></a><strong>peekLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peekLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (l == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : l.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pollFirst\"><a href=\"#pollFirst\" class=\"headerlink\" title=\"pollFirst()\"></a><strong>pollFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pollFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pollLast\"><a href=\"#pollLast\" class=\"headerlink\" title=\"pollLast()\"></a><strong>pollLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pollLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (l == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkLast(l);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"push-E-e\"><a href=\"#push-E-e\" class=\"headerlink\" title=\"push( E e)\"></a><strong>push( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * addFirst(e)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addFirst(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pop\"><a href=\"#pop\" class=\"headerlink\" title=\"pop()\"></a><strong>pop()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * pop()</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pop</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"removeFirstOccurrence-Object-o\"><a href=\"#removeFirstOccurrence-Object-o\" class=\"headerlink\" title=\"removeFirstOccurrence( Object o)\"></a><strong>removeFirstOccurrence( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">removeFirstOccurrence</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> remove(o);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/77110354\">https://blog.csdn.net/panweiwei1994/article/details/77110354</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>LinkedList<br>LinkedList</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LinkedList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSequentialList</span>&lt;E&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>LinkedList<E></li>\n<li>extends AbstractSequentialList<E></li>\n<li>AbstractSequentialList AbstractListAbstractSequentialList </li>\n<li> AbstractList LinkedList</li>\n<li>implements List<E></li>\n<li>implements Deque<E>DequeDouble ended queueLinkedList</li>\n<li>implements Cloneableclone()field-for-field</li>\n<li>implements java.io.Serializable</li>\n</ul>\n<p>ArrayListLinkedListRandomAccessRandomAccessLinkedList</p>\n<p>LinkedList</p>\n<p><img src=\"/images/java-linkedlist/java-linkedlist-1.jpg\" alt=\"image\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * LinkedList</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class=\"line\"><span class=\"comment\"> *            (first.prev == null &amp;&amp; first.item != null)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;E&gt; first;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * Invariant: (first == null &amp;&amp; last == null) ||</span></span><br><span class=\"line\"><span class=\"comment\"> *            (last.next == null &amp;&amp; last.item != null)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure>\n\n<p>node<strong>Node.java</strong>Nodeitemnextprev</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>LinkedListArrayList</p>\n<ol>\n<li>LinkedList</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">LinkedList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>LinkedList</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * clinkedListlinkedlistclinkedList</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException cnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">LinkedList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>();</span><br><span class=\"line\">    addAll(c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"linkFirst-E-e\"><a href=\"#linkFirst-E-e\" class=\"headerlink\" title=\"linkFirst(E e)\"></a><strong>linkFirst(E e)</strong></h5><p>e</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">linkFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//f</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"comment\">//newNodenull</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(<span class=\"literal\">null</span>, e, f);</span><br><span class=\"line\">    <span class=\"comment\">//newNode </span></span><br><span class=\"line\">    first = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nullfnewNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        last = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        f.prev = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"linkLast-E-e\"><a href=\"#linkLast-E-e\" class=\"headerlink\" title=\"linkLast(E e)\"></a><strong>linkLast(E e)</strong></h5><p>e</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * e</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">linkLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//l</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"comment\">//newNodelnull</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(l, e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"comment\">//newNode</span></span><br><span class=\"line\">    last = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nulllnewNode</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        l.next = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"linkBefore-E-e-Node-succ\"><a href=\"#linkBefore-E-e-Node-succ\" class=\"headerlink\" title=\"linkBefore( E e, Node succ)\"></a><strong>linkBefore( E e, Node succ)</strong></h5><p>succe</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * succesuccnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">linkBefore</span><span class=\"params\">(E e, Node&lt;E&gt; succ)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert succ != null;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; pred = succ.prev;</span><br><span class=\"line\">    <span class=\"comment\">//newNodepredsucc</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(pred, e, succ);</span><br><span class=\"line\">    <span class=\"comment\">//succnewTouch</span></span><br><span class=\"line\">    succ.prev = newNode;</span><br><span class=\"line\">    <span class=\"comment\">//nullnewTouchpred</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pred == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        pred.next = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlinkFirst-Node-f\"><a href=\"#unlinkFirst-Node-f\" class=\"headerlink\" title=\"unlinkFirst( Node f)\"></a><strong>unlinkFirst( Node f)</strong></h5><p>f</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * f</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> E <span class=\"title function_\">unlinkFirst</span><span class=\"params\">( Node&lt;E&gt; f)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert f == first &amp;&amp; f != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> f.item;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; next = f.next;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    f.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    f.next = <span class=\"literal\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">    <span class=\"comment\">//next</span></span><br><span class=\"line\">    first = next;</span><br><span class=\"line\">    <span class=\"comment\">//nextnullnullnextnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (next == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        last = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        next.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlinkLast-Node-l\"><a href=\"#unlinkLast-Node-l\" class=\"headerlink\" title=\"unlinkLast( Node l)\"></a><strong>unlinkLast( Node l)</strong></h5><p>f</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * l.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> E <span class=\"title function_\">unlinkLast</span><span class=\"params\">(Node&lt;E&gt; l)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert l == last &amp;&amp; l != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> l.item;</span><br><span class=\"line\">    <span class=\"comment\">//prev</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; prev = l.prev;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    l.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    l.prev = <span class=\"literal\">null</span>; <span class=\"comment\">// help GC</span></span><br><span class=\"line\">    <span class=\"comment\">//prev</span></span><br><span class=\"line\">    last = prev;</span><br><span class=\"line\">    <span class=\"comment\">//nullnullnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prev == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        first = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        prev.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"unlink-Node-x\"><a href=\"#unlink-Node-x\" class=\"headerlink\" title=\"unlink( Node x)\"></a><strong>unlink( Node x)</strong></h5><p>x</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">E <span class=\"title function_\">unlink</span><span class=\"params\">(Node&lt;E&gt; x)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert x != null;</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">E</span> <span class=\"variable\">element</span> <span class=\"operator\">=</span> x.item;</span><br><span class=\"line\">    <span class=\"comment\">// next</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; next = x.next;</span><br><span class=\"line\">    <span class=\"comment\">// prev</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; prev = x.prev;</span><br><span class=\"line\">    <span class=\"comment\">//prevnullnextprevnextxnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prev == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        first = next;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        prev.next = next;</span><br><span class=\"line\">        x.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//nextnullprevnextprevxnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (next == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        last = prev;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        next.prev = prev;</span><br><span class=\"line\">        x.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//xnull</span></span><br><span class=\"line\">    x.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size--;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"getFirst\"><a href=\"#getFirst\" class=\"headerlink\" title=\"getFirst()\"></a><strong>getFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">getFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"getLast\"><a href=\"#getLast\" class=\"headerlink\" title=\"getLast()\"></a><strong>getLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">getLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> l.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"removeFirst\"><a href=\"#removeFirst\" class=\"headerlink\" title=\"removeFirst\"></a><strong>removeFirst</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">removeFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"removeLast\"><a href=\"#removeLast\" class=\"headerlink\" title=\"removeLast\"></a><strong>removeLast</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">removeLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (l == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchElementException</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlinkLast(l);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addFirst-E-e\"><a href=\"#addFirst-E-e\" class=\"headerlink\" title=\"addFirst( E e)\"></a><strong>addFirst( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkFirst(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addLast-E-e\"><a href=\"#addLast-E-e\" class=\"headerlink\" title=\"addLast( E e)\"></a><strong>addLast( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * add()</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> */</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkLast(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"contains-Object-o\"><a href=\"#contains-Object-o\" class=\"headerlink\" title=\"contains( Object o)\"></a><strong>contains( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * o</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> indexOf(o) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"size\"><a href=\"#size\" class=\"headerlink\" title=\"size()\"></a><strong>size()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"add-E-e\"><a href=\"#add-E-e\" class=\"headerlink\" title=\"add( E e)\"></a><strong>add( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * addLast</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    linkLast(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove-Object-o\"><a href=\"#remove-Object-o\" class=\"headerlink\" title=\"remove(Object o)\"></a><strong>remove(Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> otrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//onullnulltruenullootrue</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item)) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addAll-Collection-lt-extends-E-gt-c\"><a href=\"#addAll-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"addAll( Collection&lt;? extends E&gt; c)\"></a><strong>addAll( Collection&lt;? extends E&gt; c)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">addAll</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> addAll(size, c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"addAll-int-index-Collection-lt-extends-E-gt-c\"><a href=\"#addAll-int-index-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"addAll( int index, Collection&lt;? extends E&gt; c)\"></a><strong>addAll( int index, Collection&lt;? extends E&gt; c)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&lt;0index&gt;size</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">addAll</span><span class=\"params\">(<span class=\"type\">int</span> index, Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    checkPositionIndex(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    Object[] a = c.toArray();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">numNew</span> <span class=\"operator\">=</span> a.length;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numNew == <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;<span class=\"comment\">//cfalse</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node&lt;E&gt; pred, succ;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == size) &#123;</span><br><span class=\"line\">        succ = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        pred = last;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        succ = node(index);</span><br><span class=\"line\">        pred = succ.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Object o : a) &#123;</span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class=\"type\">E</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> (E) o;</span><br><span class=\"line\">        Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>&lt;&gt;(pred, e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pred == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            first = newNode;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            pred.next = newNode;</span><br><span class=\"line\">        pred = newNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (succ == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        last = pred;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        pred.next = succ;</span><br><span class=\"line\">        succ.prev = pred;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    size += numNew;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear()\"></a><strong>clear()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Clearing all of the links between nodes is &quot;unnecessary&quot;, but:</span></span><br><span class=\"line\">    <span class=\"comment\">// - helps a generational GC if the discarded nodes inhabit</span></span><br><span class=\"line\">    <span class=\"comment\">//   more than one generation</span></span><br><span class=\"line\">    <span class=\"comment\">// - is sure to free memory even if there is a reachable Iterator</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; ) &#123;</span><br><span class=\"line\">        Node&lt;E&gt; next = x.next;</span><br><span class=\"line\">        x.item = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x.prev = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        x = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    first = last = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    size = <span class=\"number\">0</span>;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"get-int-index\"><a href=\"#get-int-index\" class=\"headerlink\" title=\"get( int index)\"></a><strong>get( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> node(index).item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"set-int-index-E-element\"><a href=\"#set-int-index-E-element\" class=\"headerlink\" title=\"set( int index, E element)\"></a><strong>set( int index, E element)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * element</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> element</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    Node&lt;E&gt; x = node(index);</span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldVal</span> <span class=\"operator\">=</span> x.item;</span><br><span class=\"line\">    x.item = element;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldVal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"add-int-index-E-element\"><a href=\"#add-int-index-E-element\" class=\"headerlink\" title=\"add( int index, E element)\"></a><strong>add( int index, E element)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    checkPositionIndex(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == size)</span><br><span class=\"line\">        linkLast(element);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        linkBefore(element, node(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove-int-index\"><a href=\"#remove-int-index\" class=\"headerlink\" title=\"remove( int index)\"></a><strong>remove( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    checkElementIndex(index);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlink(node(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"isElementIndex-int-index\"><a href=\"#isElementIndex-int-index\" class=\"headerlink\" title=\"isElementIndex( int index)\"></a><strong>isElementIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isElementIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt; size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"isPositionIndex-int-index\"><a href=\"#isPositionIndex-int-index\" class=\"headerlink\" title=\"isPositionIndex(int index)\"></a><strong>isPositionIndex(int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPositionIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> index &gt;= <span class=\"number\">0</span> &amp;&amp; index &lt;= size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"outOfBoundsMsg-int-index\"><a href=\"#outOfBoundsMsg-int-index\" class=\"headerlink\" title=\"outOfBoundsMsg( int index)\"></a><strong>outOfBoundsMsg( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String <span class=\"title function_\">outOfBoundsMsg</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Index: &quot;</span>+index+<span class=\"string\">&quot;, Size: &quot;</span>+size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"checkElementIndex-int-index\"><a href=\"#checkElementIndex-int-index\" class=\"headerlink\" title=\"checkElementIndex( int index)\"></a><strong>checkElementIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">checkElementIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isElementIndex(index))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"checkPositionIndex-int-index\"><a href=\"#checkPositionIndex-int-index\" class=\"headerlink\" title=\"checkPositionIndex( int index)\"></a><strong>checkPositionIndex( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">checkPositionIndex</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isPositionIndex(index))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"node-int-index\"><a href=\"#node-int-index\" class=\"headerlink\" title=\"node( int index)\"></a><strong>node( int index)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Node&lt;E&gt; <span class=\"title function_\">node</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert isElementIndex(index);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &lt; (size &gt;&gt; <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = first;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; index; i++)</span><br><span class=\"line\">            x = x.next;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = last;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> size - <span class=\"number\">1</span>; i &gt; index; i--)</span><br><span class=\"line\">            x = x.prev;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"indexOf-Object-o\"><a href=\"#indexOf-Object-o\" class=\"headerlink\" title=\"indexOf( Object o)\"></a><strong>indexOf( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -1.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> -1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">indexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">            index++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"literal\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">            index++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"lastIndexOf-Object-o\"><a href=\"#lastIndexOf-Object-o\" class=\"headerlink\" title=\"lastIndexOf( Object o)\"></a><strong>lastIndexOf( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * -1.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> -1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">lastIndexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> size;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = last; x != <span class=\"literal\">null</span>; x = x.prev) &#123;</span><br><span class=\"line\">            index--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = last; x != <span class=\"literal\">null</span>; x = x.prev) &#123;</span><br><span class=\"line\">            index--;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"peek\"><a href=\"#peek\" class=\"headerlink\" title=\"peek()\"></a><strong>peek()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peek</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"element\"><a href=\"#element\" class=\"headerlink\" title=\"element()\"></a><strong>element()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">element</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"poll\"><a href=\"#poll\" class=\"headerlink\" title=\"poll()\"></a><strong>poll()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">poll</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"remove\"><a href=\"#remove\" class=\"headerlink\" title=\"remove()\"></a><strong>remove()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"offer-E-e\"><a href=\"#offer-E-e\" class=\"headerlink\" title=\"offer(E e)\"></a><strong>offer(E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.5</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offer</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> add(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><h5 id=\"offerFirst-E-e\"><a href=\"#offerFirst-E-e\" class=\"headerlink\" title=\"offerFirst( E e)\"></a><strong>offerFirst( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offerFirst</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addFirst(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"offerLast-E-e\"><a href=\"#offerLast-E-e\" class=\"headerlink\" title=\"offerLast( E e)\"></a><strong>offerLast( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * .</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  true</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">offerLast</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addLast(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"peekFirst\"><a href=\"#peekFirst\" class=\"headerlink\" title=\"peekFirst()\"></a><strong>peekFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peekFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : f.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"peekLast\"><a href=\"#peekLast\" class=\"headerlink\" title=\"peekLast()\"></a><strong>peekLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">peekLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (l == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : l.item;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pollFirst\"><a href=\"#pollFirst\" class=\"headerlink\" title=\"pollFirst()\"></a><strong>pollFirst()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pollFirst</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (f == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pollLast\"><a href=\"#pollLast\" class=\"headerlink\" title=\"pollLast()\"></a><strong>pollLast()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * null.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> null.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pollLast</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; l = last;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (l == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : unlinkLast(l);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"push-E-e\"><a href=\"#push-E-e\" class=\"headerlink\" title=\"push( E e)\"></a><strong>push( E e)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * addFirst(e)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">push</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    addFirst(e);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"pop\"><a href=\"#pop\" class=\"headerlink\" title=\"pop()\"></a><strong>pop()</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * pop()</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoSuchElementException </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">pop</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeFirst();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"removeFirstOccurrence-Object-o\"><a href=\"#removeFirstOccurrence-Object-o\" class=\"headerlink\" title=\"removeFirstOccurrence( Object o)\"></a><strong>removeFirstOccurrence( Object o)</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> o </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">removeFirstOccurrence</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> remove(o);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/77110354\">https://blog.csdn.net/panweiwei1994/article/details/77110354</a></p>\n"},{"title":"java HashMap","date":"2021-05-17T06:30:04.000Z","_content":"\nJDK1.8\n\n# \n\n![image](/images/java-hashmap/java-hash-map-1.jpg)\n\nHashMap++since JDK1.8****keyhashhash****(jdk1.7)key-valuehash8(TREEIFY_THRESHOLD)\n\n# \n\n> HashMapMapMapkeyvaluenullHashMapunsynchronizednullHashMapHashTable\n> \n> (get  put) collection  HashMap -initial capacityload factor\n> \n> HashMapinitial capacityload factorinitial capacity*load factorinitial capacity*load factorHashMaprehashed\n> \n>  (0.75)  HashMap get  put rehashrehash \n> \n>  HashMap  rehash \n> \n>  Collections.synchronizedMap \n> \n> Map m = Collections.synchronizedMap(new HashMap());\n> \n> collection fail-fast remove ConcurrentModificationException\n> \n>  ConcurrentModificationExceptionbug\n>\n>  Java Collections Framework \n>\n> @author Doug Lea\n> @author Josh Bloch\n> @author Arthur van Hoff\n> @author Neal Gafter\n> @see Object#hashCode()\n> @see Collection\n> @see Map\n> @see TreeMap\n\n\n\n- ****HashMapMap\n- **null**HashMapkeyvaluenull\n- ****HashMap\n- **rehash**initial capacity*load factorinitial capacity*load factorHashMaprehashed\n- ****rehashrehashrehash\n- ****0.75rehash\n- ****HashMap\n- ****fast-fail\n\n# \n\n```java\npublic class HashMap<K,V> extends AbstractMap<K,V> implements Map<K,V>, Cloneable, Serializable\n```\n\n- HashMap<K,V>HashMapkey-value\n- extends AbstractMap<K,V>AbstractMapMap\n- implements Map<K,V>MapMap\n- implements Cloneableclone()field-for-field\n- implements Serializable\n\nHashMap\n\n![image](/images/java-hashmap/java-hash-map-2.jpg)\n\n# \n\n```java\n/**\n * 16\n * 2n.\n */\nstatic final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16\n\n/**\n * , MAXIMUM_CAPACITY.\n * 21<<30230\n */\nstatic final int MAXIMUM_CAPACITY = 1 << 30;\n\n/**\n * \n */\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n\n/**\n * \n * TREEIFY_THRESHOLD\n * 8\n */\nstatic final int TREEIFY_THRESHOLD = 8;\n\n/**\n * \n * TREEIFY_THRESHOLD6\n */\nstatic final int UNTREEIFY_THRESHOLD = 6;\n\n/**\n * \n * 4*TREEIFY_THRESHOLD\n */\nstatic final int MIN_TREEIFY_CAPACITY = 64;\n```\n\n# Node\n\n```java\n/**\n * HashMapHashMap\n */\nstatic class Node<K,V> implements Map.Entry<K,V> {\n    //key\n    final int hash;\n    final K key;\n    V value;\n    //\n    Node<K,V> next;\n    //\n    Node(int hash, K key, V value, Node<K,V> next) {\n        this.hash = hash;\n        this.key = key;\n        this.value = value;\n        this.next = next;\n    }\n\n    public final K getKey()        { return key; }\n    public final V getValue()      { return value; }\n    public final String toString() { return key + \"=\" + value; }\n\n    public final int hashCode() {\n        return Objects.hashCode(key) ^ Objects.hashCode(value);\n    }\n\n    public final V setValue(V newValue) {\n        V oldValue = value;\n        value = newValue;\n        return oldValue;\n    }\n\n    public final boolean equals(Object o) {\n        if (o == this)\n            return true;\n        if (o instanceof Map.Entry) {\n            Map.Entry<?,?> e = (Map.Entry<?,?>)o;\n            if (Objects.equals(key, e.getKey()) &&\n                Objects.equals(value, e.getValue()))\n                return true;\n        }\n        return false;\n    }\n}\n```\n\n# \n\n## get( Object key)\n\n```java\n/**\n * keyvaluevaluenullnull\n *\n * @see #put(Object, Object)\n */\npublic V get(Object key) {\n    Node<K,V> e;\n    //keynodenullnullnodevaluegetNode\n    return (e = getNode(hash(key), key)) == null ? null : e.value;\n}\n```\n\nget(E e)\n\n1. hash(Object key)keyhash\n2. getNode( int hash, Object key)node\n3. nodenullnullnode.value\n\n\n\n\n```java\n(n - 1) & hash\n```\n\nnhashhash(key)\n\n```java\n/**\n * key\n */\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n```\n\nkeyhashCodekeyhashCode1616\n\n![image](/images/java-hashmap/java-hash-map-3.jpg)\n\n****\n\nn16n-1150000 0000 0000 0000 0000 0000 0000 1111hashCode()4\n\nkeyhashnode\n\n## getNode( int hash, Object key)\n\n```java\n/**\n * keykey\n * \n * @param hash key\n * @param key key\n * @return nodenull\n */\nfinal Node<K,V> getNode(int hash, Object key) {\n    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;\n    //key\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        //hashkey\n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            //\n            return first;\n        //\n        if ((e = first.next) != null) {\n            //get\n            if (first instanceof TreeNode)\n                return ((TreeNode<K,V>)first).getTreeNode(hash, key);\n            //\n            do {\n                //key\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    //null\n    return null;\n}\n```\n\n### get\n\nget(E e)\n\n1. hash(Object key)keyhash\n2. getNode( int hash, Object key)node\n3. nodenullnullnode.value\n\nhash\n1. keyhashCode\n2. keyhashCode1616\n3. \n\ngetNode\n\n1. keynull\n2. hashkey\n3. \n   1. get\n   2. key\n4. null\n\n## put( K key, V value)\n\n```java\n/**\n * keyvaluemapkeykeyvalue\n * \n * @param key key\n * @param value value\n * @return valuevaluenullkeyvaluenull\n */\npublic V put(K key, V value) {\n    //putVal\n    return putVal(hash(key), key, value, false, true);\n}\n```\n\nput(K key, V value)\n\n1. hash(Object key)key\n2. putVal(hash(key), key, value, false, true)\n3. putVal\n\nputVal\n\n## putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\n\n```java\n/**\n * Map.put\n * \n * @param hash key\n * @param key key\n * @param value value\n * @param onlyIfAbsent truekeymapvalue\n * @param evict falsetable\n * @return valuevaluenullkeyvaluenull\n */\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) {\n    Node<K,V>[] tab; Node<K,V> p; int n, i;\n    //resize()n\n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    //hash\n    if ((p = tab[i = (n - 1) & hash]) == null)\n        //map\n        tab[i] = newNode(hash, key, value, null);\n    else {\n        Node<K,V> e; K k;\n        //\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            //\n            e = p;\n        //\n        else if (p instanceof TreeNode)\n            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n        //\n        else {\n            //\n            for (int binCount = 0; ; ++binCount) {\n                //\n                if ((e = p.next) == null) {\n                    //\n                    p.next = newNode(hash, key, value, null);\n                    //TREEIFY_THRESHOLD\n                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                        treeifyBin(tab, hash);\n                    //\n                    break;\n                }\n                //keykeykey\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    break;\n                //e = p.next\n                p = e;\n            }\n        }\n        //keynull\n        if (e != null) { // existing mapping for key\n            //vlaue\n            V oldValue = e.value;\n            //onlyIfAbsentfalseoldValuenull\n            if (!onlyIfAbsent || oldValue == null)\n                //value\n                e.value = value;\n            //\n            afterNodeAccess(e);\n            //\n            return oldValue;\n        }\n    }\n    //+1\n    ++modCount;\n    //\n    if (++size > threshold)\n        resize();\n    //\n    afterNodeInsertion(evict);\n    return null;\n}\n```\n\nputVal\n\n1. resize()\n2. hash\n3. key\n   1. \n   2. \n   3. keyTREEIFY_THRESHOLDtreeifyBin\n4. keynull\n   1. vlaue\n   2. onlyIfAbsentfalseoldValuenullvalue\n   3. value\n5. key23hashMapsize1sizethresholdresize\n\n## resize()\nhashMapHashMaphashMap\n\nresizen-1&hash+\n\n```java\n/**\n * table\n * tablenulltable\n * tablen-1&hash+\n */\nfinal Node<K,V>[] resize() {\n    //oldTabtable\n    Node<K,V>[] oldTab = table;\n    //oldCaptable\n    int oldCap = (oldTab == null) ? 0 : oldTab.length;\n    //\n    int oldThr = threshold;\n    int newCap, newThr = 0;\n    // > 0\n    if (oldCap > 0) {\n        //>=MAXIMUM_CAPACITY\n        if (oldCap >= MAXIMUM_CAPACITY) {\n            //\n            threshold = Integer.MAX_VALUE;\n            //\n            return oldTab;\n        }\n        //MAXIMUM_CAPACITYDEFAULT_INITIAL_CAPACITY\n        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&oldCap >= DEFAULT_INITIAL_CAPACITY)\n            //2\n            newThr = oldThr << 1; \n    }// <= 0 > 0\n    else if (oldThr > 0) \n        //\n        newCap = oldThr;\n    else {// <= 0 <= 0DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY\n        newCap = DEFAULT_INITIAL_CAPACITY;\n        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n    }\n    if (newThr == 0) {//oldThr > 0newThr == 0\n        //ft\n        float ft = (float)newCap * loadFactor;\n        //< MAXIMUM_CAPACITYft < (float)MAXIMUM_CAPACITYftInteger.MAX_VALUE\n        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?\n                  (int)ft : Integer.MAX_VALUE);\n    }\n    //hashMapnewThr\n    threshold = newThr;\n    //tablenewCap\n    @SuppressWarnings({\"rawtypes\",\"unchecked\"})\n        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];\n    //hashMaptablenewTab\n    table = newTab;\n    //tabletabletable\n    if (oldTab != null) {\n        //\n        for (int j = 0; j < oldCap; ++j) {\n            Node<K,V> e;\n            //nulle\n            if ((e = oldTab[j]) != null) {\n                //null\n                oldTab[j] = null;\n                //node\n                if (e.next == null)\n                    //eoldTab[j]newTabe.hash & (newCap - 1)\n                    newTab[e.hash & (newCap - 1)] = e;\n                //\n                else if (e instanceof TreeNode)\n                    //node\n                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);\n                else { //hash\n                    Node<K,V> loHead = null, loTail = null;\n                    Node<K,V> hiHead = null, hiTail = null;\n                    Node<K,V> next;\n                    //\n                    do {\n                        next = e.next;\n                        //\n                        if ((e.hash & oldCap) == 0) {\n                            if (loTail == null)\n                                loHead = e;\n                            else\n                                loTail.next = e;\n                            loTail = e;\n                        }\n                        else {\n                            if (hiTail == null)\n                                hiHead = e;\n                            else\n                                hiTail.next = e;\n                            hiTail = e;\n                        }\n                    } while ((e = next) != null);\n                    if (loTail != null) {\n                        loTail.next = null;\n                        newTab[j] = loHead;\n                    }\n                    if (hiTail != null) {\n                        hiTail.next = null;\n                        newTab[j + oldCap] = hiHead;\n                    }\n                }\n            }\n        }\n    }\n    return newTab;\n}\n```\n\nHashMapmapmap\n\nresize\n\n1. \n2. hashMap\n3. hashMaptable\n4. table\n\n## remove( Object key)\n\n```java\n/**\n * hashMapkeynode\n *\n * @param  key key\n * @return nodenullvalue\n */\npublic V remove(Object key) {\n    Node<K,V> e;\n    //keynoderemoveNode\n    return (e = removeNode(hash(key), key, null, false, true)) == null ?\n        null : e.value;\n}\n```\n\nremove\n\n1. hash(Object key)key\n2. removeNode\n3. nodevalue\n\nremoveNode\n\n## removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\n\n```java\n/**\n * Map.remove\n * node\n * \n * @param hash key\n * @param key key\n * @param value matchValuetruevaluenode\n * @param matchValue truevaluenode\n * @param movable falsenodenode\n * @return nodenodenull\n */\nfinal Node<K,V> removeNode(int hash, Object key, Object value,boolean matchValue, boolean movable) {\n    Node<K,V>[] tab; Node<K,V> p; int n, index;\n    //tablekey\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (p = tab[index = (n - 1) & hash]) != null) {\n        //\n        Node<K,V> node = null, e; K k; V v;\n        //nodenode\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            //node\n            node = p;\n        else if ((e = p.next) != null) {//node\n            if (p instanceof TreeNode)//\n                //keynode\n                node = ((TreeNode<K,V>)p).getTreeNode(hash, key);\n            else {//\n                do {//keynode\n                    if (e.hash == hash &&\n                        ((k = e.key) == key ||\n                         (key != null && key.equals(k)))) {\n                        //keynode\n                        node = e;\n                        break;\n                    }\n                    p = e;\n                } while ((e = e.next) != null);\n            }\n        }\n        //nodenull(matchValuefalse||node.valuevalue)\n        if (node != null && (!matchValue || (v = node.value) == value || (value != null && value.equals(v)))) {\n            //\n            if (node instanceof TreeNode)\n                //node\n                ((TreeNode<K,V>)node).removeTreeNode(this, tab, movable);\n            else if (node == p)//nodenode\n                //node\n                tab[index] = node.next;\n            else//node\n                p.next = node.next;\n            //+1\n            ++modCount;\n            //-1\n            --size;\n            afterNodeRemoval(node);\n            //node\n            return node;\n        }\n    }\n    //tablekeynull\n    return null;\n}\n```\n\nremoveNode\n\n1. tablekeynull\n2. keynodenode\n3. nodekeynode\n4. keynode\n5. nodenullnodesize-1\n6. node\n\n# \n\n## hash( Object key)\n\n\n\n## comparableClassFor( Object x)\n\n```java\n/**\n * xComparablexnull\n */\nstatic Class<?> comparableClassFor(Object x) {\n    if (x instanceof Comparable) {\n        Class<?> c; Type[] ts, as; Type t; ParameterizedType p;\n        if ((c = x.getClass()) == String.class) // bypass checks\n            return c;\n        if ((ts = c.getGenericInterfaces()) != null) {\n            for (int i = 0; i < ts.length; ++i) {\n                if (((t = ts[i]) instanceof ParameterizedType) &&\n                    ((p = (ParameterizedType)t).getRawType() ==\n                     Comparable.class) &&\n                    (as = p.getActualTypeArguments()) != null &&\n                    as.length == 1 && as[0] == c) // type arg is c\n                    return c;\n            }\n        }\n    }\n    return null;\n}\n```\n\n## compareComparables( Class<?> kc, Object k, Object x)\n\n```java\n/**\n * xkck.compareTo(x)0.\n */\n@SuppressWarnings({\"rawtypes\",\"unchecked\"}) // for cast to Comparable\nstatic int compareComparables(Class<?> kc, Object k, Object x) {\n    return (x == null || x.getClass() != kc ? 0 :\n            ((Comparable)k).compareTo(x));\n}\n```\n\n\n\n## tableSizeFor( int cap)\n\n```java\n/**\n * cap\n */\nstatic final int tableSizeFor(int cap) {\n    int n = cap - 1;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n```\n\n# \n\n```java\n/**\n * 2\n */\ntransient Node<K,V>[] table;\n\n/**\n * entrySetKeyhashCode\n */\ntransient Set<Map.Entry<K,V>> entrySet;\n\n/**\n * \n */\ntransient int size;\n\n/**\n * HashMap\n * rehash\n * HashMapfail-fastConcurrentModificationException\n */\ntransient int modCount;\n\n/**\n * capacity * load factorHashMap\n * @serial\n */\n\nint threshold;\n\n/**\n * \n *\n * @serial\n */\nfinal float loadFactor;\n```\n\n# \n## HashMap( int initialCapacity, float loadFactor)\n\n```java\n/**\n * initial capacity load factorHashMap\n *\n * @param  initialCapacity \n * @param  loadFactor      \n * @throws IllegalArgumentException \n */\npublic HashMap(int initialCapacity, float loadFactor) {\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException(\"Illegal initial capacity: \" +\n                                           initialCapacity);\n    if (initialCapacity > MAXIMUM_CAPACITY)\n        initialCapacity = MAXIMUM_CAPACITY;\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new IllegalArgumentException(\"Illegal load factor: \" +\n                                           loadFactor);\n    this.loadFactor = loadFactor;\n    this.threshold = tableSizeFor(initialCapacity);\n}\n```\n\n## HashMap( int initialCapacity)\n\n```java\n/**\n * initial capacityDEFAULT_LOAD_FACTOR0.75HashMap\n *\n * @param  initialCapacity \n * @throws IllegalArgumentException \n */\npublic HashMap(int initialCapacity) {\n    this(initialCapacity, DEFAULT_LOAD_FACTOR);\n}\n```\n\n## HashMap()\n\n```java\n/**\n * 16DEFAULT_LOAD_FACTOR0.75HashMap\n */\npublic HashMap() {\n    this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted\n}\n```\n\n## HashMap( Map<? extends K, ? extends V>m)\n\n```java\n/**\n * Map mHashMap16DEFAULT_LOAD_FACTOR0.75\n * @param   m map\n * @throws  NullPointerException mapnull\n */\npublic HashMap(Map<? extends K, ? extends V> m) {\n    this.loadFactor = DEFAULT_LOAD_FACTOR;\n    putMapEntries(m, false);\n}\n```\n\n# \n\n## putMapEntries(Map<? extends K, ? extends V> m, boolean evict)\n\n```java\n/**\n * Map.putAll and Map constructor\n * mmap\n * \n * @param m the map\n * @param evict mapfalsetrue\n */\nfinal void putMapEntries(Map<? extends K, ? extends V> m, boolean evict) {\n    int s = m.size();\n    //map\n    if (s > 0) {\n        //table\n        if (table == null) { // pre-size\n            //initial capacity*load factorhashMaps/loadFactor+1\n            float ft = ((float)s / loadFactor) + 1.0F;\n            //ftMAXIMUM_CAPACITYftMAXIMUM_CAPACITY\n            int t = ((ft < (float)MAXIMUM_CAPACITY) ?\n                     (int)ft : MAXIMUM_CAPACITY);\n            //\n            if (t > threshold)\n                //\n                threshold = tableSizeFor(t);\n        }\n        //tablemap\n        else if (s > threshold)\n            //\n            resize();\n        //maphashMap\n        for (Map.Entry<? extends K, ? extends V> e : m.entrySet()) {\n            K key = e.getKey();\n            V value = e.getValue();\n            //putVal\n            putVal(hash(key), key, value, false, evict);\n        }\n    }\n}\n```\n\n## size()\n\n```java\n/**\n * map\n * \n * @return map\n */\npublic int size() {\n    return size;\n}\n```\n\n## isEmpty()\n\n```java\n/**\n * maptrue\n * \n * @return <maptrue\n */\npublic boolean isEmpty() {\n    return size == 0;\n}\n```\n\n## get( Object key)\n\n\n\n## getNode( int hash, Object key)\n\n\n\n## containsKey( Object key)\n\n```java\n/**\n * mapkeykeytrue\n * \n * @param   key   key\n * @return mapkeykeytrue\n */\npublic boolean containsKey(Object key) {\n    return getNode(hash(key), key) != null;\n}\n```\n\n## put( K key, V value)\n\n\n\n## putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\n\n\n\n## resize()\n\n\n\n## treeifyBin( Node<K,V>[] tab, int hash)\n\n```java\n/**\n * \n */\nfinal void treeifyBin(Node<K,V>[] tab, int hash) {\n    int n, index; Node<K,V> e;\n    //tabletableMIN_TREEIFY_CAPACITY\n    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)\n        //\n        resize();\n    else if ((e = tab[index = (n - 1) & hash]) != null) {//hashnull\n        TreeNode<K,V> hd = null, tl = null;\n        //\n        do {\n            //nodenode\n            TreeNode<K,V> p = replacementTreeNode(e, null);\n            //\n            if (tl == null)\n                hd = p;\n            else {\n                p.prev = tl;\n                tl.next = p;\n            }\n            tl = p;\n        } while ((e = e.next) != null);\n        //\n        if ((tab[index] = hd) != null)\n            hd.treeify(tab);\n    }\n}\n```\n\n## putAll( Map<? extends K, ? extends V> m)\n\n```java\n/**\n * maphashMapvalue\n * @param m map\n * @throws NullPointerException mapnull\n */\npublic void putAll(Map<? extends K, ? extends V> m) {\n    putMapEntries(m, true);\n}\n```\n\n## remove( Object key)\n\n\n\n## removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\n\n\n\n## clear()\n\n```java\n/**\n * map\n */\npublic void clear() {\n    Node<K,V>[] tab;\n    modCount++;\n    if ((tab = table) != null && size > 0) {\n        size = 0;\n        for (int i = 0; i < tab.length; ++i)\n            tab[i] = null;\n    }\n}\n```\n\n## containsValue( Object value)\n\n```java\n/**\n * hashMapvaluevaluetrue\n *\n * @param value value\n * @return hashMapvaluevaluetrue\n */\npublic boolean containsValue(Object value) {\n    Node<K,V>[] tab; V v;\n    //\n    if ((tab = table) != null && size > 0) {\n        //table\n        for (int i = 0; i < tab.length; ++i) {\n            //node\n            for (Node<K,V> e = tab[i]; e != null; e = e.next) {\n                if ((v = e.value) == value ||\n                    (value != null && value.equals(v)))\n                    return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\n# \n\n## keySet()\n\n```java\n/**\n * hashMapkey\n * hashMapset\n * sethashMap(remove())\n * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapkeyset\n */\npublic Set<K> keySet() {\n    //\n    Set<K> ks = keySet;\n    if (ks == null) {\n        ks = new KeySet();\n        keySet = ks;\n    }\n    return ks;\n}\n\n/**\n * KeySet\n */\nfinal class KeySet extends AbstractSet<K> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<K> iterator()     { return new KeyIterator(); }\n    public final boolean contains(Object o) { return containsKey(o); }\n    public final boolean remove(Object key) {\n        return removeNode(hash(key), key, null, false, true) != null;\n    }\n    public final Spliterator<K> spliterator() {\n        return new KeySpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super K> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e.key);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n## values()\n\n```java\n/**\n * hashMapvaluecollection\n * hashMapcollection\n * collectionhashMapremove()\n * collectionIterator.removeCollection.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapkeycollection\n */\npublic Collection<V> values() {\n    Collection<V> vs = values;\n    if (vs == null) {\n        vs = new Values();\n        values = vs;\n    }\n    return vs;\n}\n\n/**\n * Values\n */\nfinal class Values extends AbstractCollection<V> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<V> iterator()     { return new ValueIterator(); }\n    public final boolean contains(Object o) { return containsValue(o); }\n    public final Spliterator<V> spliterator() {\n        return new ValueSpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super V> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e.value);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n## entrySet()\n\n```java\n/**\n * hashMapset\n * hashMapset\n * sethashMap(remove())\n * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapset\n */\npublic Set<Map.Entry<K,V>> entrySet() {\n    Set<Map.Entry<K,V>> es;\n    return (es = entrySet) == null ? (entrySet = new EntrySet()) : es;\n}\n\n/**\n * EntrySet\n */\nfinal class EntrySet extends AbstractSet<Map.Entry<K,V>> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<Map.Entry<K,V>> iterator() {\n        return new EntryIterator();\n    }\n    public final boolean contains(Object o) {\n        if (!(o instanceof Map.Entry))\n            return false;\n        Map.Entry<?,?> e = (Map.Entry<?,?>) o;\n        Object key = e.getKey();\n        Node<K,V> candidate = getNode(hash(key), key);\n        return candidate != null && candidate.equals(e);\n    }\n    public final boolean remove(Object o) {\n        if (o instanceof Map.Entry) {\n            Map.Entry<?,?> e = (Map.Entry<?,?>) o;\n            Object key = e.getKey();\n            Object value = e.getValue();\n            return removeNode(hash(key), key, value, true, true) != null;\n        }\n        return false;\n    }\n    public final Spliterator<Map.Entry<K,V>> spliterator() {\n        return new EntrySpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super Map.Entry<K,V>> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n# JDK8\n\n## getOrDefault( Object key, V defaultValue)\n\n```java\n/**\n * keynodedefaultValue\n *\n * @return keynodedefaultValue\n */\n@Override\npublic V getOrDefault(Object key, V defaultValue) {\n    Node<K,V> e;\n    return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;\n}\n```\n\n## putIfAbsent( K key, V value)\n\n```java\n/**\n * hashMapkeyvaluekeyhashMapvalue\n *\n * @return keyhashMapvalue\n */\n@Override\npublic V putIfAbsent(K key, V value) {\n    return putVal(hash(key), key, value, true, true);\n}\n```\n\n## remove( Object key, Object value)\n\n```java\n/**\n * hashMapkeykeyvaluevalue\n *\n * @return true\n */\n@Override\npublic boolean remove(Object key, Object value) {\n    return removeNode(hash(key), key, value, true, true) != null;\n}\n```\n\n## replace( K key, V oldValue, V newValue)\n\n```java\n/**\n * newValuekeyoldValuevalue\n * \n * @return true\n */\n@Override\npublic boolean replace(K key, V oldValue, V newValue) {\n    Node<K,V> e; V v;\n    if ((e = getNode(hash(key), key)) != null &&\n        ((v = e.value) == oldValue || (v != null && v.equals(oldValue)))) {\n        e.value = newValue;\n        afterNodeAccess(e);\n        return true;\n    }\n    return false;\n}\n```\n\n## replace( K key, V value)\n\n```java\n/**\n * valuekeyvalue\n * \n * @return true\n */\n@Override\npublic V replace(K key, V value) {\n    Node<K,V> e;\n    if ((e = getNode(hash(key), key)) != null) {\n        V oldValue = e.value;\n        e.value = value;\n        afterNodeAccess(e);\n        return oldValue;\n    }\n    return null;\n}\n```\n\n## clone()\n\n```java\n/**\n * \n * cloneHashMapHashMaptableHashMap\n * HashMapcloneclone\n *\n * @return hashMap\n */\n@SuppressWarnings(\"unchecked\")\n@Override\npublic Object clone() {\n    HashMap<K,V> result;\n    try {\n        result = (HashMap<K,V>)super.clone();\n    } catch (CloneNotSupportedException e) {\n        // this shouldn't happen, since we are Cloneable\n        throw new InternalError(e);\n    }\n    result.reinitialize();\n    result.putMapEntries(this, false);\n    return result;\n}\n```\n\n## loadFactor()\n\n```java\n// These methods are also used when serializing HashSets\nfinal float loadFactor() { return loadFactor; }\n```\n\n## capacity()\n\n```java\n// These methods are also used when serializing HashSets\nfinal int capacity() {\n    return (table != null) ? table.length :\n        (threshold > 0) ? threshold :\n        DEFAULT_INITIAL_CAPACITY;\n}\n```\n\n## writeObject( java.io.ObjectOutputStream s)\n\n```java\n/**\n * hashMapObjectOutputStream\n * hashMapcapacitysizeObjectOutputStream\n */\nprivate void writeObject(java.io.ObjectOutputStream s)\n    throws IOException {\n    int buckets = capacity();\n    // Write out the threshold, loadfactor, and any hidden stuff\n    s.defaultWriteObject();\n    //\n    s.writeInt(buckets);\n    //\n    s.writeInt(size);\n    //\n    internalWriteEntries(s);\n}\n\n// hashMapObjectOutputStream\nvoid internalWriteEntries(java.io.ObjectOutputStream s) throws IOException {\n    Node<K,V>[] tab;\n    if (size > 0 && (tab = table) != null) {\n        for (int i = 0; i < tab.length; ++i) {\n            for (Node<K,V> e = tab[i]; e != null; e = e.next) {\n                s.writeObject(e.key);\n                s.writeObject(e.value);\n            }\n        }\n    }\n}\n```\n\n## readObject( java.io.ObjectInputStream s)\n\n```java\n/**\n * ObjectOutputStreamhashMap\n * hashMapcapacitysize\n */\nprivate void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException {\n    // hashMapcapacitysize\n    s.defaultReadObject();\n    //hashMap\n    reinitialize();\n    //\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new InvalidObjectException(\"Illegal load factor: \" + loadFactor);\n    //\n    s.readInt();                // Read and ignore number of buckets\n    //size\n    int mappings = s.readInt(); // Read number of mappings (size)\n    //size0\n    if (mappings < 0)\n        throw new InvalidObjectException(\"Illegal mappings count: \" + mappings);\n    else if (mappings > 0) { // (if zero, use defaults)\n        //hashMap\n        // Size the table using given load factor only if within range of 0.25...4.0\n        // \n        float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f);\n        //\n        float fc = (float)mappings / lf + 1.0f;\n        //\n        int cap = ((fc < DEFAULT_INITIAL_CAPACITY) ?\n                   DEFAULT_INITIAL_CAPACITY :\n                   (fc >= MAXIMUM_CAPACITY) ?\n                   MAXIMUM_CAPACITY :\n                   tableSizeFor((int)fc));\n        //\n        float ft = (float)cap * lf;\n        //\n        threshold = ((cap < MAXIMUM_CAPACITY && ft < MAXIMUM_CAPACITY) ? (int)ft : Integer.MAX_VALUE);\n        @SuppressWarnings({\"rawtypes\",\"unchecked\"})\n        //table\n            Node<K,V>[] tab = (Node<K,V>[])new Node[cap];\n        table = tab;\n\n        // keyvaluehashMap\n        for (int i = 0; i < mappings; i++) {\n            @SuppressWarnings(\"unchecked\")\n                K key = (K) s.readObject();\n            @SuppressWarnings(\"unchecked\")\n                V value = (V) s.readObject();\n            putVal(hash(key), key, value, false, false);\n        }\n    }\n}\n```\n\nhttps://blog.csdn.net/panweiwei1994/article/details/77244920","source":"_posts/java/container/java-hashmap.md","raw":"---\ntitle: java HashMap\ndate: 2021-05-17 14:30:04\ncategories:\n  - java\n  - container\ntags:\n  - java\n  - Map\n---\n\nJDK1.8\n\n# \n\n![image](/images/java-hashmap/java-hash-map-1.jpg)\n\nHashMap++since JDK1.8****keyhashhash****(jdk1.7)key-valuehash8(TREEIFY_THRESHOLD)\n\n# \n\n> HashMapMapMapkeyvaluenullHashMapunsynchronizednullHashMapHashTable\n> \n> (get  put) collection  HashMap -initial capacityload factor\n> \n> HashMapinitial capacityload factorinitial capacity*load factorinitial capacity*load factorHashMaprehashed\n> \n>  (0.75)  HashMap get  put rehashrehash \n> \n>  HashMap  rehash \n> \n>  Collections.synchronizedMap \n> \n> Map m = Collections.synchronizedMap(new HashMap());\n> \n> collection fail-fast remove ConcurrentModificationException\n> \n>  ConcurrentModificationExceptionbug\n>\n>  Java Collections Framework \n>\n> @author Doug Lea\n> @author Josh Bloch\n> @author Arthur van Hoff\n> @author Neal Gafter\n> @see Object#hashCode()\n> @see Collection\n> @see Map\n> @see TreeMap\n\n\n\n- ****HashMapMap\n- **null**HashMapkeyvaluenull\n- ****HashMap\n- **rehash**initial capacity*load factorinitial capacity*load factorHashMaprehashed\n- ****rehashrehashrehash\n- ****0.75rehash\n- ****HashMap\n- ****fast-fail\n\n# \n\n```java\npublic class HashMap<K,V> extends AbstractMap<K,V> implements Map<K,V>, Cloneable, Serializable\n```\n\n- HashMap<K,V>HashMapkey-value\n- extends AbstractMap<K,V>AbstractMapMap\n- implements Map<K,V>MapMap\n- implements Cloneableclone()field-for-field\n- implements Serializable\n\nHashMap\n\n![image](/images/java-hashmap/java-hash-map-2.jpg)\n\n# \n\n```java\n/**\n * 16\n * 2n.\n */\nstatic final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16\n\n/**\n * , MAXIMUM_CAPACITY.\n * 21<<30230\n */\nstatic final int MAXIMUM_CAPACITY = 1 << 30;\n\n/**\n * \n */\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n\n/**\n * \n * TREEIFY_THRESHOLD\n * 8\n */\nstatic final int TREEIFY_THRESHOLD = 8;\n\n/**\n * \n * TREEIFY_THRESHOLD6\n */\nstatic final int UNTREEIFY_THRESHOLD = 6;\n\n/**\n * \n * 4*TREEIFY_THRESHOLD\n */\nstatic final int MIN_TREEIFY_CAPACITY = 64;\n```\n\n# Node\n\n```java\n/**\n * HashMapHashMap\n */\nstatic class Node<K,V> implements Map.Entry<K,V> {\n    //key\n    final int hash;\n    final K key;\n    V value;\n    //\n    Node<K,V> next;\n    //\n    Node(int hash, K key, V value, Node<K,V> next) {\n        this.hash = hash;\n        this.key = key;\n        this.value = value;\n        this.next = next;\n    }\n\n    public final K getKey()        { return key; }\n    public final V getValue()      { return value; }\n    public final String toString() { return key + \"=\" + value; }\n\n    public final int hashCode() {\n        return Objects.hashCode(key) ^ Objects.hashCode(value);\n    }\n\n    public final V setValue(V newValue) {\n        V oldValue = value;\n        value = newValue;\n        return oldValue;\n    }\n\n    public final boolean equals(Object o) {\n        if (o == this)\n            return true;\n        if (o instanceof Map.Entry) {\n            Map.Entry<?,?> e = (Map.Entry<?,?>)o;\n            if (Objects.equals(key, e.getKey()) &&\n                Objects.equals(value, e.getValue()))\n                return true;\n        }\n        return false;\n    }\n}\n```\n\n# \n\n## get( Object key)\n\n```java\n/**\n * keyvaluevaluenullnull\n *\n * @see #put(Object, Object)\n */\npublic V get(Object key) {\n    Node<K,V> e;\n    //keynodenullnullnodevaluegetNode\n    return (e = getNode(hash(key), key)) == null ? null : e.value;\n}\n```\n\nget(E e)\n\n1. hash(Object key)keyhash\n2. getNode( int hash, Object key)node\n3. nodenullnullnode.value\n\n\n\n\n```java\n(n - 1) & hash\n```\n\nnhashhash(key)\n\n```java\n/**\n * key\n */\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n```\n\nkeyhashCodekeyhashCode1616\n\n![image](/images/java-hashmap/java-hash-map-3.jpg)\n\n****\n\nn16n-1150000 0000 0000 0000 0000 0000 0000 1111hashCode()4\n\nkeyhashnode\n\n## getNode( int hash, Object key)\n\n```java\n/**\n * keykey\n * \n * @param hash key\n * @param key key\n * @return nodenull\n */\nfinal Node<K,V> getNode(int hash, Object key) {\n    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;\n    //key\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (first = tab[(n - 1) & hash]) != null) {\n        //hashkey\n        if (first.hash == hash && // always check first node\n            ((k = first.key) == key || (key != null && key.equals(k))))\n            //\n            return first;\n        //\n        if ((e = first.next) != null) {\n            //get\n            if (first instanceof TreeNode)\n                return ((TreeNode<K,V>)first).getTreeNode(hash, key);\n            //\n            do {\n                //key\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    //null\n    return null;\n}\n```\n\n### get\n\nget(E e)\n\n1. hash(Object key)keyhash\n2. getNode( int hash, Object key)node\n3. nodenullnullnode.value\n\nhash\n1. keyhashCode\n2. keyhashCode1616\n3. \n\ngetNode\n\n1. keynull\n2. hashkey\n3. \n   1. get\n   2. key\n4. null\n\n## put( K key, V value)\n\n```java\n/**\n * keyvaluemapkeykeyvalue\n * \n * @param key key\n * @param value value\n * @return valuevaluenullkeyvaluenull\n */\npublic V put(K key, V value) {\n    //putVal\n    return putVal(hash(key), key, value, false, true);\n}\n```\n\nput(K key, V value)\n\n1. hash(Object key)key\n2. putVal(hash(key), key, value, false, true)\n3. putVal\n\nputVal\n\n## putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\n\n```java\n/**\n * Map.put\n * \n * @param hash key\n * @param key key\n * @param value value\n * @param onlyIfAbsent truekeymapvalue\n * @param evict falsetable\n * @return valuevaluenullkeyvaluenull\n */\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) {\n    Node<K,V>[] tab; Node<K,V> p; int n, i;\n    //resize()n\n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    //hash\n    if ((p = tab[i = (n - 1) & hash]) == null)\n        //map\n        tab[i] = newNode(hash, key, value, null);\n    else {\n        Node<K,V> e; K k;\n        //\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            //\n            e = p;\n        //\n        else if (p instanceof TreeNode)\n            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);\n        //\n        else {\n            //\n            for (int binCount = 0; ; ++binCount) {\n                //\n                if ((e = p.next) == null) {\n                    //\n                    p.next = newNode(hash, key, value, null);\n                    //TREEIFY_THRESHOLD\n                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                        treeifyBin(tab, hash);\n                    //\n                    break;\n                }\n                //keykeykey\n                if (e.hash == hash &&\n                    ((k = e.key) == key || (key != null && key.equals(k))))\n                    break;\n                //e = p.next\n                p = e;\n            }\n        }\n        //keynull\n        if (e != null) { // existing mapping for key\n            //vlaue\n            V oldValue = e.value;\n            //onlyIfAbsentfalseoldValuenull\n            if (!onlyIfAbsent || oldValue == null)\n                //value\n                e.value = value;\n            //\n            afterNodeAccess(e);\n            //\n            return oldValue;\n        }\n    }\n    //+1\n    ++modCount;\n    //\n    if (++size > threshold)\n        resize();\n    //\n    afterNodeInsertion(evict);\n    return null;\n}\n```\n\nputVal\n\n1. resize()\n2. hash\n3. key\n   1. \n   2. \n   3. keyTREEIFY_THRESHOLDtreeifyBin\n4. keynull\n   1. vlaue\n   2. onlyIfAbsentfalseoldValuenullvalue\n   3. value\n5. key23hashMapsize1sizethresholdresize\n\n## resize()\nhashMapHashMaphashMap\n\nresizen-1&hash+\n\n```java\n/**\n * table\n * tablenulltable\n * tablen-1&hash+\n */\nfinal Node<K,V>[] resize() {\n    //oldTabtable\n    Node<K,V>[] oldTab = table;\n    //oldCaptable\n    int oldCap = (oldTab == null) ? 0 : oldTab.length;\n    //\n    int oldThr = threshold;\n    int newCap, newThr = 0;\n    // > 0\n    if (oldCap > 0) {\n        //>=MAXIMUM_CAPACITY\n        if (oldCap >= MAXIMUM_CAPACITY) {\n            //\n            threshold = Integer.MAX_VALUE;\n            //\n            return oldTab;\n        }\n        //MAXIMUM_CAPACITYDEFAULT_INITIAL_CAPACITY\n        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&oldCap >= DEFAULT_INITIAL_CAPACITY)\n            //2\n            newThr = oldThr << 1; \n    }// <= 0 > 0\n    else if (oldThr > 0) \n        //\n        newCap = oldThr;\n    else {// <= 0 <= 0DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY\n        newCap = DEFAULT_INITIAL_CAPACITY;\n        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n    }\n    if (newThr == 0) {//oldThr > 0newThr == 0\n        //ft\n        float ft = (float)newCap * loadFactor;\n        //< MAXIMUM_CAPACITYft < (float)MAXIMUM_CAPACITYftInteger.MAX_VALUE\n        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?\n                  (int)ft : Integer.MAX_VALUE);\n    }\n    //hashMapnewThr\n    threshold = newThr;\n    //tablenewCap\n    @SuppressWarnings({\"rawtypes\",\"unchecked\"})\n        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];\n    //hashMaptablenewTab\n    table = newTab;\n    //tabletabletable\n    if (oldTab != null) {\n        //\n        for (int j = 0; j < oldCap; ++j) {\n            Node<K,V> e;\n            //nulle\n            if ((e = oldTab[j]) != null) {\n                //null\n                oldTab[j] = null;\n                //node\n                if (e.next == null)\n                    //eoldTab[j]newTabe.hash & (newCap - 1)\n                    newTab[e.hash & (newCap - 1)] = e;\n                //\n                else if (e instanceof TreeNode)\n                    //node\n                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);\n                else { //hash\n                    Node<K,V> loHead = null, loTail = null;\n                    Node<K,V> hiHead = null, hiTail = null;\n                    Node<K,V> next;\n                    //\n                    do {\n                        next = e.next;\n                        //\n                        if ((e.hash & oldCap) == 0) {\n                            if (loTail == null)\n                                loHead = e;\n                            else\n                                loTail.next = e;\n                            loTail = e;\n                        }\n                        else {\n                            if (hiTail == null)\n                                hiHead = e;\n                            else\n                                hiTail.next = e;\n                            hiTail = e;\n                        }\n                    } while ((e = next) != null);\n                    if (loTail != null) {\n                        loTail.next = null;\n                        newTab[j] = loHead;\n                    }\n                    if (hiTail != null) {\n                        hiTail.next = null;\n                        newTab[j + oldCap] = hiHead;\n                    }\n                }\n            }\n        }\n    }\n    return newTab;\n}\n```\n\nHashMapmapmap\n\nresize\n\n1. \n2. hashMap\n3. hashMaptable\n4. table\n\n## remove( Object key)\n\n```java\n/**\n * hashMapkeynode\n *\n * @param  key key\n * @return nodenullvalue\n */\npublic V remove(Object key) {\n    Node<K,V> e;\n    //keynoderemoveNode\n    return (e = removeNode(hash(key), key, null, false, true)) == null ?\n        null : e.value;\n}\n```\n\nremove\n\n1. hash(Object key)key\n2. removeNode\n3. nodevalue\n\nremoveNode\n\n## removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\n\n```java\n/**\n * Map.remove\n * node\n * \n * @param hash key\n * @param key key\n * @param value matchValuetruevaluenode\n * @param matchValue truevaluenode\n * @param movable falsenodenode\n * @return nodenodenull\n */\nfinal Node<K,V> removeNode(int hash, Object key, Object value,boolean matchValue, boolean movable) {\n    Node<K,V>[] tab; Node<K,V> p; int n, index;\n    //tablekey\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (p = tab[index = (n - 1) & hash]) != null) {\n        //\n        Node<K,V> node = null, e; K k; V v;\n        //nodenode\n        if (p.hash == hash &&\n            ((k = p.key) == key || (key != null && key.equals(k))))\n            //node\n            node = p;\n        else if ((e = p.next) != null) {//node\n            if (p instanceof TreeNode)//\n                //keynode\n                node = ((TreeNode<K,V>)p).getTreeNode(hash, key);\n            else {//\n                do {//keynode\n                    if (e.hash == hash &&\n                        ((k = e.key) == key ||\n                         (key != null && key.equals(k)))) {\n                        //keynode\n                        node = e;\n                        break;\n                    }\n                    p = e;\n                } while ((e = e.next) != null);\n            }\n        }\n        //nodenull(matchValuefalse||node.valuevalue)\n        if (node != null && (!matchValue || (v = node.value) == value || (value != null && value.equals(v)))) {\n            //\n            if (node instanceof TreeNode)\n                //node\n                ((TreeNode<K,V>)node).removeTreeNode(this, tab, movable);\n            else if (node == p)//nodenode\n                //node\n                tab[index] = node.next;\n            else//node\n                p.next = node.next;\n            //+1\n            ++modCount;\n            //-1\n            --size;\n            afterNodeRemoval(node);\n            //node\n            return node;\n        }\n    }\n    //tablekeynull\n    return null;\n}\n```\n\nremoveNode\n\n1. tablekeynull\n2. keynodenode\n3. nodekeynode\n4. keynode\n5. nodenullnodesize-1\n6. node\n\n# \n\n## hash( Object key)\n\n\n\n## comparableClassFor( Object x)\n\n```java\n/**\n * xComparablexnull\n */\nstatic Class<?> comparableClassFor(Object x) {\n    if (x instanceof Comparable) {\n        Class<?> c; Type[] ts, as; Type t; ParameterizedType p;\n        if ((c = x.getClass()) == String.class) // bypass checks\n            return c;\n        if ((ts = c.getGenericInterfaces()) != null) {\n            for (int i = 0; i < ts.length; ++i) {\n                if (((t = ts[i]) instanceof ParameterizedType) &&\n                    ((p = (ParameterizedType)t).getRawType() ==\n                     Comparable.class) &&\n                    (as = p.getActualTypeArguments()) != null &&\n                    as.length == 1 && as[0] == c) // type arg is c\n                    return c;\n            }\n        }\n    }\n    return null;\n}\n```\n\n## compareComparables( Class<?> kc, Object k, Object x)\n\n```java\n/**\n * xkck.compareTo(x)0.\n */\n@SuppressWarnings({\"rawtypes\",\"unchecked\"}) // for cast to Comparable\nstatic int compareComparables(Class<?> kc, Object k, Object x) {\n    return (x == null || x.getClass() != kc ? 0 :\n            ((Comparable)k).compareTo(x));\n}\n```\n\n\n\n## tableSizeFor( int cap)\n\n```java\n/**\n * cap\n */\nstatic final int tableSizeFor(int cap) {\n    int n = cap - 1;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n```\n\n# \n\n```java\n/**\n * 2\n */\ntransient Node<K,V>[] table;\n\n/**\n * entrySetKeyhashCode\n */\ntransient Set<Map.Entry<K,V>> entrySet;\n\n/**\n * \n */\ntransient int size;\n\n/**\n * HashMap\n * rehash\n * HashMapfail-fastConcurrentModificationException\n */\ntransient int modCount;\n\n/**\n * capacity * load factorHashMap\n * @serial\n */\n\nint threshold;\n\n/**\n * \n *\n * @serial\n */\nfinal float loadFactor;\n```\n\n# \n## HashMap( int initialCapacity, float loadFactor)\n\n```java\n/**\n * initial capacity load factorHashMap\n *\n * @param  initialCapacity \n * @param  loadFactor      \n * @throws IllegalArgumentException \n */\npublic HashMap(int initialCapacity, float loadFactor) {\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException(\"Illegal initial capacity: \" +\n                                           initialCapacity);\n    if (initialCapacity > MAXIMUM_CAPACITY)\n        initialCapacity = MAXIMUM_CAPACITY;\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new IllegalArgumentException(\"Illegal load factor: \" +\n                                           loadFactor);\n    this.loadFactor = loadFactor;\n    this.threshold = tableSizeFor(initialCapacity);\n}\n```\n\n## HashMap( int initialCapacity)\n\n```java\n/**\n * initial capacityDEFAULT_LOAD_FACTOR0.75HashMap\n *\n * @param  initialCapacity \n * @throws IllegalArgumentException \n */\npublic HashMap(int initialCapacity) {\n    this(initialCapacity, DEFAULT_LOAD_FACTOR);\n}\n```\n\n## HashMap()\n\n```java\n/**\n * 16DEFAULT_LOAD_FACTOR0.75HashMap\n */\npublic HashMap() {\n    this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted\n}\n```\n\n## HashMap( Map<? extends K, ? extends V>m)\n\n```java\n/**\n * Map mHashMap16DEFAULT_LOAD_FACTOR0.75\n * @param   m map\n * @throws  NullPointerException mapnull\n */\npublic HashMap(Map<? extends K, ? extends V> m) {\n    this.loadFactor = DEFAULT_LOAD_FACTOR;\n    putMapEntries(m, false);\n}\n```\n\n# \n\n## putMapEntries(Map<? extends K, ? extends V> m, boolean evict)\n\n```java\n/**\n * Map.putAll and Map constructor\n * mmap\n * \n * @param m the map\n * @param evict mapfalsetrue\n */\nfinal void putMapEntries(Map<? extends K, ? extends V> m, boolean evict) {\n    int s = m.size();\n    //map\n    if (s > 0) {\n        //table\n        if (table == null) { // pre-size\n            //initial capacity*load factorhashMaps/loadFactor+1\n            float ft = ((float)s / loadFactor) + 1.0F;\n            //ftMAXIMUM_CAPACITYftMAXIMUM_CAPACITY\n            int t = ((ft < (float)MAXIMUM_CAPACITY) ?\n                     (int)ft : MAXIMUM_CAPACITY);\n            //\n            if (t > threshold)\n                //\n                threshold = tableSizeFor(t);\n        }\n        //tablemap\n        else if (s > threshold)\n            //\n            resize();\n        //maphashMap\n        for (Map.Entry<? extends K, ? extends V> e : m.entrySet()) {\n            K key = e.getKey();\n            V value = e.getValue();\n            //putVal\n            putVal(hash(key), key, value, false, evict);\n        }\n    }\n}\n```\n\n## size()\n\n```java\n/**\n * map\n * \n * @return map\n */\npublic int size() {\n    return size;\n}\n```\n\n## isEmpty()\n\n```java\n/**\n * maptrue\n * \n * @return <maptrue\n */\npublic boolean isEmpty() {\n    return size == 0;\n}\n```\n\n## get( Object key)\n\n\n\n## getNode( int hash, Object key)\n\n\n\n## containsKey( Object key)\n\n```java\n/**\n * mapkeykeytrue\n * \n * @param   key   key\n * @return mapkeykeytrue\n */\npublic boolean containsKey(Object key) {\n    return getNode(hash(key), key) != null;\n}\n```\n\n## put( K key, V value)\n\n\n\n## putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\n\n\n\n## resize()\n\n\n\n## treeifyBin( Node<K,V>[] tab, int hash)\n\n```java\n/**\n * \n */\nfinal void treeifyBin(Node<K,V>[] tab, int hash) {\n    int n, index; Node<K,V> e;\n    //tabletableMIN_TREEIFY_CAPACITY\n    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)\n        //\n        resize();\n    else if ((e = tab[index = (n - 1) & hash]) != null) {//hashnull\n        TreeNode<K,V> hd = null, tl = null;\n        //\n        do {\n            //nodenode\n            TreeNode<K,V> p = replacementTreeNode(e, null);\n            //\n            if (tl == null)\n                hd = p;\n            else {\n                p.prev = tl;\n                tl.next = p;\n            }\n            tl = p;\n        } while ((e = e.next) != null);\n        //\n        if ((tab[index] = hd) != null)\n            hd.treeify(tab);\n    }\n}\n```\n\n## putAll( Map<? extends K, ? extends V> m)\n\n```java\n/**\n * maphashMapvalue\n * @param m map\n * @throws NullPointerException mapnull\n */\npublic void putAll(Map<? extends K, ? extends V> m) {\n    putMapEntries(m, true);\n}\n```\n\n## remove( Object key)\n\n\n\n## removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\n\n\n\n## clear()\n\n```java\n/**\n * map\n */\npublic void clear() {\n    Node<K,V>[] tab;\n    modCount++;\n    if ((tab = table) != null && size > 0) {\n        size = 0;\n        for (int i = 0; i < tab.length; ++i)\n            tab[i] = null;\n    }\n}\n```\n\n## containsValue( Object value)\n\n```java\n/**\n * hashMapvaluevaluetrue\n *\n * @param value value\n * @return hashMapvaluevaluetrue\n */\npublic boolean containsValue(Object value) {\n    Node<K,V>[] tab; V v;\n    //\n    if ((tab = table) != null && size > 0) {\n        //table\n        for (int i = 0; i < tab.length; ++i) {\n            //node\n            for (Node<K,V> e = tab[i]; e != null; e = e.next) {\n                if ((v = e.value) == value ||\n                    (value != null && value.equals(v)))\n                    return true;\n            }\n        }\n    }\n    return false;\n}\n```\n\n# \n\n## keySet()\n\n```java\n/**\n * hashMapkey\n * hashMapset\n * sethashMap(remove())\n * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapkeyset\n */\npublic Set<K> keySet() {\n    //\n    Set<K> ks = keySet;\n    if (ks == null) {\n        ks = new KeySet();\n        keySet = ks;\n    }\n    return ks;\n}\n\n/**\n * KeySet\n */\nfinal class KeySet extends AbstractSet<K> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<K> iterator()     { return new KeyIterator(); }\n    public final boolean contains(Object o) { return containsKey(o); }\n    public final boolean remove(Object key) {\n        return removeNode(hash(key), key, null, false, true) != null;\n    }\n    public final Spliterator<K> spliterator() {\n        return new KeySpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super K> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e.key);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n## values()\n\n```java\n/**\n * hashMapvaluecollection\n * hashMapcollection\n * collectionhashMapremove()\n * collectionIterator.removeCollection.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapkeycollection\n */\npublic Collection<V> values() {\n    Collection<V> vs = values;\n    if (vs == null) {\n        vs = new Values();\n        values = vs;\n    }\n    return vs;\n}\n\n/**\n * Values\n */\nfinal class Values extends AbstractCollection<V> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<V> iterator()     { return new ValueIterator(); }\n    public final boolean contains(Object o) { return containsValue(o); }\n    public final Spliterator<V> spliterator() {\n        return new ValueSpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super V> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e.value);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n## entrySet()\n\n```java\n/**\n * hashMapset\n * hashMapset\n * sethashMap(remove())\n * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll\n *\n * @return hashMapset\n */\npublic Set<Map.Entry<K,V>> entrySet() {\n    Set<Map.Entry<K,V>> es;\n    return (es = entrySet) == null ? (entrySet = new EntrySet()) : es;\n}\n\n/**\n * EntrySet\n */\nfinal class EntrySet extends AbstractSet<Map.Entry<K,V>> {\n    public final int size()                 { return size; }\n    public final void clear()               { HashMap.this.clear(); }\n    public final Iterator<Map.Entry<K,V>> iterator() {\n        return new EntryIterator();\n    }\n    public final boolean contains(Object o) {\n        if (!(o instanceof Map.Entry))\n            return false;\n        Map.Entry<?,?> e = (Map.Entry<?,?>) o;\n        Object key = e.getKey();\n        Node<K,V> candidate = getNode(hash(key), key);\n        return candidate != null && candidate.equals(e);\n    }\n    public final boolean remove(Object o) {\n        if (o instanceof Map.Entry) {\n            Map.Entry<?,?> e = (Map.Entry<?,?>) o;\n            Object key = e.getKey();\n            Object value = e.getValue();\n            return removeNode(hash(key), key, value, true, true) != null;\n        }\n        return false;\n    }\n    public final Spliterator<Map.Entry<K,V>> spliterator() {\n        return new EntrySpliterator<>(HashMap.this, 0, -1, 0, 0);\n    }\n    public final void forEach(Consumer<? super Map.Entry<K,V>> action) {\n        Node<K,V>[] tab;\n        if (action == null)\n            throw new NullPointerException();\n        if (size > 0 && (tab = table) != null) {\n            int mc = modCount;\n            for (int i = 0; i < tab.length; ++i) {\n                for (Node<K,V> e = tab[i]; e != null; e = e.next)\n                    action.accept(e);\n            }\n            if (modCount != mc)\n                throw new ConcurrentModificationException();\n        }\n    }\n}\n```\n\n# JDK8\n\n## getOrDefault( Object key, V defaultValue)\n\n```java\n/**\n * keynodedefaultValue\n *\n * @return keynodedefaultValue\n */\n@Override\npublic V getOrDefault(Object key, V defaultValue) {\n    Node<K,V> e;\n    return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;\n}\n```\n\n## putIfAbsent( K key, V value)\n\n```java\n/**\n * hashMapkeyvaluekeyhashMapvalue\n *\n * @return keyhashMapvalue\n */\n@Override\npublic V putIfAbsent(K key, V value) {\n    return putVal(hash(key), key, value, true, true);\n}\n```\n\n## remove( Object key, Object value)\n\n```java\n/**\n * hashMapkeykeyvaluevalue\n *\n * @return true\n */\n@Override\npublic boolean remove(Object key, Object value) {\n    return removeNode(hash(key), key, value, true, true) != null;\n}\n```\n\n## replace( K key, V oldValue, V newValue)\n\n```java\n/**\n * newValuekeyoldValuevalue\n * \n * @return true\n */\n@Override\npublic boolean replace(K key, V oldValue, V newValue) {\n    Node<K,V> e; V v;\n    if ((e = getNode(hash(key), key)) != null &&\n        ((v = e.value) == oldValue || (v != null && v.equals(oldValue)))) {\n        e.value = newValue;\n        afterNodeAccess(e);\n        return true;\n    }\n    return false;\n}\n```\n\n## replace( K key, V value)\n\n```java\n/**\n * valuekeyvalue\n * \n * @return true\n */\n@Override\npublic V replace(K key, V value) {\n    Node<K,V> e;\n    if ((e = getNode(hash(key), key)) != null) {\n        V oldValue = e.value;\n        e.value = value;\n        afterNodeAccess(e);\n        return oldValue;\n    }\n    return null;\n}\n```\n\n## clone()\n\n```java\n/**\n * \n * cloneHashMapHashMaptableHashMap\n * HashMapcloneclone\n *\n * @return hashMap\n */\n@SuppressWarnings(\"unchecked\")\n@Override\npublic Object clone() {\n    HashMap<K,V> result;\n    try {\n        result = (HashMap<K,V>)super.clone();\n    } catch (CloneNotSupportedException e) {\n        // this shouldn't happen, since we are Cloneable\n        throw new InternalError(e);\n    }\n    result.reinitialize();\n    result.putMapEntries(this, false);\n    return result;\n}\n```\n\n## loadFactor()\n\n```java\n// These methods are also used when serializing HashSets\nfinal float loadFactor() { return loadFactor; }\n```\n\n## capacity()\n\n```java\n// These methods are also used when serializing HashSets\nfinal int capacity() {\n    return (table != null) ? table.length :\n        (threshold > 0) ? threshold :\n        DEFAULT_INITIAL_CAPACITY;\n}\n```\n\n## writeObject( java.io.ObjectOutputStream s)\n\n```java\n/**\n * hashMapObjectOutputStream\n * hashMapcapacitysizeObjectOutputStream\n */\nprivate void writeObject(java.io.ObjectOutputStream s)\n    throws IOException {\n    int buckets = capacity();\n    // Write out the threshold, loadfactor, and any hidden stuff\n    s.defaultWriteObject();\n    //\n    s.writeInt(buckets);\n    //\n    s.writeInt(size);\n    //\n    internalWriteEntries(s);\n}\n\n// hashMapObjectOutputStream\nvoid internalWriteEntries(java.io.ObjectOutputStream s) throws IOException {\n    Node<K,V>[] tab;\n    if (size > 0 && (tab = table) != null) {\n        for (int i = 0; i < tab.length; ++i) {\n            for (Node<K,V> e = tab[i]; e != null; e = e.next) {\n                s.writeObject(e.key);\n                s.writeObject(e.value);\n            }\n        }\n    }\n}\n```\n\n## readObject( java.io.ObjectInputStream s)\n\n```java\n/**\n * ObjectOutputStreamhashMap\n * hashMapcapacitysize\n */\nprivate void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException {\n    // hashMapcapacitysize\n    s.defaultReadObject();\n    //hashMap\n    reinitialize();\n    //\n    if (loadFactor <= 0 || Float.isNaN(loadFactor))\n        throw new InvalidObjectException(\"Illegal load factor: \" + loadFactor);\n    //\n    s.readInt();                // Read and ignore number of buckets\n    //size\n    int mappings = s.readInt(); // Read number of mappings (size)\n    //size0\n    if (mappings < 0)\n        throw new InvalidObjectException(\"Illegal mappings count: \" + mappings);\n    else if (mappings > 0) { // (if zero, use defaults)\n        //hashMap\n        // Size the table using given load factor only if within range of 0.25...4.0\n        // \n        float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f);\n        //\n        float fc = (float)mappings / lf + 1.0f;\n        //\n        int cap = ((fc < DEFAULT_INITIAL_CAPACITY) ?\n                   DEFAULT_INITIAL_CAPACITY :\n                   (fc >= MAXIMUM_CAPACITY) ?\n                   MAXIMUM_CAPACITY :\n                   tableSizeFor((int)fc));\n        //\n        float ft = (float)cap * lf;\n        //\n        threshold = ((cap < MAXIMUM_CAPACITY && ft < MAXIMUM_CAPACITY) ? (int)ft : Integer.MAX_VALUE);\n        @SuppressWarnings({\"rawtypes\",\"unchecked\"})\n        //table\n            Node<K,V>[] tab = (Node<K,V>[])new Node[cap];\n        table = tab;\n\n        // keyvaluehashMap\n        for (int i = 0; i < mappings; i++) {\n            @SuppressWarnings(\"unchecked\")\n                K key = (K) s.readObject();\n            @SuppressWarnings(\"unchecked\")\n                V value = (V) s.readObject();\n            putVal(hash(key), key, value, false, false);\n        }\n    }\n}\n```\n\nhttps://blog.csdn.net/panweiwei1994/article/details/77244920","slug":"java/container/java-hashmap","published":1,"updated":"2022-05-10T08:25:56.392Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p9001zxklobtuw8cwx","content":"<p>JDK1.8</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/java-hashmap/java-hash-map-1.jpg\" alt=\"image\"></p>\n<p>HashMap++since JDK1.8<strong></strong>keyhashhash<strong></strong>(jdk1.7)key-valuehash8(TREEIFY_THRESHOLD)</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><blockquote>\n<p>HashMapMapMapkeyvaluenullHashMapunsynchronizednullHashMapHashTable</p>\n<p>(get  put) collection  HashMap -initial capacityload factor</p>\n<p>HashMapinitial capacityload factorinitial capacity<em>load factorinitial capacity</em>load factorHashMaprehashed</p>\n<p> (0.75)  HashMap get  put rehashrehash </p>\n<p> HashMap  rehash </p>\n<p> Collections.synchronizedMap </p>\n<p>Map m &#x3D; Collections.synchronizedMap(new HashMap());</p>\n<p>collection fail-fast remove ConcurrentModificationException</p>\n<p> ConcurrentModificationExceptionbug</p>\n<p> Java Collections Framework </p>\n<p>@author Doug Lea<br>@author Josh Bloch<br>@author Arthur van Hoff<br>@author Neal Gafter<br>@see Object#hashCode()<br>@see Collection<br>@see Map<br>@see TreeMap</p>\n</blockquote>\n<p></p>\n<ul>\n<li><strong></strong>HashMapMap</li>\n<li><strong>null</strong>HashMapkeyvaluenull</li>\n<li><strong></strong>HashMap</li>\n<li><strong>rehash</strong>initial capacity<em>load factorinitial capacity</em>load factorHashMaprehashed</li>\n<li><strong></strong>rehashrehashrehash</li>\n<li><strong></strong>0.75rehash</li>\n<li><strong></strong>HashMap</li>\n<li><strong></strong>fast-fail</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HashMap</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractMap</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>&lt;K,V&gt;, Cloneable, Serializable</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>HashMap&lt;K,V&gt;HashMapkey-value</li>\n<li>extends AbstractMap&lt;K,V&gt;AbstractMapMap</li>\n<li>implements Map&lt;K,V&gt;MapMap</li>\n<li>implements Cloneableclone()field-for-field</li>\n<li>implements Serializable</li>\n</ul>\n<p>HashMap</p>\n<p><img src=\"/images/java-hashmap/java-hash-map-2.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 16</span></span><br><span class=\"line\"><span class=\"comment\"> * 2n.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_INITIAL_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">4</span>; <span class=\"comment\">// aka 16</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * , MAXIMUM_CAPACITY.</span></span><br><span class=\"line\"><span class=\"comment\"> * 21&lt;&lt;30230</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAXIMUM_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">float</span> <span class=\"variable\">DEFAULT_LOAD_FACTOR</span> <span class=\"operator\">=</span> <span class=\"number\">0.75f</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * TREEIFY_THRESHOLD</span></span><br><span class=\"line\"><span class=\"comment\"> * 8</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * TREEIFY_THRESHOLD6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">UNTREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * 4*TREEIFY_THRESHOLD</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MIN_TREEIFY_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">64</span>;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Node\"><a href=\"#Node\" class=\"headerlink\" title=\"Node\"></a>Node</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//key</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">int</span> hash;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node&lt;K,V&gt; next;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node(<span class=\"type\">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hash = hash;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.next = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title function_\">getKey</span><span class=\"params\">()</span>        &#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">getValue</span><span class=\"params\">()</span>      &#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> key + <span class=\"string\">&quot;=&quot;</span> + value; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hashCode</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">setValue</span><span class=\"params\">(V newValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> value;</span><br><span class=\"line\">        value = newValue;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o == <span class=\"built_in\">this</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class=\"line\">                Objects.equals(value, e.getValue()))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"get-Object-key\"><a href=\"#get-Object-key\" class=\"headerlink\" title=\"get( Object key)\"></a>get( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keyvaluevaluenullnull</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@see</span> #put(Object, Object)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//keynodenullnullnodevaluegetNode</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"literal\">null</span> ? <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>get(E e)</p>\n<ol>\n<li>hash(Object key)keyhash</li>\n<li>getNode( int hash, Object key)node</li>\n<li>nodenullnullnode.value<br></li>\n</ol>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(n - <span class=\"number\">1</span>) &amp; hash</span><br></pre></td></tr></table></figure>\n\n<p>nhashhash(key)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * key</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hash</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> h;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"literal\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>keyhashCodekeyhashCode1616</p>\n<p><img src=\"/images/java-hashmap/java-hash-map-3.jpg\" alt=\"image\"></p>\n<p><strong></strong></p>\n<p>n16n-1150000 0000 0000 0000 0000 0000 0000 1111hashCode()4</p>\n<p>keyhashnode</p>\n<h2 id=\"getNode-int-hash-Object-key\"><a href=\"#getNode-int-hash-Object-key\" class=\"headerlink\" title=\"getNode( int hash, Object key)\"></a>getNode( int hash, Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keykey</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">getNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class=\"type\">int</span> n; K k;</span><br><span class=\"line\">    <span class=\"comment\">//key</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">        (first = tab[(n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//hashkey</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (first.hash == hash &amp;&amp; <span class=\"comment\">// always check first node</span></span><br><span class=\"line\">            ((k = first.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> first;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e = first.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//get</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//key</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                    ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h3><p>get(E e)</p>\n<ol>\n<li>hash(Object key)keyhash</li>\n<li>getNode( int hash, Object key)node</li>\n<li>nodenullnullnode.value</li>\n</ol>\n<p>hash</p>\n<ol>\n<li>keyhashCode</li>\n<li>keyhashCode1616</li>\n<li></li>\n</ol>\n<p>getNode</p>\n<ol>\n<li>keynull</li>\n<li>hashkey</li>\n<li><ol>\n<li>get</li>\n<li>key</li>\n</ol>\n</li>\n<li>null</li>\n</ol>\n<h2 id=\"put-K-key-V-value\"><a href=\"#put-K-key-V-value\" class=\"headerlink\" title=\"put( K key, V value)\"></a>put( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keyvaluemapkeykeyvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> valuevaluenullkeyvaluenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">put</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//putVal</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>put(K key, V value)</p>\n<ol>\n<li>hash(Object key)key</li>\n<li>putVal(hash(key), key, value, false, true)</li>\n<li>putVal</li>\n</ol>\n<p>putVal</p>\n<h2 id=\"putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict\"><a href=\"#putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict\" class=\"headerlink\" title=\"putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\"></a>putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.put</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> onlyIfAbsent truekeymapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> evict falsetable</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> valuevaluenullkeyvaluenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(<span class=\"type\">int</span> hash, K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent,<span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, i;</span><br><span class=\"line\">    <span class=\"comment\">//resize()n</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">        n = (tab = resize()).length;</span><br><span class=\"line\">    <span class=\"comment\">//hash</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"comment\">//map</span></span><br><span class=\"line\">        tab[i] = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">            ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            e = p;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"built_in\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    p.next = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//TREEIFY_THRESHOLD</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></span><br><span class=\"line\">                        treeifyBin(tab, hash);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//keykeykey</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                    ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"comment\">//e = p.next</span></span><br><span class=\"line\">                p = e;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//keynull</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e != <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">            <span class=\"comment\">//vlaue</span></span><br><span class=\"line\">            <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">            <span class=\"comment\">//onlyIfAbsentfalseoldValuenull</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"comment\">//value</span></span><br><span class=\"line\">                e.value = value;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            afterNodeAccess(e);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    ++modCount;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    afterNodeInsertion(evict);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>putVal</p>\n<ol>\n<li>resize()</li>\n<li>hash</li>\n<li>key<ol>\n<li></li>\n<li></li>\n<li>keyTREEIFY_THRESHOLDtreeifyBin</li>\n</ol>\n</li>\n<li>keynull<ol>\n<li>vlaue</li>\n<li>onlyIfAbsentfalseoldValuenullvalue</li>\n<li>value</li>\n</ol>\n</li>\n<li>key23hashMapsize1sizethresholdresize</li>\n</ol>\n<h2 id=\"resize\"><a href=\"#resize\" class=\"headerlink\" title=\"resize()\"></a>resize()</h2><p>hashMapHashMaphashMap</p>\n<p>resizen-1&amp;hash+</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * table</span></span><br><span class=\"line\"><span class=\"comment\"> * tablenulltable</span></span><br><span class=\"line\"><span class=\"comment\"> * tablen-1&amp;hash+</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//oldTabtable</span></span><br><span class=\"line\">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class=\"line\">    <span class=\"comment\">//oldCaptable</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldCap</span> <span class=\"operator\">=</span> (oldTab == <span class=\"literal\">null</span>) ? <span class=\"number\">0</span> : oldTab.length;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldThr</span> <span class=\"operator\">=</span> threshold;</span><br><span class=\"line\">    <span class=\"type\">int</span> newCap, newThr = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// &gt; 0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldCap &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//&gt;=MAXIMUM_CAPACITY</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            threshold = Integer.MAX_VALUE;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldTab;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//MAXIMUM_CAPACITYDEFAULT_INITIAL_CAPACITY</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((newCap = oldCap &lt;&lt; <span class=\"number\">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class=\"line\">            <span class=\"comment\">//2</span></span><br><span class=\"line\">            newThr = oldThr &lt;&lt; <span class=\"number\">1</span>; </span><br><span class=\"line\">    &#125;<span class=\"comment\">// &lt;= 0 &gt; 0</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldThr &gt; <span class=\"number\">0</span>) </span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        newCap = oldThr;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;<span class=\"comment\">// &lt;= 0 &lt;= 0DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY</span></span><br><span class=\"line\">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">        newThr = (<span class=\"type\">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newThr == <span class=\"number\">0</span>) &#123;<span class=\"comment\">//oldThr &gt; 0newThr == 0</span></span><br><span class=\"line\">        <span class=\"comment\">//ft</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)newCap * loadFactor;</span><br><span class=\"line\">        <span class=\"comment\">//&lt; MAXIMUM_CAPACITYft &lt; (float)MAXIMUM_CAPACITYftInteger.MAX_VALUE</span></span><br><span class=\"line\">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class=\"type\">float</span>)MAXIMUM_CAPACITY ?</span><br><span class=\"line\">                  (<span class=\"type\">int</span>)ft : Integer.MAX_VALUE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//hashMapnewThr</span></span><br><span class=\"line\">    threshold = newThr;</span><br><span class=\"line\">    <span class=\"comment\">//tablenewCap</span></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class=\"line\">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>[newCap];</span><br><span class=\"line\">    <span class=\"comment\">//hashMaptablenewTab</span></span><br><span class=\"line\">    table = newTab;</span><br><span class=\"line\">    <span class=\"comment\">//tabletabletable</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldTab != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; e;</span><br><span class=\"line\">            <span class=\"comment\">//nulle</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e = oldTab[j]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//null</span></span><br><span class=\"line\">                oldTab[j] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.next == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                    <span class=\"comment\">//eoldTab[j]newTabe.hash &amp; (newCap - 1)</span></span><br><span class=\"line\">                    newTab[e.hash &amp; (newCap - <span class=\"number\">1</span>)] = e;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    <span class=\"comment\">//node</span></span><br><span class=\"line\">                    ((TreeNode&lt;K,V&gt;)e).split(<span class=\"built_in\">this</span>, newTab, j, oldCap);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//hash</span></span><br><span class=\"line\">                    Node&lt;K,V&gt; loHead = <span class=\"literal\">null</span>, loTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    Node&lt;K,V&gt; hiHead = <span class=\"literal\">null</span>, hiTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    Node&lt;K,V&gt; next;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                        next = e.next;</span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> ((e.hash &amp; oldCap) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (loTail == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                loHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span></span><br><span class=\"line\">                                loTail.next = e;</span><br><span class=\"line\">                            loTail = e;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (hiTail == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                hiHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span></span><br><span class=\"line\">                                hiTail.next = e;</span><br><span class=\"line\">                            hiTail = e;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (loTail != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        loTail.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        newTab[j] = loHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (hiTail != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        hiTail.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        newTab[j + oldCap] = hiHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newTab;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>HashMapmapmap</p>\n<p>resize</p>\n<ol>\n<li></li>\n<li>hashMap</li>\n<li>hashMaptable</li>\n<li>table</li>\n</ol>\n<h2 id=\"remove-Object-key\"><a href=\"#remove-Object-key\" class=\"headerlink\" title=\"remove( Object key)\"></a>remove( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeynode</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenullvalue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//keynoderemoveNode</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) == <span class=\"literal\">null</span> ?</span><br><span class=\"line\">        <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>remove</p>\n<ol>\n<li>hash(Object key)key</li>\n<li>removeNode</li>\n<li>nodevalue</li>\n</ol>\n<p>removeNode</p>\n<h2 id=\"removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable\"><a href=\"#removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable\" class=\"headerlink\" title=\"removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\"></a>removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.remove</span></span><br><span class=\"line\"><span class=\"comment\"> * node</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value matchValuetruevaluenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> matchValue truevaluenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> movable falsenodenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenodenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">removeNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key, Object value,<span class=\"type\">boolean</span> matchValue, <span class=\"type\">boolean</span> movable)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, index;</span><br><span class=\"line\">    <span class=\"comment\">//tablekey</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">        (p = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Node&lt;K,V&gt; node = <span class=\"literal\">null</span>, e; K k; V v;</span><br><span class=\"line\">        <span class=\"comment\">//nodenode</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">            ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            node = p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = p.next) != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)<span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"comment\">//keynode</span></span><br><span class=\"line\">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;<span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">do</span> &#123;<span class=\"comment\">//keynode</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key ||</span><br><span class=\"line\">                         (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//keynode</span></span><br><span class=\"line\">                        node = e;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//nodenull(matchValuefalse||node.valuevalue)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node != <span class=\"literal\">null</span> &amp;&amp; (!matchValue || (v = node.value) == value || (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class=\"built_in\">this</span>, tab, movable);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node == p)<span class=\"comment\">//nodenode</span></span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                tab[index] = node.next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span><span class=\"comment\">//node</span></span><br><span class=\"line\">                p.next = node.next;</span><br><span class=\"line\">            <span class=\"comment\">//+1</span></span><br><span class=\"line\">            ++modCount;</span><br><span class=\"line\">            <span class=\"comment\">//-1</span></span><br><span class=\"line\">            --size;</span><br><span class=\"line\">            afterNodeRemoval(node);</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//tablekeynull</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>removeNode</p>\n<ol>\n<li>tablekeynull</li>\n<li>keynodenode</li>\n<li>nodekeynode</li>\n<li>keynode</li>\n<li>nodenullnodesize-1</li>\n<li>node</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"hash-Object-key\"><a href=\"#hash-Object-key\" class=\"headerlink\" title=\"hash( Object key)\"></a>hash( Object key)</h2><p></p>\n<h2 id=\"comparableClassFor-Object-x\"><a href=\"#comparableClassFor-Object-x\" class=\"headerlink\" title=\"comparableClassFor( Object x)\"></a>comparableClassFor( Object x)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * xComparablexnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> Class&lt;?&gt; comparableClassFor(Object x) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x <span class=\"keyword\">instanceof</span> Comparable) &#123;</span><br><span class=\"line\">        Class&lt;?&gt; c; Type[] ts, as; Type t; ParameterizedType p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((c = x.getClass()) == String.class) <span class=\"comment\">// bypass checks</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((ts = c.getGenericInterfaces()) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; ts.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (((t = ts[i]) <span class=\"keyword\">instanceof</span> ParameterizedType) &amp;&amp;</span><br><span class=\"line\">                    ((p = (ParameterizedType)t).getRawType() ==</span><br><span class=\"line\">                     Comparable.class) &amp;&amp;</span><br><span class=\"line\">                    (as = p.getActualTypeArguments()) != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">                    as.length == <span class=\"number\">1</span> &amp;&amp; as[<span class=\"number\">0</span>] == c) <span class=\"comment\">// type arg is c</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"compareComparables-Class-lt-gt-kc-Object-k-Object-x\"><a href=\"#compareComparables-Class-lt-gt-kc-Object-k-Object-x\" class=\"headerlink\" title=\"compareComparables( Class&lt;?&gt; kc, Object k, Object x)\"></a>compareComparables( Class&lt;?&gt; kc, Object k, Object x)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * xkck.compareTo(x)0.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span> <span class=\"comment\">// for cast to Comparable</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">compareComparables</span><span class=\"params\">(Class&lt;?&gt; kc, Object k, Object x)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (x == <span class=\"literal\">null</span> || x.getClass() != kc ? <span class=\"number\">0</span> :</span><br><span class=\"line\">            ((Comparable)k).compareTo(x));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"tableSizeFor-int-cap\"><a href=\"#tableSizeFor-int-cap\" class=\"headerlink\" title=\"tableSizeFor( int cap)\"></a>tableSizeFor( int cap)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">tableSizeFor</span><span class=\"params\">(<span class=\"type\">int</span> cap)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> cap - <span class=\"number\">1</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">2</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">4</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">8</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">16</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (n &lt; <span class=\"number\">0</span>) ? <span class=\"number\">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * entrySetKeyhashCode</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * rehash</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapfail-fastConcurrentModificationException</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> modCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * capacity * load factorHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> threshold;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">float</span> loadFactor;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"HashMap-int-initialCapacity-float-loadFactor\"><a href=\"#HashMap-int-initialCapacity-float-loadFactor\" class=\"headerlink\" title=\"HashMap( int initialCapacity, float loadFactor)\"></a>HashMap( int initialCapacity, float loadFactor)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * initial capacity load factorHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  loadFactor      </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity, <span class=\"type\">float</span> loadFactor)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class=\"line\">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal load factor: &quot;</span> +</span><br><span class=\"line\">                                           loadFactor);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = loadFactor;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap-int-initialCapacity\"><a href=\"#HashMap-int-initialCapacity\" class=\"headerlink\" title=\"HashMap( int initialCapacity)\"></a>HashMap( int initialCapacity)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * initial capacityDEFAULT_LOAD_FACTOR0.75HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap\"><a href=\"#HashMap\" class=\"headerlink\" title=\"HashMap()\"></a>HashMap()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 16DEFAULT_LOAD_FACTOR0.75HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class=\"comment\">// all other fields defaulted</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap-Map-lt-extends-K-extends-V-gt-m\"><a href=\"#HashMap-Map-lt-extends-K-extends-V-gt-m\" class=\"headerlink\" title=\"HashMap( Map&lt;? extends K, ? extends V&gt;m)\"></a>HashMap( Map&lt;? extends K, ? extends V&gt;m)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map mHashMap16DEFAULT_LOAD_FACTOR0.75</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   m map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span>  NullPointerException mapnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class=\"line\">    putMapEntries(m, <span class=\"literal\">false</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict\"><a href=\"#putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict\" class=\"headerlink\" title=\"putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)\"></a>putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.putAll and Map constructor</span></span><br><span class=\"line\"><span class=\"comment\"> * mmap</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> m the map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> evict mapfalsetrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">putMapEntries</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m, <span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> m.size();</span><br><span class=\"line\">    <span class=\"comment\">//map</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (table == <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// pre-size</span></span><br><span class=\"line\">            <span class=\"comment\">//initial capacity*load factorhashMaps/loadFactor+1</span></span><br><span class=\"line\">            <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> ((<span class=\"type\">float</span>)s / loadFactor) + <span class=\"number\">1.0F</span>;</span><br><span class=\"line\">            <span class=\"comment\">//ftMAXIMUM_CAPACITYftMAXIMUM_CAPACITY</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> ((ft &lt; (<span class=\"type\">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class=\"line\">                     (<span class=\"type\">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (t &gt; threshold)</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                threshold = tableSizeFor(t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//tablemap</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s &gt; threshold)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            resize();</span><br><span class=\"line\">        <span class=\"comment\">//maphashMap</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">K</span>, ? <span class=\"keyword\">extends</span> <span class=\"title class_\">V</span>&gt; e : m.entrySet()) &#123;</span><br><span class=\"line\">            <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">            <span class=\"type\">V</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> e.getValue();</span><br><span class=\"line\">            <span class=\"comment\">//putVal</span></span><br><span class=\"line\">            putVal(hash(key), key, value, <span class=\"literal\">false</span>, evict);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"size\"><a href=\"#size\" class=\"headerlink\" title=\"size()\"></a>size()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * map</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> map</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isEmpty\"><a href=\"#isEmpty\" class=\"headerlink\" title=\"isEmpty()\"></a>isEmpty()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * maptrue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &lt;maptrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isEmpty</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">return</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span>= <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"get-Object-key-1\"><a href=\"#get-Object-key-1\" class=\"headerlink\" title=\"get( Object key)\"></a>get( Object key)</h2><p></p>\n<h2 id=\"getNode-int-hash-Object-key-1\"><a href=\"#getNode-int-hash-Object-key-1\" class=\"headerlink\" title=\"getNode( int hash, Object key)\"></a>getNode( int hash, Object key)</h2><p></p>\n<h2 id=\"containsKey-Object-key\"><a href=\"#containsKey-Object-key\" class=\"headerlink\" title=\"containsKey( Object key)\"></a>containsKey( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * mapkeykeytrue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   key   key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> mapkeykeytrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">containsKey</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getNode(hash(key), key) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"put-K-key-V-value-1\"><a href=\"#put-K-key-V-value-1\" class=\"headerlink\" title=\"put( K key, V value)\"></a>put( K key, V value)</h2><p></p>\n<h2 id=\"putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict-1\"><a href=\"#putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict-1\" class=\"headerlink\" title=\"putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\"></a>putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)</h2><p></p>\n<h2 id=\"resize\"><a href=\"#resize\" class=\"headerlink\" title=\"resize()\"></a>resize()</h2><p></p>\n<h2 id=\"treeifyBin-Node-lt-K-V-gt-tab-int-hash\"><a href=\"#treeifyBin-Node-lt-K-V-gt-tab-int-hash\" class=\"headerlink\" title=\"treeifyBin( Node&lt;K,V&gt;[] tab, int hash)\"></a>treeifyBin( Node&lt;K,V&gt;[] tab, int hash)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">treeifyBin</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> hash)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//tabletableMIN_TREEIFY_CAPACITY</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">//hashnull</span></span><br><span class=\"line\">        TreeNode&lt;K,V&gt; hd = <span class=\"literal\">null</span>, tl = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//nodenode</span></span><br><span class=\"line\">            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tl == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                hd = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                p.prev = tl;</span><br><span class=\"line\">                tl.next = p;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            tl = p;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab[index] = hd) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            hd.treeify(tab);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"putAll-Map-lt-extends-K-extends-V-gt-m\"><a href=\"#putAll-Map-lt-extends-K-extends-V-gt-m\" class=\"headerlink\" title=\"putAll( Map&lt;? extends K, ? extends V&gt; m)\"></a>putAll( Map&lt;? extends K, ? extends V&gt; m)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * maphashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> m map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException mapnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">putAll</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">    putMapEntries(m, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"remove-Object-key-1\"><a href=\"#remove-Object-key-1\" class=\"headerlink\" title=\"remove( Object key)\"></a>remove( Object key)</h2><p></p>\n<h2 id=\"removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable-1\"><a href=\"#removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable-1\" class=\"headerlink\" title=\"removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\"></a>removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)</h2><p></p>\n<h2 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear()\"></a>clear()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * map</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        size = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i)</span><br><span class=\"line\">            tab[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"containsValue-Object-value\"><a href=\"#containsValue-Object-value\" class=\"headerlink\" title=\"containsValue( Object value)\"></a>containsValue( Object value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapvaluevaluetrue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapvaluevaluetrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">containsValue</span><span class=\"params\">(Object value)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; V v;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((v = e.value) == value ||</span><br><span class=\"line\">                    (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"keySet\"><a href=\"#keySet\" class=\"headerlink\" title=\"keySet()\"></a>keySet()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkey</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * sethashMap(remove())</span></span><br><span class=\"line\"><span class=\"comment\"> * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapkeyset</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Set&lt;K&gt; <span class=\"title function_\">keySet</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Set&lt;K&gt; ks = keySet;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ks == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        ks = <span class=\"keyword\">new</span> <span class=\"title class_\">KeySet</span>();</span><br><span class=\"line\">        keySet = ks;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ks;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * KeySet</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">KeySet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSet</span>&lt;K&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;K&gt; <span class=\"title function_\">iterator</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">KeyIterator</span>(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123; <span class=\"keyword\">return</span> containsKey(o); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;K&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">KeySpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> K&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e.key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"values\"><a href=\"#values\" class=\"headerlink\" title=\"values()\"></a>values()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapvaluecollection</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcollection</span></span><br><span class=\"line\"><span class=\"comment\"> * collectionhashMapremove()</span></span><br><span class=\"line\"><span class=\"comment\"> * collectionIterator.removeCollection.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapkeycollection</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Collection&lt;V&gt; <span class=\"title function_\">values</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    Collection&lt;V&gt; vs = values;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (vs == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        vs = <span class=\"keyword\">new</span> <span class=\"title class_\">Values</span>();</span><br><span class=\"line\">        values = vs;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> vs;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Values</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Values</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCollection</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;V&gt; <span class=\"title function_\">iterator</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ValueIterator</span>(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123; <span class=\"keyword\">return</span> containsValue(o); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;V&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ValueSpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> V&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e.value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"entrySet\"><a href=\"#entrySet\" class=\"headerlink\" title=\"entrySet()\"></a>entrySet()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * sethashMap(remove())</span></span><br><span class=\"line\"><span class=\"comment\"> * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class=\"line\">    Set&lt;Map.Entry&lt;K,V&gt;&gt; es;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (es = entrySet) == <span class=\"literal\">null</span> ? (entrySet = <span class=\"keyword\">new</span> <span class=\"title class_\">EntrySet</span>()) : es;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * EntrySet</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EntrySet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSet</span>&lt;Map.Entry&lt;K,V&gt;&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EntryIterator</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(o <span class=\"keyword\">instanceof</span> Map.Entry))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">        Node&lt;K,V&gt; candidate = getNode(hash(key), key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> candidate != <span class=\"literal\">null</span> &amp;&amp; candidate.equals(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> e.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> removeNode(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;Map.Entry&lt;K,V&gt;&gt; spliterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EntrySpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> Map.Entry&lt;K,V&gt;&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"JDK8\"><a href=\"#JDK8\" class=\"headerlink\" title=\"JDK8\"></a>JDK8</h1><h2 id=\"getOrDefault-Object-key-V-defaultValue\"><a href=\"#getOrDefault-Object-key-V-defaultValue\" class=\"headerlink\" title=\"getOrDefault( Object key, V defaultValue)\"></a>getOrDefault( Object key, V defaultValue)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keynodedefaultValue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> keynodedefaultValue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"literal\">null</span> ? defaultValue : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"putIfAbsent-K-key-V-value\"><a href=\"#putIfAbsent-K-key-V-value\" class=\"headerlink\" title=\"putIfAbsent( K key, V value)\"></a>putIfAbsent( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeyvaluekeyhashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> keyhashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">putIfAbsent</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"remove-Object-key-Object-value\"><a href=\"#remove-Object-key-Object-value\" class=\"headerlink\" title=\"remove( Object key, Object value)\"></a>remove( Object key, Object value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeykeyvaluevalue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object key, Object value)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeNode(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"replace-K-key-V-oldValue-V-newValue\"><a href=\"#replace-K-key-V-oldValue-V-newValue\" class=\"headerlink\" title=\"replace( K key, V oldValue, V newValue)\"></a>replace( K key, V oldValue, V newValue)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * newValuekeyoldValuevalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">replace</span><span class=\"params\">(K key, V oldValue, V newValue)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e; V v;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">        ((v = e.value) == oldValue || (v != <span class=\"literal\">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class=\"line\">        e.value = newValue;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"replace-K-key-V-value\"><a href=\"#replace-K-key-V-value\" class=\"headerlink\" title=\"replace( K key, V value)\"></a>replace( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * valuekeyvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">replace</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">        e.value = value;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"clone\"><a href=\"#clone\" class=\"headerlink\" title=\"clone()\"></a>clone()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * cloneHashMapHashMaptableHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapcloneclone</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">clone</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    HashMap&lt;K,V&gt; result;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        result = (HashMap&lt;K,V&gt;)<span class=\"built_in\">super</span>.clone();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// this shouldn&#x27;t happen, since we are Cloneable</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    result.reinitialize();</span><br><span class=\"line\">    result.putMapEntries(<span class=\"built_in\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"loadFactor\"><a href=\"#loadFactor\" class=\"headerlink\" title=\"loadFactor()\"></a>loadFactor()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// These methods are also used when serializing HashSets</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">float</span> <span class=\"title function_\">loadFactor</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> loadFactor; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"capacity\"><a href=\"#capacity\" class=\"headerlink\" title=\"capacity()\"></a>capacity()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// These methods are also used when serializing HashSets</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">capacity</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (table != <span class=\"literal\">null</span>) ? table.length :</span><br><span class=\"line\">        (threshold &gt; <span class=\"number\">0</span>) ? threshold :</span><br><span class=\"line\">        DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"writeObject-java-io-ObjectOutputStream-s\"><a href=\"#writeObject-java-io-ObjectOutputStream-s\" class=\"headerlink\" title=\"writeObject( java.io.ObjectOutputStream s)\"></a>writeObject( java.io.ObjectOutputStream s)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapObjectOutputStream</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcapacitysizeObjectOutputStream</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">writeObject</span><span class=\"params\">(java.io.ObjectOutputStream s)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">buckets</span> <span class=\"operator\">=</span> capacity();</span><br><span class=\"line\">    <span class=\"comment\">// Write out the threshold, loadfactor, and any hidden stuff</span></span><br><span class=\"line\">    s.defaultWriteObject();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.writeInt(buckets);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.writeInt(size);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    internalWriteEntries(s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hashMapObjectOutputStream</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">internalWriteEntries</span><span class=\"params\">(java.io.ObjectOutputStream s)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                s.writeObject(e.key);</span><br><span class=\"line\">                s.writeObject(e.value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"readObject-java-io-ObjectInputStream-s\"><a href=\"#readObject-java-io-ObjectInputStream-s\" class=\"headerlink\" title=\"readObject( java.io.ObjectInputStream s)\"></a>readObject( java.io.ObjectInputStream s)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ObjectOutputStreamhashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcapacitysize</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">readObject</span><span class=\"params\">(java.io.ObjectInputStream s)</span> <span class=\"keyword\">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class=\"line\">    <span class=\"comment\">// hashMapcapacitysize</span></span><br><span class=\"line\">    s.defaultReadObject();</span><br><span class=\"line\">    <span class=\"comment\">//hashMap</span></span><br><span class=\"line\">    reinitialize();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidObjectException</span>(<span class=\"string\">&quot;Illegal load factor: &quot;</span> + loadFactor);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.readInt();                <span class=\"comment\">// Read and ignore number of buckets</span></span><br><span class=\"line\">    <span class=\"comment\">//size</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">mappings</span> <span class=\"operator\">=</span> s.readInt(); <span class=\"comment\">// Read number of mappings (size)</span></span><br><span class=\"line\">    <span class=\"comment\">//size0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mappings &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidObjectException</span>(<span class=\"string\">&quot;Illegal mappings count: &quot;</span> + mappings);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mappings &gt; <span class=\"number\">0</span>) &#123; <span class=\"comment\">// (if zero, use defaults)</span></span><br><span class=\"line\">        <span class=\"comment\">//hashMap</span></span><br><span class=\"line\">        <span class=\"comment\">// Size the table using given load factor only if within range of 0.25...4.0</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">lf</span> <span class=\"operator\">=</span> Math.min(Math.max(<span class=\"number\">0.25f</span>, loadFactor), <span class=\"number\">4.0f</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">fc</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)mappings / lf + <span class=\"number\">1.0f</span>;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cap</span> <span class=\"operator\">=</span> ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?</span><br><span class=\"line\">                   DEFAULT_INITIAL_CAPACITY :</span><br><span class=\"line\">                   (fc &gt;= MAXIMUM_CAPACITY) ?</span><br><span class=\"line\">                   MAXIMUM_CAPACITY :</span><br><span class=\"line\">                   tableSizeFor((<span class=\"type\">int</span>)fc));</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)cap * lf;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ? (<span class=\"type\">int</span>)ft : Integer.MAX_VALUE);</span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">            Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>[cap];</span><br><span class=\"line\">        table = tab;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// keyvaluehashMap</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; mappings; i++) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> (K) s.readObject();</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> (V) s.readObject();</span><br><span class=\"line\">            putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/77244920\">https://blog.csdn.net/panweiwei1994/article/details/77244920</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>JDK1.8</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/java-hashmap/java-hash-map-1.jpg\" alt=\"image\"></p>\n<p>HashMap++since JDK1.8<strong></strong>keyhashhash<strong></strong>(jdk1.7)key-valuehash8(TREEIFY_THRESHOLD)</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><blockquote>\n<p>HashMapMapMapkeyvaluenullHashMapunsynchronizednullHashMapHashTable</p>\n<p>(get  put) collection  HashMap -initial capacityload factor</p>\n<p>HashMapinitial capacityload factorinitial capacity<em>load factorinitial capacity</em>load factorHashMaprehashed</p>\n<p> (0.75)  HashMap get  put rehashrehash </p>\n<p> HashMap  rehash </p>\n<p> Collections.synchronizedMap </p>\n<p>Map m &#x3D; Collections.synchronizedMap(new HashMap());</p>\n<p>collection fail-fast remove ConcurrentModificationException</p>\n<p> ConcurrentModificationExceptionbug</p>\n<p> Java Collections Framework </p>\n<p>@author Doug Lea<br>@author Josh Bloch<br>@author Arthur van Hoff<br>@author Neal Gafter<br>@see Object#hashCode()<br>@see Collection<br>@see Map<br>@see TreeMap</p>\n</blockquote>\n<p></p>\n<ul>\n<li><strong></strong>HashMapMap</li>\n<li><strong>null</strong>HashMapkeyvaluenull</li>\n<li><strong></strong>HashMap</li>\n<li><strong>rehash</strong>initial capacity<em>load factorinitial capacity</em>load factorHashMaprehashed</li>\n<li><strong></strong>rehashrehashrehash</li>\n<li><strong></strong>0.75rehash</li>\n<li><strong></strong>HashMap</li>\n<li><strong></strong>fast-fail</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HashMap</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractMap</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>&lt;K,V&gt;, Cloneable, Serializable</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>HashMap&lt;K,V&gt;HashMapkey-value</li>\n<li>extends AbstractMap&lt;K,V&gt;AbstractMapMap</li>\n<li>implements Map&lt;K,V&gt;MapMap</li>\n<li>implements Cloneableclone()field-for-field</li>\n<li>implements Serializable</li>\n</ul>\n<p>HashMap</p>\n<p><img src=\"/images/java-hashmap/java-hash-map-2.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 16</span></span><br><span class=\"line\"><span class=\"comment\"> * 2n.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_INITIAL_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">4</span>; <span class=\"comment\">// aka 16</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * , MAXIMUM_CAPACITY.</span></span><br><span class=\"line\"><span class=\"comment\"> * 21&lt;&lt;30230</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAXIMUM_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">float</span> <span class=\"variable\">DEFAULT_LOAD_FACTOR</span> <span class=\"operator\">=</span> <span class=\"number\">0.75f</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * TREEIFY_THRESHOLD</span></span><br><span class=\"line\"><span class=\"comment\"> * 8</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">TREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * TREEIFY_THRESHOLD6</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">UNTREEIFY_THRESHOLD</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * 4*TREEIFY_THRESHOLD</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MIN_TREEIFY_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">64</span>;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Node\"><a href=\"#Node\" class=\"headerlink\" title=\"Node\"></a>Node</h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Node</span>&lt;K,V&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//key</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">int</span> hash;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node&lt;K,V&gt; next;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Node(<span class=\"type\">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hash = hash;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.next = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title function_\">getKey</span><span class=\"params\">()</span>        &#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">getValue</span><span class=\"params\">()</span>      &#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> key + <span class=\"string\">&quot;=&quot;</span> + value; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hashCode</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title function_\">setValue</span><span class=\"params\">(V newValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> value;</span><br><span class=\"line\">        value = newValue;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o == <span class=\"built_in\">this</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class=\"line\">                Objects.equals(value, e.getValue()))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"get-Object-key\"><a href=\"#get-Object-key\" class=\"headerlink\" title=\"get( Object key)\"></a>get( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keyvaluevaluenullnull</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@see</span> #put(Object, Object)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//keynodenullnullnodevaluegetNode</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"literal\">null</span> ? <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>get(E e)</p>\n<ol>\n<li>hash(Object key)keyhash</li>\n<li>getNode( int hash, Object key)node</li>\n<li>nodenullnullnode.value<br></li>\n</ol>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(n - <span class=\"number\">1</span>) &amp; hash</span><br></pre></td></tr></table></figure>\n\n<p>nhashhash(key)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * key</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">hash</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> h;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"literal\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>keyhashCodekeyhashCode1616</p>\n<p><img src=\"/images/java-hashmap/java-hash-map-3.jpg\" alt=\"image\"></p>\n<p><strong></strong></p>\n<p>n16n-1150000 0000 0000 0000 0000 0000 0000 1111hashCode()4</p>\n<p>keyhashnode</p>\n<h2 id=\"getNode-int-hash-Object-key\"><a href=\"#getNode-int-hash-Object-key\" class=\"headerlink\" title=\"getNode( int hash, Object key)\"></a>getNode( int hash, Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keykey</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">getNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class=\"type\">int</span> n; K k;</span><br><span class=\"line\">    <span class=\"comment\">//key</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">        (first = tab[(n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//hashkey</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (first.hash == hash &amp;&amp; <span class=\"comment\">// always check first node</span></span><br><span class=\"line\">            ((k = first.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> first;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e = first.next) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//get</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//key</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                    ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//null</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"get\"><a href=\"#get\" class=\"headerlink\" title=\"get\"></a>get</h3><p>get(E e)</p>\n<ol>\n<li>hash(Object key)keyhash</li>\n<li>getNode( int hash, Object key)node</li>\n<li>nodenullnullnode.value</li>\n</ol>\n<p>hash</p>\n<ol>\n<li>keyhashCode</li>\n<li>keyhashCode1616</li>\n<li></li>\n</ol>\n<p>getNode</p>\n<ol>\n<li>keynull</li>\n<li>hashkey</li>\n<li><ol>\n<li>get</li>\n<li>key</li>\n</ol>\n</li>\n<li>null</li>\n</ol>\n<h2 id=\"put-K-key-V-value\"><a href=\"#put-K-key-V-value\" class=\"headerlink\" title=\"put( K key, V value)\"></a>put( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keyvaluemapkeykeyvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> valuevaluenullkeyvaluenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">put</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//putVal</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>put(K key, V value)</p>\n<ol>\n<li>hash(Object key)key</li>\n<li>putVal(hash(key), key, value, false, true)</li>\n<li>putVal</li>\n</ol>\n<p>putVal</p>\n<h2 id=\"putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict\"><a href=\"#putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict\" class=\"headerlink\" title=\"putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\"></a>putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.put</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> onlyIfAbsent truekeymapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> evict falsetable</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> valuevaluenullkeyvaluenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> V <span class=\"title function_\">putVal</span><span class=\"params\">(<span class=\"type\">int</span> hash, K key, V value, <span class=\"type\">boolean</span> onlyIfAbsent,<span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, i;</span><br><span class=\"line\">    <span class=\"comment\">//resize()n</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"literal\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">        n = (tab = resize()).length;</span><br><span class=\"line\">    <span class=\"comment\">//hash</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        <span class=\"comment\">//map</span></span><br><span class=\"line\">        tab[i] = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">            ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            e = p;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"built_in\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">binCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    p.next = newNode(hash, key, value, <span class=\"literal\">null</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//TREEIFY_THRESHOLD</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></span><br><span class=\"line\">                        treeifyBin(tab, hash);</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//keykeykey</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                    ((k = e.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"comment\">//e = p.next</span></span><br><span class=\"line\">                p = e;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//keynull</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e != <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">            <span class=\"comment\">//vlaue</span></span><br><span class=\"line\">            <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">            <span class=\"comment\">//onlyIfAbsentfalseoldValuenull</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                <span class=\"comment\">//value</span></span><br><span class=\"line\">                e.value = value;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            afterNodeAccess(e);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    ++modCount;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    afterNodeInsertion(evict);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>putVal</p>\n<ol>\n<li>resize()</li>\n<li>hash</li>\n<li>key<ol>\n<li></li>\n<li></li>\n<li>keyTREEIFY_THRESHOLDtreeifyBin</li>\n</ol>\n</li>\n<li>keynull<ol>\n<li>vlaue</li>\n<li>onlyIfAbsentfalseoldValuenullvalue</li>\n<li>value</li>\n</ol>\n</li>\n<li>key23hashMapsize1sizethresholdresize</li>\n</ol>\n<h2 id=\"resize\"><a href=\"#resize\" class=\"headerlink\" title=\"resize()\"></a>resize()</h2><p>hashMapHashMaphashMap</p>\n<p>resizen-1&amp;hash+</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * table</span></span><br><span class=\"line\"><span class=\"comment\"> * tablenulltable</span></span><br><span class=\"line\"><span class=\"comment\"> * tablen-1&amp;hash+</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//oldTabtable</span></span><br><span class=\"line\">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class=\"line\">    <span class=\"comment\">//oldCaptable</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldCap</span> <span class=\"operator\">=</span> (oldTab == <span class=\"literal\">null</span>) ? <span class=\"number\">0</span> : oldTab.length;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldThr</span> <span class=\"operator\">=</span> threshold;</span><br><span class=\"line\">    <span class=\"type\">int</span> newCap, newThr = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// &gt; 0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldCap &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//&gt;=MAXIMUM_CAPACITY</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            threshold = Integer.MAX_VALUE;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldTab;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//MAXIMUM_CAPACITYDEFAULT_INITIAL_CAPACITY</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((newCap = oldCap &lt;&lt; <span class=\"number\">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class=\"line\">            <span class=\"comment\">//2</span></span><br><span class=\"line\">            newThr = oldThr &lt;&lt; <span class=\"number\">1</span>; </span><br><span class=\"line\">    &#125;<span class=\"comment\">// &lt;= 0 &gt; 0</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldThr &gt; <span class=\"number\">0</span>) </span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        newCap = oldThr;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;<span class=\"comment\">// &lt;= 0 &lt;= 0DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY</span></span><br><span class=\"line\">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">        newThr = (<span class=\"type\">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newThr == <span class=\"number\">0</span>) &#123;<span class=\"comment\">//oldThr &gt; 0newThr == 0</span></span><br><span class=\"line\">        <span class=\"comment\">//ft</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)newCap * loadFactor;</span><br><span class=\"line\">        <span class=\"comment\">//&lt; MAXIMUM_CAPACITYft &lt; (float)MAXIMUM_CAPACITYftInteger.MAX_VALUE</span></span><br><span class=\"line\">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class=\"type\">float</span>)MAXIMUM_CAPACITY ?</span><br><span class=\"line\">                  (<span class=\"type\">int</span>)ft : Integer.MAX_VALUE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//hashMapnewThr</span></span><br><span class=\"line\">    threshold = newThr;</span><br><span class=\"line\">    <span class=\"comment\">//tablenewCap</span></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class=\"line\">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>[newCap];</span><br><span class=\"line\">    <span class=\"comment\">//hashMaptablenewTab</span></span><br><span class=\"line\">    table = newTab;</span><br><span class=\"line\">    <span class=\"comment\">//tabletabletable</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldTab != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class=\"line\">            Node&lt;K,V&gt; e;</span><br><span class=\"line\">            <span class=\"comment\">//nulle</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e = oldTab[j]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//null</span></span><br><span class=\"line\">                oldTab[j] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.next == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                    <span class=\"comment\">//eoldTab[j]newTabe.hash &amp; (newCap - 1)</span></span><br><span class=\"line\">                    newTab[e.hash &amp; (newCap - <span class=\"number\">1</span>)] = e;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    <span class=\"comment\">//node</span></span><br><span class=\"line\">                    ((TreeNode&lt;K,V&gt;)e).split(<span class=\"built_in\">this</span>, newTab, j, oldCap);</span><br><span class=\"line\">                <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//hash</span></span><br><span class=\"line\">                    Node&lt;K,V&gt; loHead = <span class=\"literal\">null</span>, loTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    Node&lt;K,V&gt; hiHead = <span class=\"literal\">null</span>, hiTail = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    Node&lt;K,V&gt; next;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                        next = e.next;</span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> ((e.hash &amp; oldCap) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (loTail == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                loHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span></span><br><span class=\"line\">                                loTail.next = e;</span><br><span class=\"line\">                            loTail = e;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (hiTail == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                                hiHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span></span><br><span class=\"line\">                                hiTail.next = e;</span><br><span class=\"line\">                            hiTail = e;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (loTail != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        loTail.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        newTab[j] = loHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (hiTail != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        hiTail.next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        newTab[j + oldCap] = hiHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newTab;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>HashMapmapmap</p>\n<p>resize</p>\n<ol>\n<li></li>\n<li>hashMap</li>\n<li>hashMaptable</li>\n<li>table</li>\n</ol>\n<h2 id=\"remove-Object-key\"><a href=\"#remove-Object-key\" class=\"headerlink\" title=\"remove( Object key)\"></a>remove( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeynode</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenullvalue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//keynoderemoveNode</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) == <span class=\"literal\">null</span> ?</span><br><span class=\"line\">        <span class=\"literal\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>remove</p>\n<ol>\n<li>hash(Object key)key</li>\n<li>removeNode</li>\n<li>nodevalue</li>\n</ol>\n<p>removeNode</p>\n<h2 id=\"removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable\"><a href=\"#removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable\" class=\"headerlink\" title=\"removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\"></a>removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.remove</span></span><br><span class=\"line\"><span class=\"comment\"> * node</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value matchValuetruevaluenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> matchValue truevaluenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> movable falsenodenode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> nodenodenull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title function_\">removeNode</span><span class=\"params\">(<span class=\"type\">int</span> hash, Object key, Object value,<span class=\"type\">boolean</span> matchValue, <span class=\"type\">boolean</span> movable)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"type\">int</span> n, index;</span><br><span class=\"line\">    <span class=\"comment\">//tablekey</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">        (p = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Node&lt;K,V&gt; node = <span class=\"literal\">null</span>, e; K k; V v;</span><br><span class=\"line\">        <span class=\"comment\">//nodenode</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">            ((k = p.key) == key || (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            node = p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = p.next) != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)<span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"comment\">//keynode</span></span><br><span class=\"line\">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;<span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">do</span> &#123;<span class=\"comment\">//keynode</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key ||</span><br><span class=\"line\">                         (key != <span class=\"literal\">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//keynode</span></span><br><span class=\"line\">                        node = e;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//nodenull(matchValuefalse||node.valuevalue)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node != <span class=\"literal\">null</span> &amp;&amp; (!matchValue || (v = node.value) == value || (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class=\"built_in\">this</span>, tab, movable);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node == p)<span class=\"comment\">//nodenode</span></span><br><span class=\"line\">                <span class=\"comment\">//node</span></span><br><span class=\"line\">                tab[index] = node.next;</span><br><span class=\"line\">            <span class=\"keyword\">else</span><span class=\"comment\">//node</span></span><br><span class=\"line\">                p.next = node.next;</span><br><span class=\"line\">            <span class=\"comment\">//+1</span></span><br><span class=\"line\">            ++modCount;</span><br><span class=\"line\">            <span class=\"comment\">//-1</span></span><br><span class=\"line\">            --size;</span><br><span class=\"line\">            afterNodeRemoval(node);</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//tablekeynull</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>removeNode</p>\n<ol>\n<li>tablekeynull</li>\n<li>keynodenode</li>\n<li>nodekeynode</li>\n<li>keynode</li>\n<li>nodenullnodesize-1</li>\n<li>node</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"hash-Object-key\"><a href=\"#hash-Object-key\" class=\"headerlink\" title=\"hash( Object key)\"></a>hash( Object key)</h2><p></p>\n<h2 id=\"comparableClassFor-Object-x\"><a href=\"#comparableClassFor-Object-x\" class=\"headerlink\" title=\"comparableClassFor( Object x)\"></a>comparableClassFor( Object x)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * xComparablexnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> Class&lt;?&gt; comparableClassFor(Object x) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x <span class=\"keyword\">instanceof</span> Comparable) &#123;</span><br><span class=\"line\">        Class&lt;?&gt; c; Type[] ts, as; Type t; ParameterizedType p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((c = x.getClass()) == String.class) <span class=\"comment\">// bypass checks</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((ts = c.getGenericInterfaces()) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; ts.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (((t = ts[i]) <span class=\"keyword\">instanceof</span> ParameterizedType) &amp;&amp;</span><br><span class=\"line\">                    ((p = (ParameterizedType)t).getRawType() ==</span><br><span class=\"line\">                     Comparable.class) &amp;&amp;</span><br><span class=\"line\">                    (as = p.getActualTypeArguments()) != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">                    as.length == <span class=\"number\">1</span> &amp;&amp; as[<span class=\"number\">0</span>] == c) <span class=\"comment\">// type arg is c</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> c;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"compareComparables-Class-lt-gt-kc-Object-k-Object-x\"><a href=\"#compareComparables-Class-lt-gt-kc-Object-k-Object-x\" class=\"headerlink\" title=\"compareComparables( Class&lt;?&gt; kc, Object k, Object x)\"></a>compareComparables( Class&lt;?&gt; kc, Object k, Object x)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * xkck.compareTo(x)0.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span> <span class=\"comment\">// for cast to Comparable</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">compareComparables</span><span class=\"params\">(Class&lt;?&gt; kc, Object k, Object x)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (x == <span class=\"literal\">null</span> || x.getClass() != kc ? <span class=\"number\">0</span> :</span><br><span class=\"line\">            ((Comparable)k).compareTo(x));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"tableSizeFor-int-cap\"><a href=\"#tableSizeFor-int-cap\" class=\"headerlink\" title=\"tableSizeFor( int cap)\"></a>tableSizeFor( int cap)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">tableSizeFor</span><span class=\"params\">(<span class=\"type\">int</span> cap)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> cap - <span class=\"number\">1</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">2</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">4</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">8</span>;</span><br><span class=\"line\">    n |= n &gt;&gt;&gt; <span class=\"number\">16</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (n &lt; <span class=\"number\">0</span>) ? <span class=\"number\">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * entrySetKeyhashCode</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * rehash</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapfail-fastConcurrentModificationException</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"type\">int</span> modCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * capacity * load factorHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> threshold;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">float</span> loadFactor;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"HashMap-int-initialCapacity-float-loadFactor\"><a href=\"#HashMap-int-initialCapacity-float-loadFactor\" class=\"headerlink\" title=\"HashMap( int initialCapacity, float loadFactor)\"></a>HashMap( int initialCapacity, float loadFactor)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * initial capacity load factorHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  loadFactor      </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity, <span class=\"type\">float</span> loadFactor)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class=\"line\">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal load factor: &quot;</span> +</span><br><span class=\"line\">                                           loadFactor);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = loadFactor;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap-int-initialCapacity\"><a href=\"#HashMap-int-initialCapacity\" class=\"headerlink\" title=\"HashMap( int initialCapacity)\"></a>HashMap( int initialCapacity)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * initial capacityDEFAULT_LOAD_FACTOR0.75HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap\"><a href=\"#HashMap\" class=\"headerlink\" title=\"HashMap()\"></a>HashMap()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 16DEFAULT_LOAD_FACTOR0.75HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class=\"comment\">// all other fields defaulted</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HashMap-Map-lt-extends-K-extends-V-gt-m\"><a href=\"#HashMap-Map-lt-extends-K-extends-V-gt-m\" class=\"headerlink\" title=\"HashMap( Map&lt;? extends K, ? extends V&gt;m)\"></a>HashMap( Map&lt;? extends K, ? extends V&gt;m)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map mHashMap16DEFAULT_LOAD_FACTOR0.75</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   m map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span>  NullPointerException mapnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">HashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class=\"line\">    putMapEntries(m, <span class=\"literal\">false</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict\"><a href=\"#putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict\" class=\"headerlink\" title=\"putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)\"></a>putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Map.putAll and Map constructor</span></span><br><span class=\"line\"><span class=\"comment\"> * mmap</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> m the map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> evict mapfalsetrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">putMapEntries</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m, <span class=\"type\">boolean</span> evict)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> m.size();</span><br><span class=\"line\">    <span class=\"comment\">//map</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (table == <span class=\"literal\">null</span>) &#123; <span class=\"comment\">// pre-size</span></span><br><span class=\"line\">            <span class=\"comment\">//initial capacity*load factorhashMaps/loadFactor+1</span></span><br><span class=\"line\">            <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> ((<span class=\"type\">float</span>)s / loadFactor) + <span class=\"number\">1.0F</span>;</span><br><span class=\"line\">            <span class=\"comment\">//ftMAXIMUM_CAPACITYftMAXIMUM_CAPACITY</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> ((ft &lt; (<span class=\"type\">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class=\"line\">                     (<span class=\"type\">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (t &gt; threshold)</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                threshold = tableSizeFor(t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//tablemap</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s &gt; threshold)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            resize();</span><br><span class=\"line\">        <span class=\"comment\">//maphashMap</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">K</span>, ? <span class=\"keyword\">extends</span> <span class=\"title class_\">V</span>&gt; e : m.entrySet()) &#123;</span><br><span class=\"line\">            <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">            <span class=\"type\">V</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> e.getValue();</span><br><span class=\"line\">            <span class=\"comment\">//putVal</span></span><br><span class=\"line\">            putVal(hash(key), key, value, <span class=\"literal\">false</span>, evict);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"size\"><a href=\"#size\" class=\"headerlink\" title=\"size()\"></a>size()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * map</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> map</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"isEmpty\"><a href=\"#isEmpty\" class=\"headerlink\" title=\"isEmpty()\"></a>isEmpty()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * maptrue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> &lt;maptrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isEmpty</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">return</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span>= <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"get-Object-key-1\"><a href=\"#get-Object-key-1\" class=\"headerlink\" title=\"get( Object key)\"></a>get( Object key)</h2><p></p>\n<h2 id=\"getNode-int-hash-Object-key-1\"><a href=\"#getNode-int-hash-Object-key-1\" class=\"headerlink\" title=\"getNode( int hash, Object key)\"></a>getNode( int hash, Object key)</h2><p></p>\n<h2 id=\"containsKey-Object-key\"><a href=\"#containsKey-Object-key\" class=\"headerlink\" title=\"containsKey( Object key)\"></a>containsKey( Object key)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * mapkeykeytrue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   key   key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> mapkeykeytrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">containsKey</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getNode(hash(key), key) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"put-K-key-V-value-1\"><a href=\"#put-K-key-V-value-1\" class=\"headerlink\" title=\"put( K key, V value)\"></a>put( K key, V value)</h2><p></p>\n<h2 id=\"putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict-1\"><a href=\"#putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict-1\" class=\"headerlink\" title=\"putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)\"></a>putVal( int hash, K key, V value, boolean onlyIfAbsent,boolean evict)</h2><p></p>\n<h2 id=\"resize\"><a href=\"#resize\" class=\"headerlink\" title=\"resize()\"></a>resize()</h2><p></p>\n<h2 id=\"treeifyBin-Node-lt-K-V-gt-tab-int-hash\"><a href=\"#treeifyBin-Node-lt-K-V-gt-tab-int-hash\" class=\"headerlink\" title=\"treeifyBin( Node&lt;K,V&gt;[] tab, int hash)\"></a>treeifyBin( Node&lt;K,V&gt;[] tab, int hash)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">treeifyBin</span><span class=\"params\">(Node&lt;K,V&gt;[] tab, <span class=\"type\">int</span> hash)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">//tabletableMIN_TREEIFY_CAPACITY</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (tab == <span class=\"literal\">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"literal\">null</span>) &#123;<span class=\"comment\">//hashnull</span></span><br><span class=\"line\">        TreeNode&lt;K,V&gt; hd = <span class=\"literal\">null</span>, tl = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//nodenode</span></span><br><span class=\"line\">            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class=\"literal\">null</span>);</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tl == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                hd = p;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                p.prev = tl;</span><br><span class=\"line\">                tl.next = p;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            tl = p;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab[index] = hd) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            hd.treeify(tab);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"putAll-Map-lt-extends-K-extends-V-gt-m\"><a href=\"#putAll-Map-lt-extends-K-extends-V-gt-m\" class=\"headerlink\" title=\"putAll( Map&lt;? extends K, ? extends V&gt; m)\"></a>putAll( Map&lt;? extends K, ? extends V&gt; m)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * maphashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> m map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException mapnull</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">putAll</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class=\"line\">    putMapEntries(m, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"remove-Object-key-1\"><a href=\"#remove-Object-key-1\" class=\"headerlink\" title=\"remove( Object key)\"></a>remove( Object key)</h2><p></p>\n<h2 id=\"removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable-1\"><a href=\"#removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable-1\" class=\"headerlink\" title=\"removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)\"></a>removeNode( int hash, Object key, Object value,boolean matchValue, boolean movable)</h2><p></p>\n<h2 id=\"clear\"><a href=\"#clear\" class=\"headerlink\" title=\"clear()\"></a>clear()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * map</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        size = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i)</span><br><span class=\"line\">            tab[i] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"containsValue-Object-value\"><a href=\"#containsValue-Object-value\" class=\"headerlink\" title=\"containsValue( Object value)\"></a>containsValue( Object value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapvaluevaluetrue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapvaluevaluetrue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">containsValue</span><span class=\"params\">(Object value)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab; V v;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"literal\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//node</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((v = e.value) == value ||</span><br><span class=\"line\">                    (value != <span class=\"literal\">null</span> &amp;&amp; value.equals(v)))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"keySet\"><a href=\"#keySet\" class=\"headerlink\" title=\"keySet()\"></a>keySet()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkey</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * sethashMap(remove())</span></span><br><span class=\"line\"><span class=\"comment\"> * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapkeyset</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Set&lt;K&gt; <span class=\"title function_\">keySet</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Set&lt;K&gt; ks = keySet;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ks == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        ks = <span class=\"keyword\">new</span> <span class=\"title class_\">KeySet</span>();</span><br><span class=\"line\">        keySet = ks;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ks;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * KeySet</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">KeySet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSet</span>&lt;K&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;K&gt; <span class=\"title function_\">iterator</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">KeyIterator</span>(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123; <span class=\"keyword\">return</span> containsKey(o); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> removeNode(hash(key), key, <span class=\"literal\">null</span>, <span class=\"literal\">false</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;K&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">KeySpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> K&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e.key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"values\"><a href=\"#values\" class=\"headerlink\" title=\"values()\"></a>values()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapvaluecollection</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcollection</span></span><br><span class=\"line\"><span class=\"comment\"> * collectionhashMapremove()</span></span><br><span class=\"line\"><span class=\"comment\"> * collectionIterator.removeCollection.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapkeycollection</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Collection&lt;V&gt; <span class=\"title function_\">values</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    Collection&lt;V&gt; vs = values;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (vs == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        vs = <span class=\"keyword\">new</span> <span class=\"title class_\">Values</span>();</span><br><span class=\"line\">        values = vs;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> vs;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Values</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Values</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCollection</span>&lt;V&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;V&gt; <span class=\"title function_\">iterator</span><span class=\"params\">()</span>     &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ValueIterator</span>(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123; <span class=\"keyword\">return</span> containsValue(o); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;V&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ValueSpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> V&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e.value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"entrySet\"><a href=\"#entrySet\" class=\"headerlink\" title=\"entrySet()\"></a>entrySet()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> * sethashMap(remove())</span></span><br><span class=\"line\"><span class=\"comment\"> * setIterator.removeSet.removeremoveAllretainAllclearhashMapaddaddAll</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMapset</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class=\"line\">    Set&lt;Map.Entry&lt;K,V&gt;&gt; es;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (es = entrySet) == <span class=\"literal\">null</span> ? (entrySet = <span class=\"keyword\">new</span> <span class=\"title class_\">EntrySet</span>()) : es;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * EntrySet</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EntrySet</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractSet</span>&lt;Map.Entry&lt;K,V&gt;&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span>                 &#123; <span class=\"keyword\">return</span> size; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">clear</span><span class=\"params\">()</span>               &#123; HashMap.<span class=\"built_in\">this</span>.clear(); &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EntryIterator</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(o <span class=\"keyword\">instanceof</span> Map.Entry))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">        Node&lt;K,V&gt; candidate = getNode(hash(key), key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> candidate != <span class=\"literal\">null</span> &amp;&amp; candidate.equals(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> e.getKey();</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> e.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> removeNode(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;Map.Entry&lt;K,V&gt;&gt; spliterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">EntrySpliterator</span>&lt;&gt;(HashMap.<span class=\"built_in\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> Map.Entry&lt;K,V&gt;&gt; action)</span> &#123;</span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NullPointerException</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mc</span> <span class=\"operator\">=</span> modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentModificationException</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"JDK8\"><a href=\"#JDK8\" class=\"headerlink\" title=\"JDK8\"></a>JDK8</h1><h2 id=\"getOrDefault-Object-key-V-defaultValue\"><a href=\"#getOrDefault-Object-key-V-defaultValue\" class=\"headerlink\" title=\"getOrDefault( Object key, V defaultValue)\"></a>getOrDefault( Object key, V defaultValue)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * keynodedefaultValue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> keynodedefaultValue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"literal\">null</span> ? defaultValue : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"putIfAbsent-K-key-V-value\"><a href=\"#putIfAbsent-K-key-V-value\" class=\"headerlink\" title=\"putIfAbsent( K key, V value)\"></a>putIfAbsent( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeyvaluekeyhashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> keyhashMapvalue</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">putIfAbsent</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"remove-Object-key-Object-value\"><a href=\"#remove-Object-key-Object-value\" class=\"headerlink\" title=\"remove( Object key, Object value)\"></a>remove( Object key, Object value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapkeykeyvaluevalue</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">remove</span><span class=\"params\">(Object key, Object value)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> removeNode(hash(key), key, value, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>) != <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"replace-K-key-V-oldValue-V-newValue\"><a href=\"#replace-K-key-V-oldValue-V-newValue\" class=\"headerlink\" title=\"replace( K key, V oldValue, V newValue)\"></a>replace( K key, V oldValue, V newValue)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * newValuekeyoldValuevalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">replace</span><span class=\"params\">(K key, V oldValue, V newValue)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e; V v;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">        ((v = e.value) == oldValue || (v != <span class=\"literal\">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class=\"line\">        e.value = newValue;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"replace-K-key-V-value\"><a href=\"#replace-K-key-V-value\" class=\"headerlink\" title=\"replace( K key, V value)\"></a>replace( K key, V value)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * valuekeyvalue</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">replace</span><span class=\"params\">(K key, V value)</span> &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"type\">V</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> e.value;</span><br><span class=\"line\">        e.value = value;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"clone\"><a href=\"#clone\" class=\"headerlink\" title=\"clone()\"></a>clone()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * cloneHashMapHashMaptableHashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * HashMapcloneclone</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> hashMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">clone</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    HashMap&lt;K,V&gt; result;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        result = (HashMap&lt;K,V&gt;)<span class=\"built_in\">super</span>.clone();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// this shouldn&#x27;t happen, since we are Cloneable</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    result.reinitialize();</span><br><span class=\"line\">    result.putMapEntries(<span class=\"built_in\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"loadFactor\"><a href=\"#loadFactor\" class=\"headerlink\" title=\"loadFactor()\"></a>loadFactor()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// These methods are also used when serializing HashSets</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">float</span> <span class=\"title function_\">loadFactor</span><span class=\"params\">()</span> &#123; <span class=\"keyword\">return</span> loadFactor; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"capacity\"><a href=\"#capacity\" class=\"headerlink\" title=\"capacity()\"></a>capacity()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// These methods are also used when serializing HashSets</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">capacity</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (table != <span class=\"literal\">null</span>) ? table.length :</span><br><span class=\"line\">        (threshold &gt; <span class=\"number\">0</span>) ? threshold :</span><br><span class=\"line\">        DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"writeObject-java-io-ObjectOutputStream-s\"><a href=\"#writeObject-java-io-ObjectOutputStream-s\" class=\"headerlink\" title=\"writeObject( java.io.ObjectOutputStream s)\"></a>writeObject( java.io.ObjectOutputStream s)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapObjectOutputStream</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcapacitysizeObjectOutputStream</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">writeObject</span><span class=\"params\">(java.io.ObjectOutputStream s)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">buckets</span> <span class=\"operator\">=</span> capacity();</span><br><span class=\"line\">    <span class=\"comment\">// Write out the threshold, loadfactor, and any hidden stuff</span></span><br><span class=\"line\">    s.defaultWriteObject();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.writeInt(buckets);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.writeInt(size);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    internalWriteEntries(s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hashMapObjectOutputStream</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">internalWriteEntries</span><span class=\"params\">(java.io.ObjectOutputStream s)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">    Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class=\"literal\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                s.writeObject(e.key);</span><br><span class=\"line\">                s.writeObject(e.value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"readObject-java-io-ObjectInputStream-s\"><a href=\"#readObject-java-io-ObjectInputStream-s\" class=\"headerlink\" title=\"readObject( java.io.ObjectInputStream s)\"></a>readObject( java.io.ObjectInputStream s)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ObjectOutputStreamhashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMapcapacitysize</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">readObject</span><span class=\"params\">(java.io.ObjectInputStream s)</span> <span class=\"keyword\">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class=\"line\">    <span class=\"comment\">// hashMapcapacitysize</span></span><br><span class=\"line\">    s.defaultReadObject();</span><br><span class=\"line\">    <span class=\"comment\">//hashMap</span></span><br><span class=\"line\">    reinitialize();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidObjectException</span>(<span class=\"string\">&quot;Illegal load factor: &quot;</span> + loadFactor);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    s.readInt();                <span class=\"comment\">// Read and ignore number of buckets</span></span><br><span class=\"line\">    <span class=\"comment\">//size</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">mappings</span> <span class=\"operator\">=</span> s.readInt(); <span class=\"comment\">// Read number of mappings (size)</span></span><br><span class=\"line\">    <span class=\"comment\">//size0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mappings &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidObjectException</span>(<span class=\"string\">&quot;Illegal mappings count: &quot;</span> + mappings);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mappings &gt; <span class=\"number\">0</span>) &#123; <span class=\"comment\">// (if zero, use defaults)</span></span><br><span class=\"line\">        <span class=\"comment\">//hashMap</span></span><br><span class=\"line\">        <span class=\"comment\">// Size the table using given load factor only if within range of 0.25...4.0</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">lf</span> <span class=\"operator\">=</span> Math.min(Math.max(<span class=\"number\">0.25f</span>, loadFactor), <span class=\"number\">4.0f</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">fc</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)mappings / lf + <span class=\"number\">1.0f</span>;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cap</span> <span class=\"operator\">=</span> ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?</span><br><span class=\"line\">                   DEFAULT_INITIAL_CAPACITY :</span><br><span class=\"line\">                   (fc &gt;= MAXIMUM_CAPACITY) ?</span><br><span class=\"line\">                   MAXIMUM_CAPACITY :</span><br><span class=\"line\">                   tableSizeFor((<span class=\"type\">int</span>)fc));</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"type\">float</span> <span class=\"variable\">ft</span> <span class=\"operator\">=</span> (<span class=\"type\">float</span>)cap * lf;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ? (<span class=\"type\">int</span>)ft : Integer.MAX_VALUE);</span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class=\"line\">        <span class=\"comment\">//table</span></span><br><span class=\"line\">            Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>[cap];</span><br><span class=\"line\">        table = tab;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// keyvaluehashMap</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; mappings; i++) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"type\">K</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> (K) s.readObject();</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">                <span class=\"type\">V</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> (V) s.readObject();</span><br><span class=\"line\">            putVal(hash(key), key, value, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/77244920\">https://blog.csdn.net/panweiwei1994/article/details/77244920</a></p>\n"},{"title":"java ArrayList","date":"2021-05-17T09:53:01.000Z","_content":"\n# \n\n![image](/images/java-arraylist/java-arraylist-1.jpg)\n\n# \n\n> ListnullListVector\n>\n>sizeisEmptygetsetiteratorlistIteratoraddnO(n)LinkedList\n>\n>ArrayListArrayList\n>\n>ensureCapacityArrayList\n>\n>ArrayListCollections.synchronizedList\nList list = Collections.synchronizedList(new ArrayList());\n>\n>iteratorlistIteratorremoveaddConcurrentModificationException\n>\n>ConcurrentModificationExceptionbug\n>\n>Java Collections Framework\n\n\n\n- ****ArrayListList\n- **null**ArrayListnull\n- ****sizeisEmptygetsetiteratorlistIteratorO(1)addremoveO(n)LinkedList\n- ****ArrayList\n- ****ArrayList\n- ****ArrayListiteratorlistIteratorfail-fast\n\n# \n\nArrayList\n\n```java\npublic class ArrayList<E> extends AbstractList<E> implements List<E>,RandomAccess,Cloneable,java.io.Serializable\n```\n\n\n\n- ArrayList<E>ArrayList\n- extends AbstractList<E> AbstractListAbstractListListArrayListLlist\n- implements List<E>List\n- implements RandomAccessArrayList\n- \n- implements Cloneableclone()field-for-field\nimplements java.io.Serializable\n\nArrayList\n\n![image](/images/java-arraylist/java-arraylist-2.jpg)\n\n# \n\n```java\n/**\n * \n */\nprivate static final int DEFAULT_CAPACITY = 10;\n\n/**\n * ArrayList0\n */\nprivate static final Object[] EMPTY_ELEMENTDATA = {};\n\n/**\n * ArrayList 0\n * EMPTY_ELEMENTDATA0\n */\nprivate static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};\n\n/**\n * ArrayList\n * ArrayList\n * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ArrayListDEFAULT_CAPACITY\n * transient\n */\ntransient Object[] elementData; // non-private to simplify nested class access\n\n/**\n * ArrayList\n * @serial\n */\nprivate int size;\n```\n\n**elementDatatransient**\nArrayListwriteObject(java.io.ObjectOutputStream s)readObject(java.io.ObjectOutputStream s)\n\n# \n\n1. ArrayList(int initialCapacity)capacityArrayList\n2. ArrayList() 10 \n3. ArrayList(Collection<? extends E> c) collection  collection \n\n## ArrayList( int initialCapacity)\n\n```java\n/**\n * capacityArrayList\n *\n * @param  initialCapacity  ArrayList\n * @throws IllegalArgumentException  ArrayList\n */\npublic ArrayList(int initialCapacity) {\n    if (initialCapacity > 0) {\n        this.elementData = new Object[initialCapacity];\n    } else if (initialCapacity == 0) {\n        this.elementData = EMPTY_ELEMENTDATA;\n    } else {\n        throw new IllegalArgumentException(\"Illegal Capacity: \"+\n                                           initialCapacity);\n    }\n}\n```\n\n## ArrayList()\n\n```java\n/**\n *  10 \n */\npublic ArrayList() {\n    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n}\n```\n\n## ArrayList(Collection<? extends E> c)\n\n```java\n/**\n *  collection  collection \n *\n * @param c  collection\n * @throws NullPointerException  collection  null\n */\npublic ArrayList(Collection<? extends E> c) {\n    elementData = c.toArray();\n    if ((size = elementData.length) != 0) {\n        // c.toArray might (incorrectly) not return Object[] (see 6260652)\n        if (elementData.getClass() != Object[].class)\n            elementData = Arrays.copyOf(elementData, size, Object[].class);\n    } else {\n        // replace with empty array.\n        this.elementData = EMPTY_ELEMENTDATA;\n    }\n}\n```\n\n# \nArrayList\n\n|  |  |\n| -- | -- |\n| get(int index) | O(1) |\n| add(E e) | O(1) |\n| add(add(int index, E element)) | O(n) |\n| remove(int index) | O(n) |\n| set(int index, E element) | O(1) |\n\n## get( int index)\n\n```java\n/**\n * listindex\n *\n * @param  index \n * @return listindex\n * @throws IndexOutOfBoundsException size\n */\npublic E get(int index) {\n    //\n    rangeCheck(index);\n    //index\n    return elementData(index);\n}\n\n/**\n * \n * index\n * \n * index\n * index>=size\n */\nprivate void rangeCheck(int index) {\n    if (index >= size)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n\n/**\n * index\n */\n@SuppressWarnings(\"unchecked\")\nE elementData(int index) {\n    return (E) elementData[index];\n}\n```\n\nArrayListgetget**O(1)**\n\nadd(E e)\n\n```java\n/**\n * list.\n *\n * @param e \n * @return true\n */\npublic boolean add(E e) {\n    //list11\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    elementData[size++] = e;\n    return true;\n}\n```\n\nadd(E e)\n\n1. \n2. \n\n\n\n\n\n![image](/images/java-arraylist/java-arraylist-3.jpg)\n\n## -ensureCapacity\n\n```java\n/**\n* ArrayList\n* \n* @param   minCapacity   \n*/\npublic void ensureCapacity(int minCapacity) {\n    // elementDataDEFAULTCAPACITY_EMPTY_ELEMENTDATADEFAULT_CAPACITY0\n    int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)? 0: DEFAULT_CAPACITY;\n    //\n    if (minCapacity > minExpand) {\n        ensureExplicitCapacity(minCapacity);\n    }\n}\n/**\n* \n* \n* @param minCapacity    \n*/\nprivate void ensureCapacityInternal(int minCapacity) {\n    // elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAminCapacityDEFAULT_CAPACITYminCapacity\n    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n    }\n\n    ensureExplicitCapacity(minCapacity);\n}\n/**\n* \n* \n* @param minCapacity \n*/\nprivate void ensureExplicitCapacity(int minCapacity) {\n    modCount++;\n\n    //  >   \n    if (minCapacity - elementData.length > 0)\n        //\n        grow(minCapacity);\n}\n\n/**\n * arrays\n * 8\n * VMarrayVMlimitOutOfMemoryError\n */\nprivate static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n\n/**\n* ArrayListminCapacity\n* newCapacity = oldCapacity + (oldCapacity >> 1);minCapacityminCapacity\n* \n* @param minCapacity \n*/\nprivate void grow(int minCapacity) {\n    // \n    int oldCapacity = elementData.length;\n    // =+/2.\n    int newCapacity = oldCapacity + (oldCapacity >> 1);\n    //\n    if (newCapacity - minCapacity < 0)\n        //\n        newCapacity = minCapacity;\n    //\n    if (newCapacity - MAX_ARRAY_SIZE > 0)\n        newCapacity = hugeCapacity(minCapacity);\n    // minCapacity is usually close to size, so this is a win:\n    elementData = Arrays.copyOf(elementData,newCapacity);\n}\n/**\n* \n*/\nprivate static int hugeCapacity(int minCapacity) {\n    //minCapacity<0\n    if (minCapacity < 0) // overflow\n        throw new OutOfMemoryError();\n    //MAX_ARRAY_SIZEInteger.MAX_VALUEMAX_ARRAY_SIZE\n    return (minCapacity > MAX_ARRAY_SIZE) ?\n        Integer.MAX_VALUE :\n        MAX_ARRAY_SIZE;\n}\n```\n\n\n\n1. \n2. grow(int minCapacity)minCapacity\n3. newCapacity = oldCapacity + (oldCapacity >> 1);\n4. minCapacityminCapacity\n5. MAX_ARRAY_SIZEMAX_ARRAY_SIZE\n6. ****\n\n## add( int index, E element)\n\n```java\n/**\n * index\n *\n * @param index \n * @param element \n * @throws IndexOutOfBoundsException size\n */\npublic void add(int index, E element) {\n    //\n    rangeCheckForAdd(index);\n    //list11\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    // indexelementindex\n    System.arraycopy(elementData, index, elementData, index + 1,size - index);\n    //indexelement\n    elementData[index] = element;\n    //+1\n    size++;\n}\n```\n\nadd(E e)\n\n1. \n2. \n3. \n\n\n\n```java\nprivate void rangeCheckForAdd(int index) {\n    if (index > size || index < 0)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n\n\n\n\n![image](/images/java-arraylist/java-arraylist-4.jpg)\n\nadd(int index, E e)**O(n)**\n\n## remove( int index)\n\n```java\n/**\n * listindex\n * \n *\n * @param index \n * @return \n * @throws IndexOutOfBoundsException index>=size\n */\npublic E remove(int index) {\n    //index>=size\n    rangeCheck(index);\n    //+1\n    modCount++;\n    //inde\n    E oldValue = elementData(index);\n\n    // \n    int numMoved = size - index - 1;\n    //\n    if (numMoved > 0)\n        System.arraycopy(elementData, index+1, elementData, index,\n                         numMoved);\n    // sizesize-1nullGCnull\n    elementData[--size] = null; // clear to let GC do its work\n\n    //\n    return oldValue;\n}\n\n/**\n * \n * index\n * \n * index\n * index>=size\n */\nprivate void rangeCheck(int index) {\n    if (index >= size)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\nArrayList\n\n1. index>=size\n2. index\n3. size-1nullGC\n\nGCnullnull\n\n![image](/images/java-arraylist/java-arraylist-5.jpg)\n\n## set( int index, E element)\n\n```java\n/**\n * \n *\n * @param \n * @param element \n * @return \n * @throws IndexOutOfBoundsException index>=size\n */\npublic E set(int index, E element) {\n    //index>=size\n    rangeCheck(index);\n\n    //\n    E oldValue = elementData(index);\n    //\n    elementData[index] = element;\n    //\n    return oldValue;\n}\n```\n\n\n\n\n\nhttps://blog.csdn.net/panweiwei1994/article/details/76760238","source":"_posts/java/container/java-arraylist.md","raw":"---\ntitle: java ArrayList\ndate: 2021-05-17 17:53:01\ncategories:\n  - java\n  - container\ntags:\n  - java\n  - list\n---\n\n# \n\n![image](/images/java-arraylist/java-arraylist-1.jpg)\n\n# \n\n> ListnullListVector\n>\n>sizeisEmptygetsetiteratorlistIteratoraddnO(n)LinkedList\n>\n>ArrayListArrayList\n>\n>ensureCapacityArrayList\n>\n>ArrayListCollections.synchronizedList\nList list = Collections.synchronizedList(new ArrayList());\n>\n>iteratorlistIteratorremoveaddConcurrentModificationException\n>\n>ConcurrentModificationExceptionbug\n>\n>Java Collections Framework\n\n\n\n- ****ArrayListList\n- **null**ArrayListnull\n- ****sizeisEmptygetsetiteratorlistIteratorO(1)addremoveO(n)LinkedList\n- ****ArrayList\n- ****ArrayList\n- ****ArrayListiteratorlistIteratorfail-fast\n\n# \n\nArrayList\n\n```java\npublic class ArrayList<E> extends AbstractList<E> implements List<E>,RandomAccess,Cloneable,java.io.Serializable\n```\n\n\n\n- ArrayList<E>ArrayList\n- extends AbstractList<E> AbstractListAbstractListListArrayListLlist\n- implements List<E>List\n- implements RandomAccessArrayList\n- \n- implements Cloneableclone()field-for-field\nimplements java.io.Serializable\n\nArrayList\n\n![image](/images/java-arraylist/java-arraylist-2.jpg)\n\n# \n\n```java\n/**\n * \n */\nprivate static final int DEFAULT_CAPACITY = 10;\n\n/**\n * ArrayList0\n */\nprivate static final Object[] EMPTY_ELEMENTDATA = {};\n\n/**\n * ArrayList 0\n * EMPTY_ELEMENTDATA0\n */\nprivate static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};\n\n/**\n * ArrayList\n * ArrayList\n * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ArrayListDEFAULT_CAPACITY\n * transient\n */\ntransient Object[] elementData; // non-private to simplify nested class access\n\n/**\n * ArrayList\n * @serial\n */\nprivate int size;\n```\n\n**elementDatatransient**\nArrayListwriteObject(java.io.ObjectOutputStream s)readObject(java.io.ObjectOutputStream s)\n\n# \n\n1. ArrayList(int initialCapacity)capacityArrayList\n2. ArrayList() 10 \n3. ArrayList(Collection<? extends E> c) collection  collection \n\n## ArrayList( int initialCapacity)\n\n```java\n/**\n * capacityArrayList\n *\n * @param  initialCapacity  ArrayList\n * @throws IllegalArgumentException  ArrayList\n */\npublic ArrayList(int initialCapacity) {\n    if (initialCapacity > 0) {\n        this.elementData = new Object[initialCapacity];\n    } else if (initialCapacity == 0) {\n        this.elementData = EMPTY_ELEMENTDATA;\n    } else {\n        throw new IllegalArgumentException(\"Illegal Capacity: \"+\n                                           initialCapacity);\n    }\n}\n```\n\n## ArrayList()\n\n```java\n/**\n *  10 \n */\npublic ArrayList() {\n    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n}\n```\n\n## ArrayList(Collection<? extends E> c)\n\n```java\n/**\n *  collection  collection \n *\n * @param c  collection\n * @throws NullPointerException  collection  null\n */\npublic ArrayList(Collection<? extends E> c) {\n    elementData = c.toArray();\n    if ((size = elementData.length) != 0) {\n        // c.toArray might (incorrectly) not return Object[] (see 6260652)\n        if (elementData.getClass() != Object[].class)\n            elementData = Arrays.copyOf(elementData, size, Object[].class);\n    } else {\n        // replace with empty array.\n        this.elementData = EMPTY_ELEMENTDATA;\n    }\n}\n```\n\n# \nArrayList\n\n|  |  |\n| -- | -- |\n| get(int index) | O(1) |\n| add(E e) | O(1) |\n| add(add(int index, E element)) | O(n) |\n| remove(int index) | O(n) |\n| set(int index, E element) | O(1) |\n\n## get( int index)\n\n```java\n/**\n * listindex\n *\n * @param  index \n * @return listindex\n * @throws IndexOutOfBoundsException size\n */\npublic E get(int index) {\n    //\n    rangeCheck(index);\n    //index\n    return elementData(index);\n}\n\n/**\n * \n * index\n * \n * index\n * index>=size\n */\nprivate void rangeCheck(int index) {\n    if (index >= size)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n\n/**\n * index\n */\n@SuppressWarnings(\"unchecked\")\nE elementData(int index) {\n    return (E) elementData[index];\n}\n```\n\nArrayListgetget**O(1)**\n\nadd(E e)\n\n```java\n/**\n * list.\n *\n * @param e \n * @return true\n */\npublic boolean add(E e) {\n    //list11\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    elementData[size++] = e;\n    return true;\n}\n```\n\nadd(E e)\n\n1. \n2. \n\n\n\n\n\n![image](/images/java-arraylist/java-arraylist-3.jpg)\n\n## -ensureCapacity\n\n```java\n/**\n* ArrayList\n* \n* @param   minCapacity   \n*/\npublic void ensureCapacity(int minCapacity) {\n    // elementDataDEFAULTCAPACITY_EMPTY_ELEMENTDATADEFAULT_CAPACITY0\n    int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)? 0: DEFAULT_CAPACITY;\n    //\n    if (minCapacity > minExpand) {\n        ensureExplicitCapacity(minCapacity);\n    }\n}\n/**\n* \n* \n* @param minCapacity    \n*/\nprivate void ensureCapacityInternal(int minCapacity) {\n    // elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAminCapacityDEFAULT_CAPACITYminCapacity\n    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n    }\n\n    ensureExplicitCapacity(minCapacity);\n}\n/**\n* \n* \n* @param minCapacity \n*/\nprivate void ensureExplicitCapacity(int minCapacity) {\n    modCount++;\n\n    //  >   \n    if (minCapacity - elementData.length > 0)\n        //\n        grow(minCapacity);\n}\n\n/**\n * arrays\n * 8\n * VMarrayVMlimitOutOfMemoryError\n */\nprivate static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n\n/**\n* ArrayListminCapacity\n* newCapacity = oldCapacity + (oldCapacity >> 1);minCapacityminCapacity\n* \n* @param minCapacity \n*/\nprivate void grow(int minCapacity) {\n    // \n    int oldCapacity = elementData.length;\n    // =+/2.\n    int newCapacity = oldCapacity + (oldCapacity >> 1);\n    //\n    if (newCapacity - minCapacity < 0)\n        //\n        newCapacity = minCapacity;\n    //\n    if (newCapacity - MAX_ARRAY_SIZE > 0)\n        newCapacity = hugeCapacity(minCapacity);\n    // minCapacity is usually close to size, so this is a win:\n    elementData = Arrays.copyOf(elementData,newCapacity);\n}\n/**\n* \n*/\nprivate static int hugeCapacity(int minCapacity) {\n    //minCapacity<0\n    if (minCapacity < 0) // overflow\n        throw new OutOfMemoryError();\n    //MAX_ARRAY_SIZEInteger.MAX_VALUEMAX_ARRAY_SIZE\n    return (minCapacity > MAX_ARRAY_SIZE) ?\n        Integer.MAX_VALUE :\n        MAX_ARRAY_SIZE;\n}\n```\n\n\n\n1. \n2. grow(int minCapacity)minCapacity\n3. newCapacity = oldCapacity + (oldCapacity >> 1);\n4. minCapacityminCapacity\n5. MAX_ARRAY_SIZEMAX_ARRAY_SIZE\n6. ****\n\n## add( int index, E element)\n\n```java\n/**\n * index\n *\n * @param index \n * @param element \n * @throws IndexOutOfBoundsException size\n */\npublic void add(int index, E element) {\n    //\n    rangeCheckForAdd(index);\n    //list11\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    // indexelementindex\n    System.arraycopy(elementData, index, elementData, index + 1,size - index);\n    //indexelement\n    elementData[index] = element;\n    //+1\n    size++;\n}\n```\n\nadd(E e)\n\n1. \n2. \n3. \n\n\n\n```java\nprivate void rangeCheckForAdd(int index) {\n    if (index > size || index < 0)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\n\n\n\n\n![image](/images/java-arraylist/java-arraylist-4.jpg)\n\nadd(int index, E e)**O(n)**\n\n## remove( int index)\n\n```java\n/**\n * listindex\n * \n *\n * @param index \n * @return \n * @throws IndexOutOfBoundsException index>=size\n */\npublic E remove(int index) {\n    //index>=size\n    rangeCheck(index);\n    //+1\n    modCount++;\n    //inde\n    E oldValue = elementData(index);\n\n    // \n    int numMoved = size - index - 1;\n    //\n    if (numMoved > 0)\n        System.arraycopy(elementData, index+1, elementData, index,\n                         numMoved);\n    // sizesize-1nullGCnull\n    elementData[--size] = null; // clear to let GC do its work\n\n    //\n    return oldValue;\n}\n\n/**\n * \n * index\n * \n * index\n * index>=size\n */\nprivate void rangeCheck(int index) {\n    if (index >= size)\n        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));\n}\n```\n\nArrayList\n\n1. index>=size\n2. index\n3. size-1nullGC\n\nGCnullnull\n\n![image](/images/java-arraylist/java-arraylist-5.jpg)\n\n## set( int index, E element)\n\n```java\n/**\n * \n *\n * @param \n * @param element \n * @return \n * @throws IndexOutOfBoundsException index>=size\n */\npublic E set(int index, E element) {\n    //index>=size\n    rangeCheck(index);\n\n    //\n    E oldValue = elementData(index);\n    //\n    elementData[index] = element;\n    //\n    return oldValue;\n}\n```\n\n\n\n\n\nhttps://blog.csdn.net/panweiwei1994/article/details/76760238","slug":"java/container/java-arraylist","published":1,"updated":"2022-05-10T08:25:56.390Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4p90024xklof5bs9oru","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/java-arraylist/java-arraylist-1.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><blockquote>\n<p>ListnullListVector</p>\n<p>sizeisEmptygetsetiteratorlistIteratoraddnO(n)LinkedList</p>\n<p>ArrayListArrayList</p>\n<p>ensureCapacityArrayList</p>\n<p>ArrayListCollections.synchronizedList<br>List list &#x3D; Collections.synchronizedList(new ArrayList());</p>\n<p>iteratorlistIteratorremoveaddConcurrentModificationException</p>\n<p>ConcurrentModificationExceptionbug</p>\n<p>Java Collections Framework</p>\n</blockquote>\n<p></p>\n<ul>\n<li><strong></strong>ArrayListList</li>\n<li><strong>null</strong>ArrayListnull</li>\n<li><strong></strong>sizeisEmptygetsetiteratorlistIteratorO(1)addremoveO(n)LinkedList</li>\n<li><strong></strong>ArrayList</li>\n<li><strong></strong>ArrayList</li>\n<li><strong></strong>ArrayListiteratorlistIteratorfail-fast</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>ArrayList</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt;,RandomAccess,Cloneable,java.io.Serializable</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>ArrayList<E>ArrayList</li>\n<li>extends AbstractList<E> AbstractListAbstractListListArrayListLlist</li>\n<li>implements List<E>List</li>\n<li>implements RandomAccessArrayList</li>\n<li></li>\n<li>implements Cloneableclone()field-for-field<br>implements java.io.Serializable</li>\n</ul>\n<p>ArrayList</p>\n<p><img src=\"/images/java-arraylist/java-arraylist-2.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList 0</span></span><br><span class=\"line\"><span class=\"comment\"> * EMPTY_ELEMENTDATA0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ArrayListDEFAULT_CAPACITY</span></span><br><span class=\"line\"><span class=\"comment\"> * transient</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Object[] elementData; <span class=\"comment\">// non-private to simplify nested class access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> size;</span><br></pre></td></tr></table></figure>\n\n<p><strong>elementDatatransient</strong><br>ArrayListwriteObject(java.io.ObjectOutputStream s)readObject(java.io.ObjectOutputStream s)</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li>ArrayList(int initialCapacity)capacityArrayList</li>\n<li>ArrayList() 10 </li>\n<li>ArrayList(Collection&lt;? extends E&gt; c) collection  collection </li>\n</ol>\n<h2 id=\"ArrayList-int-initialCapacity\"><a href=\"#ArrayList-int-initialCapacity\" class=\"headerlink\" title=\"ArrayList( int initialCapacity)\"></a>ArrayList( int initialCapacity)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * capacityArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity  ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException  ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[initialCapacity];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (initialCapacity == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal Capacity: &quot;</span>+</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ArrayList\"><a href=\"#ArrayList\" class=\"headerlink\" title=\"ArrayList()\"></a>ArrayList()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  10 </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ArrayList-Collection-lt-extends-E-gt-c\"><a href=\"#ArrayList-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"ArrayList(Collection&lt;? extends E&gt; c)\"></a>ArrayList(Collection&lt;? extends E&gt; c)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  collection  collection </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c  collection</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException  collection  null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    elementData = c.toArray();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((size = elementData.length) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementData.getClass() != Object[].class)</span><br><span class=\"line\">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// replace with empty array.</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>ArrayList</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>get(int index)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>add(E e)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>add(add(int index, E element))</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>remove(int index)</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>set(int index, E element)</td>\n<td>O(1)</td>\n</tr>\n</tbody></table>\n<h2 id=\"get-int-index\"><a href=\"#get-int-index\" class=\"headerlink\" title=\"get( int index)\"></a>get( int index)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * listindex</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> listindex</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\">    <span class=\"comment\">//index</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> elementData(index);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheck</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= size)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">E <span class=\"title function_\">elementData</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (E) elementData[index];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ArrayListgetget<strong>O(1)</strong></p>\n<p>add(E e)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * list.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//list11</span></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!!</span></span><br><span class=\"line\">    elementData[size++] = e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>add(E e)</p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-arraylist/java-arraylist-3.jpg\" alt=\"image\"></p>\n<h2 id=\"-ensureCapacity\"><a href=\"#-ensureCapacity\" class=\"headerlink\" title=\"-ensureCapacity\"></a>-ensureCapacity</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* ArrayList</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span>   minCapacity   </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// elementDataDEFAULTCAPACITY_EMPTY_ELEMENTDATADEFAULT_CAPACITY0</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">minExpand</span> <span class=\"operator\">=</span> (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)? <span class=\"number\">0</span>: DEFAULT_CAPACITY;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class=\"line\">        ensureExplicitCapacity(minCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity    </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureCapacityInternal</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAminCapacityDEFAULT_CAPACITYminCapacity</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class=\"line\">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ensureExplicitCapacity(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureExplicitCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  &gt;   </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity - elementData.length &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        grow(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * arrays</span></span><br><span class=\"line\"><span class=\"comment\"> * 8</span></span><br><span class=\"line\"><span class=\"comment\"> * VMarrayVMlimitOutOfMemoryError</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAX_ARRAY_SIZE</span> <span class=\"operator\">=</span> Integer.MAX_VALUE - <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* ArrayListminCapacity</span></span><br><span class=\"line\"><span class=\"comment\">* newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);minCapacityminCapacity</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">grow</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldCapacity</span> <span class=\"operator\">=</span> elementData.length;</span><br><span class=\"line\">    <span class=\"comment\">// =+/2.</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">newCapacity</span> <span class=\"operator\">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newCapacity - minCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        newCapacity = minCapacity;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        newCapacity = hugeCapacity(minCapacity);</span><br><span class=\"line\">    <span class=\"comment\">// minCapacity is usually close to size, so this is a win:</span></span><br><span class=\"line\">    elementData = Arrays.copyOf(elementData,newCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">hugeCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//minCapacity&lt;0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity &lt; <span class=\"number\">0</span>) <span class=\"comment\">// overflow</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">OutOfMemoryError</span>();</span><br><span class=\"line\">    <span class=\"comment\">//MAX_ARRAY_SIZEInteger.MAX_VALUEMAX_ARRAY_SIZE</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class=\"line\">        Integer.MAX_VALUE :</span><br><span class=\"line\">        MAX_ARRAY_SIZE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li></li>\n<li>grow(int minCapacity)minCapacity</li>\n<li>newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1);</li>\n<li>minCapacityminCapacity</li>\n<li>MAX_ARRAY_SIZEMAX_ARRAY_SIZE</li>\n<li><strong></strong></li>\n</ol>\n<h2 id=\"add-int-index-E-element\"><a href=\"#add-int-index-E-element\" class=\"headerlink\" title=\"add( int index, E element)\"></a>add( int index, E element)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    rangeCheckForAdd(index);</span><br><span class=\"line\">    <span class=\"comment\">//list11</span></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!!</span></span><br><span class=\"line\">    <span class=\"comment\">// indexelementindex</span></span><br><span class=\"line\">    System.arraycopy(elementData, index, elementData, index + <span class=\"number\">1</span>,size - index);</span><br><span class=\"line\">    <span class=\"comment\">//indexelement</span></span><br><span class=\"line\">    elementData[index] = element;</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    size++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>add(E e)</p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheckForAdd</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; size || index &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p></p>\n<p><img src=\"/images/java-arraylist/java-arraylist-4.jpg\" alt=\"image\"></p>\n<p>add(int index, E e)<strong>O(n)</strong></p>\n<h2 id=\"remove-int-index\"><a href=\"#remove-int-index\" class=\"headerlink\" title=\"remove( int index)\"></a>remove( int index)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * listindex</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//index&gt;=size</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//inde</span></span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> elementData(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">numMoved</span> <span class=\"operator\">=</span> size - index - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numMoved &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        System.arraycopy(elementData, index+<span class=\"number\">1</span>, elementData, index,</span><br><span class=\"line\">                         numMoved);</span><br><span class=\"line\">    <span class=\"comment\">// sizesize-1nullGCnull</span></span><br><span class=\"line\">    elementData[--size] = <span class=\"literal\">null</span>; <span class=\"comment\">// clear to let GC do its work</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheck</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= size)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ArrayList</p>\n<ol>\n<li>index&gt;&#x3D;size</li>\n<li>index</li>\n<li>size-1nullGC</li>\n</ol>\n<p>GCnullnull</p>\n<p><img src=\"/images/java-arraylist/java-arraylist-5.jpg\" alt=\"image\"></p>\n<h2 id=\"set-int-index-E-element\"><a href=\"#set-int-index-E-element\" class=\"headerlink\" title=\"set( int index, E element)\"></a>set( int index, E element)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//index&gt;=size</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> elementData(index);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    elementData[index] = element;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/76760238\">https://blog.csdn.net/panweiwei1994/article/details/76760238</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><img src=\"/images/java-arraylist/java-arraylist-1.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><blockquote>\n<p>ListnullListVector</p>\n<p>sizeisEmptygetsetiteratorlistIteratoraddnO(n)LinkedList</p>\n<p>ArrayListArrayList</p>\n<p>ensureCapacityArrayList</p>\n<p>ArrayListCollections.synchronizedList<br>List list &#x3D; Collections.synchronizedList(new ArrayList());</p>\n<p>iteratorlistIteratorremoveaddConcurrentModificationException</p>\n<p>ConcurrentModificationExceptionbug</p>\n<p>Java Collections Framework</p>\n</blockquote>\n<p></p>\n<ul>\n<li><strong></strong>ArrayListList</li>\n<li><strong>null</strong>ArrayListnull</li>\n<li><strong></strong>sizeisEmptygetsetiteratorlistIteratorO(1)addremoveO(n)LinkedList</li>\n<li><strong></strong>ArrayList</li>\n<li><strong></strong>ArrayList</li>\n<li><strong></strong>ArrayListiteratorlistIteratorfail-fast</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>ArrayList</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt;,RandomAccess,Cloneable,java.io.Serializable</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li>ArrayList<E>ArrayList</li>\n<li>extends AbstractList<E> AbstractListAbstractListListArrayListLlist</li>\n<li>implements List<E>List</li>\n<li>implements RandomAccessArrayList</li>\n<li></li>\n<li>implements Cloneableclone()field-for-field<br>implements java.io.Serializable</li>\n</ul>\n<p>ArrayList</p>\n<p><img src=\"/images/java-arraylist/java-arraylist-2.jpg\" alt=\"image\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList 0</span></span><br><span class=\"line\"><span class=\"comment\"> * EMPTY_ELEMENTDATA0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ArrayListDEFAULT_CAPACITY</span></span><br><span class=\"line\"><span class=\"comment\"> * transient</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Object[] elementData; <span class=\"comment\">// non-private to simplify nested class access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@serial</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> size;</span><br></pre></td></tr></table></figure>\n\n<p><strong>elementDatatransient</strong><br>ArrayListwriteObject(java.io.ObjectOutputStream s)readObject(java.io.ObjectOutputStream s)</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ol>\n<li>ArrayList(int initialCapacity)capacityArrayList</li>\n<li>ArrayList() 10 </li>\n<li>ArrayList(Collection&lt;? extends E&gt; c) collection  collection </li>\n</ol>\n<h2 id=\"ArrayList-int-initialCapacity\"><a href=\"#ArrayList-int-initialCapacity\" class=\"headerlink\" title=\"ArrayList( int initialCapacity)\"></a>ArrayList( int initialCapacity)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * capacityArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  initialCapacity  ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException  ArrayList</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">(<span class=\"type\">int</span> initialCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[initialCapacity];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (initialCapacity == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;Illegal Capacity: &quot;</span>+</span><br><span class=\"line\">                                           initialCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ArrayList\"><a href=\"#ArrayList\" class=\"headerlink\" title=\"ArrayList()\"></a>ArrayList()</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  10 </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ArrayList-Collection-lt-extends-E-gt-c\"><a href=\"#ArrayList-Collection-lt-extends-E-gt-c\" class=\"headerlink\" title=\"ArrayList(Collection&lt;? extends E&gt; c)\"></a>ArrayList(Collection&lt;? extends E&gt; c)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  collection  collection </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> c  collection</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NullPointerException  collection  null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">ArrayList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class=\"line\">    elementData = c.toArray();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((size = elementData.length) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementData.getClass() != Object[].class)</span><br><span class=\"line\">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// replace with empty array.</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>ArrayList</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>get(int index)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>add(E e)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>add(add(int index, E element))</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>remove(int index)</td>\n<td>O(n)</td>\n</tr>\n<tr>\n<td>set(int index, E element)</td>\n<td>O(1)</td>\n</tr>\n</tbody></table>\n<h2 id=\"get-int-index\"><a href=\"#get-int-index\" class=\"headerlink\" title=\"get( int index)\"></a>get( int index)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * listindex</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>  index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> listindex</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\">    <span class=\"comment\">//index</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> elementData(index);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheck</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= size)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">E <span class=\"title function_\">elementData</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (E) elementData[index];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ArrayListgetget<strong>O(1)</strong></p>\n<p>add(E e)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * list.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> e </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//list11</span></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!!</span></span><br><span class=\"line\">    elementData[size++] = e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>add(E e)</p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-arraylist/java-arraylist-3.jpg\" alt=\"image\"></p>\n<h2 id=\"-ensureCapacity\"><a href=\"#-ensureCapacity\" class=\"headerlink\" title=\"-ensureCapacity\"></a>-ensureCapacity</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* ArrayList</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span>   minCapacity   </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// elementDataDEFAULTCAPACITY_EMPTY_ELEMENTDATADEFAULT_CAPACITY0</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">minExpand</span> <span class=\"operator\">=</span> (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)? <span class=\"number\">0</span>: DEFAULT_CAPACITY;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class=\"line\">        ensureExplicitCapacity(minCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity    </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureCapacityInternal</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAminCapacityDEFAULT_CAPACITYminCapacity</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class=\"line\">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ensureExplicitCapacity(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">ensureExplicitCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  &gt;   </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity - elementData.length &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        grow(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * arrays</span></span><br><span class=\"line\"><span class=\"comment\"> * 8</span></span><br><span class=\"line\"><span class=\"comment\"> * VMarrayVMlimitOutOfMemoryError</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">MAX_ARRAY_SIZE</span> <span class=\"operator\">=</span> Integer.MAX_VALUE - <span class=\"number\">8</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* ArrayListminCapacity</span></span><br><span class=\"line\"><span class=\"comment\">* newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);minCapacityminCapacity</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> minCapacity </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">grow</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">oldCapacity</span> <span class=\"operator\">=</span> elementData.length;</span><br><span class=\"line\">    <span class=\"comment\">// =+/2.</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">newCapacity</span> <span class=\"operator\">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newCapacity - minCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        newCapacity = minCapacity;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        newCapacity = hugeCapacity(minCapacity);</span><br><span class=\"line\">    <span class=\"comment\">// minCapacity is usually close to size, so this is a win:</span></span><br><span class=\"line\">    elementData = Arrays.copyOf(elementData,newCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">hugeCapacity</span><span class=\"params\">(<span class=\"type\">int</span> minCapacity)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//minCapacity&lt;0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (minCapacity &lt; <span class=\"number\">0</span>) <span class=\"comment\">// overflow</span></span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">OutOfMemoryError</span>();</span><br><span class=\"line\">    <span class=\"comment\">//MAX_ARRAY_SIZEInteger.MAX_VALUEMAX_ARRAY_SIZE</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class=\"line\">        Integer.MAX_VALUE :</span><br><span class=\"line\">        MAX_ARRAY_SIZE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ol>\n<li></li>\n<li>grow(int minCapacity)minCapacity</li>\n<li>newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1);</li>\n<li>minCapacityminCapacity</li>\n<li>MAX_ARRAY_SIZEMAX_ARRAY_SIZE</li>\n<li><strong></strong></li>\n</ol>\n<h2 id=\"add-int-index-E-element\"><a href=\"#add-int-index-E-element\" class=\"headerlink\" title=\"add( int index, E element)\"></a>add( int index, E element)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    rangeCheckForAdd(index);</span><br><span class=\"line\">    <span class=\"comment\">//list11</span></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!!</span></span><br><span class=\"line\">    <span class=\"comment\">// indexelementindex</span></span><br><span class=\"line\">    System.arraycopy(elementData, index, elementData, index + <span class=\"number\">1</span>,size - index);</span><br><span class=\"line\">    <span class=\"comment\">//indexelement</span></span><br><span class=\"line\">    elementData[index] = element;</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    size++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>add(E e)</p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheckForAdd</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; size || index &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p></p>\n<p><img src=\"/images/java-arraylist/java-arraylist-4.jpg\" alt=\"image\"></p>\n<p>add(int index, E e)<strong>O(n)</strong></p>\n<h2 id=\"remove-int-index\"><a href=\"#remove-int-index\" class=\"headerlink\" title=\"remove( int index)\"></a>remove( int index)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * listindex</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> index </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">remove</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//index&gt;=size</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\">    <span class=\"comment\">//+1</span></span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"comment\">//inde</span></span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> elementData(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">numMoved</span> <span class=\"operator\">=</span> size - index - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numMoved &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        System.arraycopy(elementData, index+<span class=\"number\">1</span>, elementData, index,</span><br><span class=\"line\">                         numMoved);</span><br><span class=\"line\">    <span class=\"comment\">// sizesize-1nullGCnull</span></span><br><span class=\"line\">    elementData[--size] = <span class=\"literal\">null</span>; <span class=\"comment\">// clear to let GC do its work</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * index</span></span><br><span class=\"line\"><span class=\"comment\"> * index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">rangeCheck</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt;= size)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ArrayList</p>\n<ol>\n<li>index&gt;&#x3D;size</li>\n<li>index</li>\n<li>size-1nullGC</li>\n</ol>\n<p>GCnullnull</p>\n<p><img src=\"/images/java-arraylist/java-arraylist-5.jpg\" alt=\"image\"></p>\n<h2 id=\"set-int-index-E-element\"><a href=\"#set-int-index-E-element\" class=\"headerlink\" title=\"set( int index, E element)\"></a>set( int index, E element)</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> element </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IndexOutOfBoundsException index&gt;=size</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//index&gt;=size</span></span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> elementData(index);</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    elementData[index] = element;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/panweiwei1994/article/details/76760238\">https://blog.csdn.net/panweiwei1994/article/details/76760238</a></p>\n"},{"title":"","date":"2021-04-30T09:05:00.000Z","typora-root-url":"..","_content":"\n 64 bit  long  idID \n\n \n\n 64  bit  1  bit  41 bit  10 bit  id12 bit \n\n ![image](/images/snowflake-algorithm.png)\n\n\n+ 0\n+ 414169\n+ 10101024\n+ 12idID124096ID\n\nID105IDC+5machine\n\n```java\npublic class SnowFlakeGenerator {\n\n    public static class Factory {\n        /**\n         * \n         */\n        private final static int DEFAULT_MACHINE_BIT_NUM = 5;   //\n        private final static int DEFAULT_IDC_BIT_NUM = 5;//\n\n        private int machineBitNum;\n        private int idcBitNum;\n\n        public Factory() {\n            this.idcBitNum = DEFAULT_IDC_BIT_NUM;\n            this.machineBitNum = DEFAULT_MACHINE_BIT_NUM;\n        }\n\n        public Factory(int machineBitNum, int idcBitNum) {\n            this.idcBitNum = idcBitNum;\n            this.machineBitNum = machineBitNum;\n        }\n\n        public SnowFlakeGenerator create(long idcId, long machineId) {\n            return new SnowFlakeGenerator(this.idcBitNum, this.machineBitNum, idcId, machineId);\n        }\n    }\n\n    /**\n     * \n     * \n     */\n    private final static long START_STAMP = 1508143349995L;\n\n    /**\n     * \n     */\n    private final static int REMAIN_BIT_NUM = 22;\n\n    /**\n     * idc\n     */\n    private long idcId;\n\n    /**\n     * \n     */\n    private long machineId;\n\n    /**\n     * \n     */\n    private long sequence = 0L;\n\n    /**\n     * \n     */\n    private long lastStamp = -1L;\n\n    /**\n     * idc\n     */\n    private int idcBitLeftOffset;\n\n    /**\n     * id\n     */\n    private int machineBitLeftOffset;\n\n    /**\n     * \n     */\n    private int timestampBitLeftOffset;\n\n    /**\n     * \n     */\n    private int maxSequenceValue;\n\n    private SnowFlakeGenerator(int idcBitNum, int machineBitNum, long idcId, long machineId) {\n        int sequenceBitNum = REMAIN_BIT_NUM - idcBitNum - machineBitNum;\n\n        if (idcBitNum <= 0 || machineBitNum <= 0 || sequenceBitNum <= 0) {\n            throw new IllegalArgumentException(\"error bit number\");\n        }\n\n        this.maxSequenceValue = ~(-1 << sequenceBitNum);\n\n        machineBitLeftOffset = sequenceBitNum;\n        idcBitLeftOffset = idcBitNum + sequenceBitNum;\n        timestampBitLeftOffset = idcBitNum + machineBitNum + sequenceBitNum;\n\n        this.idcId = idcId;\n        this.machineId = machineId;\n    }\n\n    /**\n     * ID\n     */\n    public synchronized long nextId() {\n        long currentStamp = getTimeMill();\n        if (currentStamp < lastStamp) {\n            throw new RuntimeException(String.format(\"Clock moved backwards. Refusing to generate id for %d milliseconds\", lastStamp - currentStamp));\n        }\n\n        //0\n        if (currentStamp == lastStamp) {\n            sequence = (sequence + 1) & this.maxSequenceValue;\n            if (sequence == 0L) {\n                //Twitter\n                lastStamp = tilNextMillis();\n//                throw new IllegalStateException(\"sequence over flow\");\n            }\n        } else {\n            sequence = 0L;\n        }\n\n        lastStamp = currentStamp;\n\n        return (currentStamp - START_STAMP) << timestampBitLeftOffset | idcId << idcBitLeftOffset | machineId << machineBitLeftOffset | sequence;\n    }\n\n    private long getTimeMill() {\n        return System.currentTimeMillis();\n    }\n\n    private long tilNextMillis() {\n        long timestamp = getTimeMill();\n        while (timestamp <= lastStamp) {\n            timestamp = getTimeMill();\n        }\n        return timestamp;\n    }\n}\n```\n\n\n\n\n\n\n\n[(snowflake)](https://blog.csdn.net/u011499747/article/details/78254990)\n[Java](https://blog.csdn.net/lq18050010830/article/details/89845790)","source":"_posts/java/functions/snowflake-algorithm.md","raw":"---\ntitle: \ndate: 2021-04-30 17:05:00\ncategories: \n  - java\ntags:\n  - \n  - java\ntypora-root-url: ..\n---\n\n 64 bit  long  idID \n\n \n\n 64  bit  1  bit  41 bit  10 bit  id12 bit \n\n ![image](/images/snowflake-algorithm.png)\n\n\n+ 0\n+ 414169\n+ 10101024\n+ 12idID124096ID\n\nID105IDC+5machine\n\n```java\npublic class SnowFlakeGenerator {\n\n    public static class Factory {\n        /**\n         * \n         */\n        private final static int DEFAULT_MACHINE_BIT_NUM = 5;   //\n        private final static int DEFAULT_IDC_BIT_NUM = 5;//\n\n        private int machineBitNum;\n        private int idcBitNum;\n\n        public Factory() {\n            this.idcBitNum = DEFAULT_IDC_BIT_NUM;\n            this.machineBitNum = DEFAULT_MACHINE_BIT_NUM;\n        }\n\n        public Factory(int machineBitNum, int idcBitNum) {\n            this.idcBitNum = idcBitNum;\n            this.machineBitNum = machineBitNum;\n        }\n\n        public SnowFlakeGenerator create(long idcId, long machineId) {\n            return new SnowFlakeGenerator(this.idcBitNum, this.machineBitNum, idcId, machineId);\n        }\n    }\n\n    /**\n     * \n     * \n     */\n    private final static long START_STAMP = 1508143349995L;\n\n    /**\n     * \n     */\n    private final static int REMAIN_BIT_NUM = 22;\n\n    /**\n     * idc\n     */\n    private long idcId;\n\n    /**\n     * \n     */\n    private long machineId;\n\n    /**\n     * \n     */\n    private long sequence = 0L;\n\n    /**\n     * \n     */\n    private long lastStamp = -1L;\n\n    /**\n     * idc\n     */\n    private int idcBitLeftOffset;\n\n    /**\n     * id\n     */\n    private int machineBitLeftOffset;\n\n    /**\n     * \n     */\n    private int timestampBitLeftOffset;\n\n    /**\n     * \n     */\n    private int maxSequenceValue;\n\n    private SnowFlakeGenerator(int idcBitNum, int machineBitNum, long idcId, long machineId) {\n        int sequenceBitNum = REMAIN_BIT_NUM - idcBitNum - machineBitNum;\n\n        if (idcBitNum <= 0 || machineBitNum <= 0 || sequenceBitNum <= 0) {\n            throw new IllegalArgumentException(\"error bit number\");\n        }\n\n        this.maxSequenceValue = ~(-1 << sequenceBitNum);\n\n        machineBitLeftOffset = sequenceBitNum;\n        idcBitLeftOffset = idcBitNum + sequenceBitNum;\n        timestampBitLeftOffset = idcBitNum + machineBitNum + sequenceBitNum;\n\n        this.idcId = idcId;\n        this.machineId = machineId;\n    }\n\n    /**\n     * ID\n     */\n    public synchronized long nextId() {\n        long currentStamp = getTimeMill();\n        if (currentStamp < lastStamp) {\n            throw new RuntimeException(String.format(\"Clock moved backwards. Refusing to generate id for %d milliseconds\", lastStamp - currentStamp));\n        }\n\n        //0\n        if (currentStamp == lastStamp) {\n            sequence = (sequence + 1) & this.maxSequenceValue;\n            if (sequence == 0L) {\n                //Twitter\n                lastStamp = tilNextMillis();\n//                throw new IllegalStateException(\"sequence over flow\");\n            }\n        } else {\n            sequence = 0L;\n        }\n\n        lastStamp = currentStamp;\n\n        return (currentStamp - START_STAMP) << timestampBitLeftOffset | idcId << idcBitLeftOffset | machineId << machineBitLeftOffset | sequence;\n    }\n\n    private long getTimeMill() {\n        return System.currentTimeMillis();\n    }\n\n    private long tilNextMillis() {\n        long timestamp = getTimeMill();\n        while (timestamp <= lastStamp) {\n            timestamp = getTimeMill();\n        }\n        return timestamp;\n    }\n}\n```\n\n\n\n\n\n\n\n[(snowflake)](https://blog.csdn.net/u011499747/article/details/78254990)\n[Java](https://blog.csdn.net/lq18050010830/article/details/89845790)","slug":"java/functions/snowflake-algorithm","published":1,"updated":"2022-05-10T08:25:56.393Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pa0026xklo9t3ucbpo","content":"<p> 64 bit  long  idID </p>\n<p> 64  bit  1  bit  41 bit  10 bit  id12 bit </p>\n<p> <img src=\"/images/snowflake-algorithm.png\" alt=\"image\"></p>\n<p></p>\n<ul>\n<li>0</li>\n<li>414169</li>\n<li>10101024</li>\n<li>12idID124096ID</li>\n</ul>\n<p>ID105IDC+5machine</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SnowFlakeGenerator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Factory</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * </span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_MACHINE_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;   <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_IDC_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;<span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> machineBitNum;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> idcBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Factory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.idcBitNum = DEFAULT_IDC_BIT_NUM;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.machineBitNum = DEFAULT_MACHINE_BIT_NUM;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Factory</span><span class=\"params\">(<span class=\"type\">int</span> machineBitNum, <span class=\"type\">int</span> idcBitNum)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.idcBitNum = idcBitNum;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.machineBitNum = machineBitNum;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> SnowFlakeGenerator <span class=\"title function_\">create</span><span class=\"params\">(<span class=\"type\">long</span> idcId, <span class=\"type\">long</span> machineId)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SnowFlakeGenerator</span>(<span class=\"built_in\">this</span>.idcBitNum, <span class=\"built_in\">this</span>.machineBitNum, idcId, machineId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"variable\">START_STAMP</span> <span class=\"operator\">=</span> <span class=\"number\">1508143349995L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">REMAIN_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">22</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * idc</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> idcId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> machineId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">sequence</span> <span class=\"operator\">=</span> <span class=\"number\">0L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">lastStamp</span> <span class=\"operator\">=</span> -<span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * idc</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> idcBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> machineBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> timestampBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> maxSequenceValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SnowFlakeGenerator</span><span class=\"params\">(<span class=\"type\">int</span> idcBitNum, <span class=\"type\">int</span> machineBitNum, <span class=\"type\">long</span> idcId, <span class=\"type\">long</span> machineId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">sequenceBitNum</span> <span class=\"operator\">=</span> REMAIN_BIT_NUM - idcBitNum - machineBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (idcBitNum &lt;= <span class=\"number\">0</span> || machineBitNum &lt;= <span class=\"number\">0</span> || sequenceBitNum &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;error bit number&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.maxSequenceValue = ~(-<span class=\"number\">1</span> &lt;&lt; sequenceBitNum);</span><br><span class=\"line\"></span><br><span class=\"line\">        machineBitLeftOffset = sequenceBitNum;</span><br><span class=\"line\">        idcBitLeftOffset = idcBitNum + sequenceBitNum;</span><br><span class=\"line\">        timestampBitLeftOffset = idcBitNum + machineBitNum + sequenceBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.idcId = idcId;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.machineId = machineId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ID</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"type\">long</span> <span class=\"title function_\">nextId</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">currentStamp</span> <span class=\"operator\">=</span> getTimeMill();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentStamp &lt; lastStamp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(String.format(<span class=\"string\">&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;</span>, lastStamp - currentStamp));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentStamp == lastStamp) &#123;</span><br><span class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; <span class=\"built_in\">this</span>.maxSequenceValue;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0L</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//Twitter</span></span><br><span class=\"line\">                lastStamp = tilNextMillis();</span><br><span class=\"line\"><span class=\"comment\">//                throw new IllegalStateException(&quot;sequence over flow&quot;);</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        lastStamp = currentStamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (currentStamp - START_STAMP) &lt;&lt; timestampBitLeftOffset | idcId &lt;&lt; idcBitLeftOffset | machineId &lt;&lt; machineBitLeftOffset | sequence;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">getTimeMill</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">tilNextMillis</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">timestamp</span> <span class=\"operator\">=</span> getTimeMill();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastStamp) &#123;</span><br><span class=\"line\">            timestamp = getTimeMill();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/u011499747/article/details/78254990\">(snowflake)</a><br><a href=\"https://blog.csdn.net/lq18050010830/article/details/89845790\">Java</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> 64 bit  long  idID </p>\n<p> 64  bit  1  bit  41 bit  10 bit  id12 bit </p>\n<p> <img src=\"/images/snowflake-algorithm.png\" alt=\"image\"></p>\n<p></p>\n<ul>\n<li>0</li>\n<li>414169</li>\n<li>10101024</li>\n<li>12idID124096ID</li>\n</ul>\n<p>ID105IDC+5machine</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SnowFlakeGenerator</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Factory</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * </span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_MACHINE_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;   <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">DEFAULT_IDC_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">5</span>;<span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> machineBitNum;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"type\">int</span> idcBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Factory</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.idcBitNum = DEFAULT_IDC_BIT_NUM;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.machineBitNum = DEFAULT_MACHINE_BIT_NUM;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Factory</span><span class=\"params\">(<span class=\"type\">int</span> machineBitNum, <span class=\"type\">int</span> idcBitNum)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.idcBitNum = idcBitNum;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.machineBitNum = machineBitNum;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> SnowFlakeGenerator <span class=\"title function_\">create</span><span class=\"params\">(<span class=\"type\">long</span> idcId, <span class=\"type\">long</span> machineId)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SnowFlakeGenerator</span>(<span class=\"built_in\">this</span>.idcBitNum, <span class=\"built_in\">this</span>.machineBitNum, idcId, machineId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"variable\">START_STAMP</span> <span class=\"operator\">=</span> <span class=\"number\">1508143349995L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">REMAIN_BIT_NUM</span> <span class=\"operator\">=</span> <span class=\"number\">22</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * idc</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> idcId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> machineId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">sequence</span> <span class=\"operator\">=</span> <span class=\"number\">0L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">lastStamp</span> <span class=\"operator\">=</span> -<span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * idc</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> idcBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> machineBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> timestampBitLeftOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> maxSequenceValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">SnowFlakeGenerator</span><span class=\"params\">(<span class=\"type\">int</span> idcBitNum, <span class=\"type\">int</span> machineBitNum, <span class=\"type\">long</span> idcId, <span class=\"type\">long</span> machineId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">sequenceBitNum</span> <span class=\"operator\">=</span> REMAIN_BIT_NUM - idcBitNum - machineBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (idcBitNum &lt;= <span class=\"number\">0</span> || machineBitNum &lt;= <span class=\"number\">0</span> || sequenceBitNum &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;error bit number&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.maxSequenceValue = ~(-<span class=\"number\">1</span> &lt;&lt; sequenceBitNum);</span><br><span class=\"line\"></span><br><span class=\"line\">        machineBitLeftOffset = sequenceBitNum;</span><br><span class=\"line\">        idcBitLeftOffset = idcBitNum + sequenceBitNum;</span><br><span class=\"line\">        timestampBitLeftOffset = idcBitNum + machineBitNum + sequenceBitNum;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.idcId = idcId;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.machineId = machineId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ID</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"type\">long</span> <span class=\"title function_\">nextId</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">currentStamp</span> <span class=\"operator\">=</span> getTimeMill();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentStamp &lt; lastStamp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(String.format(<span class=\"string\">&quot;Clock moved backwards. Refusing to generate id for %d milliseconds&quot;</span>, lastStamp - currentStamp));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (currentStamp == lastStamp) &#123;</span><br><span class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; <span class=\"built_in\">this</span>.maxSequenceValue;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0L</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//Twitter</span></span><br><span class=\"line\">                lastStamp = tilNextMillis();</span><br><span class=\"line\"><span class=\"comment\">//                throw new IllegalStateException(&quot;sequence over flow&quot;);</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        lastStamp = currentStamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (currentStamp - START_STAMP) &lt;&lt; timestampBitLeftOffset | idcId &lt;&lt; idcBitLeftOffset | machineId &lt;&lt; machineBitLeftOffset | sequence;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">getTimeMill</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"title function_\">tilNextMillis</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">timestamp</span> <span class=\"operator\">=</span> getTimeMill();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastStamp) &#123;</span><br><span class=\"line\">            timestamp = getTimeMill();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p></p>\n<p><a href=\"https://blog.csdn.net/u011499747/article/details/78254990\">(snowflake)</a><br><a href=\"https://blog.csdn.net/lq18050010830/article/details/89845790\">Java</a></p>\n"},{"title":"mongoDB ","date":"2022-05-11T06:49:49.000Z","_content":"\n## \n\n1. mongoDB\n2. jsonjson\n   - \n   - \n   - \n3. mongoDB\n   - 3.4\n\n## \n\n1. \n   mongoDB\n   - \n   - I/O\n2. \n    MongoDB \n3. \n   mongoDB\n   - \n4. \n   - WiredTiger \n   - \n\n\n\n[](https://www.mongodb.com/docs/manual/)\n\n","source":"_posts/database/mongodb/mongobase.md","raw":"---\ntitle: mongoDB \ndate: 2022-05-11 14:49:49\ncategories:\n  - database\n  - mongodb\ntags: \n  - mongodb\n---\n\n## \n\n1. mongoDB\n2. jsonjson\n   - \n   - \n   - \n3. mongoDB\n   - 3.4\n\n## \n\n1. \n   mongoDB\n   - \n   - I/O\n2. \n    MongoDB \n3. \n   mongoDB\n   - \n4. \n   - WiredTiger \n   - \n\n\n\n[](https://www.mongodb.com/docs/manual/)\n\n","slug":"database/mongodb/mongobase","published":1,"updated":"2022-05-11T08:52:20.381Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pa002axklo03e36t9q","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li>mongoDB</li>\n<li>jsonjson<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>mongoDB<ul>\n<li>3.4</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><br>mongoDB<ul>\n<li></li>\n<li>I&#x2F;O</li>\n</ul>\n</li>\n<li><br> MongoDB </li>\n<li><br>mongoDB<ul>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li>WiredTiger </li>\n<li></li>\n</ul>\n</li>\n</ol>\n<p><a href=\"https://www.mongodb.com/docs/manual/\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li>mongoDB</li>\n<li>jsonjson<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>mongoDB<ul>\n<li>3.4</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><br>mongoDB<ul>\n<li></li>\n<li>I&#x2F;O</li>\n</ul>\n</li>\n<li><br> MongoDB </li>\n<li><br>mongoDB<ul>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li>WiredTiger </li>\n<li></li>\n</ul>\n</li>\n</ol>\n<p><a href=\"https://www.mongodb.com/docs/manual/\"></a></p>\n"},{"title":"java cas ","date":"2021-05-19T08:28:19.000Z","_content":"\n CAS JDK  java.util.concurrent \n\n```java\n// \nstatic int data = 0;\n// main\nIntStream.range(0, 2).forEach((i) -> {\n\t\tnew Thread(() -> {\n\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(20);\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t\t\tdata++;\n\t\t\t\t});\n\t\t}).start();\n});\n\n\ttry {\n\t\t\tThread.sleep(2000);\n\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t}\n\nSystem.out.println(data);\n}\n```\n\n\n\n![image](/images/java-cas/java-cas-1.jpg)\n\ndata int \n `data++`  200 sleep  20  200 \n\n#### ****\n\n\n\n** synchronized **\n\n synchronized JVM\n\nsynchronized \n\n```java\n// Object\nObject lock = new Object();\n \n // synchronized  ()  lock \nIntStream.range(0, 100).forEach(y -> {\n\t\tsynchronized (lock.getClass()) {\n\t\t\t\tdata++;\n\t\t}\n});\n```\n\n![image](/images/java-cas/java-cas-2.jpg)\n\n** Lock **\n\n Lock  synchronized \n Lock  AQS + CAS  AQS  <<AQS>> CAS \n\n Lock \n\n```java\n//   \nLock lock = new ReentrantLock();\n\n//  lock()  unlock() \nIntStream.range(0, 100).forEach(y -> {\n\t\tlock.lock();\n\t\tdata++;\n\t\tlock.unlock();\n});\n```\n\n\n\n![image](/images/java-cas/java-cas-3.jpg)\n\n** Atomic **\n\nsynchronized  JDK1.6  Lock  JVM  Lock  unlock() \n\nJDK \n\n![image](/images/java-cas/java-cas-4.jpg)\n\n AtomicInteger \n\n```java\n// \nAtomicInteger atomicData = new AtomicInteger();\n\n// \nIntStream.range(0, 2).forEach((i) -> {\n\tnew Thread(() -> {\n\t\t\ttry {\n\t\t\t\t\tThread.sleep(20);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t  // \n\t\t\t\t\tatomicData.incrementAndGet();\n\t\t\t});\n\t}).start();\n});\n\ntry {\n\t\tThread.sleep(2000);\n} catch (InterruptedException e) {\n\t\te.printStackTrace();\n}\n\n//  get () \nSystem.out.println(atomicData.get());\n```\n\n\n\n![image](/images/java-cas/java-cas-5.jpg)\n\n Atomic  CAS \n\n** LongAdder **\n\nLongAdder  JDK1.8   AtomicInteger  java.util.concurrent.atomic \n\nLongAdder  AtomicIntegerAtomicLong \n\n LongAdder \n\n```java\n// LongAdder\nLongAdder longAdderData = new LongAdder();\n\n// \nIntStream.range(0, 2).forEach((i) -> {\n\t\tnew Thread(() -> {\n\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(20);\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t\t  //  increment() \n\t\t\t\t\t\tlongAdderData.increment();\n\t\t\t\t});\n\t\t}).start();\n});\n\ntry {\n\t\tThread.sleep(2000);\n} catch (InterruptedException e) {\n\t\te.printStackTrace();\n}\n//  sum() \nSystem.out.println(longAdderData.sum());\n```\n\n\n\n![image](/images/java-cas/java-cas-6.jpg)\n\n LongAdder  CAS LongAdder  base  Cell[]  Cell LongAdder \n\n LongAdder  AtomicInteger \n\n**volatile **\n\n** `volatile`** \n\n![image](/images/java-cas/java-cas-7.jpg)\n\n 200\n\ndata++  Java\n\n\n\n1 data\n\n2 +1 \n\n3 data \n\n****\n\n\n\nJavaJMM synchronized  Lock  Atomic ****\n\n `volatile` \n\n#### **CAS**\n\nCAS \n\n synchronizedsynchronized \n\n\n\n\n\n\n\nCAS \n\n AtomicIntegerLongAdderLock java.util.concurrent.atomic  CAS \n\n AtomicInteger  CAS \n\n```java\natomicData.incrementAndGet()\n```\n\n\n\n```java\n// 1\npublic final int incrementAndGet() {\n\t\treturn unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n}\n\n// compareAndSet\npublic final boolean compareAndSet(int expect, int update) {\n\t\treturn unsafe.compareAndSwapInt(this, valueOffset, expect, update);\n}\n\n// Unsafe \npublic final int getAndAddInt (Object o,long offset, int delta){\n\t\tint v;\n\t\tdo {\n\t\t\t\tv = getIntVolatile(o, offset);\n\t\t} while (!weakCompareAndSetInt(o, offset, v, v + delta));\n\t\treturn v;\n}\n```\n\n AtomicInteger  Unsafe Unsafe CPU\n\n\n\n```java\nunsafe.compareAndSwapInt(this, valueOffset, expect, update)\n```\n\n CAS Compare And Swap\n\n\n1thisUnsafe  value \n\n2valueOffsetvalue \n\n3expect\n\n4update\n\n value  expect update  true false\n\n valueOffset\n\n```java\n// Unsafe\nprivate static final Unsafe unsafe = Unsafe.getUnsafe();\nprivate static final long valueOffset;\n\nstatic {\n\t\ttry {\n\t\t\t  // valueAtomicInteger\n\t\t\t\tvalueOffset = unsafe.objectFieldOffset\n\t\t\t\t\t\t(AtomicInteger.class.getDeclaredField(\"value\"));\n\t\t} catch (Exception ex) { throw new Error(ex); }\n}\n// \nprivate volatile int value;\n```\n\n value  **volatile** ****\n\n Unsafe.getUnsafe()  Unsafe  AtomicInteger  **rt.jar ** AtomicInteger  **Bootstrap **\n\n\n\n```java\n@CallerSensitive\npublic static Unsafe getUnsafe() {\n\t\tClass var0 = Reflection.getCallerClass();\n\t\t// Bootstrap C++null\n\t\tif (!VM.isSystemDomainLoader(var0.getClassLoader())) {\n\t\t\t\tthrow new SecurityException(\"Unsafe\");\n\t\t} else {\n\t\t\t\treturn theUnsafe;\n\t\t}\n}\n```\n\n\n\n![image](/images/java-cas/java-cas-8.jpg)\n\n#### **CPU**\n\nCPU  L1L2L3 CPU \n\n![image](/images/java-cas/java-cas-9.jpg)\n\n CPU  CPU \n\n\n\n- ****\n\n BUS  Lock \n\n\n\n- ** **\n\n MESI \n\n\n\n****\n\n\n\n1\n\n2Intel 486  Pentium \n\n#### **CAS**\n\n CAS \n\n CPU \n\n CAS \n\n1Tetst-and-Set\n\n2Fetch-and-Increment\n\n3Swap\n\n4Compare-and-Swap\n\n5/Load-Linked/Store-Conditional\n\n\n\nIA64x86  **cmpxchg**  CAS  sparc-TSO  **casa**  ARM  PowerPC  **ldrex/strex**  LL/SC **load and reserve**  **store conditional **  CAS \n\nsun.misc.Unsafe  CAS \n\n```java\npublic final native boolean compareAndSwapObject(Object var1, long var2, Object var4, Object var5);\n\npublic final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5);\n\npublic final native boolean compareAndSwapLong(Object var1, long var2, long var4, long var6);\n```\n\n openjdk  hotspot \n\n`hotspot/src/share/vm/prims/unsafe.cpp`\n\n```c++\n#define FN_PTR(f) CAST_FROM_FN_PTR(void*, &f)\n\n{CC\"compareAndSwapObject\", CC\"(\"OBJ\"J\"OBJ\"\"OBJ\")Z\",  FN_PTR(Unsafe_CompareAndSwapObject)},\n\n{CC\"compareAndSwapInt\",  CC\"(\"OBJ\"J\"\"I\"\"I\"\")Z\",      FN_PTR(Unsafe_CompareAndSwapInt)},\n\n{CC\"compareAndSwapLong\", CC\"(\"OBJ\"J\"\"J\"\"J\"\")Z\",      FN_PTR(Unsafe_CompareAndSwapLong)},\n```\n\n hotspot  cmpxchg  hotspot \n\n`hotspot/src/share/vm/runtime/Atomic.cpp`\n\n**cmpxchg **\n\n```c++\njbyte Atomic::cmpxchg(jbyte exchange_value, volatile jbyte*dest, jbyte compare_value) {\n\t\t assert (sizeof(jbyte) == 1,\"assumption.\");\n\t\t uintptr_t dest_addr = (uintptr_t) dest;\n\t\t uintptr_t offset = dest_addr % sizeof(jint);\n\t\t volatile jint*dest_int = ( volatile jint*)(dest_addr - offset);\n\t\t // \n\t\t jint cur = *dest_int;\n\t\t // cur\n\t\t jbyte * cur_as_bytes = (jbyte *) ( & cur);\n\t\t // new_val\n\t\t jint new_val = cur;\n\t\t jbyte * new_val_as_bytes = (jbyte *) ( & new_val);\n\t\t  // new_valexchange_valuenew_val\n\t\t new_val_as_bytes[offset] = exchange_value;\n\t\t // \n\t\t while (cur_as_bytes[offset] == compare_value) {\n\t\t  // cmpxchgCAScurnew_val\n\t\t\t jint res = cmpxchg(new_val, dest_int, cur);\n\t\t\t if (res == cur) break;\n\t\t\t cur = res;\n\t\t\t new_val = cur;\n\t\t\t new_val_as_bytes[offset] = exchange_value;\n\t\t }\n\t\t // \n\t\t return cur_as_bytes[offset];\n}\n```\n\n C++  ~\n\n```c++\njint res = cmpxchg(new_val, dest_int, cur);\n```\n\n cmpxchg CAS\n\n#### ****\n\nCAS \n\n**1**\n\n CPU\n\n LongAdder LongAdder  CAS  CPU \n\n**2**\n\n**A-->B--->A**  A B A CAS \n\n\n\nJDK  java.util.concurrent.atomic  **AtomicStampedReference** Stamp  CAS \n\n\n\n\n\nhttps://www.cnblogs.com/ldws/p/11970087.html\n","source":"_posts/java/multiThread/java-cas.md","raw":"---\ntitle: java cas \ndate: 2021-05-19 16:28:19\ncategories:\n  - java\ntags:\n  - java\n  - cas\n---\n\n CAS JDK  java.util.concurrent \n\n```java\n// \nstatic int data = 0;\n// main\nIntStream.range(0, 2).forEach((i) -> {\n\t\tnew Thread(() -> {\n\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(20);\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t\t\tdata++;\n\t\t\t\t});\n\t\t}).start();\n});\n\n\ttry {\n\t\t\tThread.sleep(2000);\n\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t}\n\nSystem.out.println(data);\n}\n```\n\n\n\n![image](/images/java-cas/java-cas-1.jpg)\n\ndata int \n `data++`  200 sleep  20  200 \n\n#### ****\n\n\n\n** synchronized **\n\n synchronized JVM\n\nsynchronized \n\n```java\n// Object\nObject lock = new Object();\n \n // synchronized  ()  lock \nIntStream.range(0, 100).forEach(y -> {\n\t\tsynchronized (lock.getClass()) {\n\t\t\t\tdata++;\n\t\t}\n});\n```\n\n![image](/images/java-cas/java-cas-2.jpg)\n\n** Lock **\n\n Lock  synchronized \n Lock  AQS + CAS  AQS  <<AQS>> CAS \n\n Lock \n\n```java\n//   \nLock lock = new ReentrantLock();\n\n//  lock()  unlock() \nIntStream.range(0, 100).forEach(y -> {\n\t\tlock.lock();\n\t\tdata++;\n\t\tlock.unlock();\n});\n```\n\n\n\n![image](/images/java-cas/java-cas-3.jpg)\n\n** Atomic **\n\nsynchronized  JDK1.6  Lock  JVM  Lock  unlock() \n\nJDK \n\n![image](/images/java-cas/java-cas-4.jpg)\n\n AtomicInteger \n\n```java\n// \nAtomicInteger atomicData = new AtomicInteger();\n\n// \nIntStream.range(0, 2).forEach((i) -> {\n\tnew Thread(() -> {\n\t\t\ttry {\n\t\t\t\t\tThread.sleep(20);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t  // \n\t\t\t\t\tatomicData.incrementAndGet();\n\t\t\t});\n\t}).start();\n});\n\ntry {\n\t\tThread.sleep(2000);\n} catch (InterruptedException e) {\n\t\te.printStackTrace();\n}\n\n//  get () \nSystem.out.println(atomicData.get());\n```\n\n\n\n![image](/images/java-cas/java-cas-5.jpg)\n\n Atomic  CAS \n\n** LongAdder **\n\nLongAdder  JDK1.8   AtomicInteger  java.util.concurrent.atomic \n\nLongAdder  AtomicIntegerAtomicLong \n\n LongAdder \n\n```java\n// LongAdder\nLongAdder longAdderData = new LongAdder();\n\n// \nIntStream.range(0, 2).forEach((i) -> {\n\t\tnew Thread(() -> {\n\t\t\t\ttry {\n\t\t\t\t\t\tThread.sleep(20);\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t\tIntStream.range(0, 100).forEach(y -> {\n\t\t\t\t\t  //  increment() \n\t\t\t\t\t\tlongAdderData.increment();\n\t\t\t\t});\n\t\t}).start();\n});\n\ntry {\n\t\tThread.sleep(2000);\n} catch (InterruptedException e) {\n\t\te.printStackTrace();\n}\n//  sum() \nSystem.out.println(longAdderData.sum());\n```\n\n\n\n![image](/images/java-cas/java-cas-6.jpg)\n\n LongAdder  CAS LongAdder  base  Cell[]  Cell LongAdder \n\n LongAdder  AtomicInteger \n\n**volatile **\n\n** `volatile`** \n\n![image](/images/java-cas/java-cas-7.jpg)\n\n 200\n\ndata++  Java\n\n\n\n1 data\n\n2 +1 \n\n3 data \n\n****\n\n\n\nJavaJMM synchronized  Lock  Atomic ****\n\n `volatile` \n\n#### **CAS**\n\nCAS \n\n synchronizedsynchronized \n\n\n\n\n\n\n\nCAS \n\n AtomicIntegerLongAdderLock java.util.concurrent.atomic  CAS \n\n AtomicInteger  CAS \n\n```java\natomicData.incrementAndGet()\n```\n\n\n\n```java\n// 1\npublic final int incrementAndGet() {\n\t\treturn unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n}\n\n// compareAndSet\npublic final boolean compareAndSet(int expect, int update) {\n\t\treturn unsafe.compareAndSwapInt(this, valueOffset, expect, update);\n}\n\n// Unsafe \npublic final int getAndAddInt (Object o,long offset, int delta){\n\t\tint v;\n\t\tdo {\n\t\t\t\tv = getIntVolatile(o, offset);\n\t\t} while (!weakCompareAndSetInt(o, offset, v, v + delta));\n\t\treturn v;\n}\n```\n\n AtomicInteger  Unsafe Unsafe CPU\n\n\n\n```java\nunsafe.compareAndSwapInt(this, valueOffset, expect, update)\n```\n\n CAS Compare And Swap\n\n\n1thisUnsafe  value \n\n2valueOffsetvalue \n\n3expect\n\n4update\n\n value  expect update  true false\n\n valueOffset\n\n```java\n// Unsafe\nprivate static final Unsafe unsafe = Unsafe.getUnsafe();\nprivate static final long valueOffset;\n\nstatic {\n\t\ttry {\n\t\t\t  // valueAtomicInteger\n\t\t\t\tvalueOffset = unsafe.objectFieldOffset\n\t\t\t\t\t\t(AtomicInteger.class.getDeclaredField(\"value\"));\n\t\t} catch (Exception ex) { throw new Error(ex); }\n}\n// \nprivate volatile int value;\n```\n\n value  **volatile** ****\n\n Unsafe.getUnsafe()  Unsafe  AtomicInteger  **rt.jar ** AtomicInteger  **Bootstrap **\n\n\n\n```java\n@CallerSensitive\npublic static Unsafe getUnsafe() {\n\t\tClass var0 = Reflection.getCallerClass();\n\t\t// Bootstrap C++null\n\t\tif (!VM.isSystemDomainLoader(var0.getClassLoader())) {\n\t\t\t\tthrow new SecurityException(\"Unsafe\");\n\t\t} else {\n\t\t\t\treturn theUnsafe;\n\t\t}\n}\n```\n\n\n\n![image](/images/java-cas/java-cas-8.jpg)\n\n#### **CPU**\n\nCPU  L1L2L3 CPU \n\n![image](/images/java-cas/java-cas-9.jpg)\n\n CPU  CPU \n\n\n\n- ****\n\n BUS  Lock \n\n\n\n- ** **\n\n MESI \n\n\n\n****\n\n\n\n1\n\n2Intel 486  Pentium \n\n#### **CAS**\n\n CAS \n\n CPU \n\n CAS \n\n1Tetst-and-Set\n\n2Fetch-and-Increment\n\n3Swap\n\n4Compare-and-Swap\n\n5/Load-Linked/Store-Conditional\n\n\n\nIA64x86  **cmpxchg**  CAS  sparc-TSO  **casa**  ARM  PowerPC  **ldrex/strex**  LL/SC **load and reserve**  **store conditional **  CAS \n\nsun.misc.Unsafe  CAS \n\n```java\npublic final native boolean compareAndSwapObject(Object var1, long var2, Object var4, Object var5);\n\npublic final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5);\n\npublic final native boolean compareAndSwapLong(Object var1, long var2, long var4, long var6);\n```\n\n openjdk  hotspot \n\n`hotspot/src/share/vm/prims/unsafe.cpp`\n\n```c++\n#define FN_PTR(f) CAST_FROM_FN_PTR(void*, &f)\n\n{CC\"compareAndSwapObject\", CC\"(\"OBJ\"J\"OBJ\"\"OBJ\")Z\",  FN_PTR(Unsafe_CompareAndSwapObject)},\n\n{CC\"compareAndSwapInt\",  CC\"(\"OBJ\"J\"\"I\"\"I\"\")Z\",      FN_PTR(Unsafe_CompareAndSwapInt)},\n\n{CC\"compareAndSwapLong\", CC\"(\"OBJ\"J\"\"J\"\"J\"\")Z\",      FN_PTR(Unsafe_CompareAndSwapLong)},\n```\n\n hotspot  cmpxchg  hotspot \n\n`hotspot/src/share/vm/runtime/Atomic.cpp`\n\n**cmpxchg **\n\n```c++\njbyte Atomic::cmpxchg(jbyte exchange_value, volatile jbyte*dest, jbyte compare_value) {\n\t\t assert (sizeof(jbyte) == 1,\"assumption.\");\n\t\t uintptr_t dest_addr = (uintptr_t) dest;\n\t\t uintptr_t offset = dest_addr % sizeof(jint);\n\t\t volatile jint*dest_int = ( volatile jint*)(dest_addr - offset);\n\t\t // \n\t\t jint cur = *dest_int;\n\t\t // cur\n\t\t jbyte * cur_as_bytes = (jbyte *) ( & cur);\n\t\t // new_val\n\t\t jint new_val = cur;\n\t\t jbyte * new_val_as_bytes = (jbyte *) ( & new_val);\n\t\t  // new_valexchange_valuenew_val\n\t\t new_val_as_bytes[offset] = exchange_value;\n\t\t // \n\t\t while (cur_as_bytes[offset] == compare_value) {\n\t\t  // cmpxchgCAScurnew_val\n\t\t\t jint res = cmpxchg(new_val, dest_int, cur);\n\t\t\t if (res == cur) break;\n\t\t\t cur = res;\n\t\t\t new_val = cur;\n\t\t\t new_val_as_bytes[offset] = exchange_value;\n\t\t }\n\t\t // \n\t\t return cur_as_bytes[offset];\n}\n```\n\n C++  ~\n\n```c++\njint res = cmpxchg(new_val, dest_int, cur);\n```\n\n cmpxchg CAS\n\n#### ****\n\nCAS \n\n**1**\n\n CPU\n\n LongAdder LongAdder  CAS  CPU \n\n**2**\n\n**A-->B--->A**  A B A CAS \n\n\n\nJDK  java.util.concurrent.atomic  **AtomicStampedReference** Stamp  CAS \n\n\n\n\n\nhttps://www.cnblogs.com/ldws/p/11970087.html\n","slug":"java/multiThread/java-cas","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pb002dxklo7z9rep6y","content":"<p> CAS JDK  java.util.concurrent </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">// main</span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t\tdata++;</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(data);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-1.jpg\" alt=\"image\"></p>\n<p>data int <br> <code>data++</code>  200 sleep  20  200 </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p></p>\n<p><strong> synchronized </strong></p>\n<p> synchronized JVM</p>\n<p>synchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Object</span></span><br><span class=\"line\"><span class=\"type\">Object</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">// synchronized  ()  lock </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (lock.getClass()) &#123;</span><br><span class=\"line\">\t\t\t\tdata++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/java-cas/java-cas-2.jpg\" alt=\"image\"></p>\n<p><strong> Lock </strong></p>\n<p> Lock  synchronized <br> Lock  AQS + CAS  AQS  &lt;&lt;AQS&gt;&gt; CAS </p>\n<p> Lock </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  lock()  unlock() </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\tlock.lock();</span><br><span class=\"line\">\t\tdata++;</span><br><span class=\"line\">\t\tlock.unlock();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-3.jpg\" alt=\"image\"></p>\n<p><strong> Atomic </strong></p>\n<p>synchronized  JDK1.6  Lock  JVM  Lock  unlock() </p>\n<p>JDK </p>\n<p><img src=\"/images/java-cas/java-cas-4.jpg\" alt=\"image\"></p>\n<p> AtomicInteger </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"type\">AtomicInteger</span> <span class=\"variable\">atomicData</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t  <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t\t\t\tatomicData.incrementAndGet();</span><br><span class=\"line\">\t\t\t&#125;);</span><br><span class=\"line\">\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  get () </span></span><br><span class=\"line\">System.out.println(atomicData.get());</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-5.jpg\" alt=\"image\"></p>\n<p> Atomic  CAS </p>\n<p><strong> LongAdder </strong></p>\n<p>LongAdder  JDK1.8   AtomicInteger  java.util.concurrent.atomic </p>\n<p>LongAdder  AtomicIntegerAtomicLong </p>\n<p> LongAdder </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// LongAdder</span></span><br><span class=\"line\"><span class=\"type\">LongAdder</span> <span class=\"variable\">longAdderData</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LongAdder</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t  <span class=\"comment\">//  increment() </span></span><br><span class=\"line\">\t\t\t\t\t\tlongAdderData.increment();</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//  sum() </span></span><br><span class=\"line\">System.out.println(longAdderData.sum());</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-6.jpg\" alt=\"image\"></p>\n<p> LongAdder  CAS LongAdder  base  Cell[]  Cell LongAdder </p>\n<p> LongAdder  AtomicInteger </p>\n<p><strong>volatile </strong></p>\n<p>** <code>volatile</code>** </p>\n<p><img src=\"/images/java-cas/java-cas-7.jpg\" alt=\"image\"></p>\n<p> 200</p>\n<p>data++  Java</p>\n<p></p>\n<p>1 data</p>\n<p>2 +1 </p>\n<p>3 data </p>\n<p><strong></strong></p>\n<p></p>\n<p>JavaJMM synchronized  Lock  Atomic <strong></strong></p>\n<p> <code>volatile</code> </p>\n<h4 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a><strong>CAS</strong></h4><p>CAS </p>\n<p> synchronizedsynchronized </p>\n<p></p>\n<p></p>\n<p></p>\n<p>CAS </p>\n<p> AtomicIntegerLongAdderLock java.util.concurrent.atomic  CAS </p>\n<p> AtomicInteger  CAS </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">atomicData.incrementAndGet()</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">incrementAndGet</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> unsafe.getAndAddInt(<span class=\"built_in\">this</span>, valueOffset, <span class=\"number\">1</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// compareAndSet</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSet</span><span class=\"params\">(<span class=\"type\">int</span> expect, <span class=\"type\">int</span> update)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> unsafe.compareAndSwapInt(<span class=\"built_in\">this</span>, valueOffset, expect, update);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unsafe </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">getAndAddInt</span> <span class=\"params\">(Object o,<span class=\"type\">long</span> offset, <span class=\"type\">int</span> delta)</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> v;</span><br><span class=\"line\">\t\t<span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">\t\t\t\tv = getIntVolatile(o, offset);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">while</span> (!weakCompareAndSetInt(o, offset, v, v + delta));</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> v;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> AtomicInteger  Unsafe Unsafe CPU</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unsafe.compareAndSwapInt(<span class=\"built_in\">this</span>, valueOffset, expect, update)</span><br></pre></td></tr></table></figure>\n\n<p> CAS Compare And Swap<br></p>\n<p>1thisUnsafe  value </p>\n<p>2valueOffsetvalue </p>\n<p>3expect</p>\n<p>4update</p>\n<p> value  expect update  true false</p>\n<p> valueOffset</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Unsafe</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Unsafe</span> <span class=\"variable\">unsafe</span> <span class=\"operator\">=</span> Unsafe.getUnsafe();</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> valueOffset;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t  <span class=\"comment\">// valueAtomicInteger</span></span><br><span class=\"line\">\t\t\t\tvalueOffset = unsafe.objectFieldOffset</span><br><span class=\"line\">\t\t\t\t\t\t(AtomicInteger.class.getDeclaredField(<span class=\"string\">&quot;value&quot;</span>));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception ex) &#123; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(ex); &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> value;</span><br></pre></td></tr></table></figure>\n\n<p> value  <strong>volatile</strong> <strong></strong></p>\n<p> Unsafe.getUnsafe()  Unsafe  AtomicInteger  **rt.jar ** AtomicInteger  <strong>Bootstrap </strong></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@CallerSensitive</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Unsafe <span class=\"title function_\">getUnsafe</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Class</span> <span class=\"variable\">var0</span> <span class=\"operator\">=</span> Reflection.getCallerClass();</span><br><span class=\"line\">\t\t<span class=\"comment\">// Bootstrap C++null</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!VM.isSystemDomainLoader(var0.getClassLoader())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SecurityException</span>(<span class=\"string\">&quot;Unsafe&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> theUnsafe;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-8.jpg\" alt=\"image\"></p>\n<h4 id=\"CPU\"><a href=\"#CPU\" class=\"headerlink\" title=\"CPU\"></a><strong>CPU</strong></h4><p>CPU  L1L2L3 CPU </p>\n<p><img src=\"/images/java-cas/java-cas-9.jpg\" alt=\"image\"></p>\n<p> CPU  CPU </p>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> BUS  Lock </p>\n<p></p>\n<ul>\n<li>** **</li>\n</ul>\n<p> MESI </p>\n<p></p>\n<p><strong></strong></p>\n<p></p>\n<p>1</p>\n<p>2Intel 486  Pentium </p>\n<h4 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a><strong>CAS</strong></h4><p> CAS </p>\n<p> CPU </p>\n<p> CAS </p>\n<p>1Tetst-and-Set</p>\n<p>2Fetch-and-Increment</p>\n<p>3Swap</p>\n<p>4Compare-and-Swap</p>\n<p>5&#x2F;Load-Linked&#x2F;Store-Conditional</p>\n<p></p>\n<p>IA64x86  <strong>cmpxchg</strong>  CAS  sparc-TSO  <strong>casa</strong>  ARM  PowerPC  <strong>ldrex&#x2F;strex</strong>  LL&#x2F;SC <strong>load and reserve</strong>  **store conditional **  CAS </p>\n<p>sun.misc.Unsafe  CAS </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapObject</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, Object var4, Object var5)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapInt</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, <span class=\"type\">int</span> var4, <span class=\"type\">int</span> var5)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapLong</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, <span class=\"type\">long</span> var4, <span class=\"type\">long</span> var6)</span>;</span><br></pre></td></tr></table></figure>\n\n<p> openjdk  hotspot </p>\n<p><code>hotspot/src/share/vm/prims/unsafe.cpp</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> FN_PTR(f) CAST_FROM_FN_PTR(void*, &amp;f)</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapObject&quot;</span>, CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span>OBJ<span class=\"string\">&quot;&quot;</span>OBJ<span class=\"string\">&quot;)Z&quot;</span>,  <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapObject)&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapInt&quot;</span>,  CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;I&quot;</span><span class=\"string\">&quot;I&quot;</span><span class=\"string\">&quot;)Z&quot;</span>,      <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapInt)&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapLong&quot;</span>, CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;)Z&quot;</span>,      <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapLong)&#125;,</span><br></pre></td></tr></table></figure>\n\n<p> hotspot  cmpxchg  hotspot </p>\n<p><code>hotspot/src/share/vm/runtime/Atomic.cpp</code></p>\n<p><strong>cmpxchg </strong></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">jbyte <span class=\"title\">Atomic::cmpxchg</span><span class=\"params\">(jbyte exchange_value, <span class=\"keyword\">volatile</span> jbyte*dest, jbyte compare_value)</span> </span>&#123;</span><br><span class=\"line\">\t\t <span class=\"built_in\">assert</span> (<span class=\"built_in\">sizeof</span>(jbyte) == <span class=\"number\">1</span>,<span class=\"string\">&quot;assumption.&quot;</span>);</span><br><span class=\"line\">\t\t <span class=\"type\">uintptr_t</span> dest_addr = (<span class=\"type\">uintptr_t</span>) dest;</span><br><span class=\"line\">\t\t <span class=\"type\">uintptr_t</span> offset = dest_addr % <span class=\"built_in\">sizeof</span>(jint);</span><br><span class=\"line\">\t\t <span class=\"keyword\">volatile</span> jint*dest_int = ( <span class=\"keyword\">volatile</span> jint*)(dest_addr - offset);</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t jint cur = *dest_int;</span><br><span class=\"line\">\t\t <span class=\"comment\">// cur</span></span><br><span class=\"line\">\t\t jbyte * cur_as_bytes = (jbyte *) ( &amp; cur);</span><br><span class=\"line\">\t\t <span class=\"comment\">// new_val</span></span><br><span class=\"line\">\t\t jint new_val = cur;</span><br><span class=\"line\">\t\t jbyte * new_val_as_bytes = (jbyte *) ( &amp; new_val);</span><br><span class=\"line\">\t\t  <span class=\"comment\">// new_valexchange_valuenew_val</span></span><br><span class=\"line\">\t\t new_val_as_bytes[offset] = exchange_value;</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t <span class=\"keyword\">while</span> (cur_as_bytes[offset] == compare_value) &#123;</span><br><span class=\"line\">\t\t  <span class=\"comment\">// cmpxchgCAScurnew_val</span></span><br><span class=\"line\">\t\t\t jint res = <span class=\"built_in\">cmpxchg</span>(new_val, dest_int, cur);</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">if</span> (res == cur) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t cur = res;</span><br><span class=\"line\">\t\t\t new_val = cur;</span><br><span class=\"line\">\t\t\t new_val_as_bytes[offset] = exchange_value;</span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t <span class=\"keyword\">return</span> cur_as_bytes[offset];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> C++  ~</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jint res = <span class=\"built_in\">cmpxchg</span>(new_val, dest_int, cur);</span><br></pre></td></tr></table></figure>\n\n<p> cmpxchg CAS</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>CAS </p>\n<p><strong>1</strong></p>\n<p> CPU</p>\n<p> LongAdder LongAdder  CAS  CPU </p>\n<p><strong>2</strong></p>\n<p><strong>A&gt;B&gt;A</strong>  A B A CAS </p>\n<p></p>\n<p>JDK  java.util.concurrent.atomic  <strong>AtomicStampedReference</strong> Stamp  CAS </p>\n<p></p>\n<p><a href=\"https://www.cnblogs.com/ldws/p/11970087.html\">https://www.cnblogs.com/ldws/p/11970087.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p> CAS JDK  java.util.concurrent </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">// main</span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t\tdata++;</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(data);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-1.jpg\" alt=\"image\"></p>\n<p>data int <br> <code>data++</code>  200 sleep  20  200 </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p></p>\n<p><strong> synchronized </strong></p>\n<p> synchronized JVM</p>\n<p>synchronized </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Object</span></span><br><span class=\"line\"><span class=\"type\">Object</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">// synchronized  ()  lock </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (lock.getClass()) &#123;</span><br><span class=\"line\">\t\t\t\tdata++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/java-cas/java-cas-2.jpg\" alt=\"image\"></p>\n<p><strong> Lock </strong></p>\n<p> Lock  synchronized <br> Lock  AQS + CAS  AQS  &lt;&lt;AQS&gt;&gt; CAS </p>\n<p> Lock </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  lock()  unlock() </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\tlock.lock();</span><br><span class=\"line\">\t\tdata++;</span><br><span class=\"line\">\t\tlock.unlock();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-3.jpg\" alt=\"image\"></p>\n<p><strong> Atomic </strong></p>\n<p>synchronized  JDK1.6  Lock  JVM  Lock  unlock() </p>\n<p>JDK </p>\n<p><img src=\"/images/java-cas/java-cas-4.jpg\" alt=\"image\"></p>\n<p> AtomicInteger </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"type\">AtomicInteger</span> <span class=\"variable\">atomicData</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t  <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t\t\t\tatomicData.incrementAndGet();</span><br><span class=\"line\">\t\t\t&#125;);</span><br><span class=\"line\">\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  get () </span></span><br><span class=\"line\">System.out.println(atomicData.get());</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-5.jpg\" alt=\"image\"></p>\n<p> Atomic  CAS </p>\n<p><strong> LongAdder </strong></p>\n<p>LongAdder  JDK1.8   AtomicInteger  java.util.concurrent.atomic </p>\n<p>LongAdder  AtomicIntegerAtomicLong </p>\n<p> LongAdder </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// LongAdder</span></span><br><span class=\"line\"><span class=\"type\">LongAdder</span> <span class=\"variable\">longAdderData</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LongAdder</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">IntStream.range(<span class=\"number\">0</span>, <span class=\"number\">2</span>).forEach((i) -&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\tThread.sleep(<span class=\"number\">20</span>);</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tIntStream.range(<span class=\"number\">0</span>, <span class=\"number\">100</span>).forEach(y -&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t  <span class=\"comment\">//  increment() </span></span><br><span class=\"line\">\t\t\t\t\t\tlongAdderData.increment();</span><br><span class=\"line\">\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t&#125;).start();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//  sum() </span></span><br><span class=\"line\">System.out.println(longAdderData.sum());</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-6.jpg\" alt=\"image\"></p>\n<p> LongAdder  CAS LongAdder  base  Cell[]  Cell LongAdder </p>\n<p> LongAdder  AtomicInteger </p>\n<p><strong>volatile </strong></p>\n<p>** <code>volatile</code>** </p>\n<p><img src=\"/images/java-cas/java-cas-7.jpg\" alt=\"image\"></p>\n<p> 200</p>\n<p>data++  Java</p>\n<p></p>\n<p>1 data</p>\n<p>2 +1 </p>\n<p>3 data </p>\n<p><strong></strong></p>\n<p></p>\n<p>JavaJMM synchronized  Lock  Atomic <strong></strong></p>\n<p> <code>volatile</code> </p>\n<h4 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a><strong>CAS</strong></h4><p>CAS </p>\n<p> synchronizedsynchronized </p>\n<p></p>\n<p></p>\n<p></p>\n<p>CAS </p>\n<p> AtomicIntegerLongAdderLock java.util.concurrent.atomic  CAS </p>\n<p> AtomicInteger  CAS </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">atomicData.incrementAndGet()</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">incrementAndGet</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> unsafe.getAndAddInt(<span class=\"built_in\">this</span>, valueOffset, <span class=\"number\">1</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// compareAndSet</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSet</span><span class=\"params\">(<span class=\"type\">int</span> expect, <span class=\"type\">int</span> update)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> unsafe.compareAndSwapInt(<span class=\"built_in\">this</span>, valueOffset, expect, update);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unsafe </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"title function_\">getAndAddInt</span> <span class=\"params\">(Object o,<span class=\"type\">long</span> offset, <span class=\"type\">int</span> delta)</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> v;</span><br><span class=\"line\">\t\t<span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">\t\t\t\tv = getIntVolatile(o, offset);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">while</span> (!weakCompareAndSetInt(o, offset, v, v + delta));</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> v;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> AtomicInteger  Unsafe Unsafe CPU</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unsafe.compareAndSwapInt(<span class=\"built_in\">this</span>, valueOffset, expect, update)</span><br></pre></td></tr></table></figure>\n\n<p> CAS Compare And Swap<br></p>\n<p>1thisUnsafe  value </p>\n<p>2valueOffsetvalue </p>\n<p>3expect</p>\n<p>4update</p>\n<p> value  expect update  true false</p>\n<p> valueOffset</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Unsafe</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Unsafe</span> <span class=\"variable\">unsafe</span> <span class=\"operator\">=</span> Unsafe.getUnsafe();</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> valueOffset;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t  <span class=\"comment\">// valueAtomicInteger</span></span><br><span class=\"line\">\t\t\t\tvalueOffset = unsafe.objectFieldOffset</span><br><span class=\"line\">\t\t\t\t\t\t(AtomicInteger.class.getDeclaredField(<span class=\"string\">&quot;value&quot;</span>));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception ex) &#123; <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(ex); &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> value;</span><br></pre></td></tr></table></figure>\n\n<p> value  <strong>volatile</strong> <strong></strong></p>\n<p> Unsafe.getUnsafe()  Unsafe  AtomicInteger  **rt.jar ** AtomicInteger  <strong>Bootstrap </strong></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@CallerSensitive</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Unsafe <span class=\"title function_\">getUnsafe</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">Class</span> <span class=\"variable\">var0</span> <span class=\"operator\">=</span> Reflection.getCallerClass();</span><br><span class=\"line\">\t\t<span class=\"comment\">// Bootstrap C++null</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!VM.isSystemDomainLoader(var0.getClassLoader())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SecurityException</span>(<span class=\"string\">&quot;Unsafe&quot;</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> theUnsafe;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/images/java-cas/java-cas-8.jpg\" alt=\"image\"></p>\n<h4 id=\"CPU\"><a href=\"#CPU\" class=\"headerlink\" title=\"CPU\"></a><strong>CPU</strong></h4><p>CPU  L1L2L3 CPU </p>\n<p><img src=\"/images/java-cas/java-cas-9.jpg\" alt=\"image\"></p>\n<p> CPU  CPU </p>\n<p></p>\n<ul>\n<li><strong></strong></li>\n</ul>\n<p> BUS  Lock </p>\n<p></p>\n<ul>\n<li>** **</li>\n</ul>\n<p> MESI </p>\n<p></p>\n<p><strong></strong></p>\n<p></p>\n<p>1</p>\n<p>2Intel 486  Pentium </p>\n<h4 id=\"CAS\"><a href=\"#CAS\" class=\"headerlink\" title=\"CAS\"></a><strong>CAS</strong></h4><p> CAS </p>\n<p> CPU </p>\n<p> CAS </p>\n<p>1Tetst-and-Set</p>\n<p>2Fetch-and-Increment</p>\n<p>3Swap</p>\n<p>4Compare-and-Swap</p>\n<p>5&#x2F;Load-Linked&#x2F;Store-Conditional</p>\n<p></p>\n<p>IA64x86  <strong>cmpxchg</strong>  CAS  sparc-TSO  <strong>casa</strong>  ARM  PowerPC  <strong>ldrex&#x2F;strex</strong>  LL&#x2F;SC <strong>load and reserve</strong>  **store conditional **  CAS </p>\n<p>sun.misc.Unsafe  CAS </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapObject</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, Object var4, Object var5)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapInt</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, <span class=\"type\">int</span> var4, <span class=\"type\">int</span> var5)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">native</span> <span class=\"type\">boolean</span> <span class=\"title function_\">compareAndSwapLong</span><span class=\"params\">(Object var1, <span class=\"type\">long</span> var2, <span class=\"type\">long</span> var4, <span class=\"type\">long</span> var6)</span>;</span><br></pre></td></tr></table></figure>\n\n<p> openjdk  hotspot </p>\n<p><code>hotspot/src/share/vm/prims/unsafe.cpp</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> FN_PTR(f) CAST_FROM_FN_PTR(void*, &amp;f)</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapObject&quot;</span>, CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span>OBJ<span class=\"string\">&quot;&quot;</span>OBJ<span class=\"string\">&quot;)Z&quot;</span>,  <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapObject)&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapInt&quot;</span>,  CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;I&quot;</span><span class=\"string\">&quot;I&quot;</span><span class=\"string\">&quot;)Z&quot;</span>,      <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapInt)&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;CC<span class=\"string\">&quot;compareAndSwapLong&quot;</span>, CC<span class=\"string\">&quot;(&quot;</span>OBJ<span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;J&quot;</span><span class=\"string\">&quot;)Z&quot;</span>,      <span class=\"built_in\">FN_PTR</span>(Unsafe_CompareAndSwapLong)&#125;,</span><br></pre></td></tr></table></figure>\n\n<p> hotspot  cmpxchg  hotspot </p>\n<p><code>hotspot/src/share/vm/runtime/Atomic.cpp</code></p>\n<p><strong>cmpxchg </strong></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">jbyte <span class=\"title\">Atomic::cmpxchg</span><span class=\"params\">(jbyte exchange_value, <span class=\"keyword\">volatile</span> jbyte*dest, jbyte compare_value)</span> </span>&#123;</span><br><span class=\"line\">\t\t <span class=\"built_in\">assert</span> (<span class=\"built_in\">sizeof</span>(jbyte) == <span class=\"number\">1</span>,<span class=\"string\">&quot;assumption.&quot;</span>);</span><br><span class=\"line\">\t\t <span class=\"type\">uintptr_t</span> dest_addr = (<span class=\"type\">uintptr_t</span>) dest;</span><br><span class=\"line\">\t\t <span class=\"type\">uintptr_t</span> offset = dest_addr % <span class=\"built_in\">sizeof</span>(jint);</span><br><span class=\"line\">\t\t <span class=\"keyword\">volatile</span> jint*dest_int = ( <span class=\"keyword\">volatile</span> jint*)(dest_addr - offset);</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t jint cur = *dest_int;</span><br><span class=\"line\">\t\t <span class=\"comment\">// cur</span></span><br><span class=\"line\">\t\t jbyte * cur_as_bytes = (jbyte *) ( &amp; cur);</span><br><span class=\"line\">\t\t <span class=\"comment\">// new_val</span></span><br><span class=\"line\">\t\t jint new_val = cur;</span><br><span class=\"line\">\t\t jbyte * new_val_as_bytes = (jbyte *) ( &amp; new_val);</span><br><span class=\"line\">\t\t  <span class=\"comment\">// new_valexchange_valuenew_val</span></span><br><span class=\"line\">\t\t new_val_as_bytes[offset] = exchange_value;</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t <span class=\"keyword\">while</span> (cur_as_bytes[offset] == compare_value) &#123;</span><br><span class=\"line\">\t\t  <span class=\"comment\">// cmpxchgCAScurnew_val</span></span><br><span class=\"line\">\t\t\t jint res = <span class=\"built_in\">cmpxchg</span>(new_val, dest_int, cur);</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">if</span> (res == cur) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t cur = res;</span><br><span class=\"line\">\t\t\t new_val = cur;</span><br><span class=\"line\">\t\t\t new_val_as_bytes[offset] = exchange_value;</span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\t <span class=\"comment\">// </span></span><br><span class=\"line\">\t\t <span class=\"keyword\">return</span> cur_as_bytes[offset];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> C++  ~</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jint res = <span class=\"built_in\">cmpxchg</span>(new_val, dest_int, cur);</span><br></pre></td></tr></table></figure>\n\n<p> cmpxchg CAS</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><strong></strong></h4><p>CAS </p>\n<p><strong>1</strong></p>\n<p> CPU</p>\n<p> LongAdder LongAdder  CAS  CPU </p>\n<p><strong>2</strong></p>\n<p><strong>A&gt;B&gt;A</strong>  A B A CAS </p>\n<p></p>\n<p>JDK  java.util.concurrent.atomic  <strong>AtomicStampedReference</strong> Stamp  CAS </p>\n<p></p>\n<p><a href=\"https://www.cnblogs.com/ldws/p/11970087.html\">https://www.cnblogs.com/ldws/p/11970087.html</a></p>\n"},{"title":"Javavolatile","date":"2021-05-12T07:59:59.000Z","typora-root-url":"..","_content":"\n\n\nvolatileJava 5Java 5volatile\n\nvolatilevolatileJavavolatilevolatilevolatile\n\n# \n\nCPUCPUCPUCPU\n\nCPUCPU\n\n```java\ni = i + 1;\n```\n\niCPUi1i\n\nCPUCPUCPUCPU\n\n2i0i2\n\niCPU11i12i01i12i\n\ni12\n\nCPU\n\n2\n\n1LOCK#\n\n2\n\n2\n\nCPULOCK#CPULOCK#CPUCPU  i = i +1LCOK#CPUi\n\nCPU\n\nIntel MESIMESICPUCPUCPUCPU\n\n![](/images/java-volatile/java-volatile-1.jpg)\n\n# \n\n\n\n1. ****\n\n    \n\n   \n\n   AB10002A1000B1000\n\n   2A1000B500500 B1000 A1000B1000\n\n   2\n\n   \n\n   32\n\n   ```java\n   i = 9;\n   ```\n\n   321616\n\n   16i\n\n2. ****\n\n   \n\n   \n\n   ```java\n   //1\n   int i = 0;\n   i = 10;\n    \n   //2\n   j = i;\n   ```\n\n   1CPU12CPU21 i =10iCPU110CPU1i10\n\n   2 j = iiCPU2i0j010.\n\n   1i21\n\n3. ****\n\n   \n\n   ```java\n   int i = 0;              \n   boolean flag = false;\n   i = 1;                //1  \n   flag = true;          //2\n   ```\n\n   intboolean12JVM12Instruction Reorder\n\n   \n\n   1221\n\n   \n\n   ```java\n   int a = 10;    //1\n   int r = 2;    //2\n   a = a + 3;    //3\n   r = a*a;     //4\n   ```\n\n    2  1  4  3\n\n   ![](/images/java-volatile/java-volatile-2.jpg)\n\n   Instruction 2Instruction 1Instruction 1Instruction 2\n\n   \n\n   ```java\n   //1:\n   context = loadContext();   //1\n   inited = true;             //2\n    \n   //2:\n   while(!inited ){\n     sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   12122whiledoSomethingwithconfig(context)context\n\n   \n   \n   \n\n\n# Java\n\n   JavaJavajava\n\n   JavaJavaJava Memory ModelJMMJavaJavaJavajava\n\n   Java\n\n   java\n\n   ```java\n   i  = 10; \n   ```\n\n\n\n   i10Java     \t\n\n**1. **\n\n   \t\tJava\n\n   i\n\n   \n\n   ```java\n   x = 10;         //1\n   y = x;         //2\n   x++;           //3\n   x = x + 1;     //4\n   ```\n\n   \t\t41\n\n   110x10\n\n   22xxx x 2\n\n   x++ x = x+13x1\n\n   41\n\n   \n\n   3264JDKJVM64\n\n   JavasynchronizedLocksynchronizedLock\n\n**2. **\n\n   Javavolatile\n\n   volatile\n\n   \n\n   synchronizedLocksynchronizedLock\n\n**3.**\n\n   Java\n\n   JavavolatilesynchronizedLocksynchronizedLock\n\n   Java happens-before happens-before\n\n   happens-before\n\n   - \n   - unLocklock\n   - volatile\n   - ABBCAC\n   - Threadstart()\n   - interrupt()\n   - Thread.join()Thread.isAlive()\n   - finalize()\n\n   8Java\n\n   844\n\n   4\n\n   \n\n   lock\n\n   \n\n   happens-before\n\n   # volatile\n\n   volatile\n\n   **1.volatile**\n\n   volatile\n\n   1\n\n   2\n\n   12\n\n   ```java\n   //1\n   boolean stop = false;\n   while(!stop){\n       doSomething();\n   }\n    \n   //2\n   stop = true;\n   ```\n\n   \n\n   1stop\n\n   2stop212stop\n\n   volatile\n\n   volatile\n\n   volatile21stopCPUL1L2\n\n   1stop1stop\n\n   2stop221stop1\n\n   1\n\n   **2.volatile**\n\n   volatilevolatile\n\n   \n\n   ```java\n   public class Test {\n       public volatile int inc = 0;\n        \n       public void increase() {\n           inc++;\n       }\n        \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n            \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   1000010000\n\n   incvolatileinc101000inc1000*10=10000\n\n   volatilevolatile\n\n   1\n\n   inc10\n\n   11inc1\n\n   22inc1inc2inc2incinc10111\n\n   11inc1inc101inc1inc1111\n\n   inc1\n\n   volatilehappens-beforevolatile1incvolatile2inc12\n\n   volatile\n\n   \n\n   synchronized\n\n   ```java\n   public class Test {\n       public  int inc = 0;\n       \n       public synchronized void increase() {\n           inc++;\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   Lock\n\n   ```java\n   public class Test {\n       public  int inc = 0;\n       Lock lock = new ReentrantLock();\n       \n       public  void increase() {\n           lock.lock();\n           try {\n               inc++;\n           } finally{\n               lock.unlock();\n           }\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   \t\tAtomicInteger\n\n   ```java\n   public class Test {\n       public  AtomicInteger inc = new AtomicInteger();\n        \n       public  void increase() {\n           inc.getAndIncrement();\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   java 1.5java.util.concurrent.atomic 11atomicCASCompare And SwapCASCMPXCHGCMPXCHG\n\n   **3.volatile**\n\n   volatilevolatile\n\n   volatile\n\n   1volatile\n\n   2volatilevolatile\n\n   \n\n   ```java\n   //xyvolatile\n   //flagvolatile\n    \n   x = 2;        //1\n   y = 0;        //2\n   flag = true;  //3\n   x = 4;         //4\n   y = -1;       //5\n   ```\n\n\t\tflagvolatile3123451245\n\n   volatile31212345\n\n   \n\n   ```java\n   //1:\n   context = loadContext();   //1\n   inited = true;             //2\n    \n   //2:\n   while(!inited ){\n     sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   21context2context\n\n   volatileinited2context\n\n   **4.volatile**\n\n   volatilevolatile\n\n   Java\n\n   volatilevolatilevolatilelock\n\n   lock3\n\n   1\n\n   2\n\n   3CPU\n\n   # volatile\n\n   synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2\n\n   1\n\n   2\n\n    volatile \n\n   2volatile\n\n   Javavolatile\n\n   **1.**\n\n   ```java\n   volatile boolean flag = false;\n    \n   while(!flag){\n       doSomething();\n   }\n    \n   public void setFlag() {\n       flag = true;\n   }\n   ```\n\n   ```java\n   volatile boolean inited = false;\n   //1:\n   context = loadContext();  \n   inited = true;            \n    \n   //2:\n   while(!inited ){\n   sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   **2.double check**\n\n   ```java\n   class Singleton{\n       private volatile static Singleton instance = null;\n        \n       private Singleton() {\n            \n       }\n        \n       public static Singleton getInstance() {\n           if(instance==null) {\n               synchronized (Singleton.class) {\n                   if(instance==null)\n                       instance = new Singleton();\n               }\n           }\n           return instance;\n       }\n   }\n   ```\n\n   \n\n   \n\nhttps://www.cnblogs.com/dolphin0520/p/3920373.html","source":"_posts/java/multiThread/java-volatile.md","raw":"---\ntitle: Javavolatile\ndate: 2021-05-12 15:59:59\ncategories:\n  - java\ntags:\n  - java\ntypora-root-url: ..\n---\n\n\n\nvolatileJava 5Java 5volatile\n\nvolatilevolatileJavavolatilevolatilevolatile\n\n# \n\nCPUCPUCPUCPU\n\nCPUCPU\n\n```java\ni = i + 1;\n```\n\niCPUi1i\n\nCPUCPUCPUCPU\n\n2i0i2\n\niCPU11i12i01i12i\n\ni12\n\nCPU\n\n2\n\n1LOCK#\n\n2\n\n2\n\nCPULOCK#CPULOCK#CPUCPU  i = i +1LCOK#CPUi\n\nCPU\n\nIntel MESIMESICPUCPUCPUCPU\n\n![](/images/java-volatile/java-volatile-1.jpg)\n\n# \n\n\n\n1. ****\n\n    \n\n   \n\n   AB10002A1000B1000\n\n   2A1000B500500 B1000 A1000B1000\n\n   2\n\n   \n\n   32\n\n   ```java\n   i = 9;\n   ```\n\n   321616\n\n   16i\n\n2. ****\n\n   \n\n   \n\n   ```java\n   //1\n   int i = 0;\n   i = 10;\n    \n   //2\n   j = i;\n   ```\n\n   1CPU12CPU21 i =10iCPU110CPU1i10\n\n   2 j = iiCPU2i0j010.\n\n   1i21\n\n3. ****\n\n   \n\n   ```java\n   int i = 0;              \n   boolean flag = false;\n   i = 1;                //1  \n   flag = true;          //2\n   ```\n\n   intboolean12JVM12Instruction Reorder\n\n   \n\n   1221\n\n   \n\n   ```java\n   int a = 10;    //1\n   int r = 2;    //2\n   a = a + 3;    //3\n   r = a*a;     //4\n   ```\n\n    2  1  4  3\n\n   ![](/images/java-volatile/java-volatile-2.jpg)\n\n   Instruction 2Instruction 1Instruction 1Instruction 2\n\n   \n\n   ```java\n   //1:\n   context = loadContext();   //1\n   inited = true;             //2\n    \n   //2:\n   while(!inited ){\n     sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   12122whiledoSomethingwithconfig(context)context\n\n   \n   \n   \n\n\n# Java\n\n   JavaJavajava\n\n   JavaJavaJava Memory ModelJMMJavaJavaJavajava\n\n   Java\n\n   java\n\n   ```java\n   i  = 10; \n   ```\n\n\n\n   i10Java     \t\n\n**1. **\n\n   \t\tJava\n\n   i\n\n   \n\n   ```java\n   x = 10;         //1\n   y = x;         //2\n   x++;           //3\n   x = x + 1;     //4\n   ```\n\n   \t\t41\n\n   110x10\n\n   22xxx x 2\n\n   x++ x = x+13x1\n\n   41\n\n   \n\n   3264JDKJVM64\n\n   JavasynchronizedLocksynchronizedLock\n\n**2. **\n\n   Javavolatile\n\n   volatile\n\n   \n\n   synchronizedLocksynchronizedLock\n\n**3.**\n\n   Java\n\n   JavavolatilesynchronizedLocksynchronizedLock\n\n   Java happens-before happens-before\n\n   happens-before\n\n   - \n   - unLocklock\n   - volatile\n   - ABBCAC\n   - Threadstart()\n   - interrupt()\n   - Thread.join()Thread.isAlive()\n   - finalize()\n\n   8Java\n\n   844\n\n   4\n\n   \n\n   lock\n\n   \n\n   happens-before\n\n   # volatile\n\n   volatile\n\n   **1.volatile**\n\n   volatile\n\n   1\n\n   2\n\n   12\n\n   ```java\n   //1\n   boolean stop = false;\n   while(!stop){\n       doSomething();\n   }\n    \n   //2\n   stop = true;\n   ```\n\n   \n\n   1stop\n\n   2stop212stop\n\n   volatile\n\n   volatile\n\n   volatile21stopCPUL1L2\n\n   1stop1stop\n\n   2stop221stop1\n\n   1\n\n   **2.volatile**\n\n   volatilevolatile\n\n   \n\n   ```java\n   public class Test {\n       public volatile int inc = 0;\n        \n       public void increase() {\n           inc++;\n       }\n        \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n            \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   1000010000\n\n   incvolatileinc101000inc1000*10=10000\n\n   volatilevolatile\n\n   1\n\n   inc10\n\n   11inc1\n\n   22inc1inc2inc2incinc10111\n\n   11inc1inc101inc1inc1111\n\n   inc1\n\n   volatilehappens-beforevolatile1incvolatile2inc12\n\n   volatile\n\n   \n\n   synchronized\n\n   ```java\n   public class Test {\n       public  int inc = 0;\n       \n       public synchronized void increase() {\n           inc++;\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   Lock\n\n   ```java\n   public class Test {\n       public  int inc = 0;\n       Lock lock = new ReentrantLock();\n       \n       public  void increase() {\n           lock.lock();\n           try {\n               inc++;\n           } finally{\n               lock.unlock();\n           }\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   \t\tAtomicInteger\n\n   ```java\n   public class Test {\n       public  AtomicInteger inc = new AtomicInteger();\n        \n       public  void increase() {\n           inc.getAndIncrement();\n       }\n       \n       public static void main(String[] args) {\n           final Test test = new Test();\n           for(int i=0;i<10;i++){\n               new Thread(){\n                   public void run() {\n                       for(int j=0;j<1000;j++)\n                           test.increase();\n                   };\n               }.start();\n           }\n           \n           while(Thread.activeCount()>1)  //\n               Thread.yield();\n           System.out.println(test.inc);\n       }\n   }\n   ```\n\n   java 1.5java.util.concurrent.atomic 11atomicCASCompare And SwapCASCMPXCHGCMPXCHG\n\n   **3.volatile**\n\n   volatilevolatile\n\n   volatile\n\n   1volatile\n\n   2volatilevolatile\n\n   \n\n   ```java\n   //xyvolatile\n   //flagvolatile\n    \n   x = 2;        //1\n   y = 0;        //2\n   flag = true;  //3\n   x = 4;         //4\n   y = -1;       //5\n   ```\n\n\t\tflagvolatile3123451245\n\n   volatile31212345\n\n   \n\n   ```java\n   //1:\n   context = loadContext();   //1\n   inited = true;             //2\n    \n   //2:\n   while(!inited ){\n     sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   21context2context\n\n   volatileinited2context\n\n   **4.volatile**\n\n   volatilevolatile\n\n   Java\n\n   volatilevolatilevolatilelock\n\n   lock3\n\n   1\n\n   2\n\n   3CPU\n\n   # volatile\n\n   synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2\n\n   1\n\n   2\n\n    volatile \n\n   2volatile\n\n   Javavolatile\n\n   **1.**\n\n   ```java\n   volatile boolean flag = false;\n    \n   while(!flag){\n       doSomething();\n   }\n    \n   public void setFlag() {\n       flag = true;\n   }\n   ```\n\n   ```java\n   volatile boolean inited = false;\n   //1:\n   context = loadContext();  \n   inited = true;            \n    \n   //2:\n   while(!inited ){\n   sleep()\n   }\n   doSomethingwithconfig(context);\n   ```\n\n   **2.double check**\n\n   ```java\n   class Singleton{\n       private volatile static Singleton instance = null;\n        \n       private Singleton() {\n            \n       }\n        \n       public static Singleton getInstance() {\n           if(instance==null) {\n               synchronized (Singleton.class) {\n                   if(instance==null)\n                       instance = new Singleton();\n               }\n           }\n           return instance;\n       }\n   }\n   ```\n\n   \n\n   \n\nhttps://www.cnblogs.com/dolphin0520/p/3920373.html","slug":"java/multiThread/java-volatile","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pc002hxklobgtt96qq","content":"<p>volatileJava 5Java 5volatile</p>\n<p>volatilevolatileJavavolatilevolatilevolatile</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>CPUCPUCPUCPU</p>\n<p>CPUCPU</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = i + <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>iCPUi1i</p>\n<p>CPUCPUCPUCPU</p>\n<p>2i0i2</p>\n<p>iCPU11i12i01i12i</p>\n<p>i12</p>\n<p>CPU</p>\n<p>2</p>\n<p>1LOCK#</p>\n<p>2</p>\n<p>2</p>\n<p>CPULOCK#CPULOCK#CPUCPU  i &#x3D; i +1LCOK#CPUi</p>\n<p>CPU</p>\n<p>Intel MESIMESICPUCPUCPUCPU</p>\n<p><img src=\"/images/java-volatile/java-volatile-1.jpg\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ol>\n<li><p><strong></strong></p>\n<p> </p>\n<p></p>\n<p>AB10002A1000B1000</p>\n<p>2A1000B500500 B1000 A1000B1000</p>\n<p>2</p>\n<p></p>\n<p>32</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">9</span>;</span><br></pre></td></tr></table></figure>\n\n<p>321616</p>\n<p>16i</p>\n</li>\n<li><p><strong></strong></p>\n<p></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">i = <span class=\"number\">10</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br><span class=\"line\">j = i;</span><br></pre></td></tr></table></figure>\n\n<p>1CPU12CPU21 i &#x3D;10iCPU110CPU1i10</p>\n<p>2 j &#x3D; iiCPU2i0j010.</p>\n<p>1i21</p>\n</li>\n<li><p><strong></strong></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;              </span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">i = <span class=\"number\">1</span>;                <span class=\"comment\">//1  </span></span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;          <span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<p>intboolean12JVM12Instruction Reorder</p>\n<p></p>\n<p>1221</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;    <span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;    <span class=\"comment\">//2</span></span><br><span class=\"line\">a = a + <span class=\"number\">3</span>;    <span class=\"comment\">//3</span></span><br><span class=\"line\">r = a*a;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n\n<p> 2  1  4  3</p>\n<p><img src=\"/images/java-volatile/java-volatile-2.jpg\"></p>\n<p>Instruction 2Instruction 1Instruction 1Instruction 2</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();   <span class=\"comment\">//1</span></span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;             <span class=\"comment\">//2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">  sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>12122whiledoSomethingwithconfig(context)context</p>\n<p></p>\n<p></p>\n</li>\n</ol>\n<h1 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h1><p>   JavaJavajava</p>\n<p>   JavaJavaJava Memory ModelJMMJavaJavaJavajava</p>\n<p>   Java</p>\n<p>   java</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i  = <span class=\"number\">10</span>; </span><br></pre></td></tr></table></figure>\n\n\n\n<p>   i10Java     \t</p>\n<p><strong>1. </strong></p>\n<p>   \t\tJava</p>\n<p>   i</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span>;         <span class=\"comment\">//1</span></span><br><span class=\"line\">y = x;         <span class=\"comment\">//2</span></span><br><span class=\"line\">x++;           <span class=\"comment\">//3</span></span><br><span class=\"line\">x = x + <span class=\"number\">1</span>;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n\n<p>   \t\t41</p>\n<p>   110x10</p>\n<p>   22xxx x 2</p>\n<p>   x++ x &#x3D; x+13x1</p>\n<p>   41</p>\n<p>   </p>\n<p>   3264JDKJVM64</p>\n<p>   JavasynchronizedLocksynchronizedLock</p>\n<p><strong>2. </strong></p>\n<p>   Javavolatile</p>\n<p>   volatile</p>\n<p>   </p>\n<p>   synchronizedLocksynchronizedLock</p>\n<p><strong>3.</strong></p>\n<p>   Java</p>\n<p>   JavavolatilesynchronizedLocksynchronizedLock</p>\n<p>   Java happens-before happens-before</p>\n<p>   happens-before</p>\n<ul>\n<li></li>\n<li>unLocklock</li>\n<li>volatile</li>\n<li>ABBCAC</li>\n<li>Threadstart()</li>\n<li>interrupt()</li>\n<li>Thread.join()Thread.isAlive()</li>\n<li>finalize()</li>\n</ul>\n<p>   8Java</p>\n<p>   844</p>\n<p>   4</p>\n<p>   </p>\n<p>   lock</p>\n<p>   </p>\n<p>   happens-before</p>\n<h1 id=\"volatile\"><a href=\"#volatile\" class=\"headerlink\" title=\"volatile\"></a>volatile</h1><p>   volatile</p>\n<p>   <strong>1.volatile</strong></p>\n<p>   volatile</p>\n<p>   1</p>\n<p>   2</p>\n<p>   12</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">stop</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span>(!stop)&#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br><span class=\"line\">stop = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n\n<p>   </p>\n<p>   1stop</p>\n<p>   2stop212stop</p>\n<p>   volatile</p>\n<p>   volatile</p>\n<p>   volatile21stopCPUL1L2</p>\n<p>   1stop1stop</p>\n<p>   2stop221stop1</p>\n<p>   1</p>\n<p>   <strong>2.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">         </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   1000010000</p>\n<p>   incvolatileinc101000inc1000*10&#x3D;10000</p>\n<p>   volatilevolatile</p>\n<p>   1</p>\n<p>   inc10</p>\n<p>   11inc1</p>\n<p>   22inc1inc2inc2incinc10111</p>\n<p>   11inc1inc101inc1inc1111</p>\n<p>   inc1</p>\n<p>   volatilehappens-beforevolatile1incvolatile2inc12</p>\n<p>   volatile</p>\n<p>   </p>\n<p>   synchronized</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   Lock</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            inc++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span>&#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   \t\tAtomicInteger</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">AtomicInteger</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>();</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc.getAndIncrement();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   java 1.5java.util.concurrent.atomic 11atomicCASCompare And SwapCASCMPXCHGCMPXCHG</p>\n<p>   <strong>3.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   volatile</p>\n<p>   1volatile</p>\n<p>   2volatilevolatile</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//xyvolatile</span></span><br><span class=\"line\"><span class=\"comment\">//flagvolatile</span></span><br><span class=\"line\"> </span><br><span class=\"line\">x = <span class=\"number\">2</span>;        <span class=\"comment\">//1</span></span><br><span class=\"line\">y = <span class=\"number\">0</span>;        <span class=\"comment\">//2</span></span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;  <span class=\"comment\">//3</span></span><br><span class=\"line\">x = <span class=\"number\">4</span>;         <span class=\"comment\">//4</span></span><br><span class=\"line\">y = -<span class=\"number\">1</span>;       <span class=\"comment\">//5</span></span><br></pre></td></tr></table></figure>\n\n<p>\t\tflagvolatile3123451245</p>\n<p>   volatile31212345</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();   <span class=\"comment\">//1</span></span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;             <span class=\"comment\">//2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">  sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>   21context2context</p>\n<p>   volatileinited2context</p>\n<p>   <strong>4.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   Java</p>\n<p>   volatilevolatilevolatilelock</p>\n<p>   lock3</p>\n<p>   1</p>\n<p>   2</p>\n<p>   3CPU</p>\n<h1 id=\"volatile\"><a href=\"#volatile\" class=\"headerlink\" title=\"volatile\"></a>volatile</h1><p>   synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2</p>\n<p>   1</p>\n<p>   2</p>\n<p>    volatile </p>\n<p>   2volatile</p>\n<p>   Javavolatile</p>\n<p>   <strong>1.</strong></p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setFlag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">inited</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();  </span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;            </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>   <strong>2.double check</strong></p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> <span class=\"type\">Singleton</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">         </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>)</span><br><span class=\"line\">                    instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.cnblogs.com/dolphin0520/p/3920373.html\">https://www.cnblogs.com/dolphin0520/p/3920373.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>volatileJava 5Java 5volatile</p>\n<p>volatilevolatileJavavolatilevolatilevolatile</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>CPUCPUCPUCPU</p>\n<p>CPUCPU</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = i + <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>iCPUi1i</p>\n<p>CPUCPUCPUCPU</p>\n<p>2i0i2</p>\n<p>iCPU11i12i01i12i</p>\n<p>i12</p>\n<p>CPU</p>\n<p>2</p>\n<p>1LOCK#</p>\n<p>2</p>\n<p>2</p>\n<p>CPULOCK#CPULOCK#CPUCPU  i &#x3D; i +1LCOK#CPUi</p>\n<p>CPU</p>\n<p>Intel MESIMESICPUCPUCPUCPU</p>\n<p><img src=\"/images/java-volatile/java-volatile-1.jpg\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ol>\n<li><p><strong></strong></p>\n<p> </p>\n<p></p>\n<p>AB10002A1000B1000</p>\n<p>2A1000B500500 B1000 A1000B1000</p>\n<p>2</p>\n<p></p>\n<p>32</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = <span class=\"number\">9</span>;</span><br></pre></td></tr></table></figure>\n\n<p>321616</p>\n<p>16i</p>\n</li>\n<li><p><strong></strong></p>\n<p></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">i = <span class=\"number\">10</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br><span class=\"line\">j = i;</span><br></pre></td></tr></table></figure>\n\n<p>1CPU12CPU21 i &#x3D;10iCPU110CPU1i10</p>\n<p>2 j &#x3D; iiCPU2i0j010.</p>\n<p>1i21</p>\n</li>\n<li><p><strong></strong></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;              </span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">i = <span class=\"number\">1</span>;                <span class=\"comment\">//1  </span></span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;          <span class=\"comment\">//2</span></span><br></pre></td></tr></table></figure>\n\n<p>intboolean12JVM12Instruction Reorder</p>\n<p></p>\n<p>1221</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;    <span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"number\">2</span>;    <span class=\"comment\">//2</span></span><br><span class=\"line\">a = a + <span class=\"number\">3</span>;    <span class=\"comment\">//3</span></span><br><span class=\"line\">r = a*a;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n\n<p> 2  1  4  3</p>\n<p><img src=\"/images/java-volatile/java-volatile-2.jpg\"></p>\n<p>Instruction 2Instruction 1Instruction 1Instruction 2</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();   <span class=\"comment\">//1</span></span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;             <span class=\"comment\">//2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">  sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>12122whiledoSomethingwithconfig(context)context</p>\n<p></p>\n<p></p>\n</li>\n</ol>\n<h1 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h1><p>   JavaJavajava</p>\n<p>   JavaJavaJava Memory ModelJMMJavaJavaJavajava</p>\n<p>   Java</p>\n<p>   java</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i  = <span class=\"number\">10</span>; </span><br></pre></td></tr></table></figure>\n\n\n\n<p>   i10Java     \t</p>\n<p><strong>1. </strong></p>\n<p>   \t\tJava</p>\n<p>   i</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span>;         <span class=\"comment\">//1</span></span><br><span class=\"line\">y = x;         <span class=\"comment\">//2</span></span><br><span class=\"line\">x++;           <span class=\"comment\">//3</span></span><br><span class=\"line\">x = x + <span class=\"number\">1</span>;     <span class=\"comment\">//4</span></span><br></pre></td></tr></table></figure>\n\n<p>   \t\t41</p>\n<p>   110x10</p>\n<p>   22xxx x 2</p>\n<p>   x++ x &#x3D; x+13x1</p>\n<p>   41</p>\n<p>   </p>\n<p>   3264JDKJVM64</p>\n<p>   JavasynchronizedLocksynchronizedLock</p>\n<p><strong>2. </strong></p>\n<p>   Javavolatile</p>\n<p>   volatile</p>\n<p>   </p>\n<p>   synchronizedLocksynchronizedLock</p>\n<p><strong>3.</strong></p>\n<p>   Java</p>\n<p>   JavavolatilesynchronizedLocksynchronizedLock</p>\n<p>   Java happens-before happens-before</p>\n<p>   happens-before</p>\n<ul>\n<li></li>\n<li>unLocklock</li>\n<li>volatile</li>\n<li>ABBCAC</li>\n<li>Threadstart()</li>\n<li>interrupt()</li>\n<li>Thread.join()Thread.isAlive()</li>\n<li>finalize()</li>\n</ul>\n<p>   8Java</p>\n<p>   844</p>\n<p>   4</p>\n<p>   </p>\n<p>   lock</p>\n<p>   </p>\n<p>   happens-before</p>\n<h1 id=\"volatile\"><a href=\"#volatile\" class=\"headerlink\" title=\"volatile\"></a>volatile</h1><p>   volatile</p>\n<p>   <strong>1.volatile</strong></p>\n<p>   volatile</p>\n<p>   1</p>\n<p>   2</p>\n<p>   12</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1</span></span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">stop</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span>(!stop)&#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2</span></span><br><span class=\"line\">stop = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n\n<p>   </p>\n<p>   1stop</p>\n<p>   2stop212stop</p>\n<p>   volatile</p>\n<p>   volatile</p>\n<p>   volatile21stopCPUL1L2</p>\n<p>   1stop1stop</p>\n<p>   2stop221stop1</p>\n<p>   1</p>\n<p>   <strong>2.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">volatile</span> <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">         </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   1000010000</p>\n<p>   incvolatileinc101000inc1000*10&#x3D;10000</p>\n<p>   volatilevolatile</p>\n<p>   1</p>\n<p>   inc10</p>\n<p>   11inc1</p>\n<p>   22inc1inc2inc2incinc10111</p>\n<p>   11inc1inc101inc1inc1111</p>\n<p>   inc1</p>\n<p>   volatilehappens-beforevolatile1incvolatile2inc12</p>\n<p>   volatile</p>\n<p>   </p>\n<p>   synchronized</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   Lock</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">int</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            inc++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span>&#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   \t\tAtomicInteger</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Test</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"type\">AtomicInteger</span> <span class=\"variable\">inc</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>();</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"keyword\">void</span> <span class=\"title function_\">increase</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        inc.getAndIncrement();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Test</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Test</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>()&#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;<span class=\"number\">1000</span>;j++)</span><br><span class=\"line\">                        test.increase();</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(Thread.activeCount()&gt;<span class=\"number\">1</span>)  <span class=\"comment\">//</span></span><br><span class=\"line\">            Thread.yield();</span><br><span class=\"line\">        System.out.println(test.inc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>   java 1.5java.util.concurrent.atomic 11atomicCASCompare And SwapCASCMPXCHGCMPXCHG</p>\n<p>   <strong>3.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   volatile</p>\n<p>   1volatile</p>\n<p>   2volatilevolatile</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//xyvolatile</span></span><br><span class=\"line\"><span class=\"comment\">//flagvolatile</span></span><br><span class=\"line\"> </span><br><span class=\"line\">x = <span class=\"number\">2</span>;        <span class=\"comment\">//1</span></span><br><span class=\"line\">y = <span class=\"number\">0</span>;        <span class=\"comment\">//2</span></span><br><span class=\"line\">flag = <span class=\"literal\">true</span>;  <span class=\"comment\">//3</span></span><br><span class=\"line\">x = <span class=\"number\">4</span>;         <span class=\"comment\">//4</span></span><br><span class=\"line\">y = -<span class=\"number\">1</span>;       <span class=\"comment\">//5</span></span><br></pre></td></tr></table></figure>\n\n<p>\t\tflagvolatile3123451245</p>\n<p>   volatile31212345</p>\n<p>   </p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();   <span class=\"comment\">//1</span></span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;             <span class=\"comment\">//2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">  sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>   21context2context</p>\n<p>   volatileinited2context</p>\n<p>   <strong>4.volatile</strong></p>\n<p>   volatilevolatile</p>\n<p>   Java</p>\n<p>   volatilevolatilevolatilelock</p>\n<p>   lock3</p>\n<p>   1</p>\n<p>   2</p>\n<p>   3CPU</p>\n<h1 id=\"volatile\"><a href=\"#volatile\" class=\"headerlink\" title=\"volatile\"></a>volatile</h1><p>   synchronizedvolatilesynchronizedvolatilesynchronizedvolatilevolatile2</p>\n<p>   1</p>\n<p>   2</p>\n<p>    volatile </p>\n<p>   2volatile</p>\n<p>   Javavolatile</p>\n<p>   <strong>1.</strong></p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">while</span>(!flag)&#123;</span><br><span class=\"line\">    doSomething();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setFlag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">inited</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"comment\">//1:</span></span><br><span class=\"line\">context = loadContext();  </span><br><span class=\"line\">inited = <span class=\"literal\">true</span>;            </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">//2:</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(!inited )&#123;</span><br><span class=\"line\">sleep()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>\n\n<p>   <strong>2.double check</strong></p>\n   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Singleton</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> <span class=\"type\">Singleton</span> <span class=\"variable\">instance</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">Singleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">         </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title function_\">getInstance</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(instance==<span class=\"literal\">null</span>)</span><br><span class=\"line\">                    instance = <span class=\"keyword\">new</span> <span class=\"title class_\">Singleton</span>();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.cnblogs.com/dolphin0520/p/3920373.html\">https://www.cnblogs.com/dolphin0520/p/3920373.html</a></p>\n"},{"title":"java ","date":"2021-05-24T02:31:01.000Z","_content":"\n# \n\n \n\n## \n\n \n\n  **** \n\n## \n\n \n\nCPUCPUCPU\n\n\n\n# JAVA\n\n## Thread\n\nThreadrunrunstart\n\n```java\npublic class ThreadDemo {\n\n    public static void main(String[] args) {\n\n        TDemo t1 = new TDemo(\"A\");\n        // \n        // start\n        // run\n        t1.start();\n        // t1.run();\n        TDemo t2 = new TDemo(\"B\");\n        t2.start();\n        // t2.run();\n\n    }\n\n}\n\nclass TDemo extends Thread {\n\n    private String name;\n\n    public TDemo(String name) {\n        this.name = name;\n    }\n\n    // 0-9\n    // \n    @Override\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            System.out.println(name + \":\" + i);\n        }\n    }\n}\n```\n\n## Runnable\n\nRunnablerunRunnableThreadstart\n\n```java\npublic class RunnableDemo {\n\n    public static void main(String[] args) {\n\n        RDemo r = new RDemo();\n        //  - \n        Thread t = new Thread(r);\n        t.start();\n\n    }\n}\nclass RDemo implements Runnable {\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            System.out.println(i);\n        }\n    }\n}\n```\n\n## Callable<T>\n\nCallable<T>call\n\n```java\npublic class CallableDemo {\n\n    public static void main(String[] args) throws InterruptedException, ExecutionException {\n\n        CDemo c = new CDemo();\n        //  \n        ExecutorService es = Executors.newCachedThreadPool();\n        Future<String> f = es.submit(c);\n        System.out.println(f.get());\n        es.shutdown();\n    }\n\n}\n\n// \nclass CDemo implements Callable<String> {\n\n    @Override\n    public String call() throws Exception {\n        return \"SUCCESS\";\n    }\n\n}\n```\n\n# \n\n\n\n\n\n# \n\n## \n\nsynchronized\n\n## \n\nthis\n\nthisRunnableThread\n\n\n\n```java\nimport java.io.FileInputStream;\nimport java.util.Properties;\n\n// \npublic class SellTicketDemo {\n    public static void main(String[] args) throws Exception {\n        // properties\n        Properties prop = new Properties();\n        prop.load(new FileInputStream(\"ticket.properties\"));\n        int count = Integer.parseInt(prop.getProperty(\"count\"));\n        // ticket\n        Ticket t = new Ticket();\n        t.setCount(count);\n        // \n        Thread t1 = new Thread(new Seller(t), \"A\");\n        Thread t2 = new Thread(new Seller(t), \"B\");\n        Thread t3 = new Thread(new Seller(t), \"C\");\n        Thread t4 = new Thread(new Seller(t), \"D\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n        t4.start();\n    }\n}\n\n// \nclass Seller implements Runnable {\n\n    private Ticket t;\n    public Seller(Ticket t) {\n        this.t = t;\n    }\n\n    @Override\n    public void run() {\n        //  --- \n        while (true) {\n            // Sellertt\n            // synchronized (t) {\n            // SellerSellerSeller\n            // synchronized (Seller.class) {\n            // synchronized (Thread.class) {\n            synchronized (\"abc\") {\n                if (t.getCount() <= 0)\n                    break;\n                try {\n                    // \n                    // \n                    // \n                    // \n                    Thread.sleep(10);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                // 1\n                t.setCount(t.getCount() - 1);\n                // currentThread()\n                // \n                String name = Thread.currentThread().getName();\n                System.out.println(name + \"\" + t.getCount());\n            }\n        }\n    }\n}\n\nclass Ticket {\n    private int count;\n\n    public int getCount() {\n        return count;\n    }\n\n    public void setCount(int count) {\n        this.count = count;\n    }\n}\n```\n\n## \n\n//\n\n/\n\n## \n\n\n\n\n\n\n\n```java\npublic class DeadLockDemo {\n\n    static Printer p = new Printer();\n    static Scan s = new Scan();\n\n    public static void main(String[] args) {\n\n        // \n        Runnable r1 = new Runnable() {\n            @Override\n            public void run() {\n                synchronized (p) {\n                    p.print();\n                    try {\n                        Thread.sleep(10);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (s) {\n                        s.scan();\n                    }\n                }\n            }\n        };\n        new Thread(r1).start();\n        // \n        Runnable r2 = new Runnable() {\n            @Override\n            public void run() {\n                synchronized (s) {\n                    s.scan();\n                    try {\n                        Thread.sleep(10);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (p) {\n                        p.print();\n                    }\n                }\n            }\n        };\n        new Thread(r2).start();\n    }\n}\n\n// \nclass Printer {\n    public void print() {\n        System.out.println(\"~~~\");\n    }\n}\n\n// \nclass Scan {\n    public void scan() {\n        System.out.println(\"~~~\");\n    }\n}\n```\n\n# \n\nJava1-10\n\n5\n\n:\n\n```java\npublic class PriorityDemo {\n\n    public static void main(String[] args) {\n\n        Thread t1 = new Thread(new PDemo(), \"A\");\n        Thread t2 = new Thread(new PDemo(), \"B\");\n\n        // 5\n        // System.out.println(t1.getPriority());\n        // System.out.println(t2.getPriority());\n\n        // \n        t1.setPriority(1);\n        t2.setPriority(10);\n        t1.start();\n        t2.start();\n    }\n}\n\nclass PDemo implements Runnable {\n    @Override\n    public void run() {\n        String name = Thread.currentThread().getName();\n        for (int i = 0; i < 10; i++) {\n            System.out.println(name + \":\" + i);\n        }\n    }\n}\n```\n\n# \n\nwaitnotifynotifyAll\n\nwaitnotifynotifyAllwaitnotify\n\n \n\n```java\npublic class WaitNotifyAllDemo {\n    public static void main(String[] args) {\n        Product p = new Product();\n\n        new Thread(new Supplier2(p)).start();\n        new Thread(new Supplier2(p)).start();\n        new Thread(new Consumer2(p)).start();\n        new Thread(new Consumer2(p)).start();\n    }\n}\n\n// \nclass Supplier2 implements Runnable {\n    private Product p;\n\n    public Supplier2(Product p) {\n        this.p = p;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            synchronized (p) {\n              //while\n              //\n                while (p.flag == false){\n                    try {\n                        // \n                        p.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                // \n                int count = (int) (Math.random() * 1000);\n                p.setCount(count);\n                System.out.println(\"\" + count + \"~~~\");\n                p.flag = false;\n                //\n                p.notifyAll();\n            }\n        }\n    }\n}\n\n// \nclass Consumer2 implements Runnable {\n\n    private Product p;\n\n    public Consumer2(Product p) {\n        this.p = p;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            synchronized (p) {\n                while (p.flag == true){\n                    try {\n                        p.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                int count = p.getCount();\n                p.setCount(0);\n                System.out.println(\"\" + count + \"~~~\");\n                p.flag = true;\n                // \n                p.notifyAll();\n            }\n        }\n    }\n}\n```\n\n# \n\n:\n\n![images](/images/java-multy-thread.png)\n\n# \n\n## \n\n\n\n## \n\n- \n- \n- JavaGC\n\n\n\n```java\npublic class DaemonDemo {\n\n    public static void main(String[] args) throws InterruptedException {\n\n        Thread t1 = new Thread(new Monster(), \"1\");\n        Thread t2 = new Thread(new Monster(), \"2\");\n        Thread t3 = new Thread(new Monster(), \"3\");\n        Thread t4 = new Thread(new Monster(), \"4\");\n\n        // \n        t1.setDaemon(true);\n        t2.setDaemon(true);\n        t3.setDaemon(true);\n        t4.setDaemon(true);\n\n        t1.start();\n        t2.start();\n        t3.start();\n        t4.start();\n\n        for (int i = 10; i > 0; i--) {\n            System.out.println(\"Boss\" + i);\n            Thread.sleep(50);\n        }\n    }\n\n}\n//boss\nclass Monster implements Runnable {\n\n    @Override\n    public void run() {\n        String name = Thread.currentThread().getName();\n        for (int i = 1000; i > 0; i--) {\n            System.out.println(name + \"\" + i);\n            try {\n                Thread.sleep(10);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\nsleepwait\n\nsleepCPUCPUsleepThread\n\nwaitwaitwaitwaitObject\n\n# \n\n## \n\n- \n- QQ\n- App\n\n## \n\n- \n- kill \n-  \n\n# JAVA\n\n\n\n\n\n\n\n\n\nhttps://www.cnblogs.com/chhyan-dream/p/10786043.html\n","source":"_posts/java/multiThread/java-multi-thread.md","raw":"---\ntitle: java \ndate: 2021-05-24 10:31:01\ncategories:\n  - java\ntags:\n  - java\n  - \n---\n\n# \n\n \n\n## \n\n \n\n  **** \n\n## \n\n \n\nCPUCPUCPU\n\n\n\n# JAVA\n\n## Thread\n\nThreadrunrunstart\n\n```java\npublic class ThreadDemo {\n\n    public static void main(String[] args) {\n\n        TDemo t1 = new TDemo(\"A\");\n        // \n        // start\n        // run\n        t1.start();\n        // t1.run();\n        TDemo t2 = new TDemo(\"B\");\n        t2.start();\n        // t2.run();\n\n    }\n\n}\n\nclass TDemo extends Thread {\n\n    private String name;\n\n    public TDemo(String name) {\n        this.name = name;\n    }\n\n    // 0-9\n    // \n    @Override\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            System.out.println(name + \":\" + i);\n        }\n    }\n}\n```\n\n## Runnable\n\nRunnablerunRunnableThreadstart\n\n```java\npublic class RunnableDemo {\n\n    public static void main(String[] args) {\n\n        RDemo r = new RDemo();\n        //  - \n        Thread t = new Thread(r);\n        t.start();\n\n    }\n}\nclass RDemo implements Runnable {\n\n    @Override\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            System.out.println(i);\n        }\n    }\n}\n```\n\n## Callable<T>\n\nCallable<T>call\n\n```java\npublic class CallableDemo {\n\n    public static void main(String[] args) throws InterruptedException, ExecutionException {\n\n        CDemo c = new CDemo();\n        //  \n        ExecutorService es = Executors.newCachedThreadPool();\n        Future<String> f = es.submit(c);\n        System.out.println(f.get());\n        es.shutdown();\n    }\n\n}\n\n// \nclass CDemo implements Callable<String> {\n\n    @Override\n    public String call() throws Exception {\n        return \"SUCCESS\";\n    }\n\n}\n```\n\n# \n\n\n\n\n\n# \n\n## \n\nsynchronized\n\n## \n\nthis\n\nthisRunnableThread\n\n\n\n```java\nimport java.io.FileInputStream;\nimport java.util.Properties;\n\n// \npublic class SellTicketDemo {\n    public static void main(String[] args) throws Exception {\n        // properties\n        Properties prop = new Properties();\n        prop.load(new FileInputStream(\"ticket.properties\"));\n        int count = Integer.parseInt(prop.getProperty(\"count\"));\n        // ticket\n        Ticket t = new Ticket();\n        t.setCount(count);\n        // \n        Thread t1 = new Thread(new Seller(t), \"A\");\n        Thread t2 = new Thread(new Seller(t), \"B\");\n        Thread t3 = new Thread(new Seller(t), \"C\");\n        Thread t4 = new Thread(new Seller(t), \"D\");\n\n        t1.start();\n        t2.start();\n        t3.start();\n        t4.start();\n    }\n}\n\n// \nclass Seller implements Runnable {\n\n    private Ticket t;\n    public Seller(Ticket t) {\n        this.t = t;\n    }\n\n    @Override\n    public void run() {\n        //  --- \n        while (true) {\n            // Sellertt\n            // synchronized (t) {\n            // SellerSellerSeller\n            // synchronized (Seller.class) {\n            // synchronized (Thread.class) {\n            synchronized (\"abc\") {\n                if (t.getCount() <= 0)\n                    break;\n                try {\n                    // \n                    // \n                    // \n                    // \n                    Thread.sleep(10);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                // 1\n                t.setCount(t.getCount() - 1);\n                // currentThread()\n                // \n                String name = Thread.currentThread().getName();\n                System.out.println(name + \"\" + t.getCount());\n            }\n        }\n    }\n}\n\nclass Ticket {\n    private int count;\n\n    public int getCount() {\n        return count;\n    }\n\n    public void setCount(int count) {\n        this.count = count;\n    }\n}\n```\n\n## \n\n//\n\n/\n\n## \n\n\n\n\n\n\n\n```java\npublic class DeadLockDemo {\n\n    static Printer p = new Printer();\n    static Scan s = new Scan();\n\n    public static void main(String[] args) {\n\n        // \n        Runnable r1 = new Runnable() {\n            @Override\n            public void run() {\n                synchronized (p) {\n                    p.print();\n                    try {\n                        Thread.sleep(10);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (s) {\n                        s.scan();\n                    }\n                }\n            }\n        };\n        new Thread(r1).start();\n        // \n        Runnable r2 = new Runnable() {\n            @Override\n            public void run() {\n                synchronized (s) {\n                    s.scan();\n                    try {\n                        Thread.sleep(10);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (p) {\n                        p.print();\n                    }\n                }\n            }\n        };\n        new Thread(r2).start();\n    }\n}\n\n// \nclass Printer {\n    public void print() {\n        System.out.println(\"~~~\");\n    }\n}\n\n// \nclass Scan {\n    public void scan() {\n        System.out.println(\"~~~\");\n    }\n}\n```\n\n# \n\nJava1-10\n\n5\n\n:\n\n```java\npublic class PriorityDemo {\n\n    public static void main(String[] args) {\n\n        Thread t1 = new Thread(new PDemo(), \"A\");\n        Thread t2 = new Thread(new PDemo(), \"B\");\n\n        // 5\n        // System.out.println(t1.getPriority());\n        // System.out.println(t2.getPriority());\n\n        // \n        t1.setPriority(1);\n        t2.setPriority(10);\n        t1.start();\n        t2.start();\n    }\n}\n\nclass PDemo implements Runnable {\n    @Override\n    public void run() {\n        String name = Thread.currentThread().getName();\n        for (int i = 0; i < 10; i++) {\n            System.out.println(name + \":\" + i);\n        }\n    }\n}\n```\n\n# \n\nwaitnotifynotifyAll\n\nwaitnotifynotifyAllwaitnotify\n\n \n\n```java\npublic class WaitNotifyAllDemo {\n    public static void main(String[] args) {\n        Product p = new Product();\n\n        new Thread(new Supplier2(p)).start();\n        new Thread(new Supplier2(p)).start();\n        new Thread(new Consumer2(p)).start();\n        new Thread(new Consumer2(p)).start();\n    }\n}\n\n// \nclass Supplier2 implements Runnable {\n    private Product p;\n\n    public Supplier2(Product p) {\n        this.p = p;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            synchronized (p) {\n              //while\n              //\n                while (p.flag == false){\n                    try {\n                        // \n                        p.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                // \n                int count = (int) (Math.random() * 1000);\n                p.setCount(count);\n                System.out.println(\"\" + count + \"~~~\");\n                p.flag = false;\n                //\n                p.notifyAll();\n            }\n        }\n    }\n}\n\n// \nclass Consumer2 implements Runnable {\n\n    private Product p;\n\n    public Consumer2(Product p) {\n        this.p = p;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            synchronized (p) {\n                while (p.flag == true){\n                    try {\n                        p.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                int count = p.getCount();\n                p.setCount(0);\n                System.out.println(\"\" + count + \"~~~\");\n                p.flag = true;\n                // \n                p.notifyAll();\n            }\n        }\n    }\n}\n```\n\n# \n\n:\n\n![images](/images/java-multy-thread.png)\n\n# \n\n## \n\n\n\n## \n\n- \n- \n- JavaGC\n\n\n\n```java\npublic class DaemonDemo {\n\n    public static void main(String[] args) throws InterruptedException {\n\n        Thread t1 = new Thread(new Monster(), \"1\");\n        Thread t2 = new Thread(new Monster(), \"2\");\n        Thread t3 = new Thread(new Monster(), \"3\");\n        Thread t4 = new Thread(new Monster(), \"4\");\n\n        // \n        t1.setDaemon(true);\n        t2.setDaemon(true);\n        t3.setDaemon(true);\n        t4.setDaemon(true);\n\n        t1.start();\n        t2.start();\n        t3.start();\n        t4.start();\n\n        for (int i = 10; i > 0; i--) {\n            System.out.println(\"Boss\" + i);\n            Thread.sleep(50);\n        }\n    }\n\n}\n//boss\nclass Monster implements Runnable {\n\n    @Override\n    public void run() {\n        String name = Thread.currentThread().getName();\n        for (int i = 1000; i > 0; i--) {\n            System.out.println(name + \"\" + i);\n            try {\n                Thread.sleep(10);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\nsleepwait\n\nsleepCPUCPUsleepThread\n\nwaitwaitwaitwaitObject\n\n# \n\n## \n\n- \n- QQ\n- App\n\n## \n\n- \n- kill \n-  \n\n# JAVA\n\n\n\n\n\n\n\n\n\nhttps://www.cnblogs.com/chhyan-dream/p/10786043.html\n","slug":"java/multiThread/java-multi-thread","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pc002kxklog71k7tcr","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<p>  <strong></strong> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<p>CPUCPUCPU</p>\n<h1 id=\"JAVA\"><a href=\"#JAVA\" class=\"headerlink\" title=\"JAVA\"></a>JAVA</h1><h2 id=\"Thread\"><a href=\"#Thread\" class=\"headerlink\" title=\"Thread\"></a>Thread</h2><p>Threadrunrunstart</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">TDemo</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TDemo</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// start</span></span><br><span class=\"line\">        <span class=\"comment\">// run</span></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        <span class=\"comment\">// t1.run();</span></span><br><span class=\"line\">        <span class=\"type\">TDemo</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TDemo</span>(<span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        <span class=\"comment\">// t2.run();</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TDemo</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">TDemo</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 0-9</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;:&quot;</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Runnable\"><a href=\"#Runnable\" class=\"headerlink\" title=\"Runnable\"></a>Runnable</h2><p>RunnablerunRunnableThreadstart</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RunnableDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">RDemo</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RDemo</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  - </span></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r);</span><br><span class=\"line\">        t.start();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">RDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Callable\"><a href=\"#Callable\" class=\"headerlink\" title=\"Callable\"></a>Callable<T></h2><p>Callable<T>call</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CallableDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">CDemo</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CDemo</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  </span></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">es</span> <span class=\"operator\">=</span> Executors.newCachedThreadPool();</span><br><span class=\"line\">        Future&lt;String&gt; f = es.submit(c);</span><br><span class=\"line\">        System.out.println(f.get());</span><br><span class=\"line\">        es.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;String&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2><p>synchronized</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>this</p>\n<p>thisRunnableThread</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SellTicketDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// properties</span></span><br><span class=\"line\">        <span class=\"type\">Properties</span> <span class=\"variable\">prop</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">        prop.load(<span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(<span class=\"string\">&quot;ticket.properties&quot;</span>));</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> Integer.parseInt(prop.getProperty(<span class=\"string\">&quot;count&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">// ticket</span></span><br><span class=\"line\">        <span class=\"type\">Ticket</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Ticket</span>();</span><br><span class=\"line\">        t.setCount(count);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;C&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;D&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\">        t4.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Seller</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Ticket t;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Seller</span><span class=\"params\">(Ticket t)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.t = t;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  --- </span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Sellertt</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (t) &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">// SellerSellerSeller</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (Seller.class) &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (Thread.class) &#123;</span></span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (<span class=\"string\">&quot;abc&quot;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (t.getCount() &lt;= <span class=\"number\">0</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 1</span></span><br><span class=\"line\">                t.setCount(t.getCount() - <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"comment\">// currentThread()</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">                System.out.println(name + <span class=\"string\">&quot;&quot;</span> + t.getCount());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Ticket</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getCount</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCount</span><span class=\"params\">(<span class=\"type\">int</span> count)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.count = count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;&#x2F;</p>\n<p>&#x2F;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeadLockDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Printer</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Printer</span>();</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Scan</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Scan</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Runnable</span> <span class=\"variable\">r1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                    p.print();</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">synchronized</span> (s) &#123;</span><br><span class=\"line\">                        s.scan();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r1).start();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Runnable</span> <span class=\"variable\">r2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (s) &#123;</span><br><span class=\"line\">                    s.scan();</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                        p.print();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r2).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Printer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Scan</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">scan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Java1-10</p>\n<p>5</p>\n<p>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PriorityDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">PDemo</span>(), <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">PDemo</span>(), <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(t1.getPriority());</span></span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(t2.getPriority());</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        t1.setPriority(<span class=\"number\">1</span>);</span><br><span class=\"line\">        t2.setPriority(<span class=\"number\">10</span>);</span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">PDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;:&quot;</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>waitnotifynotifyAll</p>\n<p>waitnotifynotifyAllwaitnotify</p>\n<p> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WaitNotifyAllDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Product</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Product</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Supplier2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Supplier2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Consumer2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Consumer2</span>(p)).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Supplier2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Product p;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Supplier2</span><span class=\"params\">(Product p)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.p = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">              <span class=\"comment\">//while</span></span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (p.flag == <span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// </span></span><br><span class=\"line\">                        p.wait();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> (<span class=\"type\">int</span>) (Math.random() * <span class=\"number\">1000</span>);</span><br><span class=\"line\">                p.setCount(count);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span> + count + <span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">                p.flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                p.notifyAll();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Product p;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Consumer2</span><span class=\"params\">(Product p)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.p = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (p.flag == <span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        p.wait();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> p.getCount();</span><br><span class=\"line\">                p.setCount(<span class=\"number\">0</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span> + count + <span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">                p.flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                p.notifyAll();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>:</p>\n<p><img src=\"/images/java-multy-thread.png\" alt=\"images\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>JavaGC</li>\n</ul>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DaemonDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        t1.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t2.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t3.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t4.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\">        t4.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>; i &gt; <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Boss&quot;</span> + i);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">50</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//boss</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Monster</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1000</span>; i &gt; <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;&quot;</span> + i);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>sleepwait</p>\n<p>sleepCPUCPUsleepThread</p>\n<p>waitwaitwaitwaitObject</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>QQ</li>\n<li>App</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>kill </li>\n<li></li>\n</ul>\n<h1 id=\"JAVA\"><a href=\"#JAVA\" class=\"headerlink\" title=\"JAVA\"></a>JAVA</h1><p></p>\n<p></p>\n<p></p>\n<p><a href=\"https://www.cnblogs.com/chhyan-dream/p/10786043.html\">https://www.cnblogs.com/chhyan-dream/p/10786043.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<p>  <strong></strong> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<p>CPUCPUCPU</p>\n<h1 id=\"JAVA\"><a href=\"#JAVA\" class=\"headerlink\" title=\"JAVA\"></a>JAVA</h1><h2 id=\"Thread\"><a href=\"#Thread\" class=\"headerlink\" title=\"Thread\"></a>Thread</h2><p>Threadrunrunstart</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">TDemo</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TDemo</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"comment\">// start</span></span><br><span class=\"line\">        <span class=\"comment\">// run</span></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        <span class=\"comment\">// t1.run();</span></span><br><span class=\"line\">        <span class=\"type\">TDemo</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TDemo</span>(<span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        <span class=\"comment\">// t2.run();</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TDemo</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">TDemo</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 0-9</span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;:&quot;</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Runnable\"><a href=\"#Runnable\" class=\"headerlink\" title=\"Runnable\"></a>Runnable</h2><p>RunnablerunRunnableThreadstart</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RunnableDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">RDemo</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RDemo</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  - </span></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r);</span><br><span class=\"line\">        t.start();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">RDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Callable\"><a href=\"#Callable\" class=\"headerlink\" title=\"Callable\"></a>Callable<T></h2><p>Callable<T>call</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CallableDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">CDemo</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CDemo</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  </span></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">es</span> <span class=\"operator\">=</span> Executors.newCachedThreadPool();</span><br><span class=\"line\">        Future&lt;String&gt; f = es.submit(c);</span><br><span class=\"line\">        System.out.println(f.get());</span><br><span class=\"line\">        es.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&lt;String&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2><p>synchronized</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>this</p>\n<p>thisRunnableThread</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SellTicketDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// properties</span></span><br><span class=\"line\">        <span class=\"type\">Properties</span> <span class=\"variable\">prop</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">        prop.load(<span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(<span class=\"string\">&quot;ticket.properties&quot;</span>));</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> Integer.parseInt(prop.getProperty(<span class=\"string\">&quot;count&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">// ticket</span></span><br><span class=\"line\">        <span class=\"type\">Ticket</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Ticket</span>();</span><br><span class=\"line\">        t.setCount(count);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;C&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Seller</span>(t), <span class=\"string\">&quot;D&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\">        t4.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Seller</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Ticket t;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Seller</span><span class=\"params\">(Ticket t)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.t = t;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  --- </span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Sellertt</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (t) &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">// SellerSellerSeller</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (Seller.class) &#123;</span></span><br><span class=\"line\">            <span class=\"comment\">// synchronized (Thread.class) &#123;</span></span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (<span class=\"string\">&quot;abc&quot;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (t.getCount() &lt;= <span class=\"number\">0</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    <span class=\"comment\">// </span></span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 1</span></span><br><span class=\"line\">                t.setCount(t.getCount() - <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"comment\">// currentThread()</span></span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">                System.out.println(name + <span class=\"string\">&quot;&quot;</span> + t.getCount());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Ticket</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getCount</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setCount</span><span class=\"params\">(<span class=\"type\">int</span> count)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.count = count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>&#x2F;&#x2F;</p>\n<p>&#x2F;</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DeadLockDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Printer</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Printer</span>();</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">Scan</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Scan</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Runnable</span> <span class=\"variable\">r1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                    p.print();</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">synchronized</span> (s) &#123;</span><br><span class=\"line\">                        s.scan();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r1).start();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">Runnable</span> <span class=\"variable\">r2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Runnable</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (s) &#123;</span><br><span class=\"line\">                    s.scan();</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                        p.print();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(r2).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Printer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Scan</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">scan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>Java1-10</p>\n<p>5</p>\n<p>:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PriorityDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">PDemo</span>(), <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">PDemo</span>(), <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 5</span></span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(t1.getPriority());</span></span><br><span class=\"line\">        <span class=\"comment\">// System.out.println(t2.getPriority());</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        t1.setPriority(<span class=\"number\">1</span>);</span><br><span class=\"line\">        t2.setPriority(<span class=\"number\">10</span>);</span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">PDemo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;:&quot;</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>waitnotifynotifyAll</p>\n<p>waitnotifynotifyAllwaitnotify</p>\n<p> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WaitNotifyAllDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Product</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Product</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Supplier2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Supplier2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Consumer2</span>(p)).start();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Consumer2</span>(p)).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Supplier2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Product p;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Supplier2</span><span class=\"params\">(Product p)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.p = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">              <span class=\"comment\">//while</span></span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> (p.flag == <span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// </span></span><br><span class=\"line\">                        p.wait();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> (<span class=\"type\">int</span>) (Math.random() * <span class=\"number\">1000</span>);</span><br><span class=\"line\">                p.setCount(count);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span> + count + <span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">                p.flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                p.notifyAll();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Product p;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Consumer2</span><span class=\"params\">(Product p)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.p = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (p) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (p.flag == <span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        p.wait();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> p.getCount();</span><br><span class=\"line\">                p.setCount(<span class=\"number\">0</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span> + count + <span class=\"string\">&quot;~~~&quot;</span>);</span><br><span class=\"line\">                p.flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                p.notifyAll();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>:</p>\n<p><img src=\"/images/java-multy-thread.png\" alt=\"images\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>JavaGC</li>\n</ul>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DaemonDemo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Monster</span>(), <span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        t1.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t2.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t3.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t4.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\">        t4.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>; i &gt; <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Boss&quot;</span> + i);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">50</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//boss</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Monster</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> Thread.currentThread().getName();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1000</span>; i &gt; <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;&quot;</span> + i);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>sleepwait</p>\n<p>sleepCPUCPUsleepThread</p>\n<p>waitwaitwaitwaitObject</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>QQ</li>\n<li>App</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>kill </li>\n<li></li>\n</ul>\n<h1 id=\"JAVA\"><a href=\"#JAVA\" class=\"headerlink\" title=\"JAVA\"></a>JAVA</h1><p></p>\n<p></p>\n<p></p>\n<p><a href=\"https://www.cnblogs.com/chhyan-dream/p/10786043.html\">https://www.cnblogs.com/chhyan-dream/p/10786043.html</a></p>\n"},{"title":"java","date":"2021-05-24T02:31:13.000Z","typora-root-url":"..\\..\\..","_content":"\n> [JYRoy](https://www.cnblogs.com/jyroy/)\n>\n> https://www.cnblogs.com/jyroy/p/11365935.html\n\nJavaJDK 8\n\nJava\n\n![images](/images/java-lock/java-lock-1.png)\n\n#  VS \n\nJava\n\nJavasynchronizedLock\n\n\n\nJavaCASJavaCAS\n\n![images](/images/java-lock/java-lock-2.png)\n\n\n\n- \n- \n\n\n\n![images](/images/java-lock/java-lock-3.png)\n\n CAS \n\nCAS Compare And Swapjava.util.concurrentCAS\n\nCAS\n\n-  V\n-  A\n-  B\n\n V  A CASBV+\n\njava.util.concurrentCASAtomicIntegerAtomicInteger\n\n![images](/images/java-lock/java-lock-4.png)\n\n\n\n- unsafe \n- valueOffset valueAtomicInteger\n- value AtomicIntegerintvolatile\n\nAtomicIntegerincrementAndGet()unsafe.getAndAddInt()JDKUnsafe.classclassOpenJDK 8 Unsafe\n\n![images](/images/java-lock/java-lock-5.png)\n\nOpenJDK 8getAndAddInt()ovv v + deltafalse+compareAndSwapInt()JNICPU\n\nJDKCPUcmpxchg A   V B  V  AJavawhilecmpxchg\n\nCAS\n\n1. ABACASABACASABAABA1A2B3A\n\nJDK1.5AtomicStampedReferenceABAcompareAndSet()compareAndSet()\n\n2. CASCPU\n\n3. CASCAS\n\nJava1.5JDKAtomicReferenceCAS\n\n#  VS \n\n\n\nJavaCPU\n\nCPU\n\n\n\n![images](/images/java-lock/java-lock-6.png)\n\n10-XX:PreBlockSpin\n\nCASAtomicIntegerunsafedo-while\n\n![images](/images/java-lock/java-lock-7.png)\n\nJDK1.4.2-XX:+UseSpinningJDK 6\n\n\n\n :TicketLockCLHlockMCSlock\n\n##  VS  VS  VS \n\nsynchronized\n\nSynchronized\n\nJavaMonitor\n\nJava\n\nsynchronizedJavaJava\n\nHotspotHotspotMark WordKlass Pointer\n\nMark WordHashCodeMark WordMark Word\n\nKlass Point\n\nMonitor\n\nMonitorJavaMonitor\n\nMonitormonitor recordmonitormonitorOwner\n\nsynchronizedsynchronizedMonitorMonitorMutex Lock\n\nJavaCPUsynchronizedJDK 6synchronizedMutex LockJDK 6\n\n4\n\nsynchronizedMark Word\n\n![images](/images/java-lock/java-lock-8.png)\n\n## \n\n\n\nCAS\n\n## \n\n\n\n\n\nMark WordIDCASMark WordCASThreadIDCAS\n\n0100\n\nJDK 6JVMJVM-XX:-UseBiasedLocking=false\n\n## \n\n\n\n010Lock RecordMark WordMark Word\n\nCASMark WordLock RecordLock RecordownerMark Word\n\nMark Word00\n\nMark Word\n\n\n\n## \n\n10Mark Word\n\n\n\n![images](/images/java-lock/java-lock-9.png)\n\nMark WordCASCAS\n\n#  VS \n\nCPU\n\nCPU\n\n\n\n![images](/images/java-lock/java-lock-10.png)\n\n\n\n\n\n![images](/images/java-lock/java-lock-11.png)\n\nReentrantLock![images](/images/java-lock/java-lock-12.png)\n\nReentrantLockSyncSyncAQSAbstractQueuedSynchronizerSyncFairSyncNonfairSyncReentrantLock\n\n:\n\n![images](/images/java-lock/java-lock-13.png)\n\nlock()hasQueuedPredecessors()\n\n![images](/images/java-lock/java-lock-14.png)\n\nhasQueuedPredecessors()truefalse\n\n\n\n#  VS \n\nclassJavaReentrantLocksynchronized\n\n![images](/images/java-lock/java-lock-15.png)\n\nsynchronizeddoSomething()doOthers()doOthers()doOthers()\n\ndoOthers()doSomething()\n\n\n\n\n\n![images](/images/java-lock/java-lock-16.png)\n\n\n\n![images](/images/java-lock/java-lock-17.png)\n\nReentrantLocksynchronizedReentrantLockNonReentrantLock\n\nReentrantLockNonReentrantLockAQSAQSstatusstatus0\n\nstatusstatus == 0status1status != 0status+1statusstatus != 0\n\nstatusstatus-1 == 0status0\n\n![images](/images/java-lock/java-lock-18.png)\n\n#  VS \n\nReentrantLockReentrantReadWriteLock\n\nTAAJDKsynchronizedJUCLock\n\nTAA\n\nAQS\n\nReentrantReadWriteLock\n\n![images](/images/java-lock/java-lock-19.png)\n\nReentrantReadWriteLockReadLockWriteLockReadLockWriteLockSyncSyncAQSCountDownLatchReentrantLockSemaphore\n\nReentrantReadWriteLockSyncReentrantReadWriteLock\n\n\n\nAQSstateint32\n\n01statestateReentrantReadWriteLockstatestate1616\n\n![images](/images/java-lock/java-lock-20.png)\n\n\n\n![images](/images/java-lock/java-lock-21.png)\n\n- ccw1616c int w = exclusiveCount(c); 1600\n- c!=00\n- 65535216-1Error\n- 00c!=0CAS\n- c=0w=0c>0w>0\n\ntryAcquire()\n\nReentrantLock0\n\n\n\n![images](/images/java-lock/java-lock-22.png)\n\ntryAcquireShared(int unused)CAS1<<16\n\nReentrantLock\n\n![images](/images/java-lock/java-lock-23.png)\n\nReentrantLocklockCASstateReentrantLock\n","source":"_posts/java/multiThread/java-lock.md","raw":"---\ntitle: java\ndate: 2021-05-24 10:31:13\ncategories:\n  - java\ntags:\n  - java\n  - \n  - \ntypora-root-url: ..\\..\\..\n---\n\n> [JYRoy](https://www.cnblogs.com/jyroy/)\n>\n> https://www.cnblogs.com/jyroy/p/11365935.html\n\nJavaJDK 8\n\nJava\n\n![images](/images/java-lock/java-lock-1.png)\n\n#  VS \n\nJava\n\nJavasynchronizedLock\n\n\n\nJavaCASJavaCAS\n\n![images](/images/java-lock/java-lock-2.png)\n\n\n\n- \n- \n\n\n\n![images](/images/java-lock/java-lock-3.png)\n\n CAS \n\nCAS Compare And Swapjava.util.concurrentCAS\n\nCAS\n\n-  V\n-  A\n-  B\n\n V  A CASBV+\n\njava.util.concurrentCASAtomicIntegerAtomicInteger\n\n![images](/images/java-lock/java-lock-4.png)\n\n\n\n- unsafe \n- valueOffset valueAtomicInteger\n- value AtomicIntegerintvolatile\n\nAtomicIntegerincrementAndGet()unsafe.getAndAddInt()JDKUnsafe.classclassOpenJDK 8 Unsafe\n\n![images](/images/java-lock/java-lock-5.png)\n\nOpenJDK 8getAndAddInt()ovv v + deltafalse+compareAndSwapInt()JNICPU\n\nJDKCPUcmpxchg A   V B  V  AJavawhilecmpxchg\n\nCAS\n\n1. ABACASABACASABAABA1A2B3A\n\nJDK1.5AtomicStampedReferenceABAcompareAndSet()compareAndSet()\n\n2. CASCPU\n\n3. CASCAS\n\nJava1.5JDKAtomicReferenceCAS\n\n#  VS \n\n\n\nJavaCPU\n\nCPU\n\n\n\n![images](/images/java-lock/java-lock-6.png)\n\n10-XX:PreBlockSpin\n\nCASAtomicIntegerunsafedo-while\n\n![images](/images/java-lock/java-lock-7.png)\n\nJDK1.4.2-XX:+UseSpinningJDK 6\n\n\n\n :TicketLockCLHlockMCSlock\n\n##  VS  VS  VS \n\nsynchronized\n\nSynchronized\n\nJavaMonitor\n\nJava\n\nsynchronizedJavaJava\n\nHotspotHotspotMark WordKlass Pointer\n\nMark WordHashCodeMark WordMark Word\n\nKlass Point\n\nMonitor\n\nMonitorJavaMonitor\n\nMonitormonitor recordmonitormonitorOwner\n\nsynchronizedsynchronizedMonitorMonitorMutex Lock\n\nJavaCPUsynchronizedJDK 6synchronizedMutex LockJDK 6\n\n4\n\nsynchronizedMark Word\n\n![images](/images/java-lock/java-lock-8.png)\n\n## \n\n\n\nCAS\n\n## \n\n\n\n\n\nMark WordIDCASMark WordCASThreadIDCAS\n\n0100\n\nJDK 6JVMJVM-XX:-UseBiasedLocking=false\n\n## \n\n\n\n010Lock RecordMark WordMark Word\n\nCASMark WordLock RecordLock RecordownerMark Word\n\nMark Word00\n\nMark Word\n\n\n\n## \n\n10Mark Word\n\n\n\n![images](/images/java-lock/java-lock-9.png)\n\nMark WordCASCAS\n\n#  VS \n\nCPU\n\nCPU\n\n\n\n![images](/images/java-lock/java-lock-10.png)\n\n\n\n\n\n![images](/images/java-lock/java-lock-11.png)\n\nReentrantLock![images](/images/java-lock/java-lock-12.png)\n\nReentrantLockSyncSyncAQSAbstractQueuedSynchronizerSyncFairSyncNonfairSyncReentrantLock\n\n:\n\n![images](/images/java-lock/java-lock-13.png)\n\nlock()hasQueuedPredecessors()\n\n![images](/images/java-lock/java-lock-14.png)\n\nhasQueuedPredecessors()truefalse\n\n\n\n#  VS \n\nclassJavaReentrantLocksynchronized\n\n![images](/images/java-lock/java-lock-15.png)\n\nsynchronizeddoSomething()doOthers()doOthers()doOthers()\n\ndoOthers()doSomething()\n\n\n\n\n\n![images](/images/java-lock/java-lock-16.png)\n\n\n\n![images](/images/java-lock/java-lock-17.png)\n\nReentrantLocksynchronizedReentrantLockNonReentrantLock\n\nReentrantLockNonReentrantLockAQSAQSstatusstatus0\n\nstatusstatus == 0status1status != 0status+1statusstatus != 0\n\nstatusstatus-1 == 0status0\n\n![images](/images/java-lock/java-lock-18.png)\n\n#  VS \n\nReentrantLockReentrantReadWriteLock\n\nTAAJDKsynchronizedJUCLock\n\nTAA\n\nAQS\n\nReentrantReadWriteLock\n\n![images](/images/java-lock/java-lock-19.png)\n\nReentrantReadWriteLockReadLockWriteLockReadLockWriteLockSyncSyncAQSCountDownLatchReentrantLockSemaphore\n\nReentrantReadWriteLockSyncReentrantReadWriteLock\n\n\n\nAQSstateint32\n\n01statestateReentrantReadWriteLockstatestate1616\n\n![images](/images/java-lock/java-lock-20.png)\n\n\n\n![images](/images/java-lock/java-lock-21.png)\n\n- ccw1616c int w = exclusiveCount(c); 1600\n- c!=00\n- 65535216-1Error\n- 00c!=0CAS\n- c=0w=0c>0w>0\n\ntryAcquire()\n\nReentrantLock0\n\n\n\n![images](/images/java-lock/java-lock-22.png)\n\ntryAcquireShared(int unused)CAS1<<16\n\nReentrantLock\n\n![images](/images/java-lock/java-lock-23.png)\n\nReentrantLocklockCASstateReentrantLock\n","slug":"java/multiThread/java-lock","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pd002mxklo445i5y71","content":"<blockquote>\n<p><a href=\"https://www.cnblogs.com/jyroy/\">JYRoy</a></p>\n<p><a href=\"https://www.cnblogs.com/jyroy/p/11365935.html\">https://www.cnblogs.com/jyroy/p/11365935.html</a></p>\n</blockquote>\n<p>JavaJDK 8</p>\n<p>Java</p>\n<p><img src=\"/images/java-lock/java-lock-1.png\" alt=\"images\"></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>Java</p>\n<p>JavasynchronizedLock</p>\n<p></p>\n<p>JavaCASJavaCAS</p>\n<p><img src=\"/images/java-lock/java-lock-2.png\" alt=\"images\"></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-3.png\" alt=\"images\"></p>\n<p> CAS </p>\n<p>CAS Compare And Swapjava.util.concurrentCAS</p>\n<p>CAS</p>\n<ul>\n<li> V</li>\n<li> A</li>\n<li> B</li>\n</ul>\n<p> V  A CASBV+</p>\n<p>java.util.concurrentCASAtomicIntegerAtomicInteger</p>\n<p><img src=\"/images/java-lock/java-lock-4.png\" alt=\"images\"></p>\n<p></p>\n<ul>\n<li>unsafe </li>\n<li>valueOffset valueAtomicInteger</li>\n<li>value AtomicIntegerintvolatile</li>\n</ul>\n<p>AtomicIntegerincrementAndGet()unsafe.getAndAddInt()JDKUnsafe.classclassOpenJDK 8 Unsafe</p>\n<p><img src=\"/images/java-lock/java-lock-5.png\" alt=\"images\"></p>\n<p>OpenJDK 8getAndAddInt()ovv v + deltafalse+compareAndSwapInt()JNICPU</p>\n<p>JDKCPUcmpxchg A   V B  V  AJavawhilecmpxchg</p>\n<p>CAS</p>\n<ol>\n<li>ABACASABACASABAABA1A2B3A</li>\n</ol>\n<p>JDK1.5AtomicStampedReferenceABAcompareAndSet()compareAndSet()</p>\n<ol start=\"2\">\n<li><p>CASCPU</p>\n</li>\n<li><p>CASCAS</p>\n</li>\n</ol>\n<p>Java1.5JDKAtomicReferenceCAS</p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p></p>\n<p>JavaCPU</p>\n<p>CPU</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-6.png\" alt=\"images\"></p>\n<p>10-XX:PreBlockSpin</p>\n<p>CASAtomicIntegerunsafedo-while</p>\n<p><img src=\"/images/java-lock/java-lock-7.png\" alt=\"images\"></p>\n<p>JDK1.4.2-XX:+UseSpinningJDK 6</p>\n<p></p>\n<p> :TicketLockCLHlockMCSlock</p>\n<h2 id=\"-VS--VS--VS-\"><a href=\"#-VS--VS--VS-\" class=\"headerlink\" title=\" VS  VS  VS \"></a> VS  VS  VS </h2><p>synchronized</p>\n<p>Synchronized</p>\n<p>JavaMonitor</p>\n<p>Java</p>\n<p>synchronizedJavaJava</p>\n<p>HotspotHotspotMark WordKlass Pointer</p>\n<p>Mark WordHashCodeMark WordMark Word</p>\n<p>Klass Point</p>\n<p>Monitor</p>\n<p>MonitorJavaMonitor</p>\n<p>Monitormonitor recordmonitormonitorOwner</p>\n<p>synchronizedsynchronizedMonitorMonitorMutex Lock</p>\n<p>JavaCPUsynchronizedJDK 6synchronizedMutex LockJDK 6</p>\n<p>4</p>\n<p>synchronizedMark Word</p>\n<p><img src=\"/images/java-lock/java-lock-8.png\" alt=\"images\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>CAS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>Mark WordIDCASMark WordCASThreadIDCAS</p>\n<p>0100</p>\n<p>JDK 6JVMJVM-XX:-UseBiasedLocking&#x3D;false</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>010Lock RecordMark WordMark Word</p>\n<p>CASMark WordLock RecordLock RecordownerMark Word</p>\n<p>Mark Word00</p>\n<p>Mark Word</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>10Mark Word</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-9.png\" alt=\"images\"></p>\n<p>Mark WordCASCAS</p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>CPU</p>\n<p>CPU</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-10.png\" alt=\"images\"></p>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-11.png\" alt=\"images\"></p>\n<p>ReentrantLock<img src=\"/images/java-lock/java-lock-12.png\" alt=\"images\"></p>\n<p>ReentrantLockSyncSyncAQSAbstractQueuedSynchronizerSyncFairSyncNonfairSyncReentrantLock</p>\n<p>:</p>\n<p><img src=\"/images/java-lock/java-lock-13.png\" alt=\"images\"></p>\n<p>lock()hasQueuedPredecessors()</p>\n<p><img src=\"/images/java-lock/java-lock-14.png\" alt=\"images\"></p>\n<p>hasQueuedPredecessors()truefalse</p>\n<p></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>classJavaReentrantLocksynchronized</p>\n<p><img src=\"/images/java-lock/java-lock-15.png\" alt=\"images\"></p>\n<p>synchronizeddoSomething()doOthers()doOthers()doOthers()</p>\n<p>doOthers()doSomething()</p>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-16.png\" alt=\"images\"></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-17.png\" alt=\"images\"></p>\n<p>ReentrantLocksynchronizedReentrantLockNonReentrantLock</p>\n<p>ReentrantLockNonReentrantLockAQSAQSstatusstatus0</p>\n<p>statusstatus &#x3D;&#x3D; 0status1status !&#x3D; 0status+1statusstatus !&#x3D; 0</p>\n<p>statusstatus-1 &#x3D;&#x3D; 0status0</p>\n<p><img src=\"/images/java-lock/java-lock-18.png\" alt=\"images\"></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>ReentrantLockReentrantReadWriteLock</p>\n<p>TAAJDKsynchronizedJUCLock</p>\n<p>TAA</p>\n<p>AQS</p>\n<p>ReentrantReadWriteLock</p>\n<p><img src=\"/images/java-lock/java-lock-19.png\" alt=\"images\"></p>\n<p>ReentrantReadWriteLockReadLockWriteLockReadLockWriteLockSyncSyncAQSCountDownLatchReentrantLockSemaphore</p>\n<p>ReentrantReadWriteLockSyncReentrantReadWriteLock</p>\n<p></p>\n<p>AQSstateint32</p>\n<p>01statestateReentrantReadWriteLockstatestate1616</p>\n<p><img src=\"/images/java-lock/java-lock-20.png\" alt=\"images\"></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-21.png\" alt=\"images\"></p>\n<ul>\n<li>ccw1616c int w &#x3D; exclusiveCount(c); 1600</li>\n<li>c!&#x3D;00</li>\n<li>65535216-1Error</li>\n<li>00c!&#x3D;0CAS</li>\n<li>c&#x3D;0w&#x3D;0c&gt;0w&gt;0</li>\n</ul>\n<p>tryAcquire()</p>\n<p>ReentrantLock0</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-22.png\" alt=\"images\"></p>\n<p>tryAcquireShared(int unused)CAS1&lt;&lt;16</p>\n<p>ReentrantLock</p>\n<p><img src=\"/images/java-lock/java-lock-23.png\" alt=\"images\"></p>\n<p>ReentrantLocklockCASstateReentrantLock</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"https://www.cnblogs.com/jyroy/\">JYRoy</a></p>\n<p><a href=\"https://www.cnblogs.com/jyroy/p/11365935.html\">https://www.cnblogs.com/jyroy/p/11365935.html</a></p>\n</blockquote>\n<p>JavaJDK 8</p>\n<p>Java</p>\n<p><img src=\"/images/java-lock/java-lock-1.png\" alt=\"images\"></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>Java</p>\n<p>JavasynchronizedLock</p>\n<p></p>\n<p>JavaCASJavaCAS</p>\n<p><img src=\"/images/java-lock/java-lock-2.png\" alt=\"images\"></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-3.png\" alt=\"images\"></p>\n<p> CAS </p>\n<p>CAS Compare And Swapjava.util.concurrentCAS</p>\n<p>CAS</p>\n<ul>\n<li> V</li>\n<li> A</li>\n<li> B</li>\n</ul>\n<p> V  A CASBV+</p>\n<p>java.util.concurrentCASAtomicIntegerAtomicInteger</p>\n<p><img src=\"/images/java-lock/java-lock-4.png\" alt=\"images\"></p>\n<p></p>\n<ul>\n<li>unsafe </li>\n<li>valueOffset valueAtomicInteger</li>\n<li>value AtomicIntegerintvolatile</li>\n</ul>\n<p>AtomicIntegerincrementAndGet()unsafe.getAndAddInt()JDKUnsafe.classclassOpenJDK 8 Unsafe</p>\n<p><img src=\"/images/java-lock/java-lock-5.png\" alt=\"images\"></p>\n<p>OpenJDK 8getAndAddInt()ovv v + deltafalse+compareAndSwapInt()JNICPU</p>\n<p>JDKCPUcmpxchg A   V B  V  AJavawhilecmpxchg</p>\n<p>CAS</p>\n<ol>\n<li>ABACASABACASABAABA1A2B3A</li>\n</ol>\n<p>JDK1.5AtomicStampedReferenceABAcompareAndSet()compareAndSet()</p>\n<ol start=\"2\">\n<li><p>CASCPU</p>\n</li>\n<li><p>CASCAS</p>\n</li>\n</ol>\n<p>Java1.5JDKAtomicReferenceCAS</p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p></p>\n<p>JavaCPU</p>\n<p>CPU</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-6.png\" alt=\"images\"></p>\n<p>10-XX:PreBlockSpin</p>\n<p>CASAtomicIntegerunsafedo-while</p>\n<p><img src=\"/images/java-lock/java-lock-7.png\" alt=\"images\"></p>\n<p>JDK1.4.2-XX:+UseSpinningJDK 6</p>\n<p></p>\n<p> :TicketLockCLHlockMCSlock</p>\n<h2 id=\"-VS--VS--VS-\"><a href=\"#-VS--VS--VS-\" class=\"headerlink\" title=\" VS  VS  VS \"></a> VS  VS  VS </h2><p>synchronized</p>\n<p>Synchronized</p>\n<p>JavaMonitor</p>\n<p>Java</p>\n<p>synchronizedJavaJava</p>\n<p>HotspotHotspotMark WordKlass Pointer</p>\n<p>Mark WordHashCodeMark WordMark Word</p>\n<p>Klass Point</p>\n<p>Monitor</p>\n<p>MonitorJavaMonitor</p>\n<p>Monitormonitor recordmonitormonitorOwner</p>\n<p>synchronizedsynchronizedMonitorMonitorMutex Lock</p>\n<p>JavaCPUsynchronizedJDK 6synchronizedMutex LockJDK 6</p>\n<p>4</p>\n<p>synchronizedMark Word</p>\n<p><img src=\"/images/java-lock/java-lock-8.png\" alt=\"images\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>CAS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>Mark WordIDCASMark WordCASThreadIDCAS</p>\n<p>0100</p>\n<p>JDK 6JVMJVM-XX:-UseBiasedLocking&#x3D;false</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>010Lock RecordMark WordMark Word</p>\n<p>CASMark WordLock RecordLock RecordownerMark Word</p>\n<p>Mark Word00</p>\n<p>Mark Word</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>10Mark Word</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-9.png\" alt=\"images\"></p>\n<p>Mark WordCASCAS</p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>CPU</p>\n<p>CPU</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-10.png\" alt=\"images\"></p>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-11.png\" alt=\"images\"></p>\n<p>ReentrantLock<img src=\"/images/java-lock/java-lock-12.png\" alt=\"images\"></p>\n<p>ReentrantLockSyncSyncAQSAbstractQueuedSynchronizerSyncFairSyncNonfairSyncReentrantLock</p>\n<p>:</p>\n<p><img src=\"/images/java-lock/java-lock-13.png\" alt=\"images\"></p>\n<p>lock()hasQueuedPredecessors()</p>\n<p><img src=\"/images/java-lock/java-lock-14.png\" alt=\"images\"></p>\n<p>hasQueuedPredecessors()truefalse</p>\n<p></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>classJavaReentrantLocksynchronized</p>\n<p><img src=\"/images/java-lock/java-lock-15.png\" alt=\"images\"></p>\n<p>synchronizeddoSomething()doOthers()doOthers()doOthers()</p>\n<p>doOthers()doSomething()</p>\n<p></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-16.png\" alt=\"images\"></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-17.png\" alt=\"images\"></p>\n<p>ReentrantLocksynchronizedReentrantLockNonReentrantLock</p>\n<p>ReentrantLockNonReentrantLockAQSAQSstatusstatus0</p>\n<p>statusstatus &#x3D;&#x3D; 0status1status !&#x3D; 0status+1statusstatus !&#x3D; 0</p>\n<p>statusstatus-1 &#x3D;&#x3D; 0status0</p>\n<p><img src=\"/images/java-lock/java-lock-18.png\" alt=\"images\"></p>\n<h1 id=\"-VS-\"><a href=\"#-VS-\" class=\"headerlink\" title=\" VS \"></a> VS </h1><p>ReentrantLockReentrantReadWriteLock</p>\n<p>TAAJDKsynchronizedJUCLock</p>\n<p>TAA</p>\n<p>AQS</p>\n<p>ReentrantReadWriteLock</p>\n<p><img src=\"/images/java-lock/java-lock-19.png\" alt=\"images\"></p>\n<p>ReentrantReadWriteLockReadLockWriteLockReadLockWriteLockSyncSyncAQSCountDownLatchReentrantLockSemaphore</p>\n<p>ReentrantReadWriteLockSyncReentrantReadWriteLock</p>\n<p></p>\n<p>AQSstateint32</p>\n<p>01statestateReentrantReadWriteLockstatestate1616</p>\n<p><img src=\"/images/java-lock/java-lock-20.png\" alt=\"images\"></p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-21.png\" alt=\"images\"></p>\n<ul>\n<li>ccw1616c int w &#x3D; exclusiveCount(c); 1600</li>\n<li>c!&#x3D;00</li>\n<li>65535216-1Error</li>\n<li>00c!&#x3D;0CAS</li>\n<li>c&#x3D;0w&#x3D;0c&gt;0w&gt;0</li>\n</ul>\n<p>tryAcquire()</p>\n<p>ReentrantLock0</p>\n<p></p>\n<p><img src=\"/images/java-lock/java-lock-22.png\" alt=\"images\"></p>\n<p>tryAcquireShared(int unused)CAS1&lt;&lt;16</p>\n<p>ReentrantLock</p>\n<p><img src=\"/images/java-lock/java-lock-23.png\" alt=\"images\"></p>\n<p>ReentrantLocklockCASstateReentrantLock</p>\n"},{"title":"maven","date":"2021-05-08T08:43:20.000Z","_content":"\n```\nmvn package -DskipTests=true -P prod (prod yml )\nmvn test-compile \nmvn compile \nmvn install:install-file -Dfile=<path-to-file> -DgroupId=<group-id> \\\n    -DartifactId=<artifact-id> -Dversion=<version> -Dpackaging=<packaging> \n```\n\n","source":"_posts/java/utils/maven-cmd.md","raw":"---\ntitle: maven\ndate: 2021-05-08 16:43:20\ncategories:\n  - maven\ntags:\n  - maven\n---\n\n```\nmvn package -DskipTests=true -P prod (prod yml )\nmvn test-compile \nmvn compile \nmvn install:install-file -Dfile=<path-to-file> -DgroupId=<group-id> \\\n    -DartifactId=<artifact-id> -Dversion=<version> -Dpackaging=<packaging> \n```\n\n","slug":"java/utils/maven-cmd","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pd002qxkload3ibh3k","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package -DskipTests=true -P prod (prod yml )</span><br><span class=\"line\">mvn test-compile </span><br><span class=\"line\">mvn compile </span><br><span class=\"line\">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DgroupId=&lt;group-id&gt; \\</span><br><span class=\"line\">    -DartifactId=&lt;artifact-id&gt; -Dversion=&lt;version&gt; -Dpackaging=&lt;packaging&gt; </span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package -DskipTests=true -P prod (prod yml )</span><br><span class=\"line\">mvn test-compile </span><br><span class=\"line\">mvn compile </span><br><span class=\"line\">mvn install:install-file -Dfile=&lt;path-to-file&gt; -DgroupId=&lt;group-id&gt; \\</span><br><span class=\"line\">    -DartifactId=&lt;artifact-id&gt; -Dversion=&lt;version&gt; -Dpackaging=&lt;packaging&gt; </span><br></pre></td></tr></table></figure>\n\n"},{"title":"java thread interrupt ","date":"2021-06-08T12:11:10.000Z","_content":"\n### \nInterrupt\n\n\njava\n(1)run\n(2)\n\n#### \n\n```java\npublic class test1 {\n\n    public static volatile boolean exit =false;  //\n    \n    public static void main(String[] args) {\n        new Thread() {\n            public void run() {\n                System.out.println(\"\");\n                while (!exit) {\n                    try {\n                        Thread.sleep(1000);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                System.out.println(\"\");\n            }\n        }.start();\n        \n        try {\n            Thread.sleep(1000 * 5);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        exit = true;//5,\n    }\n}\n```\n\n#### \n\nhttps://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java\n\n","source":"_posts/java/multiThread/java-thread-interrupt.md","raw":"---\ntitle: java thread interrupt \ndate: 2021-06-08 20:11:10\ncategories:\n  - java\ntags:\n  - java\n  - \n---\n\n### \nInterrupt\n\n\njava\n(1)run\n(2)\n\n#### \n\n```java\npublic class test1 {\n\n    public static volatile boolean exit =false;  //\n    \n    public static void main(String[] args) {\n        new Thread() {\n            public void run() {\n                System.out.println(\"\");\n                while (!exit) {\n                    try {\n                        Thread.sleep(1000);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                System.out.println(\"\");\n            }\n        }.start();\n        \n        try {\n            Thread.sleep(1000 * 5);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        exit = true;//5,\n    }\n}\n```\n\n#### \n\nhttps://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java\n\n","slug":"java/multiThread/java-thread-interrupt","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pe002txklo97e23hyh","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Interrupt</p>\n<p>java<br>(1)run<br>(2)</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">test1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">exit</span> <span class=\"operator\">=</span><span class=\"literal\">false</span>;  <span class=\"comment\">//</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (!exit) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;.start();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span> * <span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        exit = <span class=\"literal\">true</span>;<span class=\"comment\">//5,</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java\">https://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Interrupt</p>\n<p>java<br>(1)run<br>(2)</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">test1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">volatile</span> <span class=\"type\">boolean</span> <span class=\"variable\">exit</span> <span class=\"operator\">=</span><span class=\"literal\">false</span>;  <span class=\"comment\">//</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (!exit) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;.start();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span> * <span class=\"number\">5</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        exit = <span class=\"literal\">true</span>;<span class=\"comment\">//5,</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java\">https://github.com/idream68/java-demo/blob/master/src/main/java/com/demo/java/multi_thread/ThreadStop.java</a></p>\n"},{"title":"jar","date":"2021-05-08T07:08:31.000Z","_content":"\n\n\n1. jar\n\n   ```\n   jar tf abc.jar\n   ```\n\n2. \n\n   ```\n   jar xf abc.jar BOOT-INF/classes/application.properties\n   ```\n\njar\n\n3. jar\n\n   ```\n   jar uf abc.jar BOOT-INF/classes/application.properties\n   ```","source":"_posts/java/utils/modify-jar-config.md","raw":"---\ntitle: jar\ndate: 2021-05-08 15:08:31\ncategories:\n  - java\ntags:\n  - java\n---\n\n\n\n1. jar\n\n   ```\n   jar tf abc.jar\n   ```\n\n2. \n\n   ```\n   jar xf abc.jar BOOT-INF/classes/application.properties\n   ```\n\njar\n\n3. jar\n\n   ```\n   jar uf abc.jar BOOT-INF/classes/application.properties\n   ```","slug":"java/utils/modify-jar-config","published":1,"updated":"2022-05-10T08:25:56.394Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pf002yxkloeudjdpso","content":"<p></p>\n<ol>\n<li><p>jar</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar tf abc.jar</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar xf abc.jar BOOT-INF/classes/application.properties</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>jar</p>\n<ol start=\"3\">\n<li><p>jar</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar uf abc.jar BOOT-INF/classes/application.properties</span><br></pre></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p></p>\n<ol>\n<li><p>jar</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar tf abc.jar</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar xf abc.jar BOOT-INF/classes/application.properties</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>jar</p>\n<ol start=\"3\">\n<li><p>jar</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jar uf abc.jar BOOT-INF/classes/application.properties</span><br></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"springboot  server.context-path ","date":"2021-04-30T06:14:53.000Z","_content":"\n- springboot v1.x  server.context-path=/path\n- springboot v2.x  server.servelt.context-path=/path","source":"_posts/spring/springboot/spring-boot-path.md","raw":"---\ntitle: springboot  server.context-path \ndate: 2021-04-30 14:14:53\ncategories: \n  - spring\n  - springboot\ntags:\n  - springboot\n  - path\n---\n\n- springboot v1.x  server.context-path=/path\n- springboot v2.x  server.servelt.context-path=/path","slug":"spring/springboot/spring-boot-path","published":1,"updated":"2022-05-10T08:25:56.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pf0031xkloctmgdokn","content":"<ul>\n<li>springboot v1.x  server.context-path&#x3D;&#x2F;path</li>\n<li>springboot v2.x  server.servelt.context-path&#x3D;&#x2F;path</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>springboot v1.x  server.context-path&#x3D;&#x2F;path</li>\n<li>springboot v2.x  server.servelt.context-path&#x3D;&#x2F;path</li>\n</ul>\n"},{"title":"SpringBootSwagger2Unable to infer base url","date":"2021-05-08T03:57:40.000Z","typora-root-url":"..","_content":"\n****\n\nUnable to infer base url.\nThis is common when using dynamic servlet registration or when the API is behind an API Gateway.\nThe base url is the root of where all the swagger resources are served. For e.g. if the api is available at http://example.org/api/v2/api-docs then the base url is http://example.org/api/.\nPlease enter the location manually:\n\n![](/images/swagger_error.png)\n\n****\n\n- application@EnableSwagger2","source":"_posts/spring/springboot/swagger2-unable-to-infer-base-url-error.md","raw":"---\ntitle: SpringBootSwagger2Unable to infer base url\ndate: 2021-05-08 11:57:40\ncategories:\n  - spring\n  - springboot\ntags:\n  - swagger\n  - springboot\ntypora-root-url: ..\n---\n\n****\n\nUnable to infer base url.\nThis is common when using dynamic servlet registration or when the API is behind an API Gateway.\nThe base url is the root of where all the swagger resources are served. For e.g. if the api is available at http://example.org/api/v2/api-docs then the base url is http://example.org/api/.\nPlease enter the location manually:\n\n![](/images/swagger_error.png)\n\n****\n\n- application@EnableSwagger2","slug":"spring/springboot/swagger2-unable-to-infer-base-url-error","published":1,"updated":"2022-05-10T08:25:56.404Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pg0036xklo9zgdea2v","content":"<p><strong></strong></p>\n<p>Unable to infer base url.<br>This is common when using dynamic servlet registration or when the API is behind an API Gateway.<br>The base url is the root of where all the swagger resources are served. For e.g. if the api is available at <a href=\"http://example.org/api/v2/api-docs\">http://example.org/api/v2/api-docs</a> then the base url is <a href=\"http://example.org/api/\">http://example.org/api/</a>.<br>Please enter the location manually:</p>\n<p><img src=\"/images/swagger_error.png\"></p>\n<p><strong></strong></p>\n<ul>\n<li>application@EnableSwagger2</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><strong></strong></p>\n<p>Unable to infer base url.<br>This is common when using dynamic servlet registration or when the API is behind an API Gateway.<br>The base url is the root of where all the swagger resources are served. For e.g. if the api is available at <a href=\"http://example.org/api/v2/api-docs\">http://example.org/api/v2/api-docs</a> then the base url is <a href=\"http://example.org/api/\">http://example.org/api/</a>.<br>Please enter the location manually:</p>\n<p><img src=\"/images/swagger_error.png\"></p>\n<p><strong></strong></p>\n<ul>\n<li>application@EnableSwagger2</li>\n</ul>\n"},{"title":"ControllerRestController","date":"2021-05-11T06:26:40.000Z","_content":"\n### \n\nSpringHTTP\n\n### \n\n#### \n\nSpringMVC \n`@Controller`\n  json \n\n##### \n\n1. \n\n```java\n@RequestMapping(\"/index\")\nString index(){\n\treturn \"index\";\n}\n```\n\n2. ModelAndView\n\n```java\n@RequestMapping(\"/user\")\npublic ModelAndView user(){\n    Map<String,Object>values= new HashMap<>();\n    values.put(\"id\",1L);\n    values.put(\"name\",\"test\");\n    return new ModelAndView(\"user\", values);\n}\n```\n\n Thymeleaf  VelocityFreeMarkespring boot  Thymeleaf jsp\n\n##### json\n\njson\n\njson\n\n1.  `@Controller` `@ResponseBody` `@ResponseBody`\n2. json `@RestCotroller`\n\n```java\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Controller  //\n@ResponseBody   //json\npublic @interface RestController {\n    @AliasFor(\n        annotation = Controller.class\n    )\n    String value() default \"\";\n}\n```\n\n`@RestController = @Controller + @ResponseBody`\n\n##### \n\n`@Controller`json,ModelAndView,`RestController`jsonjson\n\nhttps://blog.csdn.net/yamadeee/article/details/80313068","source":"_posts/spring/springboot/diff-with-controller-restcontroller.md","raw":"---\ntitle: ControllerRestController\ndate: 2021-05-11 14:26:40\ncategories:\n  - spring\n  - springboot\ntags:\n  - springboot\n---\n\n### \n\nSpringHTTP\n\n### \n\n#### \n\nSpringMVC \n`@Controller`\n  json \n\n##### \n\n1. \n\n```java\n@RequestMapping(\"/index\")\nString index(){\n\treturn \"index\";\n}\n```\n\n2. ModelAndView\n\n```java\n@RequestMapping(\"/user\")\npublic ModelAndView user(){\n    Map<String,Object>values= new HashMap<>();\n    values.put(\"id\",1L);\n    values.put(\"name\",\"test\");\n    return new ModelAndView(\"user\", values);\n}\n```\n\n Thymeleaf  VelocityFreeMarkespring boot  Thymeleaf jsp\n\n##### json\n\njson\n\njson\n\n1.  `@Controller` `@ResponseBody` `@ResponseBody`\n2. json `@RestCotroller`\n\n```java\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Controller  //\n@ResponseBody   //json\npublic @interface RestController {\n    @AliasFor(\n        annotation = Controller.class\n    )\n    String value() default \"\";\n}\n```\n\n`@RestController = @Controller + @ResponseBody`\n\n##### \n\n`@Controller`json,ModelAndView,`RestController`jsonjson\n\nhttps://blog.csdn.net/yamadeee/article/details/80313068","slug":"spring/springboot/diff-with-controller-restcontroller","published":1,"updated":"2022-05-10T08:25:56.400Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pg0039xklo0olkd0fa","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>SpringHTTP</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>SpringMVC <br><code>@Controller</code><br>  json </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/index&quot;)</span></span><br><span class=\"line\">String <span class=\"title function_\">index</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;index&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ModelAndView</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    Map&lt;String,Object&gt;values= <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">    values.put(<span class=\"string\">&quot;id&quot;</span>,<span class=\"number\">1L</span>);</span><br><span class=\"line\">    values.put(<span class=\"string\">&quot;name&quot;</span>,<span class=\"string\">&quot;test&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ModelAndView</span>(<span class=\"string\">&quot;user&quot;</span>, values);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Thymeleaf  VelocityFreeMarkespring boot  Thymeleaf jsp</p>\n<h5 id=\"json\"><a href=\"#json\" class=\"headerlink\" title=\"json\"></a>json</h5><p>json</p>\n<p>json</p>\n<ol>\n<li> <code>@Controller</code> <code>@ResponseBody</code> <code>@ResponseBody</code></li>\n<li>json <code>@RestCotroller</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Controller</span>  <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span>   <span class=\"comment\">//json</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> RestController &#123;</span><br><span class=\"line\">    <span class=\"meta\">@AliasFor(</span></span><br><span class=\"line\"><span class=\"meta\">        annotation = Controller.class</span></span><br><span class=\"line\"><span class=\"meta\">    )</span></span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@RestController = @Controller + @ResponseBody</code></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>@Controller</code>json,ModelAndView,<code>RestController</code>jsonjson</p>\n<p><a href=\"https://blog.csdn.net/yamadeee/article/details/80313068\">https://blog.csdn.net/yamadeee/article/details/80313068</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>SpringHTTP</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>SpringMVC <br><code>@Controller</code><br>  json </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><ol>\n<li></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/index&quot;)</span></span><br><span class=\"line\">String <span class=\"title function_\">index</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;index&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ModelAndView</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/user&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    Map&lt;String,Object&gt;values= <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">    values.put(<span class=\"string\">&quot;id&quot;</span>,<span class=\"number\">1L</span>);</span><br><span class=\"line\">    values.put(<span class=\"string\">&quot;name&quot;</span>,<span class=\"string\">&quot;test&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ModelAndView</span>(<span class=\"string\">&quot;user&quot;</span>, values);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> Thymeleaf  VelocityFreeMarkespring boot  Thymeleaf jsp</p>\n<h5 id=\"json\"><a href=\"#json\" class=\"headerlink\" title=\"json\"></a>json</h5><p>json</p>\n<p>json</p>\n<ol>\n<li> <code>@Controller</code> <code>@ResponseBody</code> <code>@ResponseBody</code></li>\n<li>json <code>@RestCotroller</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Controller</span>  <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span>   <span class=\"comment\">//json</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> RestController &#123;</span><br><span class=\"line\">    <span class=\"meta\">@AliasFor(</span></span><br><span class=\"line\"><span class=\"meta\">        annotation = Controller.class</span></span><br><span class=\"line\"><span class=\"meta\">    )</span></span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>@RestController = @Controller + @ResponseBody</code></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><code>@Controller</code>json,ModelAndView,<code>RestController</code>jsonjson</p>\n<p><a href=\"https://blog.csdn.net/yamadeee/article/details/80313068\">https://blog.csdn.net/yamadeee/article/details/80313068</a></p>\n"},{"title":"ClassPathXmlApplicationContext","date":"2021-05-11T09:18:56.000Z","_content":"\n### \n\n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nprepare=>subroutine: |:>.\nobtainFresh=>subroutine: bean|:>.\nprepareBeanFactory=>subroutine: bean|:>.\npostProcessBeanFactory=>subroutine: bean|:>.\ninvokeBeanFactoryPostProcessors=>subroutine: bean|:>.\nregisterBeanPostProcessor=>subroutine: BeanBean|:>.\ninitMessageSource=>subroutine: |:>.\ninitApplicationEventMulticaster=>subroutine: |:>.\nonRefresh=>subroutine: bean|:>.\nregisterListeners=>subroutine: |:>.\nfinishBeanFactory=>subroutine: bean|:>.\nfinishRefresh=>subroutine: |:>.\ns->prepare\nprepare->obtainFresh\nobtainFresh->prepareBeanFactory\nprepareBeanFactory->postProcessBeanFactory\npostProcessBeanFactory->invokeBeanFactoryPostProcessors\ninvokeBeanFactoryPostProcessors->registerBeanPostProcessor\nregisterBeanPostProcessor->initMessageSource\ninitMessageSource->initApplicationEventMulticaster\ninitApplicationEventMulticaster->onRefresh\nonRefresh->registerListeners\nregisterListeners->finishBeanFactory\nfinishBeanFactory->finishRefresh\nfinishRefresh->e\n```\n\n### \n\n### \n\n```flow\ns=>start: \nstartupDate=>operation: \nsetClosedFlag=>operation: \nsetActiveFlag=>operation: \nwriteLog=>operation: \ninitPropertySources=>subroutine: \nvalidateProperties=>subroutine: \nearlyListenersExists=>condition: \nsetEarlyListeners=>operation: \ncleanLinteners=>operation: \naddListeners=>operation: \nsetEarlyEnents=>operation: \ne=>end: \ns->startupDate\nstartupDate->setClosedFlag\nsetClosedFlag->setActiveFlag\nsetActiveFlag->writeLog\nwriteLog->initPropertySources\ninitPropertySources->validateProperties\nvalidateProperties->earlyListenersExists\nearlyListenersExists(no,left)->setEarlyListeners\nearlyListenersExists(yes)->cleanLinteners\ncleanLinteners->addListeners\nsetEarlyListeners->setEarlyEnents\naddListeners->setEarlyEnents\nsetEarlyEnents->e\n```\n","source":"_posts/spring/springcarding/AbstractApplicationContext-refresh.md","raw":"---\ntitle: ClassPathXmlApplicationContext\ndate: 2021-05-11 17:18:56\ncategories:\n  - spring\n  - spring carding\ntags:\n  - spring\n  - spring\n---\n\n### \n\n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nprepare=>subroutine: |:>.\nobtainFresh=>subroutine: bean|:>.\nprepareBeanFactory=>subroutine: bean|:>.\npostProcessBeanFactory=>subroutine: bean|:>.\ninvokeBeanFactoryPostProcessors=>subroutine: bean|:>.\nregisterBeanPostProcessor=>subroutine: BeanBean|:>.\ninitMessageSource=>subroutine: |:>.\ninitApplicationEventMulticaster=>subroutine: |:>.\nonRefresh=>subroutine: bean|:>.\nregisterListeners=>subroutine: |:>.\nfinishBeanFactory=>subroutine: bean|:>.\nfinishRefresh=>subroutine: |:>.\ns->prepare\nprepare->obtainFresh\nobtainFresh->prepareBeanFactory\nprepareBeanFactory->postProcessBeanFactory\npostProcessBeanFactory->invokeBeanFactoryPostProcessors\ninvokeBeanFactoryPostProcessors->registerBeanPostProcessor\nregisterBeanPostProcessor->initMessageSource\ninitMessageSource->initApplicationEventMulticaster\ninitApplicationEventMulticaster->onRefresh\nonRefresh->registerListeners\nregisterListeners->finishBeanFactory\nfinishBeanFactory->finishRefresh\nfinishRefresh->e\n```\n\n### \n\n### \n\n```flow\ns=>start: \nstartupDate=>operation: \nsetClosedFlag=>operation: \nsetActiveFlag=>operation: \nwriteLog=>operation: \ninitPropertySources=>subroutine: \nvalidateProperties=>subroutine: \nearlyListenersExists=>condition: \nsetEarlyListeners=>operation: \ncleanLinteners=>operation: \naddListeners=>operation: \nsetEarlyEnents=>operation: \ne=>end: \ns->startupDate\nstartupDate->setClosedFlag\nsetClosedFlag->setActiveFlag\nsetActiveFlag->writeLog\nwriteLog->initPropertySources\ninitPropertySources->validateProperties\nvalidateProperties->earlyListenersExists\nearlyListenersExists(no,left)->setEarlyListeners\nearlyListenersExists(yes)->cleanLinteners\ncleanLinteners->addListeners\nsetEarlyListeners->setEarlyEnents\naddListeners->setEarlyEnents\nsetEarlyEnents->e\n```\n","slug":"spring/springcarding/AbstractApplicationContext-refresh","published":1,"updated":"2022-05-11T13:17:29.460Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ph003dxklo0wndf26n","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-1\" class=\"flow-chart\"></div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nprepare=>subroutine: |:>.\nobtainFresh=>subroutine: bean|:>.\nprepareBeanFactory=>subroutine: bean|:>.\npostProcessBeanFactory=>subroutine: bean|:>.\ninvokeBeanFactoryPostProcessors=>subroutine: bean|:>.\nregisterBeanPostProcessor=>subroutine: BeanBean|:>.\ninitMessageSource=>subroutine: |:>.\ninitApplicationEventMulticaster=>subroutine: |:>.\nonRefresh=>subroutine: bean|:>.\nregisterListeners=>subroutine: |:>.\nfinishBeanFactory=>subroutine: bean|:>.\nfinishRefresh=>subroutine: |:>.\ns->prepare\nprepare->obtainFresh\nobtainFresh->prepareBeanFactory\nprepareBeanFactory->postProcessBeanFactory\npostProcessBeanFactory->invokeBeanFactoryPostProcessors\ninvokeBeanFactoryPostProcessors->registerBeanPostProcessor\nregisterBeanPostProcessor->initMessageSource\ninitMessageSource->initApplicationEventMulticaster\ninitApplicationEventMulticaster->onRefresh\nonRefresh->registerListeners\nregisterListeners->finishBeanFactory\nfinishBeanFactory->finishRefresh\nfinishRefresh->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script><textarea id=\"flowchart-1-code\" style=\"display: none\">s=>start: \nstartupDate=>operation: \nsetClosedFlag=>operation: \nsetActiveFlag=>operation: \nwriteLog=>operation: \ninitPropertySources=>subroutine: \nvalidateProperties=>subroutine: \nearlyListenersExists=>condition: \nsetEarlyListeners=>operation: \ncleanLinteners=>operation: \naddListeners=>operation: \nsetEarlyEnents=>operation: \ne=>end: \ns->startupDate\nstartupDate->setClosedFlag\nsetClosedFlag->setActiveFlag\nsetActiveFlag->writeLog\nwriteLog->initPropertySources\ninitPropertySources->validateProperties\nvalidateProperties->earlyListenersExists\nearlyListenersExists(no,left)->setEarlyListeners\nearlyListenersExists(yes)->cleanLinteners\ncleanLinteners->addListeners\nsetEarlyListeners->setEarlyEnents\naddListeners->setEarlyEnents\nsetEarlyEnents->e</textarea><textarea id=\"flowchart-1-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-1-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-1-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-1\", options);</script>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-1\" class=\"flow-chart\"></div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nprepare=>subroutine: |:>.\nobtainFresh=>subroutine: bean|:>.\nprepareBeanFactory=>subroutine: bean|:>.\npostProcessBeanFactory=>subroutine: bean|:>.\ninvokeBeanFactoryPostProcessors=>subroutine: bean|:>.\nregisterBeanPostProcessor=>subroutine: BeanBean|:>.\ninitMessageSource=>subroutine: |:>.\ninitApplicationEventMulticaster=>subroutine: |:>.\nonRefresh=>subroutine: bean|:>.\nregisterListeners=>subroutine: |:>.\nfinishBeanFactory=>subroutine: bean|:>.\nfinishRefresh=>subroutine: |:>.\ns->prepare\nprepare->obtainFresh\nobtainFresh->prepareBeanFactory\nprepareBeanFactory->postProcessBeanFactory\npostProcessBeanFactory->invokeBeanFactoryPostProcessors\ninvokeBeanFactoryPostProcessors->registerBeanPostProcessor\nregisterBeanPostProcessor->initMessageSource\ninitMessageSource->initApplicationEventMulticaster\ninitApplicationEventMulticaster->onRefresh\nonRefresh->registerListeners\nregisterListeners->finishBeanFactory\nfinishBeanFactory->finishRefresh\nfinishRefresh->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script><textarea id=\"flowchart-1-code\" style=\"display: none\">s=>start: \nstartupDate=>operation: \nsetClosedFlag=>operation: \nsetActiveFlag=>operation: \nwriteLog=>operation: \ninitPropertySources=>subroutine: \nvalidateProperties=>subroutine: \nearlyListenersExists=>condition: \nsetEarlyListeners=>operation: \ncleanLinteners=>operation: \naddListeners=>operation: \nsetEarlyEnents=>operation: \ne=>end: \ns->startupDate\nstartupDate->setClosedFlag\nsetClosedFlag->setActiveFlag\nsetActiveFlag->writeLog\nwriteLog->initPropertySources\ninitPropertySources->validateProperties\nvalidateProperties->earlyListenersExists\nearlyListenersExists(no,left)->setEarlyListeners\nearlyListenersExists(yes)->cleanLinteners\ncleanLinteners->addListeners\nsetEarlyListeners->setEarlyEnents\naddListeners->setEarlyEnents\nsetEarlyEnents->e</textarea><textarea id=\"flowchart-1-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-1-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-1-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-1\", options);</script>"},{"title":"spring @ComponentScan@MapperScan","date":"2021-05-10T03:47:40.000Z","_content":"\n- @MapperScan:\n  - mapper\n- @ComponentScan:\n  -  @Controller @Service @Repository @ComponentScan\n\n\n\n","source":"_posts/spring/springboot/spring-diff-componentscan-mapperscan.md","raw":"---\ntitle: spring @ComponentScan@MapperScan\ndate: 2021-05-10 11:47:40\ncategories:\n  - spring\n  - springboot\ntags:\n  - springboot\n---\n\n- @MapperScan:\n  - mapper\n- @ComponentScan:\n  -  @Controller @Service @Repository @ComponentScan\n\n\n\n","slug":"spring/springboot/spring-diff-componentscan-mapperscan","published":1,"updated":"2022-05-10T08:25:56.404Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4ph003gxklo2vhuaoez","content":"<ul>\n<li>@MapperScan:<ul>\n<li>mapper</li>\n</ul>\n</li>\n<li>@ComponentScan:<ul>\n<li> @Controller @Service @Repository @ComponentScan</li>\n</ul>\n</li>\n</ul>\n<p></p>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>@MapperScan:<ul>\n<li>mapper</li>\n</ul>\n</li>\n<li>@ComponentScan:<ul>\n<li> @Controller @Service @Repository @ComponentScan</li>\n</ul>\n</li>\n</ul>\n<p></p>\n"},{"title":"ClassPathXmlApplicationContext","date":"2021-05-11T11:35:35.000Z","_content":"\n### \n\n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nlocations=>operation: \nresolvePath=>subroutine: |:>#\ns->locations->resolvePath->e\n```\n\n### \n\n1. \n\n   1. \n\n      org.springframework.context.support.AbstractRefreshableConfigApplicationContext\n\n   2. \n\n      AbstractRefreshableApplicationContext\n\n   3. \n\n      setConfigLocations(@Nullable String... locations)\n\n   4. \n\n      \n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\ngetEnvironment=>subroutine: |:># \nresolveRequiredPlaceholders=>subroutine: |:>#\ntirmSpace=>operation: \nstart->getEnvironment->resolveRequiredPlaceholders->tirmSpace->end\n```\n\n### \n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\nenvirmonentExists=>condition: \ncreateEnvironment=>subroutine:  |:> #\ngetEnvironment=>operation: \nstart->envirmonentExists\nenvirmonentExists(yes)->getEnvironment\nenvirmonentExists(no)->createEnvironment\ncreateEnvironment->getEnvironment\ngetEnvironment->end\n```\n\n\n\n\n\n### \n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\ninitDefaultProfiles=>operation: \ninitPropertySources=>operation: \ninitPropertyResolver=>operation: \ngetSystemProperty=>operation: \nwhichGetEnvironment=>condition: ?\ngetSystemEnvironment=>operation: \nstart->initDefaultProfiles\ninitDefaultProfiles->initPropertySources\ninitPropertySources->initPropertyResolver\ninitPropertyResolver->getSystemProperty\ngetSystemProperty->whichGetEnvironment\nwhichGetEnvironment(yes)->getSystemEnvironment->end\nwhichGetEnvironment(no)->end\n```\n\n\n\n### \n\n```java\nSpringProperties.setProperty(\"spring.getenv.ignore\", \"true\"); // true:\n```\n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\nhelperExists=>condition: \ncreateHepler=>operation: \ngetHelper=>operation: \nresolve=>operation: \nstart->helperExists\nhelperExists(yes)->getHelper\nhelperExists(no)->createHepler\ncreateHepler->getHelper\ngetHelper->resolve\nresolve->end\n```\n\n### \n\n\n\n","source":"_posts/spring/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations.md","raw":"---\ntitle: ClassPathXmlApplicationContext\ndate: 2021-05-11 19:35:35\ncategories:\n  - spring\n  - spring carding\ntags:\n  - spring\n  - spring\n---\n\n### \n\n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nlocations=>operation: \nresolvePath=>subroutine: |:>#\ns->locations->resolvePath->e\n```\n\n### \n\n1. \n\n   1. \n\n      org.springframework.context.support.AbstractRefreshableConfigApplicationContext\n\n   2. \n\n      AbstractRefreshableApplicationContext\n\n   3. \n\n      setConfigLocations(@Nullable String... locations)\n\n   4. \n\n      \n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\ngetEnvironment=>subroutine: |:># \nresolveRequiredPlaceholders=>subroutine: |:>#\ntirmSpace=>operation: \nstart->getEnvironment->resolveRequiredPlaceholders->tirmSpace->end\n```\n\n### \n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\nenvirmonentExists=>condition: \ncreateEnvironment=>subroutine:  |:> #\ngetEnvironment=>operation: \nstart->envirmonentExists\nenvirmonentExists(yes)->getEnvironment\nenvirmonentExists(no)->createEnvironment\ncreateEnvironment->getEnvironment\ngetEnvironment->end\n```\n\n\n\n\n\n### \n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\ninitDefaultProfiles=>operation: \ninitPropertySources=>operation: \ninitPropertyResolver=>operation: \ngetSystemProperty=>operation: \nwhichGetEnvironment=>condition: ?\ngetSystemEnvironment=>operation: \nstart->initDefaultProfiles\ninitDefaultProfiles->initPropertySources\ninitPropertySources->initPropertyResolver\ninitPropertyResolver->getSystemProperty\ngetSystemProperty->whichGetEnvironment\nwhichGetEnvironment(yes)->getSystemEnvironment->end\nwhichGetEnvironment(no)->end\n```\n\n\n\n### \n\n```java\nSpringProperties.setProperty(\"spring.getenv.ignore\", \"true\"); // true:\n```\n\n\n\n### \n\n```flow\nstart=>start: |:>#\nend=>end: |:>#\nhelperExists=>condition: \ncreateHepler=>operation: \ngetHelper=>operation: \nresolve=>operation: \nstart->helperExists\nhelperExists(yes)->getHelper\nhelperExists(no)->createHepler\ncreateHepler->getHelper\ngetHelper->resolve\nresolve->end\n```\n\n### \n\n\n\n","slug":"spring/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations","published":1,"updated":"2022-05-10T08:25:56.405Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pi003jxkloex6r538a","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><p></p>\n<ol>\n<li><p></p>\n<p>org.springframework.context.support.AbstractRefreshableConfigApplicationContext</p>\n</li>\n<li><p></p>\n<p>AbstractRefreshableApplicationContext</p>\n</li>\n<li><p></p>\n<p>setConfigLocations(@Nullable String locations)</p>\n</li>\n<li><p></p>\n<p></p>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-1\" class=\"flow-chart\"></div>\n\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-2\" class=\"flow-chart\"></div>\n\n\n\n\n\n<h3 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-3\" class=\"flow-chart\"></div>\n\n\n\n<h3 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SpringProperties.setProperty(<span class=\"string\">&quot;spring.getenv.ignore&quot;</span>, <span class=\"string\">&quot;true&quot;</span>); <span class=\"comment\">// true:</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-4\" class=\"flow-chart\"></div>\n\n<h3 id=\"-4\"><a href=\"#-4\" class=\"headerlink\" title=\"\"></a></h3><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nlocations=>operation: \nresolvePath=>subroutine: |:>#\ns->locations->resolvePath->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script><textarea id=\"flowchart-1-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\ngetEnvironment=>subroutine: |:># \nresolveRequiredPlaceholders=>subroutine: |:>#\ntirmSpace=>operation: \nstart->getEnvironment->resolveRequiredPlaceholders->tirmSpace->end</textarea><textarea id=\"flowchart-1-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-1-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-1-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-1\", options);</script><textarea id=\"flowchart-2-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\nenvirmonentExists=>condition: \ncreateEnvironment=>subroutine:  |:> #\ngetEnvironment=>operation: \nstart->envirmonentExists\nenvirmonentExists(yes)->getEnvironment\nenvirmonentExists(no)->createEnvironment\ncreateEnvironment->getEnvironment\ngetEnvironment->end</textarea><textarea id=\"flowchart-2-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-2-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-2-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-2\", options);</script><textarea id=\"flowchart-3-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\ninitDefaultProfiles=>operation: \ninitPropertySources=>operation: \ninitPropertyResolver=>operation: \ngetSystemProperty=>operation: \nwhichGetEnvironment=>condition: ?\ngetSystemEnvironment=>operation: \nstart->initDefaultProfiles\ninitDefaultProfiles->initPropertySources\ninitPropertySources->initPropertyResolver\ninitPropertyResolver->getSystemProperty\ngetSystemProperty->whichGetEnvironment\nwhichGetEnvironment(yes)->getSystemEnvironment->end\nwhichGetEnvironment(no)->end</textarea><textarea id=\"flowchart-3-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-3-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-3-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-3\", options);</script><textarea id=\"flowchart-4-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\nhelperExists=>condition: \ncreateHepler=>operation: \ngetHelper=>operation: \nresolve=>operation: \nstart->helperExists\nhelperExists(yes)->getHelper\nhelperExists(no)->createHepler\ncreateHepler->getHelper\ngetHelper->resolve\nresolve->end</textarea><textarea id=\"flowchart-4-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-4-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-4-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-4\", options);</script>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><p></p>\n<ol>\n<li><p></p>\n<p>org.springframework.context.support.AbstractRefreshableConfigApplicationContext</p>\n</li>\n<li><p></p>\n<p>AbstractRefreshableApplicationContext</p>\n</li>\n<li><p></p>\n<p>setConfigLocations(@Nullable String locations)</p>\n</li>\n<li><p></p>\n<p></p>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-1\" class=\"flow-chart\"></div>\n\n<h3 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-2\" class=\"flow-chart\"></div>\n\n\n\n\n\n<h3 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h3><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-3\" class=\"flow-chart\"></div>\n\n\n\n<h3 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SpringProperties.setProperty(<span class=\"string\">&quot;spring.getenv.ignore&quot;</span>, <span class=\"string\">&quot;true&quot;</span>); <span class=\"comment\">// true:</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-4\" class=\"flow-chart\"></div>\n\n<h3 id=\"-4\"><a href=\"#-4\" class=\"headerlink\" title=\"\"></a></h3><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\nlocations=>operation: \nresolvePath=>subroutine: |:>#\ns->locations->resolvePath->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script><textarea id=\"flowchart-1-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\ngetEnvironment=>subroutine: |:># \nresolveRequiredPlaceholders=>subroutine: |:>#\ntirmSpace=>operation: \nstart->getEnvironment->resolveRequiredPlaceholders->tirmSpace->end</textarea><textarea id=\"flowchart-1-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-1-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-1-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-1\", options);</script><textarea id=\"flowchart-2-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\nenvirmonentExists=>condition: \ncreateEnvironment=>subroutine:  |:> #\ngetEnvironment=>operation: \nstart->envirmonentExists\nenvirmonentExists(yes)->getEnvironment\nenvirmonentExists(no)->createEnvironment\ncreateEnvironment->getEnvironment\ngetEnvironment->end</textarea><textarea id=\"flowchart-2-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-2-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-2-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-2\", options);</script><textarea id=\"flowchart-3-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\ninitDefaultProfiles=>operation: \ninitPropertySources=>operation: \ninitPropertyResolver=>operation: \ngetSystemProperty=>operation: \nwhichGetEnvironment=>condition: ?\ngetSystemEnvironment=>operation: \nstart->initDefaultProfiles\ninitDefaultProfiles->initPropertySources\ninitPropertySources->initPropertyResolver\ninitPropertyResolver->getSystemProperty\ngetSystemProperty->whichGetEnvironment\nwhichGetEnvironment(yes)->getSystemEnvironment->end\nwhichGetEnvironment(no)->end</textarea><textarea id=\"flowchart-3-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-3-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-3-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-3\", options);</script><textarea id=\"flowchart-4-code\" style=\"display: none\">start=>start: |:>#\nend=>end: |:>#\nhelperExists=>condition: \ncreateHepler=>operation: \ngetHelper=>operation: \nresolve=>operation: \nstart->helperExists\nhelperExists(yes)->getHelper\nhelperExists(no)->createHepler\ncreateHepler->getHelper\ngetHelper->resolve\nresolve->end</textarea><textarea id=\"flowchart-4-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-4-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-4-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-4\", options);</script>"},{"title":"ClassPathXmlApplicationContext","date":"2021-05-11T07:18:32.000Z","_content":"\n### \n\n```flow\nst=>start: Start\ne=>end\ncreate=>subroutine: |:>/2021/05/11/springcarding/AbstractXmlApplicationContext-new\nset_config_path=>subroutine: |:>/2021/05/11/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations\nrefresh_content=>subroutine: bean|:>/2021/05/11/springcarding/AbstractApplicationContext-refresh\nst(right)->create(right)->set_config_path(right)->refresh_content(right)->e\n```\n\n### \n\n1. \n   1. org.springframework.context.support.AbstractXmlApplicationContext\n   2. org.springframework.context.ApplicationContext org.springframework.beans.factory.xml.XmlBeanDefinitionReader xml getConfigResources getConfigLocations  getResourceByPath   getResourcePatternResolver  \n   3. AbstractXmlApplicationContext(@Nullable ApplicationContext parent)\n   4. \n2. \n   1. org.springframework.context.support.AbstractRefreshableConfigApplicationContext\n   2. \n      AbstractRefreshableApplicationContextXML\n   3. setConfigLocations(@Nullable String... locations)\n   4. \n3. bean\n   1.   org.springframework.context.support.AbstractApplicationContext\n   2. \n   3. refresh()\n   4.   bean\n\n\n\n","source":"_posts/spring/springcarding/ClassPathXmlApplicationContext-main.md","raw":"---\ntitle: ClassPathXmlApplicationContext\ndate: 2021-05-11 15:18:32\ncategories:\n  - spring\n  - spring carding\ntags:\n  - spring\n  - spring\n---\n\n### \n\n```flow\nst=>start: Start\ne=>end\ncreate=>subroutine: |:>/2021/05/11/springcarding/AbstractXmlApplicationContext-new\nset_config_path=>subroutine: |:>/2021/05/11/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations\nrefresh_content=>subroutine: bean|:>/2021/05/11/springcarding/AbstractApplicationContext-refresh\nst(right)->create(right)->set_config_path(right)->refresh_content(right)->e\n```\n\n### \n\n1. \n   1. org.springframework.context.support.AbstractXmlApplicationContext\n   2. org.springframework.context.ApplicationContext org.springframework.beans.factory.xml.XmlBeanDefinitionReader xml getConfigResources getConfigLocations  getResourceByPath   getResourcePatternResolver  \n   3. AbstractXmlApplicationContext(@Nullable ApplicationContext parent)\n   4. \n2. \n   1. org.springframework.context.support.AbstractRefreshableConfigApplicationContext\n   2. \n      AbstractRefreshableApplicationContextXML\n   3. setConfigLocations(@Nullable String... locations)\n   4. \n3. bean\n   1.   org.springframework.context.support.AbstractApplicationContext\n   2. \n   3. refresh()\n   4.   bean\n\n\n\n","slug":"spring/springcarding/ClassPathXmlApplicationContext-main","published":1,"updated":"2022-05-10T08:25:56.407Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pj003nxklo8qzraxzl","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><ol>\n<li>org.springframework.context.support.AbstractXmlApplicationContext</li>\n<li>org.springframework.context.ApplicationContext org.springframework.beans.factory.xml.XmlBeanDefinitionReader xml getConfigResources getConfigLocations  getResourceByPath   getResourcePatternResolver  </li>\n<li>AbstractXmlApplicationContext(@Nullable ApplicationContext parent)</li>\n<li></li>\n</ol>\n</li>\n<li><ol>\n<li>org.springframework.context.support.AbstractRefreshableConfigApplicationContext</li>\n<li><br>AbstractRefreshableApplicationContextXML</li>\n<li>setConfigLocations(@Nullable String locations)</li>\n<li></li>\n</ol>\n</li>\n<li>bean<ol>\n<li>  org.springframework.context.support.AbstractApplicationContext</li>\n<li></li>\n<li>refresh()</li>\n<li>  bean</li>\n</ol>\n</li>\n</ol>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">st=>start: Start\ne=>end\ncreate=>subroutine: |:>/2021/05/11/springcarding/AbstractXmlApplicationContext-new\nset_config_path=>subroutine: |:>/2021/05/11/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations\nrefresh_content=>subroutine: bean|:>/2021/05/11/springcarding/AbstractApplicationContext-refresh\nst(right)->create(right)->set_config_path(right)->refresh_content(right)->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script>","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li><ol>\n<li>org.springframework.context.support.AbstractXmlApplicationContext</li>\n<li>org.springframework.context.ApplicationContext org.springframework.beans.factory.xml.XmlBeanDefinitionReader xml getConfigResources getConfigLocations  getResourceByPath   getResourcePatternResolver  </li>\n<li>AbstractXmlApplicationContext(@Nullable ApplicationContext parent)</li>\n<li></li>\n</ol>\n</li>\n<li><ol>\n<li>org.springframework.context.support.AbstractRefreshableConfigApplicationContext</li>\n<li><br>AbstractRefreshableApplicationContextXML</li>\n<li>setConfigLocations(@Nullable String locations)</li>\n<li></li>\n</ol>\n</li>\n<li>bean<ol>\n<li>  org.springframework.context.support.AbstractApplicationContext</li>\n<li></li>\n<li>refresh()</li>\n<li>  bean</li>\n</ol>\n</li>\n</ol>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">st=>start: Start\ne=>end\ncreate=>subroutine: |:>/2021/05/11/springcarding/AbstractXmlApplicationContext-new\nset_config_path=>subroutine: |:>/2021/05/11/springcarding/AbstractRefreshableConfigApplicationContext-setConfigLocations\nrefresh_content=>subroutine: bean|:>/2021/05/11/springcarding/AbstractApplicationContext-refresh\nst(right)->create(right)->set_config_path(right)->refresh_content(right)->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script>"},{"title":"ClassPathXmlApplicationContext","date":"2021-05-11T11:27:25.000Z","_content":"\n### \n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ngetResourceResolver=>operation: ()|:>.\nsetParent=>operation: |:>.\ns->getResourceResolver\ngetResourceResolver->setParent\nsetParent->e\n```\n\n\n###  \n\n1. ()\n   1. org.springframework.context.support.AbstractApplicationContext\n\n   2. \n\n   3. org.springframework.context.ApplicationContext\n      \n      beanApplicationContextbeanbeanbean\n\n      1. org.springframework.beans.factory.config.BeanFactoryPostProcessor BeanFactoryPostProcessors\n      2. org.springframework.beans.factory.config.BeanPostProcessor BeanPostProcessors\n      3. org.springframework.context.ApplicationListener ApplicationListeners\n\n      bean\n\n   3. \n      AbstractApplicationContext()\n   4. \n      \n2. \n   1. \n      org.springframework.context.support.AbstractApplicationContext\n   2. \n      \n   3. \n      setParent(@Nullable ApplicationContext parent)\n   4. \n      ","source":"_posts/spring/springcarding/AbstractXmlApplicationContext-new.md","raw":"---\ntitle: ClassPathXmlApplicationContext\ndate: 2021-05-11 19:27:25\ncategories:\n  - spring\n  - spring carding\ntags:\n  - spring\n  - spring\n---\n\n### \n```flow\ns=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ngetResourceResolver=>operation: ()|:>.\nsetParent=>operation: |:>.\ns->getResourceResolver\ngetResourceResolver->setParent\nsetParent->e\n```\n\n\n###  \n\n1. ()\n   1. org.springframework.context.support.AbstractApplicationContext\n\n   2. \n\n   3. org.springframework.context.ApplicationContext\n      \n      beanApplicationContextbeanbeanbean\n\n      1. org.springframework.beans.factory.config.BeanFactoryPostProcessor BeanFactoryPostProcessors\n      2. org.springframework.beans.factory.config.BeanPostProcessor BeanPostProcessors\n      3. org.springframework.context.ApplicationListener ApplicationListeners\n\n      bean\n\n   3. \n      AbstractApplicationContext()\n   4. \n      \n2. \n   1. \n      org.springframework.context.support.AbstractApplicationContext\n   2. \n      \n   3. \n      setParent(@Nullable ApplicationContext parent)\n   4. \n      ","slug":"spring/springcarding/AbstractXmlApplicationContext-new","published":1,"updated":"2022-05-10T08:25:56.406Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pj003qxklo3lz19uv4","content":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>()<ol>\n<li><p>org.springframework.context.support.AbstractApplicationContext</p>\n</li>\n<li><p></p>\n</li>\n<li><p>org.springframework.context.ApplicationContext<br><br>beanApplicationContextbeanbeanbean</p>\n<ol>\n<li>org.springframework.beans.factory.config.BeanFactoryPostProcessor BeanFactoryPostProcessors</li>\n<li>org.springframework.beans.factory.config.BeanPostProcessor BeanPostProcessors</li>\n<li>org.springframework.context.ApplicationListener ApplicationListeners</li>\n</ol>\n<p>bean</p>\n</li>\n<li><p><br>AbstractApplicationContext()</p>\n</li>\n<li><p><br></p>\n</li>\n</ol>\n</li>\n<li><ol>\n<li><br>org.springframework.context.support.AbstractApplicationContext</li>\n<li><br></li>\n<li><br>setParent(@Nullable ApplicationContext parent)</li>\n<li><br><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ngetResourceResolver=>operation: ()|:>.\nsetParent=>operation: |:>.\ns->getResourceResolver\ngetResourceResolver->setParent\nsetParent->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script></li>\n</ol>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><div id=\"flowchart-0\" class=\"flow-chart\"></div>\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>()<ol>\n<li><p>org.springframework.context.support.AbstractApplicationContext</p>\n</li>\n<li><p></p>\n</li>\n<li><p>org.springframework.context.ApplicationContext<br><br>beanApplicationContextbeanbeanbean</p>\n<ol>\n<li>org.springframework.beans.factory.config.BeanFactoryPostProcessor BeanFactoryPostProcessors</li>\n<li>org.springframework.beans.factory.config.BeanPostProcessor BeanPostProcessors</li>\n<li>org.springframework.context.ApplicationListener ApplicationListeners</li>\n</ol>\n<p>bean</p>\n</li>\n<li><p><br>AbstractApplicationContext()</p>\n</li>\n<li><p><br></p>\n</li>\n</ol>\n</li>\n<li><ol>\n<li><br>org.springframework.context.support.AbstractApplicationContext</li>\n<li><br></li>\n<li><br>setParent(@Nullable ApplicationContext parent)</li>\n<li><br><script src=\"https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js\"></script><script src=\"https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js\"></script><textarea id=\"flowchart-0-code\" style=\"display: none\">s=>start: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ne=>end: |:>/2021/05/11/springcarding/ClassPathXmlApplicationContext-main\ngetResourceResolver=>operation: ()|:>.\nsetParent=>operation: |:>.\ns->getResourceResolver\ngetResourceResolver->setParent\nsetParent->e</textarea><textarea id=\"flowchart-0-options\" style=\"display: none\">{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12}</textarea><script>  var code = document.getElementById(\"flowchart-0-code\").value;  var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value));  var diagram = flowchart.parse(code);  diagram.drawSVG(\"flowchart-0\", options);</script></li>\n</ol>\n</li>\n</ol>\n"},{"title":"","date":"2022-05-19T13:16:10.000Z","_content":"\n## \n\n\n\n\n\n## \n\n \n\n- \n- \n- \n- \n- \n- \n- \n","source":"_posts/messagequeue/kafka/eventstream.md","raw":"---\ntitle: \ndate: 2022-05-19 21:16:10\ncategories:\ntags:\n---\n\n## \n\n\n\n\n\n## \n\n \n\n- \n- \n- \n- \n- \n- \n- \n","slug":"messagequeue/kafka/eventstream","published":1,"updated":"2022-05-19T13:24:36.162Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pk003uxklo4e1o3tb7","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n"},{"title":"springboot","date":"2022-05-11T07:09:47.000Z","_content":"","source":"_posts/spring/springbootcarding/springbootcardingfirst.md","raw":"---\ntitle: springboot\ndate: 2022-05-11 15:09:47\ncategories:\n  - springboot\n  - springboot carding\ntags:\n  - springboot\n  - \n---\n","slug":"spring/springbootcarding/springbootcardingfirst","published":1,"updated":"2022-05-11T07:10:58.428Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pk003xxklo91v14sqt","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"springcloud","date":"2022-05-11T07:11:23.000Z","_content":"","source":"_posts/spring/springcloud/springcloudbase.md","raw":"---\ntitle: springcloud\ndate: 2022-05-11 15:11:23\ncategories:\n  - spring cloud\ntags:\n  - spring cloud\n  - \n---\n","slug":"spring/springcloud/springcloudbase","published":1,"updated":"2022-05-11T07:11:54.242Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pl0040xkloenhf35wd","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"rabbitmq ","date":"2022-05-11T07:08:45.000Z","_content":"\n## \n\nRabbitMQ RabbitMQ \n\nRabbitMQ  -\n\nRabbitMQ \n\n- ****\n![image](/images/rabbitmq-base/producer.png)\n- **** RabbitMQ  RabbitMQ \n![image](/images/rabbitmq-base/queue.png)\n- ****:\n![image](/images/rabbitmq-base/consumer.png)\n****\n\n## \n\n### \n\n\n![image](/images/rabbitmq-base/python-one.png)\n\n#### \n\n RabbitMQ\n![image](/images/rabbitmq-base/sending.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.nio.charset.StandardCharsets;\n\npublic class Send {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // rabbitmq\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            // \n            channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n            String message = \"Hello World!\";\n            // \n            channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n}\n```\n\n\n![images](/images/rabbitmq-base/receiving.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\nimport java.nio.charset.StandardCharsets;\n\npublic class Recv {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // \n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // ()\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n        // \n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);\n            System.out.println(\" [x] Received '\" + message + \"'\");\n        };\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> { });\n    }\n}\n```\n\n### \n\n\n**** \n Web  HTTP \n![image](/images/rabbitmq-base/python-two.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\nimport java.nio.charset.StandardCharsets;\n\npublic class Recv {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // \n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // ()\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n        // \n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);\n            System.out.println(\" [x] Received '\" + message + \"'\");\n            doWork(message);\n        };\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> { });\n    }\n\n    private void doWork(String task) {\n      for (char c: task.toCharArray()) {\n        if (c == '.') Thread.sleep(1000);\n      }\n    }\n}\n\n```\n\n#### \n\n\n\nRabbitMQ \n\n#### \n\n RabbitMQ \n\n\n\nRabbitMQ   RabbitMQ  RabbitMQ \n\n ack  TCP RabbitMQ \n\n 30 `Delivery Acknowledgement Timeout` \n\nautoAck=true false\n\n```java\nchannel.basicQos(1); // \n\nDeliverCallback deliverCallback = (consumerTag, delivery) -> {\n  String message = new String(delivery.getBody(), \"UTF-8\");\n\n  System.out.println(\" [x] Received '\" + message + \"'\");\n  try {\n    doWork(message);\n  } finally {\n    System.out.println(\" [x] Done\");\n    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n  }\n};\nboolean autoAck = false;\nchannel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, consumerTag -> { });\n```\n\n\n\n#### \n\n```java\nboolean durable = true;\n// \nchannel.queueDeclare(\"hello\", durable, false, false, null);\n```\n\n```java\nimport com.rabbitmq.client.MessageProperties;\n// MessageProperties.PERSISTENT_TEXT_PLAIN\nchannel.basicPublish(\"\", \"task_queue\",\n            MessageProperties.PERSISTENT_TEXT_PLAIN,\n            message.getBytes());\n```\n\n****\n RabbitMQ  RabbitMQ RabbitMQ `fsync(2)`  \n\n#### \n\n`prefetchCount = 1``basicQos`  RabbitMQ  worker \n![images](/images/rabbitmq-base/prefetch-count.png)\n\n```java\nint prefetchCount = 1 ; \nchannel.basicQos(prefetchCount);\n```\n\n**NewTask**\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.MessageProperties;\n\npublic class NewTask {\n\n    private static final String TASK_QUEUE_NAME = \"task_queue\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);\n\n            String message = String.join(\" \", argv);\n\n            channel.basicPublish(\"\", TASK_QUEUE_NAME,\n                    MessageProperties.PERSISTENT_TEXT_PLAIN,\n                    message.getBytes(\"UTF-8\"));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n\n}\n```\n\n**Worker**\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class Worker {\n\n    private static final String TASK_QUEUE_NAME = \"task_queue\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        final Connection connection = factory.newConnection();\n        final Channel channel = connection.createChannel();\n\n        channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n        channel.basicQos(1);\n\n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), \"UTF-8\");\n\n            System.out.println(\" [x] Received '\" + message + \"'\");\n            try {\n                doWork(message);\n            } finally {\n                System.out.println(\" [x] Done\");\n                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n            }\n        };\n        channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> { });\n    }\n\n    private static void doWork(String task) {\n        for (char ch : task.toCharArray()) {\n            if (ch == '.') {\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException _ignored) {\n                    Thread.currentThread().interrupt();\n                }\n            }\n        }\n    }\n}\n```\n\n### /\n\n\n\n#### Exchanges\n\nRabbitMQ \n\n \n![images](/images/rabbitmq-base/exchanges.png)\n\n`direct``topic``headers` `fanout``fanout`logs\n\n```java\nchannel.exchangeDeclare(\"logs\", \"fanout\");\nchannel.basicPublish( \"logs\" , \"\" , null , message.getBytes());\n```\n\nfanout\n\n#### \n\n\n\n-  Rabbit  - \n- \n\n```java\nString queueName = channel.queueDeclare().getQueue();\n```\n\n#### \n\n![images](/images/rabbitmq-base/bindings.png)\n\n\n```java\nchannel.queueBind(queueName, \"logs\" , \"\" );\n```\n\n![images](/images/rabbitmq-base/python-three-overall.png)\n`routingKey``fanout`****\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLog {\n\n    private static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n\n            String message = argv.length < 1 ? \"info: Hello World!\" :\n                    String.join(\" \", argv);\n\n            channel.basicPublish(EXCHANGE_NAME, \"\", null, message.getBytes(\"UTF-8\"));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n\n}\n\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class ReceiveLogs {\n    private static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // \n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        // \n        String queueName = channel.queueDeclare().getQueue();\n        // \n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), \"UTF-8\");\n            System.out.println(\" [x] Received '\" + message + \"'\");\n        };\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n    }\n}\n```\n\n### \n\n\n\n#### \n\n/\n\n```java\nchannel.queueBind(queueName, EXCHANGE_NAME, \"\" );\n```\n\n\n\n`routingKey``basic_publish```\n\n```java\nchannel.queueBind(queueName, EXCHANGE_NAME, \"black\" );\n```\n\n```fanout`\n\n#### \n\n`direct`````\n![images](/images/rabbitmq-base/direct-exchange.png)\n``X`orange``black``green`\n\n`orange`Q1`black``green`Q2\n\n##### \n\n![images](/images/rabbitmq-base/direct-exchange-multiple.png)\n`fanout``black``Q1``Q2`\n\n##### \n\n![images](/images/rabbitmq-base/python-four.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLogDirect {\n\n  private static final String EXCHANGE_NAME = \"direct_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    try (Connection connection = factory.newConnection();\n         Channel channel = connection.createChannel()) {\n        channel.exchangeDeclare(EXCHANGE_NAME, \"direct\");\n\n        String severity = getSeverity(argv);\n        String message = getMessage(argv);\n\n        channel.basicPublish(EXCHANGE_NAME, severity, null, message.getBytes(\"UTF-8\"));\n        System.out.println(\" [x] Sent '\" + severity + \"':'\" + message + \"'\");\n    }\n  }\n  //..\n}\n\n\nimport com.rabbitmq.client.*;\n\npublic class ReceiveLogsDirect {\n\n  private static final String EXCHANGE_NAME = \"direct_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    Connection connection = factory.newConnection();\n    Channel channel = connection.createChannel();\n\n    channel.exchangeDeclare(EXCHANGE_NAME, \"direct\");\n    String queueName = channel.queueDeclare().getQueue();\n\n    if (argv.length < 1) {\n        System.err.println(\"Usage: ReceiveLogsDirect [info] [warning] [error]\");\n        System.exit(1);\n    }\n\n    for (String severity : argv) {\n        channel.queueBind(queueName, EXCHANGE_NAME, severity);\n    }\n    System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n    DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n        String message = new String(delivery.getBody(), \"UTF-8\");\n        System.out.println(\" [x] Received '\" +\n            delivery.getEnvelope().getRoutingKey() + \"':'\" + message + \"'\");\n    };\n    channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n  }\n}\n```\n\n### \n\n#### \n\n`` `routing_key` - \"stock.usd.nyse\"\"nyse.vmw\"\"quick.orange.rabbit\"`255`\n\n````--\n\n- `*`\n- `#` (hash) \n\n![images](/images/rabbitmq-base/python-five.png)\n\n`<speed>.<colour>.<species>`\nQ1  *.orange.* Q2  *.*.rabbit  lazy.# \n\n`Q1`\n`Q2`\n`quick.orange.rabbit``lazy.orange.elephant``quick.orange.fox``Q1``lazy.brown.fox``Q2``lazy.pink.rabbit``Q2``quick.brown.fox` \n\n\"orange\"\"quick.orange.male.rabbit\"\"lazy.orange.male.rabbit\"`Q2`\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLogTopic {\n\n  private static final String EXCHANGE_NAME = \"topic_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    try (Connection connection = factory.newConnection();\n         Channel channel = connection.createChannel()) {\n\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n\n        String routingKey = getRouting(argv);\n        String message = getMessage(argv);\n\n        channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(\"UTF-8\"));\n        System.out.println(\" [x] Sent '\" + routingKey + \"':'\" + message + \"'\");\n    }\n  }\n  //..\n}\n\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class ReceiveLogsTopic {\n\n  private static final String EXCHANGE_NAME = \"topic_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    Connection connection = factory.newConnection();\n    Channel channel = connection.createChannel();\n\n    channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n    String queueName = channel.queueDeclare().getQueue();\n\n    if (argv.length < 1) {\n        System.err.println(\"Usage: ReceiveLogsTopic [binding_key]...\");\n        System.exit(1);\n    }\n\n    for (String bindingKey : argv) {\n        channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);\n    }\n\n    System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n    DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n        String message = new String(delivery.getBody(), \"UTF-8\");\n        System.out.println(\" [x] Received '\" +\n            delivery.getEnvelope().getRoutingKey() + \"':'\" + message + \"'\");\n    };\n    channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n  }\n}\n```\n\n### RPC\n\n---\n\n[](https://www.rabbitmq.com/)\n[](https://www.rabbitmq.com/configure.html)\n","source":"_posts/messagequeue/rabbitmq/rabbitmqbase.md","raw":"---\ntitle: rabbitmq \ndate: 2022-05-11 15:08:45\ncategories:\n  - rabbitmq\n  - queue\ntags:\n  - rabbitmq\n  - queue\n---\n\n## \n\nRabbitMQ RabbitMQ \n\nRabbitMQ  -\n\nRabbitMQ \n\n- ****\n![image](/images/rabbitmq-base/producer.png)\n- **** RabbitMQ  RabbitMQ \n![image](/images/rabbitmq-base/queue.png)\n- ****:\n![image](/images/rabbitmq-base/consumer.png)\n****\n\n## \n\n### \n\n\n![image](/images/rabbitmq-base/python-one.png)\n\n#### \n\n RabbitMQ\n![image](/images/rabbitmq-base/sending.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.nio.charset.StandardCharsets;\n\npublic class Send {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // rabbitmq\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            // \n            channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n            String message = \"Hello World!\";\n            // \n            channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n}\n```\n\n\n![images](/images/rabbitmq-base/receiving.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\nimport java.nio.charset.StandardCharsets;\n\npublic class Recv {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // \n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // ()\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n        // \n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);\n            System.out.println(\" [x] Received '\" + message + \"'\");\n        };\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> { });\n    }\n}\n```\n\n### \n\n\n**** \n Web  HTTP \n![image](/images/rabbitmq-base/python-two.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\nimport java.nio.charset.StandardCharsets;\n\npublic class Recv {\n\n    private final static String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] argv) throws Exception {\n        // \n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // ()\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n        // \n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);\n            System.out.println(\" [x] Received '\" + message + \"'\");\n            doWork(message);\n        };\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> { });\n    }\n\n    private void doWork(String task) {\n      for (char c: task.toCharArray()) {\n        if (c == '.') Thread.sleep(1000);\n      }\n    }\n}\n\n```\n\n#### \n\n\n\nRabbitMQ \n\n#### \n\n RabbitMQ \n\n\n\nRabbitMQ   RabbitMQ  RabbitMQ \n\n ack  TCP RabbitMQ \n\n 30 `Delivery Acknowledgement Timeout` \n\nautoAck=true false\n\n```java\nchannel.basicQos(1); // \n\nDeliverCallback deliverCallback = (consumerTag, delivery) -> {\n  String message = new String(delivery.getBody(), \"UTF-8\");\n\n  System.out.println(\" [x] Received '\" + message + \"'\");\n  try {\n    doWork(message);\n  } finally {\n    System.out.println(\" [x] Done\");\n    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n  }\n};\nboolean autoAck = false;\nchannel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, consumerTag -> { });\n```\n\n\n\n#### \n\n```java\nboolean durable = true;\n// \nchannel.queueDeclare(\"hello\", durable, false, false, null);\n```\n\n```java\nimport com.rabbitmq.client.MessageProperties;\n// MessageProperties.PERSISTENT_TEXT_PLAIN\nchannel.basicPublish(\"\", \"task_queue\",\n            MessageProperties.PERSISTENT_TEXT_PLAIN,\n            message.getBytes());\n```\n\n****\n RabbitMQ  RabbitMQ RabbitMQ `fsync(2)`  \n\n#### \n\n`prefetchCount = 1``basicQos`  RabbitMQ  worker \n![images](/images/rabbitmq-base/prefetch-count.png)\n\n```java\nint prefetchCount = 1 ; \nchannel.basicQos(prefetchCount);\n```\n\n**NewTask**\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.MessageProperties;\n\npublic class NewTask {\n\n    private static final String TASK_QUEUE_NAME = \"task_queue\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);\n\n            String message = String.join(\" \", argv);\n\n            channel.basicPublish(\"\", TASK_QUEUE_NAME,\n                    MessageProperties.PERSISTENT_TEXT_PLAIN,\n                    message.getBytes(\"UTF-8\"));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n\n}\n```\n\n**Worker**\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class Worker {\n\n    private static final String TASK_QUEUE_NAME = \"task_queue\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        final Connection connection = factory.newConnection();\n        final Channel channel = connection.createChannel();\n\n        channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n        channel.basicQos(1);\n\n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), \"UTF-8\");\n\n            System.out.println(\" [x] Received '\" + message + \"'\");\n            try {\n                doWork(message);\n            } finally {\n                System.out.println(\" [x] Done\");\n                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n            }\n        };\n        channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> { });\n    }\n\n    private static void doWork(String task) {\n        for (char ch : task.toCharArray()) {\n            if (ch == '.') {\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException _ignored) {\n                    Thread.currentThread().interrupt();\n                }\n            }\n        }\n    }\n}\n```\n\n### /\n\n\n\n#### Exchanges\n\nRabbitMQ \n\n \n![images](/images/rabbitmq-base/exchanges.png)\n\n`direct``topic``headers` `fanout``fanout`logs\n\n```java\nchannel.exchangeDeclare(\"logs\", \"fanout\");\nchannel.basicPublish( \"logs\" , \"\" , null , message.getBytes());\n```\n\nfanout\n\n#### \n\n\n\n-  Rabbit  - \n- \n\n```java\nString queueName = channel.queueDeclare().getQueue();\n```\n\n#### \n\n![images](/images/rabbitmq-base/bindings.png)\n\n\n```java\nchannel.queueBind(queueName, \"logs\" , \"\" );\n```\n\n![images](/images/rabbitmq-base/python-three-overall.png)\n`routingKey``fanout`****\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLog {\n\n    private static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        try (Connection connection = factory.newConnection();\n             Channel channel = connection.createChannel()) {\n            channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n\n            String message = argv.length < 1 ? \"info: Hello World!\" :\n                    String.join(\" \", argv);\n\n            channel.basicPublish(EXCHANGE_NAME, \"\", null, message.getBytes(\"UTF-8\"));\n            System.out.println(\" [x] Sent '\" + message + \"'\");\n        }\n    }\n\n}\n\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class ReceiveLogs {\n    private static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] argv) throws Exception {\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"localhost\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        // \n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        // \n        String queueName = channel.queueDeclare().getQueue();\n        // \n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n\n        System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n        DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n            String message = new String(delivery.getBody(), \"UTF-8\");\n            System.out.println(\" [x] Received '\" + message + \"'\");\n        };\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n    }\n}\n```\n\n### \n\n\n\n#### \n\n/\n\n```java\nchannel.queueBind(queueName, EXCHANGE_NAME, \"\" );\n```\n\n\n\n`routingKey``basic_publish```\n\n```java\nchannel.queueBind(queueName, EXCHANGE_NAME, \"black\" );\n```\n\n```fanout`\n\n#### \n\n`direct`````\n![images](/images/rabbitmq-base/direct-exchange.png)\n``X`orange``black``green`\n\n`orange`Q1`black``green`Q2\n\n##### \n\n![images](/images/rabbitmq-base/direct-exchange-multiple.png)\n`fanout``black``Q1``Q2`\n\n##### \n\n![images](/images/rabbitmq-base/python-four.png)\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLogDirect {\n\n  private static final String EXCHANGE_NAME = \"direct_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    try (Connection connection = factory.newConnection();\n         Channel channel = connection.createChannel()) {\n        channel.exchangeDeclare(EXCHANGE_NAME, \"direct\");\n\n        String severity = getSeverity(argv);\n        String message = getMessage(argv);\n\n        channel.basicPublish(EXCHANGE_NAME, severity, null, message.getBytes(\"UTF-8\"));\n        System.out.println(\" [x] Sent '\" + severity + \"':'\" + message + \"'\");\n    }\n  }\n  //..\n}\n\n\nimport com.rabbitmq.client.*;\n\npublic class ReceiveLogsDirect {\n\n  private static final String EXCHANGE_NAME = \"direct_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    Connection connection = factory.newConnection();\n    Channel channel = connection.createChannel();\n\n    channel.exchangeDeclare(EXCHANGE_NAME, \"direct\");\n    String queueName = channel.queueDeclare().getQueue();\n\n    if (argv.length < 1) {\n        System.err.println(\"Usage: ReceiveLogsDirect [info] [warning] [error]\");\n        System.exit(1);\n    }\n\n    for (String severity : argv) {\n        channel.queueBind(queueName, EXCHANGE_NAME, severity);\n    }\n    System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n    DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n        String message = new String(delivery.getBody(), \"UTF-8\");\n        System.out.println(\" [x] Received '\" +\n            delivery.getEnvelope().getRoutingKey() + \"':'\" + message + \"'\");\n    };\n    channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n  }\n}\n```\n\n### \n\n#### \n\n`` `routing_key` - \"stock.usd.nyse\"\"nyse.vmw\"\"quick.orange.rabbit\"`255`\n\n````--\n\n- `*`\n- `#` (hash) \n\n![images](/images/rabbitmq-base/python-five.png)\n\n`<speed>.<colour>.<species>`\nQ1  *.orange.* Q2  *.*.rabbit  lazy.# \n\n`Q1`\n`Q2`\n`quick.orange.rabbit``lazy.orange.elephant``quick.orange.fox``Q1``lazy.brown.fox``Q2``lazy.pink.rabbit``Q2``quick.brown.fox` \n\n\"orange\"\"quick.orange.male.rabbit\"\"lazy.orange.male.rabbit\"`Q2`\n\n```java\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\npublic class EmitLogTopic {\n\n  private static final String EXCHANGE_NAME = \"topic_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    try (Connection connection = factory.newConnection();\n         Channel channel = connection.createChannel()) {\n\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n\n        String routingKey = getRouting(argv);\n        String message = getMessage(argv);\n\n        channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(\"UTF-8\"));\n        System.out.println(\" [x] Sent '\" + routingKey + \"':'\" + message + \"'\");\n    }\n  }\n  //..\n}\n\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport com.rabbitmq.client.DeliverCallback;\n\npublic class ReceiveLogsTopic {\n\n  private static final String EXCHANGE_NAME = \"topic_logs\";\n\n  public static void main(String[] argv) throws Exception {\n    ConnectionFactory factory = new ConnectionFactory();\n    factory.setHost(\"localhost\");\n    Connection connection = factory.newConnection();\n    Channel channel = connection.createChannel();\n\n    channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n    String queueName = channel.queueDeclare().getQueue();\n\n    if (argv.length < 1) {\n        System.err.println(\"Usage: ReceiveLogsTopic [binding_key]...\");\n        System.exit(1);\n    }\n\n    for (String bindingKey : argv) {\n        channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);\n    }\n\n    System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\");\n\n    DeliverCallback deliverCallback = (consumerTag, delivery) -> {\n        String message = new String(delivery.getBody(), \"UTF-8\");\n        System.out.println(\" [x] Received '\" +\n            delivery.getEnvelope().getRoutingKey() + \"':'\" + message + \"'\");\n    };\n    channel.basicConsume(queueName, true, deliverCallback, consumerTag -> { });\n  }\n}\n```\n\n### RPC\n\n---\n\n[](https://www.rabbitmq.com/)\n[](https://www.rabbitmq.com/configure.html)\n","slug":"messagequeue/rabbitmq/rabbitmqbase","published":1,"updated":"2022-05-24T07:50:58.740Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pl0043xklobx457xho","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>RabbitMQ RabbitMQ </p>\n<p>RabbitMQ  -</p>\n<p>RabbitMQ </p>\n<ul>\n<li><strong></strong><br><img src=\"/images/rabbitmq-base/producer.png\" alt=\"image\"></li>\n<li><strong></strong> RabbitMQ  RabbitMQ <br><img src=\"/images/rabbitmq-base/queue.png\" alt=\"image\"></li>\n<li><strong></strong>:<br><img src=\"/images/rabbitmq-base/consumer.png\" alt=\"image\"><br><strong></strong></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br><img src=\"/images/rabbitmq-base/python-one.png\" alt=\"image\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RabbitMQ<br><img src=\"/images/rabbitmq-base/sending.png\" alt=\"image\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Send</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// rabbitmq</span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Hello World!&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, QUEUE_NAME, <span class=\"literal\">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><br><img src=\"/images/rabbitmq-base/receiving.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recv</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// ()</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), StandardCharsets.UTF_8);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br><strong></strong> <br> Web  HTTP <br><img src=\"/images/rabbitmq-base/python-two.png\" alt=\"image\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recv</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// ()</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), StandardCharsets.UTF_8);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">            doWork(message);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doWork</span><span class=\"params\">(String task)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"type\">char</span> c: task.toCharArray()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"string\">&#x27;.&#x27;</span>) Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><br>RabbitMQ </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RabbitMQ </p>\n<p></p>\n<p>RabbitMQ   RabbitMQ  RabbitMQ </p>\n<p> ack  TCP RabbitMQ </p>\n<p> 30 <code>Delivery Acknowledgement Timeout</code> </p>\n<p>autoAck&#x3D;true false</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.basicQos(<span class=\"number\">1</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    doWork(message);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [x] Done&quot;</span>);</span><br><span class=\"line\">    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">autoAck</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">durable</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">channel.queueDeclare(<span class=\"string\">&quot;hello&quot;</span>, durable, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class=\"line\"><span class=\"comment\">// MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\">channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;task_queue&quot;</span>,</span><br><span class=\"line\">            MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class=\"line\">            message.getBytes());</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong><br> RabbitMQ  RabbitMQ RabbitMQ <code>fsync(2)</code>  </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code>prefetchCount = 1</code><code>basicQos</code>  RabbitMQ  worker <br><img src=\"/images/rabbitmq-base/prefetch-count.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">prefetchCount</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> ; </span><br><span class=\"line\">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure>\n\n<p><strong>NewTask</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NewTask</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TASK_QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> String.join(<span class=\"string\">&quot; &quot;</span>, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, TASK_QUEUE_NAME,</span><br><span class=\"line\">                    MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class=\"line\">                    message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Worker</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Worker</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TASK_QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicQos(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                doWork(message);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [x] Done&quot;</span>);</span><br><span class=\"line\">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(TASK_QUEUE_NAME, <span class=\"literal\">false</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doWork</span><span class=\"params\">(String task)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">char</span> ch : task.toCharArray()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ch == <span class=\"string\">&#x27;.&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException _ignored) &#123;</span><br><span class=\"line\">                    Thread.currentThread().interrupt();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-x2F-\"><a href=\"#-x2F-\" class=\"headerlink\" title=\"&#x2F;\"></a>&#x2F;</h3><p></p>\n<h4 id=\"Exchanges\"><a href=\"#Exchanges\" class=\"headerlink\" title=\"Exchanges\"></a>Exchanges</h4><p>RabbitMQ </p>\n<p> <br><img src=\"/images/rabbitmq-base/exchanges.png\" alt=\"images\"></p>\n<p><code>direct</code><code>topic</code><code>headers</code> <code>fanout</code><code>fanout</code>logs</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.exchangeDeclare(<span class=\"string\">&quot;logs&quot;</span>, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">channel.basicPublish( <span class=\"string\">&quot;logs&quot;</span> , <span class=\"string\">&quot;&quot;</span> , <span class=\"literal\">null</span> , message.getBytes());</span><br></pre></td></tr></table></figure>\n\n<p>fanout</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ul>\n<li> Rabbit  - </li>\n<li></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"/images/rabbitmq-base/bindings.png\" alt=\"images\"><br></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, <span class=\"string\">&quot;logs&quot;</span> , <span class=\"string\">&quot;&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/rabbitmq-base/python-three-overall.png\" alt=\"images\"><br><code>routingKey</code><code>fanout</code><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLog</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> argv.length &lt; <span class=\"number\">1</span> ? <span class=\"string\">&quot;info: Hello World!&quot;</span> :</span><br><span class=\"line\">                    String.join(<span class=\"string\">&quot; &quot;</span>, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">            channel.basicPublish(EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogs</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>&#x2F;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>routingKey</code><code>basic_publish</code><code></code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;black&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p><code></code><code>fanout</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code>direct</code><code></code><code></code><br><img src=\"/images/rabbitmq-base/direct-exchange.png\" alt=\"images\"><br><code></code>X<code>orange</code><code>black</code><code>green</code></p>\n<p><code>orange</code>Q1<code>black</code><code>green</code>Q2</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><img src=\"/images/rabbitmq-base/direct-exchange-multiple.png\" alt=\"images\"><br><code>fanout</code><code>black</code><code>Q1</code><code>Q2</code></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><img src=\"/images/rabbitmq-base/python-four.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLogDirect</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">         <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;direct&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">severity</span> <span class=\"operator\">=</span> getSeverity(argv);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> getMessage(argv);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, severity, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + severity + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogsDirect</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">    <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">    channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;direct&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argv.length &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">&quot;Usage: ReceiveLogsDirect [info] [warning] [error]&quot;</span>);</span><br><span class=\"line\">        System.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String severity : argv) &#123;</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, severity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> +</span><br><span class=\"line\">            delivery.getEnvelope().getRoutingKey() + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code></code> <code>routing_key</code> - stock.usd.nysenyse.vmwquick.orange.rabbit<code>255</code></p>\n<p><code></code><code></code></p>\n<ul>\n<li><code>*</code></li>\n<li><code>#</code> (hash) </li>\n</ul>\n<p><img src=\"/images/rabbitmq-base/python-five.png\" alt=\"images\"></p>\n<p><code>&lt;speed&gt;.&lt;colour&gt;.&lt;species&gt;</code><br>Q1  <em>.orange.</em> Q2  <em>.</em>.rabbit  lazy.# <br><br><code>Q1</code><br><code>Q2</code><br><code>quick.orange.rabbit</code><code>lazy.orange.elephant</code><code>quick.orange.fox</code><code>Q1</code><code>lazy.brown.fox</code><code>Q2</code><code>lazy.pink.rabbit</code><code>Q2</code><code>quick.brown.fox</code> </p>\n<p>orangequick.orange.male.rabbitlazy.orange.male.rabbit<code>Q2</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLogTopic</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">         <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;topic&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">routingKey</span> <span class=\"operator\">=</span> getRouting(argv);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> getMessage(argv);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, routingKey, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + routingKey + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogsTopic</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">    <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">    channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;topic&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argv.length &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">&quot;Usage: ReceiveLogsTopic [binding_key]...&quot;</span>);</span><br><span class=\"line\">        System.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String bindingKey : argv) &#123;</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> +</span><br><span class=\"line\">            delivery.getEnvelope().getRoutingKey() + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h3><hr>\n<p><a href=\"https://www.rabbitmq.com/\"></a><br><a href=\"https://www.rabbitmq.com/configure.html\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>RabbitMQ RabbitMQ </p>\n<p>RabbitMQ  -</p>\n<p>RabbitMQ </p>\n<ul>\n<li><strong></strong><br><img src=\"/images/rabbitmq-base/producer.png\" alt=\"image\"></li>\n<li><strong></strong> RabbitMQ  RabbitMQ <br><img src=\"/images/rabbitmq-base/queue.png\" alt=\"image\"></li>\n<li><strong></strong>:<br><img src=\"/images/rabbitmq-base/consumer.png\" alt=\"image\"><br><strong></strong></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br><img src=\"/images/rabbitmq-base/python-one.png\" alt=\"image\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RabbitMQ<br><img src=\"/images/rabbitmq-base/sending.png\" alt=\"image\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Send</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// rabbitmq</span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Hello World!&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, QUEUE_NAME, <span class=\"literal\">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><br><img src=\"/images/rabbitmq-base/receiving.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recv</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// ()</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), StandardCharsets.UTF_8);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br><strong></strong> <br> Web  HTTP <br><img src=\"/images/rabbitmq-base/python-two.png\" alt=\"image\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Recv</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// ()</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), StandardCharsets.UTF_8);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">            doWork(message);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doWork</span><span class=\"params\">(String task)</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"type\">char</span> c: task.toCharArray()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c == <span class=\"string\">&#x27;.&#x27;</span>) Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><br>RabbitMQ </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> RabbitMQ </p>\n<p></p>\n<p>RabbitMQ   RabbitMQ  RabbitMQ </p>\n<p> ack  TCP RabbitMQ </p>\n<p> 30 <code>Delivery Acknowledgement Timeout</code> </p>\n<p>autoAck&#x3D;true false</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.basicQos(<span class=\"number\">1</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    doWork(message);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [x] Done&quot;</span>);</span><br><span class=\"line\">    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">autoAck</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">boolean</span> <span class=\"variable\">durable</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">channel.queueDeclare(<span class=\"string\">&quot;hello&quot;</span>, durable, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class=\"line\"><span class=\"comment\">// MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\">channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;task_queue&quot;</span>,</span><br><span class=\"line\">            MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class=\"line\">            message.getBytes());</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong><br> RabbitMQ  RabbitMQ RabbitMQ <code>fsync(2)</code>  </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code>prefetchCount = 1</code><code>basicQos</code>  RabbitMQ  worker <br><img src=\"/images/rabbitmq-base/prefetch-count.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">prefetchCount</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> ; </span><br><span class=\"line\">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure>\n\n<p><strong>NewTask</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.MessageProperties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NewTask</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TASK_QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> String.join(<span class=\"string\">&quot; &quot;</span>, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, TASK_QUEUE_NAME,</span><br><span class=\"line\">                    MessageProperties.PERSISTENT_TEXT_PLAIN,</span><br><span class=\"line\">                    message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Worker</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Worker</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TASK_QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"literal\">true</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicQos(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                doWork(message);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [x] Done&quot;</span>);</span><br><span class=\"line\">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(TASK_QUEUE_NAME, <span class=\"literal\">false</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doWork</span><span class=\"params\">(String task)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">char</span> ch : task.toCharArray()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ch == <span class=\"string\">&#x27;.&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException _ignored) &#123;</span><br><span class=\"line\">                    Thread.currentThread().interrupt();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"-x2F-\"><a href=\"#-x2F-\" class=\"headerlink\" title=\"&#x2F;\"></a>&#x2F;</h3><p></p>\n<h4 id=\"Exchanges\"><a href=\"#Exchanges\" class=\"headerlink\" title=\"Exchanges\"></a>Exchanges</h4><p>RabbitMQ </p>\n<p> <br><img src=\"/images/rabbitmq-base/exchanges.png\" alt=\"images\"></p>\n<p><code>direct</code><code>topic</code><code>headers</code> <code>fanout</code><code>fanout</code>logs</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.exchangeDeclare(<span class=\"string\">&quot;logs&quot;</span>, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">channel.basicPublish( <span class=\"string\">&quot;logs&quot;</span> , <span class=\"string\">&quot;&quot;</span> , <span class=\"literal\">null</span> , message.getBytes());</span><br></pre></td></tr></table></figure>\n\n<p>fanout</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p></p>\n<ul>\n<li> Rabbit  - </li>\n<li></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"/images/rabbitmq-base/bindings.png\" alt=\"images\"><br></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, <span class=\"string\">&quot;logs&quot;</span> , <span class=\"string\">&quot;&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/rabbitmq-base/python-three-overall.png\" alt=\"images\"><br><code>routingKey</code><code>fanout</code><strong></strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLog</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">             <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">            channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> argv.length &lt; <span class=\"number\">1</span> ? <span class=\"string\">&quot;info: Hello World!&quot;</span> :</span><br><span class=\"line\">                    String.join(<span class=\"string\">&quot; &quot;</span>, argv);</span><br><span class=\"line\"></span><br><span class=\"line\">            channel.basicPublish(EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogs</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>&#x2F;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>routingKey</code><code>basic_publish</code><code></code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;black&quot;</span> );</span><br></pre></td></tr></table></figure>\n\n<p><code></code><code>fanout</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code>direct</code><code></code><code></code><br><img src=\"/images/rabbitmq-base/direct-exchange.png\" alt=\"images\"><br><code></code>X<code>orange</code><code>black</code><code>green</code></p>\n<p><code>orange</code>Q1<code>black</code><code>green</code>Q2</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><img src=\"/images/rabbitmq-base/direct-exchange-multiple.png\" alt=\"images\"><br><code>fanout</code><code>black</code><code>Q1</code><code>Q2</code></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p><img src=\"/images/rabbitmq-base/python-four.png\" alt=\"images\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLogDirect</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">         <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;direct&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">severity</span> <span class=\"operator\">=</span> getSeverity(argv);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> getMessage(argv);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, severity, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + severity + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogsDirect</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">    <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">    channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;direct&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argv.length &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">&quot;Usage: ReceiveLogsDirect [info] [warning] [error]&quot;</span>);</span><br><span class=\"line\">        System.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String severity : argv) &#123;</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, severity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> +</span><br><span class=\"line\">            delivery.getEnvelope().getRoutingKey() + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><code></code> <code>routing_key</code> - stock.usd.nysenyse.vmwquick.orange.rabbit<code>255</code></p>\n<p><code></code><code></code></p>\n<ul>\n<li><code>*</code></li>\n<li><code>#</code> (hash) </li>\n</ul>\n<p><img src=\"/images/rabbitmq-base/python-five.png\" alt=\"images\"></p>\n<p><code>&lt;speed&gt;.&lt;colour&gt;.&lt;species&gt;</code><br>Q1  <em>.orange.</em> Q2  <em>.</em>.rabbit  lazy.# <br><br><code>Q1</code><br><code>Q2</code><br><code>quick.orange.rabbit</code><code>lazy.orange.elephant</code><code>quick.orange.fox</code><code>Q1</code><code>lazy.brown.fox</code><code>Q2</code><code>lazy.pink.rabbit</code><code>Q2</code><code>quick.brown.fox</code> </p>\n<p>orangequick.orange.male.rabbitlazy.orange.male.rabbit<code>Q2</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">EmitLogTopic</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">         <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;topic&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">routingKey</span> <span class=\"operator\">=</span> getRouting(argv);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> getMessage(argv);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, routingKey, <span class=\"literal\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + routingKey + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DeliverCallback;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReceiveLogsTopic</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">EXCHANGE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">    <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">    factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">    <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">    channel.exchangeDeclare(EXCHANGE_NAME, <span class=\"string\">&quot;topic&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">queueName</span> <span class=\"operator\">=</span> channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argv.length &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">&quot;Usage: ReceiveLogsTopic [binding_key]...&quot;</span>);</span><br><span class=\"line\">        System.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String bindingKey : argv) &#123;</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, bindingKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; [*] Waiting for messages. To exit press CTRL+C&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">DeliverCallback</span> <span class=\"variable\">deliverCallback</span> <span class=\"operator\">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(delivery.getBody(), <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Received &#x27;&quot;</span> +</span><br><span class=\"line\">            delivery.getEnvelope().getRoutingKey() + <span class=\"string\">&quot;&#x27;:&#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    channel.basicConsume(queueName, <span class=\"literal\">true</span>, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h3><hr>\n<p><a href=\"https://www.rabbitmq.com/\"></a><br><a href=\"https://www.rabbitmq.com/configure.html\"></a></p>\n"},{"title":"shiro ","date":"2021-06-15T12:10:55.000Z","_content":"\nSubject, SecurityManager  Realms.\n\nSubjectShiroSubjectDaemon AccountShiro SubjectSecurityManager\n\nSecurityManagerShiroFacadeShiroSecurityManager\n\nRealm RealmShiroShiroRealm RealmDAOShiroShiroRealmRealm ShiroRealmLDAPJDBCINIRealmRealm\n\n\n\n1. Authentication/()\n2. Authorization\n3. Session Managersession\n4. Cryptography\n5. Web SupportWebWeb\n6. Cachingredis\n7. Concurrency\n8. Testing\n9. Run As\n10. Remember Me\n\n[](https://shiro.apache.org/architecture.html)\n\n> The following diagram shows Shiros core architectural concepts followed by short summaries of each:\n>\n> ![images](/images/shiro/ShiroArchitecture.png)\n>\n> - Subject (org.apache.shiro.subject.Subject)\n>\n> A security-specific view of the entity (user, 3rd-party service, cron job, etc) currently interacting with the software.\n>\n> - SecurityManager (org.apache.shiro.mgt.SecurityManager)\n>\n> As mentioned above, the SecurityManager is the heart of Shiros architecture. It is mostly an umbrella object that coordinates its managed components to ensure they work smoothly together. It also manages Shiros view of every application user, so it knows how to perform security operations per user.\n>\n> - Authenticator (org.apache.shiro.authc.Authenticator)\n>\n> The Authenticator is the component that is responsible for executing and reacting to authentication (log-in) attempts by users. When a user tries to log-in, that logic is executed by the Authenticator. The Authenticator knows how to coordinate with one or more Realms that store relevant user/account information. The data obtained from these Realms is used to verify the users identity to guarantee the user really is who they say they are.\n>\n> - Authentication Strategy (org.apache.shiro.authc.pam.AuthenticationStrategy)\n>\n> If more than one Realm is configured, the AuthenticationStrategy will coordinate the Realms to determine the conditions under which an authentication attempt succeeds or fails (for example, if one realm succeeds but others fail, is the attempt successful? Must all realms succeed? Only the first?).\n>\n> - Authorizer (org.apache.shiro.authz.Authorizer)\n>\n> The Authorizer is the component responsible determining users access control in the application. It is the mechanism that ultimately says if a user is allowed to do something or not. Like the Authenticator, the Authorizer also knows how to coordinate with multiple back-end data sources to access role and permission information. The Authorizer uses this information to determine exactly if a user is allowed to perform a given action.\n>\n> - SessionManager (org.apache.shiro.session.mgt.SessionManager)\n>\n> The SessionManager knows how to create and manage user Session lifecycles to provide a robust Session experience for users in all environments. This is a unique feature in the world of security frameworks - Shiro has the ability to natively manage user Sessions in any environment, even if there is no Web/Servlet or EJB container available. By default, Shiro will use an existing session mechanism if available, (e.g. Servlet Container), but if there isnt one, such as in a standalone application or non-web environment, it will use its built-in enterprise session management to offer the same programming experience. The SessionDAO exists to allow any datasource to be used to persist sessions.\n>\n> - SessionDAO (org.apache.shiro.session.mgt.eis.SessionDAO)\n>\n> The SessionDAO performs Session persistence (CRUD) operations on behalf of the SessionManager. This allows any data store to be plugged in to the Session Management infrastructure.\n>\n> - CacheManager (org.apache.shiro.cache.CacheManager) The CacheManager creates and manages Cache instance lifecycles used by other Shiro components. Because Shiro can access many back-end data sources for authentication, authorization and session management, caching has always been a first-class architectural feature in the framework to improve performance while using these data sources. Any of the modern open-source and/or enterprise caching products can be plugged in to Shiro to provide a fast and efficient user-experience.\n> - Cryptography (org.apache.shiro.crypto.*)\n>\n> Cryptography is a natural addition to an enterprise security framework. Shiros crypto package contains easy-to-use and understand representations of crytographic Ciphers, Hashes (aka digests) and different codec implementations. All of the classes in this package are carefully designed to be very easy to use and easy to understand. Anyone who has used Javas native cryptography support knows it can be a challenging animal to tame. Shiros crypto APIs simplify the complicated Java mechanisms and make cryptography easy to use for normal mortal human beings.\n>\n> - Realms (org.apache.shiro.realm.Realm)\n>\n> As mentioned above, Realms act as the bridge or connector between Shiro and your applications security data. When it comes time to actually interact with security-related data like user accounts to perform authentication (login) and authorization (access control), Shiro looks up many of these things from one or more Realms configured for an application. You can configure as many Realms as you need (usually one per data source) and Shiro will coordinate with them as necessary for both authentication and authorization.\n\n\n\n\n\n|  |  |\n| :--: | :--: |\n| anon |  |\n| authc | () |\n| authcBasic | httpBasic |\n| perms |  perms[user:add:] |\n| port | port[8081] schemal://serverName:8081?queryString |\n| rest |  |\n| roles |  |\n| ssl | url |\n| user |  |\n| ... |  |\n\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_base)\n\n","source":"_posts/spring/springboot/shiro/shiro-base.md","raw":"---\ntitle: shiro \ndate: 2021-06-15 20:10:55\ncategories:\n  - spring\n  - springboot\n  - shiro\ntags:\n  - springboot\n  - shiro\n---\n\nSubject, SecurityManager  Realms.\n\nSubjectShiroSubjectDaemon AccountShiro SubjectSecurityManager\n\nSecurityManagerShiroFacadeShiroSecurityManager\n\nRealm RealmShiroShiroRealm RealmDAOShiroShiroRealmRealm ShiroRealmLDAPJDBCINIRealmRealm\n\n\n\n1. Authentication/()\n2. Authorization\n3. Session Managersession\n4. Cryptography\n5. Web SupportWebWeb\n6. Cachingredis\n7. Concurrency\n8. Testing\n9. Run As\n10. Remember Me\n\n[](https://shiro.apache.org/architecture.html)\n\n> The following diagram shows Shiros core architectural concepts followed by short summaries of each:\n>\n> ![images](/images/shiro/ShiroArchitecture.png)\n>\n> - Subject (org.apache.shiro.subject.Subject)\n>\n> A security-specific view of the entity (user, 3rd-party service, cron job, etc) currently interacting with the software.\n>\n> - SecurityManager (org.apache.shiro.mgt.SecurityManager)\n>\n> As mentioned above, the SecurityManager is the heart of Shiros architecture. It is mostly an umbrella object that coordinates its managed components to ensure they work smoothly together. It also manages Shiros view of every application user, so it knows how to perform security operations per user.\n>\n> - Authenticator (org.apache.shiro.authc.Authenticator)\n>\n> The Authenticator is the component that is responsible for executing and reacting to authentication (log-in) attempts by users. When a user tries to log-in, that logic is executed by the Authenticator. The Authenticator knows how to coordinate with one or more Realms that store relevant user/account information. The data obtained from these Realms is used to verify the users identity to guarantee the user really is who they say they are.\n>\n> - Authentication Strategy (org.apache.shiro.authc.pam.AuthenticationStrategy)\n>\n> If more than one Realm is configured, the AuthenticationStrategy will coordinate the Realms to determine the conditions under which an authentication attempt succeeds or fails (for example, if one realm succeeds but others fail, is the attempt successful? Must all realms succeed? Only the first?).\n>\n> - Authorizer (org.apache.shiro.authz.Authorizer)\n>\n> The Authorizer is the component responsible determining users access control in the application. It is the mechanism that ultimately says if a user is allowed to do something or not. Like the Authenticator, the Authorizer also knows how to coordinate with multiple back-end data sources to access role and permission information. The Authorizer uses this information to determine exactly if a user is allowed to perform a given action.\n>\n> - SessionManager (org.apache.shiro.session.mgt.SessionManager)\n>\n> The SessionManager knows how to create and manage user Session lifecycles to provide a robust Session experience for users in all environments. This is a unique feature in the world of security frameworks - Shiro has the ability to natively manage user Sessions in any environment, even if there is no Web/Servlet or EJB container available. By default, Shiro will use an existing session mechanism if available, (e.g. Servlet Container), but if there isnt one, such as in a standalone application or non-web environment, it will use its built-in enterprise session management to offer the same programming experience. The SessionDAO exists to allow any datasource to be used to persist sessions.\n>\n> - SessionDAO (org.apache.shiro.session.mgt.eis.SessionDAO)\n>\n> The SessionDAO performs Session persistence (CRUD) operations on behalf of the SessionManager. This allows any data store to be plugged in to the Session Management infrastructure.\n>\n> - CacheManager (org.apache.shiro.cache.CacheManager) The CacheManager creates and manages Cache instance lifecycles used by other Shiro components. Because Shiro can access many back-end data sources for authentication, authorization and session management, caching has always been a first-class architectural feature in the framework to improve performance while using these data sources. Any of the modern open-source and/or enterprise caching products can be plugged in to Shiro to provide a fast and efficient user-experience.\n> - Cryptography (org.apache.shiro.crypto.*)\n>\n> Cryptography is a natural addition to an enterprise security framework. Shiros crypto package contains easy-to-use and understand representations of crytographic Ciphers, Hashes (aka digests) and different codec implementations. All of the classes in this package are carefully designed to be very easy to use and easy to understand. Anyone who has used Javas native cryptography support knows it can be a challenging animal to tame. Shiros crypto APIs simplify the complicated Java mechanisms and make cryptography easy to use for normal mortal human beings.\n>\n> - Realms (org.apache.shiro.realm.Realm)\n>\n> As mentioned above, Realms act as the bridge or connector between Shiro and your applications security data. When it comes time to actually interact with security-related data like user accounts to perform authentication (login) and authorization (access control), Shiro looks up many of these things from one or more Realms configured for an application. You can configure as many Realms as you need (usually one per data source) and Shiro will coordinate with them as necessary for both authentication and authorization.\n\n\n\n\n\n|  |  |\n| :--: | :--: |\n| anon |  |\n| authc | () |\n| authcBasic | httpBasic |\n| perms |  perms[user:add:] |\n| port | port[8081] schemal://serverName:8081?queryString |\n| rest |  |\n| roles |  |\n| ssl | url |\n| user |  |\n| ... |  |\n\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_base)\n\n","slug":"spring/springboot/shiro/shiro-base","published":1,"updated":"2022-05-10T08:25:56.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pm0046xklo9quce1dj","content":"<p>Subject, SecurityManager  Realms.</p>\n<p>SubjectShiroSubjectDaemon AccountShiro SubjectSecurityManager</p>\n<p>SecurityManagerShiroFacadeShiroSecurityManager</p>\n<p>Realm RealmShiroShiroRealm RealmDAOShiroShiroRealmRealm ShiroRealmLDAPJDBCINIRealmRealm</p>\n<p></p>\n<ol>\n<li>Authentication&#x2F;()</li>\n<li>Authorization</li>\n<li>Session Managersession</li>\n<li>Cryptography</li>\n<li>Web SupportWebWeb</li>\n<li>Cachingredis</li>\n<li>Concurrency</li>\n<li>Testing</li>\n<li>Run As</li>\n<li>Remember Me</li>\n</ol>\n<p><a href=\"https://shiro.apache.org/architecture.html\"></a></p>\n<blockquote>\n<p>The following diagram shows Shiros core architectural concepts followed by short summaries of each:</p>\n<p><img src=\"/images/shiro/ShiroArchitecture.png\" alt=\"images\"></p>\n<ul>\n<li>Subject (org.apache.shiro.subject.Subject)</li>\n</ul>\n<p>A security-specific view of the entity (user, 3rd-party service, cron job, etc) currently interacting with the software.</p>\n<ul>\n<li>SecurityManager (org.apache.shiro.mgt.SecurityManager)</li>\n</ul>\n<p>As mentioned above, the SecurityManager is the heart of Shiros architecture. It is mostly an umbrella object that coordinates its managed components to ensure they work smoothly together. It also manages Shiros view of every application user, so it knows how to perform security operations per user.</p>\n<ul>\n<li>Authenticator (org.apache.shiro.authc.Authenticator)</li>\n</ul>\n<p>The Authenticator is the component that is responsible for executing and reacting to authentication (log-in) attempts by users. When a user tries to log-in, that logic is executed by the Authenticator. The Authenticator knows how to coordinate with one or more Realms that store relevant user&#x2F;account information. The data obtained from these Realms is used to verify the users identity to guarantee the user really is who they say they are.</p>\n<ul>\n<li>Authentication Strategy (org.apache.shiro.authc.pam.AuthenticationStrategy)</li>\n</ul>\n<p>If more than one Realm is configured, the AuthenticationStrategy will coordinate the Realms to determine the conditions under which an authentication attempt succeeds or fails (for example, if one realm succeeds but others fail, is the attempt successful? Must all realms succeed? Only the first?).</p>\n<ul>\n<li>Authorizer (org.apache.shiro.authz.Authorizer)</li>\n</ul>\n<p>The Authorizer is the component responsible determining users access control in the application. It is the mechanism that ultimately says if a user is allowed to do something or not. Like the Authenticator, the Authorizer also knows how to coordinate with multiple back-end data sources to access role and permission information. The Authorizer uses this information to determine exactly if a user is allowed to perform a given action.</p>\n<ul>\n<li>SessionManager (org.apache.shiro.session.mgt.SessionManager)</li>\n</ul>\n<p>The SessionManager knows how to create and manage user Session lifecycles to provide a robust Session experience for users in all environments. This is a unique feature in the world of security frameworks - Shiro has the ability to natively manage user Sessions in any environment, even if there is no Web&#x2F;Servlet or EJB container available. By default, Shiro will use an existing session mechanism if available, (e.g. Servlet Container), but if there isnt one, such as in a standalone application or non-web environment, it will use its built-in enterprise session management to offer the same programming experience. The SessionDAO exists to allow any datasource to be used to persist sessions.</p>\n<ul>\n<li>SessionDAO (org.apache.shiro.session.mgt.eis.SessionDAO)</li>\n</ul>\n<p>The SessionDAO performs Session persistence (CRUD) operations on behalf of the SessionManager. This allows any data store to be plugged in to the Session Management infrastructure.</p>\n<ul>\n<li>CacheManager (org.apache.shiro.cache.CacheManager) The CacheManager creates and manages Cache instance lifecycles used by other Shiro components. Because Shiro can access many back-end data sources for authentication, authorization and session management, caching has always been a first-class architectural feature in the framework to improve performance while using these data sources. Any of the modern open-source and&#x2F;or enterprise caching products can be plugged in to Shiro to provide a fast and efficient user-experience.</li>\n<li>Cryptography (org.apache.shiro.crypto.*)</li>\n</ul>\n<p>Cryptography is a natural addition to an enterprise security framework. Shiros crypto package contains easy-to-use and understand representations of crytographic Ciphers, Hashes (aka digests) and different codec implementations. All of the classes in this package are carefully designed to be very easy to use and easy to understand. Anyone who has used Javas native cryptography support knows it can be a challenging animal to tame. Shiros crypto APIs simplify the complicated Java mechanisms and make cryptography easy to use for normal mortal human beings.</p>\n<ul>\n<li>Realms (org.apache.shiro.realm.Realm)</li>\n</ul>\n<p>As mentioned above, Realms act as the bridge or connector between Shiro and your applications security data. When it comes time to actually interact with security-related data like user accounts to perform authentication (login) and authorization (access control), Shiro looks up many of these things from one or more Realms configured for an application. You can configure as many Realms as you need (usually one per data source) and Shiro will coordinate with them as necessary for both authentication and authorization.</p>\n</blockquote>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">anon</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">authc</td>\n<td align=\"center\">()</td>\n</tr>\n<tr>\n<td align=\"center\">authcBasic</td>\n<td align=\"center\">httpBasic</td>\n</tr>\n<tr>\n<td align=\"center\">perms</td>\n<td align=\"center\"> perms[user:add:]</td>\n</tr>\n<tr>\n<td align=\"center\">port</td>\n<td align=\"center\">port[8081] schemal:&#x2F;&#x2F;serverName:8081?queryString</td>\n</tr>\n<tr>\n<td align=\"center\">rest</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">roles</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">ssl</td>\n<td align=\"center\">url</td>\n</tr>\n<tr>\n<td align=\"center\">user</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_base\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Subject, SecurityManager  Realms.</p>\n<p>SubjectShiroSubjectDaemon AccountShiro SubjectSecurityManager</p>\n<p>SecurityManagerShiroFacadeShiroSecurityManager</p>\n<p>Realm RealmShiroShiroRealm RealmDAOShiroShiroRealmRealm ShiroRealmLDAPJDBCINIRealmRealm</p>\n<p></p>\n<ol>\n<li>Authentication&#x2F;()</li>\n<li>Authorization</li>\n<li>Session Managersession</li>\n<li>Cryptography</li>\n<li>Web SupportWebWeb</li>\n<li>Cachingredis</li>\n<li>Concurrency</li>\n<li>Testing</li>\n<li>Run As</li>\n<li>Remember Me</li>\n</ol>\n<p><a href=\"https://shiro.apache.org/architecture.html\"></a></p>\n<blockquote>\n<p>The following diagram shows Shiros core architectural concepts followed by short summaries of each:</p>\n<p><img src=\"/images/shiro/ShiroArchitecture.png\" alt=\"images\"></p>\n<ul>\n<li>Subject (org.apache.shiro.subject.Subject)</li>\n</ul>\n<p>A security-specific view of the entity (user, 3rd-party service, cron job, etc) currently interacting with the software.</p>\n<ul>\n<li>SecurityManager (org.apache.shiro.mgt.SecurityManager)</li>\n</ul>\n<p>As mentioned above, the SecurityManager is the heart of Shiros architecture. It is mostly an umbrella object that coordinates its managed components to ensure they work smoothly together. It also manages Shiros view of every application user, so it knows how to perform security operations per user.</p>\n<ul>\n<li>Authenticator (org.apache.shiro.authc.Authenticator)</li>\n</ul>\n<p>The Authenticator is the component that is responsible for executing and reacting to authentication (log-in) attempts by users. When a user tries to log-in, that logic is executed by the Authenticator. The Authenticator knows how to coordinate with one or more Realms that store relevant user&#x2F;account information. The data obtained from these Realms is used to verify the users identity to guarantee the user really is who they say they are.</p>\n<ul>\n<li>Authentication Strategy (org.apache.shiro.authc.pam.AuthenticationStrategy)</li>\n</ul>\n<p>If more than one Realm is configured, the AuthenticationStrategy will coordinate the Realms to determine the conditions under which an authentication attempt succeeds or fails (for example, if one realm succeeds but others fail, is the attempt successful? Must all realms succeed? Only the first?).</p>\n<ul>\n<li>Authorizer (org.apache.shiro.authz.Authorizer)</li>\n</ul>\n<p>The Authorizer is the component responsible determining users access control in the application. It is the mechanism that ultimately says if a user is allowed to do something or not. Like the Authenticator, the Authorizer also knows how to coordinate with multiple back-end data sources to access role and permission information. The Authorizer uses this information to determine exactly if a user is allowed to perform a given action.</p>\n<ul>\n<li>SessionManager (org.apache.shiro.session.mgt.SessionManager)</li>\n</ul>\n<p>The SessionManager knows how to create and manage user Session lifecycles to provide a robust Session experience for users in all environments. This is a unique feature in the world of security frameworks - Shiro has the ability to natively manage user Sessions in any environment, even if there is no Web&#x2F;Servlet or EJB container available. By default, Shiro will use an existing session mechanism if available, (e.g. Servlet Container), but if there isnt one, such as in a standalone application or non-web environment, it will use its built-in enterprise session management to offer the same programming experience. The SessionDAO exists to allow any datasource to be used to persist sessions.</p>\n<ul>\n<li>SessionDAO (org.apache.shiro.session.mgt.eis.SessionDAO)</li>\n</ul>\n<p>The SessionDAO performs Session persistence (CRUD) operations on behalf of the SessionManager. This allows any data store to be plugged in to the Session Management infrastructure.</p>\n<ul>\n<li>CacheManager (org.apache.shiro.cache.CacheManager) The CacheManager creates and manages Cache instance lifecycles used by other Shiro components. Because Shiro can access many back-end data sources for authentication, authorization and session management, caching has always been a first-class architectural feature in the framework to improve performance while using these data sources. Any of the modern open-source and&#x2F;or enterprise caching products can be plugged in to Shiro to provide a fast and efficient user-experience.</li>\n<li>Cryptography (org.apache.shiro.crypto.*)</li>\n</ul>\n<p>Cryptography is a natural addition to an enterprise security framework. Shiros crypto package contains easy-to-use and understand representations of crytographic Ciphers, Hashes (aka digests) and different codec implementations. All of the classes in this package are carefully designed to be very easy to use and easy to understand. Anyone who has used Javas native cryptography support knows it can be a challenging animal to tame. Shiros crypto APIs simplify the complicated Java mechanisms and make cryptography easy to use for normal mortal human beings.</p>\n<ul>\n<li>Realms (org.apache.shiro.realm.Realm)</li>\n</ul>\n<p>As mentioned above, Realms act as the bridge or connector between Shiro and your applications security data. When it comes time to actually interact with security-related data like user accounts to perform authentication (login) and authorization (access control), Shiro looks up many of these things from one or more Realms configured for an application. You can configure as many Realms as you need (usually one per data source) and Shiro will coordinate with them as necessary for both authentication and authorization.</p>\n</blockquote>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">anon</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">authc</td>\n<td align=\"center\">()</td>\n</tr>\n<tr>\n<td align=\"center\">authcBasic</td>\n<td align=\"center\">httpBasic</td>\n</tr>\n<tr>\n<td align=\"center\">perms</td>\n<td align=\"center\"> perms[user:add:]</td>\n</tr>\n<tr>\n<td align=\"center\">port</td>\n<td align=\"center\">port[8081] schemal:&#x2F;&#x2F;serverName:8081?queryString</td>\n</tr>\n<tr>\n<td align=\"center\">rest</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">roles</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">ssl</td>\n<td align=\"center\">url</td>\n</tr>\n<tr>\n<td align=\"center\">user</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_base\"></a></p>\n"},{"title":"kafka ","date":"2022-05-11T07:08:11.000Z","_content":"\n## \n\n`Kafka`:\n\n- [](/2022/05/19/messagequeue/kafka/eventstream/)/ \n-  \n-  \nKafka \n\n## \n\n`Kafka`TCP````\n\n- Kafka  Kafka Connect Kafka  Kafka Kafka \n\n- [](https://cwiki.apache.org/confluence/display/KAFKA/Clients)\n\n## \n\n****  \n  \n  \n   Bob  200 \n  2020  6  25  2:06\n\n**** Kafka **** Kafka \n\n************``****``Kafka``````****``````****************`` Kafka \n\n******** Kafka ```` ID`` Kafka````\n![images](/images/kafka-base/streams-and-tables-p1_p4.png)\n P1P4****\n\n 3\n\n[](https://kafka.apache.org/)\n","source":"_posts/messagequeue/kafka/kafkabase.md","raw":"---\ntitle: kafka \ndate: 2022-05-11 15:08:11\ncategories:\n  - kafka\n  - queue\ntags:\n  - kafka\n  - queue\n---\n\n## \n\n`Kafka`:\n\n- [](/2022/05/19/messagequeue/kafka/eventstream/)/ \n-  \n-  \nKafka \n\n## \n\n`Kafka`TCP````\n\n- Kafka  Kafka Connect Kafka  Kafka Kafka \n\n- [](https://cwiki.apache.org/confluence/display/KAFKA/Clients)\n\n## \n\n****  \n  \n  \n   Bob  200 \n  2020  6  25  2:06\n\n**** Kafka **** Kafka \n\n************``****``Kafka``````****``````****************`` Kafka \n\n******** Kafka ```` ID`` Kafka````\n![images](/images/kafka-base/streams-and-tables-p1_p4.png)\n P1P4****\n\n 3\n\n[](https://kafka.apache.org/)\n","slug":"messagequeue/kafka/kafkabase","published":1,"updated":"2022-05-19T14:03:09.154Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pm0049xklo15zmaila","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>Kafka</code>:</p>\n<ul>\n<li><a href=\"/2022/05/19/messagequeue/kafka/eventstream/\"></a>&#x2F; </li>\n<li> </li>\n<li> <br>Kafka </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>Kafka</code>TCP<code></code><code></code></p>\n<ul>\n<li><p>Kafka  Kafka Connect Kafka  Kafka Kafka </p>\n</li>\n<li><p><a href=\"https://cwiki.apache.org/confluence/display/KAFKA/Clients\"></a></p>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>  <br>  <br>  <br>   Bob  200 <br>  2020  6  25  2:06</p>\n<p><strong></strong> Kafka <strong></strong> Kafka </p>\n<p><strong></strong><strong></strong><strong></strong><code></code><strong></strong><code></code>Kafka<code></code><code></code><code></code><strong></strong><code></code><code></code><code></code><strong></strong><strong></strong><strong></strong><strong></strong><code></code> Kafka </p>\n<p><strong></strong><strong></strong> Kafka <code></code><code></code> ID<code></code> Kafka<code></code><code></code><br><img src=\"/images/kafka-base/streams-and-tables-p1_p4.png\" alt=\"images\"><br> P1P4<strong></strong></p>\n<p> 3</p>\n<p><a href=\"https://kafka.apache.org/\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>Kafka</code>:</p>\n<ul>\n<li><a href=\"/2022/05/19/messagequeue/kafka/eventstream/\"></a>&#x2F; </li>\n<li> </li>\n<li> <br>Kafka </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>Kafka</code>TCP<code></code><code></code></p>\n<ul>\n<li><p>Kafka  Kafka Connect Kafka  Kafka Kafka </p>\n</li>\n<li><p><a href=\"https://cwiki.apache.org/confluence/display/KAFKA/Clients\"></a></p>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>  <br>  <br>  <br>   Bob  200 <br>  2020  6  25  2:06</p>\n<p><strong></strong> Kafka <strong></strong> Kafka </p>\n<p><strong></strong><strong></strong><strong></strong><code></code><strong></strong><code></code>Kafka<code></code><code></code><code></code><strong></strong><code></code><code></code><code></code><strong></strong><strong></strong><strong></strong><strong></strong><code></code> Kafka </p>\n<p><strong></strong><strong></strong> Kafka <code></code><code></code> ID<code></code> Kafka<code></code><code></code><br><img src=\"/images/kafka-base/streams-and-tables-p1_p4.png\" alt=\"images\"><br> P1P4<strong></strong></p>\n<p> 3</p>\n<p><a href=\"https://kafka.apache.org/\"></a></p>\n"},{"title":"shiro + redis ","date":"2021-06-15T12:20:28.000Z","_content":"\n session  redis \n\n1. gradle\n\n```\nimplementation group: 'org.crazycake', name: 'shiro-redis', version: '3.3.1'\n```\n\nshiro-redissessionredis\n\n2. sessionredis\n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n       @Autowired(required = false)\n       private ResourcesService resourcesService;\n   \n       @Value(\"${spring.redis.host}\")\n       private String host;\n   \n       @Value(\"${spring.redis.timeout}\")\n       private int timeout;\n   \n       @Value(\"${spring.redis.password}\")\n       private String password;\n   \n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        * ShiroFilterFactoryBean \n        * ShiroFilterFactoryBean\n        * ShiroFilterFactoryBeanSecurityManager\n        *\n        Filter Chain\n        1URLFilter\n        2\n        3permsroles\n        *\n        */\n       @Bean\n       public ShiroFilterFactoryBean shirFilter(SecurityManager securityManager){\n           System.out.println(\"ShiroConfiguration.shirFilter()\");\n           ShiroFilterFactoryBean shiroFilterFactoryBean  = new ShiroFilterFactoryBean();\n   \n           //  SecurityManager\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           // Web\"/login.jsp\"\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           // \n           shiroFilterFactoryBean.setSuccessUrl(\"/users\");\n           //;\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/403\");\n           //.\n           Map<String,String> filterChainDefinitionMap = new LinkedHashMap<String,String>();\n   \n           // ,Shiro\n           filterChainDefinitionMap.put(\"/logout\", \"logout\");\n           filterChainDefinitionMap.put(\"/css/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/js/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/img/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/font-awesome/**\",\"anon\");\n           //<!--  /** -->:;\n           //<!-- authc:url; anon:url-->\n           //\n           List<Resources> resourcesList = resourcesService.list();\n           for(Resources resources:resourcesList){\n   \n               if (StringUtils.hasText(resources.getResUrl())) {\n                   String permission = \"perms[\" + resources.getResUrl()+ \"]\";\n                   filterChainDefinitionMap.put(resources.getResUrl(),permission);\n               }\n           }\n           filterChainDefinitionMap.put(\"/**\", \"authc\");\n   \n   \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n   \n       @Bean\n       public SecurityManager securityManager(){\n           DefaultWebSecurityManager securityManager =  new DefaultWebSecurityManager();\n           //realm.\n           securityManager.setRealm(myShiroRealm());\n           //  redis\n           securityManager.setCacheManager(cacheManager());\n           // session redis\n           securityManager.setSessionManager(sessionManager());\n           return securityManager;\n       }\n   \n       @Bean\n       public MyShiroRealm myShiroRealm(){\n           MyShiroRealm myShiroRealm = new MyShiroRealm();\n           myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());\n           return myShiroRealm;\n       }\n   \n       /**\n        * \n        * ShiroSimpleAuthenticationInfo\n        *  doGetAuthenticationInfo;\n        * \n        * @return\n        */\n       @Bean\n       public HashedCredentialsMatcher hashedCredentialsMatcher(){\n           HashedCredentialsMatcher hashedCredentialsMatcher = new HashedCredentialsMatcher();\n   \n           hashedCredentialsMatcher.setHashAlgorithmName(\"SHA-1\");\n           hashedCredentialsMatcher.setHashIterations(16);\n   \n           return hashedCredentialsMatcher;\n       }\n   \n   \n       /**\n        *  shiro aop.\n        *  ;;\n        * @param securityManager\n        * @return\n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager){\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       /**\n        * shiro redisManager\n        * shiro-redis\n        * @return\n        */\n       public RedisManager redisManager() {\n           RedisManager redisManager = new RedisManager();\n           redisManager.setHost(host);\n           redisManager.setTimeout(timeout);\n           if (StringUtils.hasText(password)){\n               redisManager.setPassword(password);\n           }\n           return redisManager;\n       }\n   \n       /**\n        * cacheManager  redis\n        * shiro-redis\n        * @return\n        */\n       public RedisCacheManager cacheManager() {\n           RedisCacheManager redisCacheManager = new RedisCacheManager();\n           redisCacheManager.setRedisManager(redisManager());\n           return redisCacheManager;\n       }\n   \n   \n       /**\n        * RedisSessionDAO shiro sessionDao redis\n        * shiro-redis\n        */\n       @Bean\n       public RedisSessionDAO redisSessionDAO() {\n           RedisSessionDAO redisSessionDAO = new RedisSessionDAO();\n           redisSessionDAO.setRedisManager(redisManager());\n           return redisSessionDAO;\n       }\n   \n       /**\n        * shiro session\n        */\n       @Bean\n       public DefaultWebSessionManager sessionManager() {\n           DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();\n           sessionManager.setSessionDAO(redisSessionDAO());\n           return sessionManager;\n       }\n   \n   ```\n\n   [](https://github.com/idream68/spring-demo/tree/master/shiro_redis)\n\n","source":"_posts/spring/springboot/shiro/shiro-redis-session.md","raw":"---\ntitle: shiro + redis \ndate: 2021-06-15 20:20:28\ncategories:\n  - spring\n  - springboot\n  - shiro\ntags:\n  - springboot\n  - redis\n  - shiro\n---\n\n session  redis \n\n1. gradle\n\n```\nimplementation group: 'org.crazycake', name: 'shiro-redis', version: '3.3.1'\n```\n\nshiro-redissessionredis\n\n2. sessionredis\n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n       @Autowired(required = false)\n       private ResourcesService resourcesService;\n   \n       @Value(\"${spring.redis.host}\")\n       private String host;\n   \n       @Value(\"${spring.redis.timeout}\")\n       private int timeout;\n   \n       @Value(\"${spring.redis.password}\")\n       private String password;\n   \n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        * ShiroFilterFactoryBean \n        * ShiroFilterFactoryBean\n        * ShiroFilterFactoryBeanSecurityManager\n        *\n        Filter Chain\n        1URLFilter\n        2\n        3permsroles\n        *\n        */\n       @Bean\n       public ShiroFilterFactoryBean shirFilter(SecurityManager securityManager){\n           System.out.println(\"ShiroConfiguration.shirFilter()\");\n           ShiroFilterFactoryBean shiroFilterFactoryBean  = new ShiroFilterFactoryBean();\n   \n           //  SecurityManager\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           // Web\"/login.jsp\"\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           // \n           shiroFilterFactoryBean.setSuccessUrl(\"/users\");\n           //;\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/403\");\n           //.\n           Map<String,String> filterChainDefinitionMap = new LinkedHashMap<String,String>();\n   \n           // ,Shiro\n           filterChainDefinitionMap.put(\"/logout\", \"logout\");\n           filterChainDefinitionMap.put(\"/css/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/js/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/img/**\",\"anon\");\n           filterChainDefinitionMap.put(\"/font-awesome/**\",\"anon\");\n           //<!--  /** -->:;\n           //<!-- authc:url; anon:url-->\n           //\n           List<Resources> resourcesList = resourcesService.list();\n           for(Resources resources:resourcesList){\n   \n               if (StringUtils.hasText(resources.getResUrl())) {\n                   String permission = \"perms[\" + resources.getResUrl()+ \"]\";\n                   filterChainDefinitionMap.put(resources.getResUrl(),permission);\n               }\n           }\n           filterChainDefinitionMap.put(\"/**\", \"authc\");\n   \n   \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n   \n       @Bean\n       public SecurityManager securityManager(){\n           DefaultWebSecurityManager securityManager =  new DefaultWebSecurityManager();\n           //realm.\n           securityManager.setRealm(myShiroRealm());\n           //  redis\n           securityManager.setCacheManager(cacheManager());\n           // session redis\n           securityManager.setSessionManager(sessionManager());\n           return securityManager;\n       }\n   \n       @Bean\n       public MyShiroRealm myShiroRealm(){\n           MyShiroRealm myShiroRealm = new MyShiroRealm();\n           myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());\n           return myShiroRealm;\n       }\n   \n       /**\n        * \n        * ShiroSimpleAuthenticationInfo\n        *  doGetAuthenticationInfo;\n        * \n        * @return\n        */\n       @Bean\n       public HashedCredentialsMatcher hashedCredentialsMatcher(){\n           HashedCredentialsMatcher hashedCredentialsMatcher = new HashedCredentialsMatcher();\n   \n           hashedCredentialsMatcher.setHashAlgorithmName(\"SHA-1\");\n           hashedCredentialsMatcher.setHashIterations(16);\n   \n           return hashedCredentialsMatcher;\n       }\n   \n   \n       /**\n        *  shiro aop.\n        *  ;;\n        * @param securityManager\n        * @return\n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager){\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       /**\n        * shiro redisManager\n        * shiro-redis\n        * @return\n        */\n       public RedisManager redisManager() {\n           RedisManager redisManager = new RedisManager();\n           redisManager.setHost(host);\n           redisManager.setTimeout(timeout);\n           if (StringUtils.hasText(password)){\n               redisManager.setPassword(password);\n           }\n           return redisManager;\n       }\n   \n       /**\n        * cacheManager  redis\n        * shiro-redis\n        * @return\n        */\n       public RedisCacheManager cacheManager() {\n           RedisCacheManager redisCacheManager = new RedisCacheManager();\n           redisCacheManager.setRedisManager(redisManager());\n           return redisCacheManager;\n       }\n   \n   \n       /**\n        * RedisSessionDAO shiro sessionDao redis\n        * shiro-redis\n        */\n       @Bean\n       public RedisSessionDAO redisSessionDAO() {\n           RedisSessionDAO redisSessionDAO = new RedisSessionDAO();\n           redisSessionDAO.setRedisManager(redisManager());\n           return redisSessionDAO;\n       }\n   \n       /**\n        * shiro session\n        */\n       @Bean\n       public DefaultWebSessionManager sessionManager() {\n           DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();\n           sessionManager.setSessionDAO(redisSessionDAO());\n           return sessionManager;\n       }\n   \n   ```\n\n   [](https://github.com/idream68/spring-demo/tree/master/shiro_redis)\n\n","slug":"spring/springboot/shiro/shiro-redis-session","published":1,"updated":"2022-05-10T08:25:56.403Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4pn004cxklohvp0c87p","content":"<p> session  redis </p>\n<ol>\n<li>gradle</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation group: &#x27;org.crazycake&#x27;, name: &#x27;shiro-redis&#x27;, version: &#x27;3.3.1&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>shiro-redissessionredis</p>\n<ol start=\"2\">\n<li><p>sessionredis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired(required = false)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ResourcesService resourcesService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.host&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String host;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.timeout&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> timeout;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.password&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBean </span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBeanSecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     Filter Chain</span></span><br><span class=\"line\"><span class=\"comment\">     1URLFilter</span></span><br><span class=\"line\"><span class=\"comment\">     2</span></span><br><span class=\"line\"><span class=\"comment\">     3permsroles</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ShiroFilterFactoryBean <span class=\"title function_\">shirFilter</span><span class=\"params\">(SecurityManager securityManager)</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;ShiroConfiguration.shirFilter()&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span>  <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  SecurityManager</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"comment\">// Web&quot;/login.jsp&quot;</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/users&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//;</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/403&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//.</span></span><br><span class=\"line\">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String,String&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ,Shiro</span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/logout&quot;</span>, <span class=\"string\">&quot;logout&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/css/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/js/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/img/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/font-awesome/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//&lt;!--  /** --&gt;:;</span></span><br><span class=\"line\">        <span class=\"comment\">//&lt;!-- authc:url; anon:url--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        List&lt;Resources&gt; resourcesList = resourcesService.list();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Resources resources:resourcesList)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StringUtils.hasText(resources.getResUrl())) &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">permission</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;perms[&quot;</span> + resources.getResUrl()+ <span class=\"string\">&quot;]&quot;</span>;</span><br><span class=\"line\">                filterChainDefinitionMap.put(resources.getResUrl(),permission);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;authc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\">        <span class=\"comment\">//realm.</span></span><br><span class=\"line\">        securityManager.setRealm(myShiroRealm());</span><br><span class=\"line\">        <span class=\"comment\">//  redis</span></span><br><span class=\"line\">        securityManager.setCacheManager(cacheManager());</span><br><span class=\"line\">        <span class=\"comment\">// session redis</span></span><br><span class=\"line\">        securityManager.setSessionManager(sessionManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> MyShiroRealm <span class=\"title function_\">myShiroRealm</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">MyShiroRealm</span> <span class=\"variable\">myShiroRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyShiroRealm</span>();</span><br><span class=\"line\">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> myShiroRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroSimpleAuthenticationInfo</span></span><br><span class=\"line\"><span class=\"comment\">     *  doGetAuthenticationInfo;</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HashedCredentialsMatcher <span class=\"title function_\">hashedCredentialsMatcher</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">HashedCredentialsMatcher</span> <span class=\"variable\">hashedCredentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HashedCredentialsMatcher</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        hashedCredentialsMatcher.setHashAlgorithmName(<span class=\"string\">&quot;SHA-1&quot;</span>);</span><br><span class=\"line\">        hashedCredentialsMatcher.setHashIterations(<span class=\"number\">16</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> hashedCredentialsMatcher;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  shiro aop.</span></span><br><span class=\"line\"><span class=\"comment\">     *  ;;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> securityManager</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro redisManager</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisManager <span class=\"title function_\">redisManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisManager</span> <span class=\"variable\">redisManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisManager</span>();</span><br><span class=\"line\">        redisManager.setHost(host);</span><br><span class=\"line\">        redisManager.setTimeout(timeout);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(password))&#123;</span><br><span class=\"line\">            redisManager.setPassword(password);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * cacheManager  redis</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisCacheManager <span class=\"title function_\">cacheManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisCacheManager</span> <span class=\"variable\">redisCacheManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisCacheManager</span>();</span><br><span class=\"line\">        redisCacheManager.setRedisManager(redisManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisCacheManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * RedisSessionDAO shiro sessionDao redis</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisSessionDAO <span class=\"title function_\">redisSessionDAO</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisSessionDAO</span> <span class=\"variable\">redisSessionDAO</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisSessionDAO</span>();</span><br><span class=\"line\">        redisSessionDAO.setRedisManager(redisManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisSessionDAO;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro session</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultWebSessionManager <span class=\"title function_\">sessionManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSessionManager</span> <span class=\"variable\">sessionManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSessionManager</span>();</span><br><span class=\"line\">        sessionManager.setSessionDAO(redisSessionDAO());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sessionManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_redis\"></a></p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p> session  redis </p>\n<ol>\n<li>gradle</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation group: &#x27;org.crazycake&#x27;, name: &#x27;shiro-redis&#x27;, version: &#x27;3.3.1&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>shiro-redissessionredis</p>\n<ol start=\"2\">\n<li><p>sessionredis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired(required = false)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ResourcesService resourcesService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.host&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String host;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.timeout&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> timeout;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;spring.redis.password&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBean </span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroFilterFactoryBeanSecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     Filter Chain</span></span><br><span class=\"line\"><span class=\"comment\">     1URLFilter</span></span><br><span class=\"line\"><span class=\"comment\">     2</span></span><br><span class=\"line\"><span class=\"comment\">     3permsroles</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ShiroFilterFactoryBean <span class=\"title function_\">shirFilter</span><span class=\"params\">(SecurityManager securityManager)</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;ShiroConfiguration.shirFilter()&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span>  <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  SecurityManager</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"comment\">// Web&quot;/login.jsp&quot;</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/users&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//;</span></span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/403&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//.</span></span><br><span class=\"line\">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String,String&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ,Shiro</span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/logout&quot;</span>, <span class=\"string\">&quot;logout&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/css/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/js/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/img/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/font-awesome/**&quot;</span>,<span class=\"string\">&quot;anon&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//&lt;!--  /** --&gt;:;</span></span><br><span class=\"line\">        <span class=\"comment\">//&lt;!-- authc:url; anon:url--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        List&lt;Resources&gt; resourcesList = resourcesService.list();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Resources resources:resourcesList)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StringUtils.hasText(resources.getResUrl())) &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">permission</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;perms[&quot;</span> + resources.getResUrl()+ <span class=\"string\">&quot;]&quot;</span>;</span><br><span class=\"line\">                filterChainDefinitionMap.put(resources.getResUrl(),permission);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;authc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\">        <span class=\"comment\">//realm.</span></span><br><span class=\"line\">        securityManager.setRealm(myShiroRealm());</span><br><span class=\"line\">        <span class=\"comment\">//  redis</span></span><br><span class=\"line\">        securityManager.setCacheManager(cacheManager());</span><br><span class=\"line\">        <span class=\"comment\">// session redis</span></span><br><span class=\"line\">        securityManager.setSessionManager(sessionManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> MyShiroRealm <span class=\"title function_\">myShiroRealm</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">MyShiroRealm</span> <span class=\"variable\">myShiroRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyShiroRealm</span>();</span><br><span class=\"line\">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> myShiroRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroSimpleAuthenticationInfo</span></span><br><span class=\"line\"><span class=\"comment\">     *  doGetAuthenticationInfo;</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HashedCredentialsMatcher <span class=\"title function_\">hashedCredentialsMatcher</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">HashedCredentialsMatcher</span> <span class=\"variable\">hashedCredentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HashedCredentialsMatcher</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        hashedCredentialsMatcher.setHashAlgorithmName(<span class=\"string\">&quot;SHA-1&quot;</span>);</span><br><span class=\"line\">        hashedCredentialsMatcher.setHashIterations(<span class=\"number\">16</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> hashedCredentialsMatcher;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  shiro aop.</span></span><br><span class=\"line\"><span class=\"comment\">     *  ;;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> securityManager</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro redisManager</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisManager <span class=\"title function_\">redisManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisManager</span> <span class=\"variable\">redisManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisManager</span>();</span><br><span class=\"line\">        redisManager.setHost(host);</span><br><span class=\"line\">        redisManager.setTimeout(timeout);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.hasText(password))&#123;</span><br><span class=\"line\">            redisManager.setPassword(password);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * cacheManager  redis</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisCacheManager <span class=\"title function_\">cacheManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisCacheManager</span> <span class=\"variable\">redisCacheManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisCacheManager</span>();</span><br><span class=\"line\">        redisCacheManager.setRedisManager(redisManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisCacheManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * RedisSessionDAO shiro sessionDao redis</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro-redis</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisSessionDAO <span class=\"title function_\">redisSessionDAO</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">RedisSessionDAO</span> <span class=\"variable\">redisSessionDAO</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RedisSessionDAO</span>();</span><br><span class=\"line\">        redisSessionDAO.setRedisManager(redisManager());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisSessionDAO;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * shiro session</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultWebSessionManager <span class=\"title function_\">sessionManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSessionManager</span> <span class=\"variable\">sessionManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSessionManager</span>();</span><br><span class=\"line\">        sessionManager.setSessionDAO(redisSessionDAO());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sessionManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_redis\"></a></p>\n</li>\n</ol>\n"},{"title":"shiro + jwt ","date":"2021-06-15T12:20:14.000Z","_content":"\n### jwt \n\n> JSON Web Token (JWT)(RFC 7519)JSON\n\nJSON Web Token(.)\n\n- Header\n- Payload\n- Signature\n\nJWT\n\n> xxxxx.yyyyy.zzzzz\n\n### shiroJWT\n\n1.  JWT filter\n\n   shiro url  JWT jwt\n\n   ```java\n   @Slf4j\n   public class JwtFilter extends BasicHttpAuthenticationFilter {\n       /**\n        * \n        */\n       @Override\n       protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {\n           HttpServletRequest httpServletRequest = WebUtils.toHttp(request);\n           HttpServletResponse httpServletResponse = WebUtils.toHttp(response);\n           // optionoption\n           if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) {\n               httpServletResponse.setStatus(HttpStatus.OK.value());\n               return false;\n           }\n           return super.preHandle(request, response);\n       }\n   \n       /**\n        * \n        */\n       @Override\n       protected void postHandle(ServletRequest request, ServletResponse response) {\n           // \n           this.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));\n       }\n   \n       /**\n        * \n        *  true \n        * false  onAccessDenied()\n        */\n       @Override\n       protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) {\n           // Header JWT token \n           if (this.isLoginRequest(request, response))\n               return false;\n           boolean allowed = false;\n           try {\n               // Header JWT token token\n               allowed = executeLogin(request, response);\n           } catch (IllegalStateException e) { // not found any token\n               log.error(\"Not found any token\");\n           } catch (Exception e) {\n               log.error(\"Error occurs when login\", e);\n           }\n           return allowed || super.isPermissive(mappedValue);\n       }\n   \n       /**\n        * Header JWT token \n        */\n       @Override\n       protected boolean isLoginAttempt(ServletRequest request, ServletResponse response) {\n           return ((HttpServletRequest) request).getHeader(JwtUtils.AUTH_HEADER) == null;\n       }\n   \n       /**\n        * , JWT token \n        */\n       @Override\n       protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception {\n           AuthenticationToken token = createToken(request, response);\n           if (token == null) {\n               String msg = \"createToken method implementation returned null. A valid non-null AuthenticationToken \"\n                       + \"must be created in order to execute a login attempt.\";\n               throw new IllegalStateException(msg);\n           }\n           try {\n               Subject subject = getSubject(request, response);\n               subject.login(token); //  Shiro \n               return onLoginSuccess(token, subject, request, response);\n           } catch (AuthenticationException e) {\n               return onLoginFailure(token, e, request, response);\n           }\n       }\n   \n       /**\n        *  Header  JWT token\n        */\n       @Override\n       protected AuthenticationToken createToken(ServletRequest servletRequest, ServletResponse servletResponse) {\n           HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n           String authorization = httpServletRequest.getHeader(JwtUtils.AUTH_HEADER);\n           JwtToken token = new JwtToken(authorization);\n           return token;\n       }\n   \n       /**\n        * isAccessAllowed()false\n        */\n       @Override\n       protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(servletResponse);\n           httpResponse.setCharacterEncoding(\"UTF-8\");\n           httpResponse.setContentType(\"application/json;charset=UTF-8\");\n           httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());\n           PrintWriter writer = httpResponse.getWriter();\n           writer.write(\"{\\\"errCode\\\": 401, \\\"msg\\\": \\\"UNAUTHORIZED\\\"}\");\n           fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);\n           return false;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginSuccess(AuthenticationToken token, Subject subject, ServletRequest request,\n                                        ServletResponse response) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(response);\n           String newToken = null;\n           if (token instanceof JwtToken) {\n               newToken = JwtUtils.refreshTokenExpired(token.getCredentials().toString(), JwtUtils.SECRET);\n           }\n           if (newToken != null)\n               httpResponse.setHeader(JwtUtils.AUTH_HEADER, newToken);\n           return true;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request,\n                                        ServletResponse response) {\n           //  false   onAccessDenied()\n           return false;\n       }\n   \n       /**\n        * \n        */\n       protected void fillCorsHeader(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\n           httpServletResponse.setHeader(\"Access-control-Allow-Origin\", httpServletRequest.getHeader(\"Origin\"));\n           httpServletResponse.setHeader(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS,HEAD\");\n           httpServletResponse.setHeader(\"Access-Control-Allow-Headers\",\n                   httpServletRequest.getHeader(\"Access-Control-Request-Headers\"));\n       }\n   }\n   ```\n\n   \n\n2.  JWT token\n\n   ```java\n   public class JwtToken implements AuthenticationToken {\n       private static final long serialVersionUID = 1L;\n   \n       //  JWT token\n       private String token;\n   \n       private String userName;\n   \n       public JwtToken(String token) {\n           this.token = token;\n           this.userName = JwtUtils.getClaimFiled(token, \"username\");\n       }\n   \n       @Override\n       public Object getPrincipal() {\n           return this.userName;\n       }\n   \n       @Override\n       public Object getCredentials() {\n           return token;\n       }\n   }\n   ```\n\n   \n\n3.  JWT Realm\n\n   \n\n   ```java\n   public class JwtRealm  extends AuthorizingRealm {\n       /**\n        *  Realm  JwtToken\n        */\n       @Override\n       public boolean supports(AuthenticationToken token) {\n           return token instanceof JwtToken;\n       }\n   \n       /**\n        *  SimpleAuthenticationInfo \n        */\n       @Override\n       protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authcToken)\n               throws AuthenticationException {\n           JwtToken jwtToken = (JwtToken) authcToken;\n           if (jwtToken.getPrincipal() == null) {\n               throw new AccountException(\"JWT token\");\n           }\n           //  JwtToken \n           String username = jwtToken.getPrincipal().toString();\n           //  Map \n           UserEntity user = ShiroRealm.userMap.get(username);\n   \n           // \n           if (user == null) {\n               throw new UnknownAccountException(\"\");\n           }\n   \n           // \n           if (user.getLocked()) {\n               throw new LockedAccountException(\",\");\n           }\n   \n           SimpleAuthenticationInfo info = new SimpleAuthenticationInfo(user, username, getName());\n           return info;\n       }\n   \n       @Override\n       protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {\n           // \n           UserEntity currentUser = (UserEntity) SecurityUtils.getSubject().getPrincipal();\n           // UserEntity currentUser = (UserEntity) principals.getPrimaryPrincipal();\n           // \n           Set<String> roles = ShiroRealm.roleMap.get(currentUser.getName());\n           // \n           Set<String> perms = ShiroRealm.permMap.get(currentUser.getName());\n           SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();\n           info.setRoles(roles);\n           info.setStringPermissions(perms);\n           return info;\n       }\n   }\n   \n   ```\n\n   \n\n4.  JWT creadentialsMatcher\n\n    token \n\n   ```java\n   @Slf4j\n   public class JwtCredentialsMatcher  implements CredentialsMatcher {\n       /**\n        * JwtCredentialsMatcherJwtToken\n        */\n       @Override\n       public boolean doCredentialsMatch(AuthenticationToken authenticationToken, AuthenticationInfo authenticationInfo) {\n   \n           String token = authenticationToken.getCredentials().toString();\n           String username = authenticationToken.getPrincipal().toString();\n           try {\n               Algorithm algorithm = Algorithm.HMAC256(JwtUtils.SECRET);\n               JWTVerifier verifier = JWT.require(algorithm).withClaim(\"username\", username).build();\n               verifier.verify(token);\n               return true;\n           } catch (JWTVerificationException e) {\n               log.error(e.getMessage());\n           }\n           return false;\n       }\n   \n   }\n   ```\n\n   \n\n5.  JWT  shiro \n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n   \n   \n       /**\n        *  Spring  Shiro-Bean \n        */\n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        *  Spring-Bean  Shiro \n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) {\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       @Bean\n       public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() {\n           DefaultAdvisorAutoProxyCreator app = new DefaultAdvisorAutoProxyCreator();\n           app.setProxyTargetClass(true);\n           return app;\n   \n       }\n   \n       /**\n        *  Spring JwtFilter Bean Spring  JwtFilter \n        *  /login  /logout \n        *  jwtFilter() @Bean \n        */\n       @Bean\n       public FilterRegistrationBean<Filter> registration(JwtFilter filter) {\n           FilterRegistrationBean<Filter> registration = new FilterRegistrationBean<Filter>(filter);\n           registration.setEnabled(false);\n           return registration;\n       }\n   \n       @Bean\n       public JwtFilter jwtFilter() {\n           return new JwtFilter();\n       }\n   \n       /**\n        * \n        */\n       @Bean\n       ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) {\n           ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           shiroFilterFactoryBean.setSuccessUrl(\"/authorized\");\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/unauthorized\");\n   \n           //  jwt  /login  /logout \n           Map<String, Filter> filterMap = new LinkedHashMap<>();\n           filterMap.put(\"jwtFilter\", jwtFilter());\n           shiroFilterFactoryBean.setFilters(filterMap);\n   \n           LinkedHashMap<String, String> filterChainDefinitionMap = new LinkedHashMap<String, String>();\n           filterChainDefinitionMap.put(\"/login\", \"anon\"); // \n   //        filterChainDefinitionMap.put(\"/logout\", \"logout\"); // \n           filterChainDefinitionMap.put(\"/**\", \"jwtFilter,authc\"); // \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n       /**\n        *  ModularRealmAuthenticator\n        */\n       @Bean\n       public ModularRealmAuthenticator authenticator() {\n           ModularRealmAuthenticator authenticator = new MultiRealmAuthenticator();\n           //  Realm AtLeastOneSuccessfulStrategy\n           AuthenticationStrategy strategy = new FirstSuccessfulStrategy();\n           authenticator.setAuthenticationStrategy(strategy);\n           return authenticator;\n       }\n   \n       /**\n        * session, \n        */\n       @Bean\n       protected SessionStorageEvaluator sessionStorageEvaluator() {\n           DefaultSessionStorageEvaluator sessionStorageEvaluator = new DefaultSessionStorageEvaluator();\n           sessionStorageEvaluator.setSessionStorageEnabled(false);\n           return sessionStorageEvaluator;\n       }\n   \n       /**\n        * JwtRealm  Realm \n        */\n       @Bean\n       JwtRealm jwtRealm() {\n           JwtRealm jwtRealm = new JwtRealm();\n           // \n           CredentialsMatcher credentialsMatcher = new JwtCredentialsMatcher();\n           // \n           jwtRealm.setCredentialsMatcher(credentialsMatcher);\n           return jwtRealm;\n       }\n   \n       /**\n        * ShiroRealm  Realm \n        */\n       @Bean\n       ShiroRealm shiroRealm() {\n           ShiroRealm shiroRealm = new ShiroRealm();\n           // \n           HashedCredentialsMatcher credentialsMatcher = new HashedCredentialsMatcher(\"SHA-1\");\n           // \n           credentialsMatcher.setHashIterations(16);\n           shiroRealm.setCredentialsMatcher(credentialsMatcher);\n           return shiroRealm;\n       }\n   \n       /**\n        *  SecurityManager\n        */\n       @Bean\n       public SecurityManager securityManager() {\n           DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();\n   \n           // 1.Authenticator\n           securityManager.setAuthenticator(authenticator());\n   \n           // 2.Realm\n           List<Realm> realms = new ArrayList<Realm>(16);\n           realms.add(jwtRealm());\n           realms.add(shiroRealm());\n           securityManager.setRealms(realms);\n   \n           // 3.shirosession\n           DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO();\n           subjectDAO.setSessionStorageEvaluator(sessionStorageEvaluator());\n           securityManager.setSubjectDAO(subjectDAO);\n   \n           return securityManager;\n       }\n   }\n   \n   ```\n\n### JWT \n\n1. JWT token tokensubject.logout sessiontokentoken\n\n   \n\n   1. tokenredis\n   2. tokenredis\n\n   redissessionId\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_jwt)\n","source":"_posts/spring/springboot/shiro/shiro-jwt.md","raw":"---\ntitle: shiro + jwt \ndate: 2021-06-15 20:20:14\ncategories:\n  - spring\n  - springboot\n  - shiro\ntags:\n  - springboot\n  - shiro\n  - jwt\n---\n\n### jwt \n\n> JSON Web Token (JWT)(RFC 7519)JSON\n\nJSON Web Token(.)\n\n- Header\n- Payload\n- Signature\n\nJWT\n\n> xxxxx.yyyyy.zzzzz\n\n### shiroJWT\n\n1.  JWT filter\n\n   shiro url  JWT jwt\n\n   ```java\n   @Slf4j\n   public class JwtFilter extends BasicHttpAuthenticationFilter {\n       /**\n        * \n        */\n       @Override\n       protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {\n           HttpServletRequest httpServletRequest = WebUtils.toHttp(request);\n           HttpServletResponse httpServletResponse = WebUtils.toHttp(response);\n           // optionoption\n           if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) {\n               httpServletResponse.setStatus(HttpStatus.OK.value());\n               return false;\n           }\n           return super.preHandle(request, response);\n       }\n   \n       /**\n        * \n        */\n       @Override\n       protected void postHandle(ServletRequest request, ServletResponse response) {\n           // \n           this.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));\n       }\n   \n       /**\n        * \n        *  true \n        * false  onAccessDenied()\n        */\n       @Override\n       protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) {\n           // Header JWT token \n           if (this.isLoginRequest(request, response))\n               return false;\n           boolean allowed = false;\n           try {\n               // Header JWT token token\n               allowed = executeLogin(request, response);\n           } catch (IllegalStateException e) { // not found any token\n               log.error(\"Not found any token\");\n           } catch (Exception e) {\n               log.error(\"Error occurs when login\", e);\n           }\n           return allowed || super.isPermissive(mappedValue);\n       }\n   \n       /**\n        * Header JWT token \n        */\n       @Override\n       protected boolean isLoginAttempt(ServletRequest request, ServletResponse response) {\n           return ((HttpServletRequest) request).getHeader(JwtUtils.AUTH_HEADER) == null;\n       }\n   \n       /**\n        * , JWT token \n        */\n       @Override\n       protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception {\n           AuthenticationToken token = createToken(request, response);\n           if (token == null) {\n               String msg = \"createToken method implementation returned null. A valid non-null AuthenticationToken \"\n                       + \"must be created in order to execute a login attempt.\";\n               throw new IllegalStateException(msg);\n           }\n           try {\n               Subject subject = getSubject(request, response);\n               subject.login(token); //  Shiro \n               return onLoginSuccess(token, subject, request, response);\n           } catch (AuthenticationException e) {\n               return onLoginFailure(token, e, request, response);\n           }\n       }\n   \n       /**\n        *  Header  JWT token\n        */\n       @Override\n       protected AuthenticationToken createToken(ServletRequest servletRequest, ServletResponse servletResponse) {\n           HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n           String authorization = httpServletRequest.getHeader(JwtUtils.AUTH_HEADER);\n           JwtToken token = new JwtToken(authorization);\n           return token;\n       }\n   \n       /**\n        * isAccessAllowed()false\n        */\n       @Override\n       protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(servletResponse);\n           httpResponse.setCharacterEncoding(\"UTF-8\");\n           httpResponse.setContentType(\"application/json;charset=UTF-8\");\n           httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());\n           PrintWriter writer = httpResponse.getWriter();\n           writer.write(\"{\\\"errCode\\\": 401, \\\"msg\\\": \\\"UNAUTHORIZED\\\"}\");\n           fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);\n           return false;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginSuccess(AuthenticationToken token, Subject subject, ServletRequest request,\n                                        ServletResponse response) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(response);\n           String newToken = null;\n           if (token instanceof JwtToken) {\n               newToken = JwtUtils.refreshTokenExpired(token.getCredentials().toString(), JwtUtils.SECRET);\n           }\n           if (newToken != null)\n               httpResponse.setHeader(JwtUtils.AUTH_HEADER, newToken);\n           return true;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request,\n                                        ServletResponse response) {\n           //  false   onAccessDenied()\n           return false;\n       }\n   \n       /**\n        * \n        */\n       protected void fillCorsHeader(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\n           httpServletResponse.setHeader(\"Access-control-Allow-Origin\", httpServletRequest.getHeader(\"Origin\"));\n           httpServletResponse.setHeader(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS,HEAD\");\n           httpServletResponse.setHeader(\"Access-Control-Allow-Headers\",\n                   httpServletRequest.getHeader(\"Access-Control-Request-Headers\"));\n       }\n   }\n   ```\n\n   \n\n2.  JWT token\n\n   ```java\n   public class JwtToken implements AuthenticationToken {\n       private static final long serialVersionUID = 1L;\n   \n       //  JWT token\n       private String token;\n   \n       private String userName;\n   \n       public JwtToken(String token) {\n           this.token = token;\n           this.userName = JwtUtils.getClaimFiled(token, \"username\");\n       }\n   \n       @Override\n       public Object getPrincipal() {\n           return this.userName;\n       }\n   \n       @Override\n       public Object getCredentials() {\n           return token;\n       }\n   }\n   ```\n\n   \n\n3.  JWT Realm\n\n   \n\n   ```java\n   public class JwtRealm  extends AuthorizingRealm {\n       /**\n        *  Realm  JwtToken\n        */\n       @Override\n       public boolean supports(AuthenticationToken token) {\n           return token instanceof JwtToken;\n       }\n   \n       /**\n        *  SimpleAuthenticationInfo \n        */\n       @Override\n       protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authcToken)\n               throws AuthenticationException {\n           JwtToken jwtToken = (JwtToken) authcToken;\n           if (jwtToken.getPrincipal() == null) {\n               throw new AccountException(\"JWT token\");\n           }\n           //  JwtToken \n           String username = jwtToken.getPrincipal().toString();\n           //  Map \n           UserEntity user = ShiroRealm.userMap.get(username);\n   \n           // \n           if (user == null) {\n               throw new UnknownAccountException(\"\");\n           }\n   \n           // \n           if (user.getLocked()) {\n               throw new LockedAccountException(\",\");\n           }\n   \n           SimpleAuthenticationInfo info = new SimpleAuthenticationInfo(user, username, getName());\n           return info;\n       }\n   \n       @Override\n       protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {\n           // \n           UserEntity currentUser = (UserEntity) SecurityUtils.getSubject().getPrincipal();\n           // UserEntity currentUser = (UserEntity) principals.getPrimaryPrincipal();\n           // \n           Set<String> roles = ShiroRealm.roleMap.get(currentUser.getName());\n           // \n           Set<String> perms = ShiroRealm.permMap.get(currentUser.getName());\n           SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();\n           info.setRoles(roles);\n           info.setStringPermissions(perms);\n           return info;\n       }\n   }\n   \n   ```\n\n   \n\n4.  JWT creadentialsMatcher\n\n    token \n\n   ```java\n   @Slf4j\n   public class JwtCredentialsMatcher  implements CredentialsMatcher {\n       /**\n        * JwtCredentialsMatcherJwtToken\n        */\n       @Override\n       public boolean doCredentialsMatch(AuthenticationToken authenticationToken, AuthenticationInfo authenticationInfo) {\n   \n           String token = authenticationToken.getCredentials().toString();\n           String username = authenticationToken.getPrincipal().toString();\n           try {\n               Algorithm algorithm = Algorithm.HMAC256(JwtUtils.SECRET);\n               JWTVerifier verifier = JWT.require(algorithm).withClaim(\"username\", username).build();\n               verifier.verify(token);\n               return true;\n           } catch (JWTVerificationException e) {\n               log.error(e.getMessage());\n           }\n           return false;\n       }\n   \n   }\n   ```\n\n   \n\n5.  JWT  shiro \n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n   \n   \n       /**\n        *  Spring  Shiro-Bean \n        */\n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        *  Spring-Bean  Shiro \n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) {\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       @Bean\n       public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() {\n           DefaultAdvisorAutoProxyCreator app = new DefaultAdvisorAutoProxyCreator();\n           app.setProxyTargetClass(true);\n           return app;\n   \n       }\n   \n       /**\n        *  Spring JwtFilter Bean Spring  JwtFilter \n        *  /login  /logout \n        *  jwtFilter() @Bean \n        */\n       @Bean\n       public FilterRegistrationBean<Filter> registration(JwtFilter filter) {\n           FilterRegistrationBean<Filter> registration = new FilterRegistrationBean<Filter>(filter);\n           registration.setEnabled(false);\n           return registration;\n       }\n   \n       @Bean\n       public JwtFilter jwtFilter() {\n           return new JwtFilter();\n       }\n   \n       /**\n        * \n        */\n       @Bean\n       ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) {\n           ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           shiroFilterFactoryBean.setSuccessUrl(\"/authorized\");\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/unauthorized\");\n   \n           //  jwt  /login  /logout \n           Map<String, Filter> filterMap = new LinkedHashMap<>();\n           filterMap.put(\"jwtFilter\", jwtFilter());\n           shiroFilterFactoryBean.setFilters(filterMap);\n   \n           LinkedHashMap<String, String> filterChainDefinitionMap = new LinkedHashMap<String, String>();\n           filterChainDefinitionMap.put(\"/login\", \"anon\"); // \n   //        filterChainDefinitionMap.put(\"/logout\", \"logout\"); // \n           filterChainDefinitionMap.put(\"/**\", \"jwtFilter,authc\"); // \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n       /**\n        *  ModularRealmAuthenticator\n        */\n       @Bean\n       public ModularRealmAuthenticator authenticator() {\n           ModularRealmAuthenticator authenticator = new MultiRealmAuthenticator();\n           //  Realm AtLeastOneSuccessfulStrategy\n           AuthenticationStrategy strategy = new FirstSuccessfulStrategy();\n           authenticator.setAuthenticationStrategy(strategy);\n           return authenticator;\n       }\n   \n       /**\n        * session, \n        */\n       @Bean\n       protected SessionStorageEvaluator sessionStorageEvaluator() {\n           DefaultSessionStorageEvaluator sessionStorageEvaluator = new DefaultSessionStorageEvaluator();\n           sessionStorageEvaluator.setSessionStorageEnabled(false);\n           return sessionStorageEvaluator;\n       }\n   \n       /**\n        * JwtRealm  Realm \n        */\n       @Bean\n       JwtRealm jwtRealm() {\n           JwtRealm jwtRealm = new JwtRealm();\n           // \n           CredentialsMatcher credentialsMatcher = new JwtCredentialsMatcher();\n           // \n           jwtRealm.setCredentialsMatcher(credentialsMatcher);\n           return jwtRealm;\n       }\n   \n       /**\n        * ShiroRealm  Realm \n        */\n       @Bean\n       ShiroRealm shiroRealm() {\n           ShiroRealm shiroRealm = new ShiroRealm();\n           // \n           HashedCredentialsMatcher credentialsMatcher = new HashedCredentialsMatcher(\"SHA-1\");\n           // \n           credentialsMatcher.setHashIterations(16);\n           shiroRealm.setCredentialsMatcher(credentialsMatcher);\n           return shiroRealm;\n       }\n   \n       /**\n        *  SecurityManager\n        */\n       @Bean\n       public SecurityManager securityManager() {\n           DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();\n   \n           // 1.Authenticator\n           securityManager.setAuthenticator(authenticator());\n   \n           // 2.Realm\n           List<Realm> realms = new ArrayList<Realm>(16);\n           realms.add(jwtRealm());\n           realms.add(shiroRealm());\n           securityManager.setRealms(realms);\n   \n           // 3.shirosession\n           DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO();\n           subjectDAO.setSessionStorageEvaluator(sessionStorageEvaluator());\n           securityManager.setSubjectDAO(subjectDAO);\n   \n           return securityManager;\n       }\n   }\n   \n   ```\n\n### JWT \n\n1. JWT token tokensubject.logout sessiontokentoken\n\n   \n\n   1. tokenredis\n   2. tokenredis\n\n   redissessionId\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_jwt)\n","slug":"spring/springboot/shiro/shiro-jwt","published":1,"updated":"2022-05-10T08:25:56.402Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4qa009sxklo8scg6u6m","content":"<h3 id=\"jwt-\"><a href=\"#jwt-\" class=\"headerlink\" title=\"jwt \"></a>jwt </h3><blockquote>\n<p>JSON Web Token (JWT)(RFC 7519)JSON</p>\n</blockquote>\n<p>JSON Web Token(.)</p>\n<ul>\n<li>Header</li>\n<li>Payload</li>\n<li>Signature</li>\n</ul>\n<p>JWT</p>\n<blockquote>\n<p>xxxxx.yyyyy.zzzzz</p>\n</blockquote>\n<h3 id=\"shiroJWT\"><a href=\"#shiroJWT\" class=\"headerlink\" title=\"shiroJWT\"></a>shiroJWT</h3><ol>\n<li><p> JWT filter</p>\n<p>shiro url  JWT jwt</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtFilter</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BasicHttpAuthenticationFilter</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> WebUtils.toHttp(request);</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpServletResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"comment\">// optionoption</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class=\"line\">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.preHandle(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *  true </span></span><br><span class=\"line\"><span class=\"comment\">     * false  onAccessDenied()</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isAccessAllowed</span><span class=\"params\">(ServletRequest request, ServletResponse response, Object mappedValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Header JWT token </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.isLoginRequest(request, response))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">allowed</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Header JWT token token</span></span><br><span class=\"line\">            allowed = executeLogin(request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalStateException e) &#123; <span class=\"comment\">// not found any token</span></span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Not found any token&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Error occurs when login&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> allowed || <span class=\"built_in\">super</span>.isPermissive(mappedValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Header JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isLoginAttempt</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((HttpServletRequest) request).getHeader(JwtUtils.AUTH_HEADER) == <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * , JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">executeLogin</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthenticationToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> createToken(request, response);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;createToken method implementation returned null. A valid non-null AuthenticationToken &quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot;must be created in order to execute a login attempt.&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Subject</span> <span class=\"variable\">subject</span> <span class=\"operator\">=</span> getSubject(request, response);</span><br><span class=\"line\">            subject.login(token); <span class=\"comment\">//  Shiro </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginSuccess(token, subject, request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginFailure(token, e, request, response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Header  JWT token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationToken <span class=\"title function_\">createToken</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">authorization</span> <span class=\"operator\">=</span> httpServletRequest.getHeader(JwtUtils.AUTH_HEADER);</span><br><span class=\"line\">        <span class=\"type\">JwtToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtToken</span>(authorization);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * isAccessAllowed()false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onAccessDenied</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(servletResponse);</span><br><span class=\"line\">        httpResponse.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setContentType(<span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> httpResponse.getWriter();</span><br><span class=\"line\">        writer.write(<span class=\"string\">&quot;&#123;\\&quot;errCode\\&quot;: 401, \\&quot;msg\\&quot;: \\&quot;UNAUTHORIZED\\&quot;&#125;&quot;</span>);</span><br><span class=\"line\">        fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginSuccess</span><span class=\"params\">(AuthenticationToken token, Subject subject, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">newToken</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token <span class=\"keyword\">instanceof</span> JwtToken) &#123;</span><br><span class=\"line\">            newToken = JwtUtils.refreshTokenExpired(token.getCredentials().toString(), JwtUtils.SECRET);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newToken != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            httpResponse.setHeader(JwtUtils.AUTH_HEADER, newToken);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginFailure</span><span class=\"params\">(AuthenticationToken token, AuthenticationException e, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  false   onAccessDenied()</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">fillCorsHeader</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class=\"string\">&quot;Origin&quot;</span>));</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;GET,POST,OPTIONS,HEAD&quot;</span>);</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class=\"line\">                httpServletRequest.getHeader(<span class=\"string\">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT token</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtToken</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">AuthenticationToken</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">serialVersionUID</span> <span class=\"operator\">=</span> <span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  JWT token</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">JwtToken</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.token = token;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.userName = JwtUtils.getClaimFiled(token, <span class=\"string\">&quot;username&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">getPrincipal</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">getCredentials</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT Realm</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtRealm</span>  <span class=\"keyword\">extends</span> <span class=\"title class_\">AuthorizingRealm</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Realm  JwtToken</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(AuthenticationToken token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token <span class=\"keyword\">instanceof</span> JwtToken;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SimpleAuthenticationInfo </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationInfo <span class=\"title function_\">doGetAuthenticationInfo</span><span class=\"params\">(AuthenticationToken authcToken)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> AuthenticationException &#123;</span><br><span class=\"line\">        <span class=\"type\">JwtToken</span> <span class=\"variable\">jwtToken</span> <span class=\"operator\">=</span> (JwtToken) authcToken;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jwtToken.getPrincipal() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AccountException</span>(<span class=\"string\">&quot;JWT token&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  JwtToken </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> jwtToken.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"comment\">//  Map </span></span><br><span class=\"line\">        <span class=\"type\">UserEntity</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> ShiroRealm.userMap.get(username);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UnknownAccountException</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user.getLocked()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LockedAccountException</span>(<span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SimpleAuthenticationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthenticationInfo</span>(user, username, getName());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthorizationInfo <span class=\"title function_\">doGetAuthorizationInfo</span><span class=\"params\">(PrincipalCollection principals)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">UserEntity</span> <span class=\"variable\">currentUser</span> <span class=\"operator\">=</span> (UserEntity) SecurityUtils.getSubject().getPrincipal();</span><br><span class=\"line\">        <span class=\"comment\">// UserEntity currentUser = (UserEntity) principals.getPrimaryPrincipal();</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        Set&lt;String&gt; roles = ShiroRealm.roleMap.get(currentUser.getName());</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        Set&lt;String&gt; perms = ShiroRealm.permMap.get(currentUser.getName());</span><br><span class=\"line\">        <span class=\"type\">SimpleAuthorizationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthorizationInfo</span>();</span><br><span class=\"line\">        info.setRoles(roles);</span><br><span class=\"line\">        info.setStringPermissions(perms);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT creadentialsMatcher</p>\n<p> token </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtCredentialsMatcher</span>  <span class=\"keyword\">implements</span> <span class=\"title class_\">CredentialsMatcher</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * JwtCredentialsMatcherJwtToken</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">doCredentialsMatch</span><span class=\"params\">(AuthenticationToken authenticationToken, AuthenticationInfo authenticationInfo)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> authenticationToken.getCredentials().toString();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> authenticationToken.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Algorithm</span> <span class=\"variable\">algorithm</span> <span class=\"operator\">=</span> Algorithm.HMAC256(JwtUtils.SECRET);</span><br><span class=\"line\">            <span class=\"type\">JWTVerifier</span> <span class=\"variable\">verifier</span> <span class=\"operator\">=</span> JWT.require(algorithm).withClaim(<span class=\"string\">&quot;username&quot;</span>, username).build();</span><br><span class=\"line\">            verifier.verify(token);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JWTVerificationException e) &#123;</span><br><span class=\"line\">            log.error(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT  shiro </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring  Shiro-Bean </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring-Bean  Shiro </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultAdvisorAutoProxyCreator <span class=\"title function_\">defaultAdvisorAutoProxyCreator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultAdvisorAutoProxyCreator</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class=\"line\">        app.setProxyTargetClass(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> app;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring JwtFilter Bean Spring  JwtFilter </span></span><br><span class=\"line\"><span class=\"comment\">     *  /login  /logout </span></span><br><span class=\"line\"><span class=\"comment\">     *  jwtFilter() <span class=\"doctag\">@Bean</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> FilterRegistrationBean&lt;Filter&gt; <span class=\"title function_\">registration</span><span class=\"params\">(JwtFilter filter)</span> &#123;</span><br><span class=\"line\">        FilterRegistrationBean&lt;Filter&gt; registration = <span class=\"keyword\">new</span> <span class=\"title class_\">FilterRegistrationBean</span>&lt;Filter&gt;(filter);</span><br><span class=\"line\">        registration.setEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> registration;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JwtFilter <span class=\"title function_\">jwtFilter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtFilter</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroFilterFactoryBean <span class=\"title function_\">shiroFilterFactoryBean</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/authorized&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/unauthorized&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  jwt  /login  /logout </span></span><br><span class=\"line\">        Map&lt;String, Filter&gt; filterMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        filterMap.put(<span class=\"string\">&quot;jwtFilter&quot;</span>, jwtFilter());</span><br><span class=\"line\">        shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class=\"line\"></span><br><span class=\"line\">        LinkedHashMap&lt;String, String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"string\">&quot;anon&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//        filterChainDefinitionMap.put(&quot;/logout&quot;, &quot;logout&quot;); // </span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;jwtFilter,authc&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  ModularRealmAuthenticator</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ModularRealmAuthenticator <span class=\"title function_\">authenticator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ModularRealmAuthenticator</span> <span class=\"variable\">authenticator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MultiRealmAuthenticator</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  Realm AtLeastOneSuccessfulStrategy</span></span><br><span class=\"line\">        <span class=\"type\">AuthenticationStrategy</span> <span class=\"variable\">strategy</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FirstSuccessfulStrategy</span>();</span><br><span class=\"line\">        authenticator.setAuthenticationStrategy(strategy);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authenticator;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * session, </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> SessionStorageEvaluator <span class=\"title function_\">sessionStorageEvaluator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultSessionStorageEvaluator</span> <span class=\"variable\">sessionStorageEvaluator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultSessionStorageEvaluator</span>();</span><br><span class=\"line\">        sessionStorageEvaluator.setSessionStorageEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sessionStorageEvaluator;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * JwtRealm  Realm </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    JwtRealm <span class=\"title function_\">jwtRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">JwtRealm</span> <span class=\"variable\">jwtRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtRealm</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">CredentialsMatcher</span> <span class=\"variable\">credentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtCredentialsMatcher</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        jwtRealm.setCredentialsMatcher(credentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jwtRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroRealm  Realm </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroRealm <span class=\"title function_\">shiroRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroRealm</span> <span class=\"variable\">shiroRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroRealm</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">HashedCredentialsMatcher</span> <span class=\"variable\">credentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HashedCredentialsMatcher</span>(<span class=\"string\">&quot;SHA-1&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        credentialsMatcher.setHashIterations(<span class=\"number\">16</span>);</span><br><span class=\"line\">        shiroRealm.setCredentialsMatcher(credentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.Authenticator</span></span><br><span class=\"line\">        securityManager.setAuthenticator(authenticator());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.Realm</span></span><br><span class=\"line\">        List&lt;Realm&gt; realms = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Realm&gt;(<span class=\"number\">16</span>);</span><br><span class=\"line\">        realms.add(jwtRealm());</span><br><span class=\"line\">        realms.add(shiroRealm());</span><br><span class=\"line\">        securityManager.setRealms(realms);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.shirosession</span></span><br><span class=\"line\">        <span class=\"type\">DefaultSubjectDAO</span> <span class=\"variable\">subjectDAO</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultSubjectDAO</span>();</span><br><span class=\"line\">        subjectDAO.setSessionStorageEvaluator(sessionStorageEvaluator());</span><br><span class=\"line\">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"JWT-\"><a href=\"#JWT-\" class=\"headerlink\" title=\"JWT \"></a>JWT </h3><ol>\n<li><p>JWT token tokensubject.logout sessiontokentoken</p>\n<p></p>\n<ol>\n<li>tokenredis</li>\n<li>tokenredis</li>\n</ol>\n<p>redissessionId</p>\n</li>\n</ol>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_jwt\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"jwt-\"><a href=\"#jwt-\" class=\"headerlink\" title=\"jwt \"></a>jwt </h3><blockquote>\n<p>JSON Web Token (JWT)(RFC 7519)JSON</p>\n</blockquote>\n<p>JSON Web Token(.)</p>\n<ul>\n<li>Header</li>\n<li>Payload</li>\n<li>Signature</li>\n</ul>\n<p>JWT</p>\n<blockquote>\n<p>xxxxx.yyyyy.zzzzz</p>\n</blockquote>\n<h3 id=\"shiroJWT\"><a href=\"#shiroJWT\" class=\"headerlink\" title=\"shiroJWT\"></a>shiroJWT</h3><ol>\n<li><p> JWT filter</p>\n<p>shiro url  JWT jwt</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtFilter</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BasicHttpAuthenticationFilter</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> WebUtils.toHttp(request);</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpServletResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"comment\">// optionoption</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class=\"line\">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.preHandle(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *  true </span></span><br><span class=\"line\"><span class=\"comment\">     * false  onAccessDenied()</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isAccessAllowed</span><span class=\"params\">(ServletRequest request, ServletResponse response, Object mappedValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Header JWT token </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.isLoginRequest(request, response))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">allowed</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Header JWT token token</span></span><br><span class=\"line\">            allowed = executeLogin(request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalStateException e) &#123; <span class=\"comment\">// not found any token</span></span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Not found any token&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Error occurs when login&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> allowed || <span class=\"built_in\">super</span>.isPermissive(mappedValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Header JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isLoginAttempt</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((HttpServletRequest) request).getHeader(JwtUtils.AUTH_HEADER) == <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * , JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">executeLogin</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthenticationToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> createToken(request, response);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;createToken method implementation returned null. A valid non-null AuthenticationToken &quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot;must be created in order to execute a login attempt.&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Subject</span> <span class=\"variable\">subject</span> <span class=\"operator\">=</span> getSubject(request, response);</span><br><span class=\"line\">            subject.login(token); <span class=\"comment\">//  Shiro </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginSuccess(token, subject, request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginFailure(token, e, request, response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Header  JWT token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationToken <span class=\"title function_\">createToken</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">authorization</span> <span class=\"operator\">=</span> httpServletRequest.getHeader(JwtUtils.AUTH_HEADER);</span><br><span class=\"line\">        <span class=\"type\">JwtToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtToken</span>(authorization);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * isAccessAllowed()false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onAccessDenied</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(servletResponse);</span><br><span class=\"line\">        httpResponse.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setContentType(<span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> httpResponse.getWriter();</span><br><span class=\"line\">        writer.write(<span class=\"string\">&quot;&#123;\\&quot;errCode\\&quot;: 401, \\&quot;msg\\&quot;: \\&quot;UNAUTHORIZED\\&quot;&#125;&quot;</span>);</span><br><span class=\"line\">        fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginSuccess</span><span class=\"params\">(AuthenticationToken token, Subject subject, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">newToken</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token <span class=\"keyword\">instanceof</span> JwtToken) &#123;</span><br><span class=\"line\">            newToken = JwtUtils.refreshTokenExpired(token.getCredentials().toString(), JwtUtils.SECRET);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newToken != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            httpResponse.setHeader(JwtUtils.AUTH_HEADER, newToken);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginFailure</span><span class=\"params\">(AuthenticationToken token, AuthenticationException e, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  false   onAccessDenied()</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">fillCorsHeader</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class=\"string\">&quot;Origin&quot;</span>));</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;GET,POST,OPTIONS,HEAD&quot;</span>);</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class=\"line\">                httpServletRequest.getHeader(<span class=\"string\">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT token</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtToken</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">AuthenticationToken</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">serialVersionUID</span> <span class=\"operator\">=</span> <span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  JWT token</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">JwtToken</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.token = token;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.userName = JwtUtils.getClaimFiled(token, <span class=\"string\">&quot;username&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">getPrincipal</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">getCredentials</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT Realm</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtRealm</span>  <span class=\"keyword\">extends</span> <span class=\"title class_\">AuthorizingRealm</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Realm  JwtToken</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(AuthenticationToken token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token <span class=\"keyword\">instanceof</span> JwtToken;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SimpleAuthenticationInfo </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationInfo <span class=\"title function_\">doGetAuthenticationInfo</span><span class=\"params\">(AuthenticationToken authcToken)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> AuthenticationException &#123;</span><br><span class=\"line\">        <span class=\"type\">JwtToken</span> <span class=\"variable\">jwtToken</span> <span class=\"operator\">=</span> (JwtToken) authcToken;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jwtToken.getPrincipal() == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AccountException</span>(<span class=\"string\">&quot;JWT token&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  JwtToken </span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> jwtToken.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"comment\">//  Map </span></span><br><span class=\"line\">        <span class=\"type\">UserEntity</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> ShiroRealm.userMap.get(username);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UnknownAccountException</span>(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user.getLocked()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LockedAccountException</span>(<span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SimpleAuthenticationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthenticationInfo</span>(user, username, getName());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthorizationInfo <span class=\"title function_\">doGetAuthorizationInfo</span><span class=\"params\">(PrincipalCollection principals)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">UserEntity</span> <span class=\"variable\">currentUser</span> <span class=\"operator\">=</span> (UserEntity) SecurityUtils.getSubject().getPrincipal();</span><br><span class=\"line\">        <span class=\"comment\">// UserEntity currentUser = (UserEntity) principals.getPrimaryPrincipal();</span></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        Set&lt;String&gt; roles = ShiroRealm.roleMap.get(currentUser.getName());</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        Set&lt;String&gt; perms = ShiroRealm.permMap.get(currentUser.getName());</span><br><span class=\"line\">        <span class=\"type\">SimpleAuthorizationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthorizationInfo</span>();</span><br><span class=\"line\">        info.setRoles(roles);</span><br><span class=\"line\">        info.setStringPermissions(perms);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT creadentialsMatcher</p>\n<p> token </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtCredentialsMatcher</span>  <span class=\"keyword\">implements</span> <span class=\"title class_\">CredentialsMatcher</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * JwtCredentialsMatcherJwtToken</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">doCredentialsMatch</span><span class=\"params\">(AuthenticationToken authenticationToken, AuthenticationInfo authenticationInfo)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> authenticationToken.getCredentials().toString();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> authenticationToken.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Algorithm</span> <span class=\"variable\">algorithm</span> <span class=\"operator\">=</span> Algorithm.HMAC256(JwtUtils.SECRET);</span><br><span class=\"line\">            <span class=\"type\">JWTVerifier</span> <span class=\"variable\">verifier</span> <span class=\"operator\">=</span> JWT.require(algorithm).withClaim(<span class=\"string\">&quot;username&quot;</span>, username).build();</span><br><span class=\"line\">            verifier.verify(token);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JWTVerificationException e) &#123;</span><br><span class=\"line\">            log.error(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> JWT  shiro </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring  Shiro-Bean </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring-Bean  Shiro </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultAdvisorAutoProxyCreator <span class=\"title function_\">defaultAdvisorAutoProxyCreator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultAdvisorAutoProxyCreator</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class=\"line\">        app.setProxyTargetClass(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> app;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring JwtFilter Bean Spring  JwtFilter </span></span><br><span class=\"line\"><span class=\"comment\">     *  /login  /logout </span></span><br><span class=\"line\"><span class=\"comment\">     *  jwtFilter() <span class=\"doctag\">@Bean</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> FilterRegistrationBean&lt;Filter&gt; <span class=\"title function_\">registration</span><span class=\"params\">(JwtFilter filter)</span> &#123;</span><br><span class=\"line\">        FilterRegistrationBean&lt;Filter&gt; registration = <span class=\"keyword\">new</span> <span class=\"title class_\">FilterRegistrationBean</span>&lt;Filter&gt;(filter);</span><br><span class=\"line\">        registration.setEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> registration;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JwtFilter <span class=\"title function_\">jwtFilter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtFilter</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroFilterFactoryBean <span class=\"title function_\">shiroFilterFactoryBean</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/authorized&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/unauthorized&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  jwt  /login  /logout </span></span><br><span class=\"line\">        Map&lt;String, Filter&gt; filterMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        filterMap.put(<span class=\"string\">&quot;jwtFilter&quot;</span>, jwtFilter());</span><br><span class=\"line\">        shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class=\"line\"></span><br><span class=\"line\">        LinkedHashMap&lt;String, String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"string\">&quot;anon&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//        filterChainDefinitionMap.put(&quot;/logout&quot;, &quot;logout&quot;); // </span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;jwtFilter,authc&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  ModularRealmAuthenticator</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ModularRealmAuthenticator <span class=\"title function_\">authenticator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ModularRealmAuthenticator</span> <span class=\"variable\">authenticator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MultiRealmAuthenticator</span>();</span><br><span class=\"line\">        <span class=\"comment\">//  Realm AtLeastOneSuccessfulStrategy</span></span><br><span class=\"line\">        <span class=\"type\">AuthenticationStrategy</span> <span class=\"variable\">strategy</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FirstSuccessfulStrategy</span>();</span><br><span class=\"line\">        authenticator.setAuthenticationStrategy(strategy);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authenticator;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * session, </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> SessionStorageEvaluator <span class=\"title function_\">sessionStorageEvaluator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultSessionStorageEvaluator</span> <span class=\"variable\">sessionStorageEvaluator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultSessionStorageEvaluator</span>();</span><br><span class=\"line\">        sessionStorageEvaluator.setSessionStorageEnabled(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sessionStorageEvaluator;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * JwtRealm  Realm </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    JwtRealm <span class=\"title function_\">jwtRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">JwtRealm</span> <span class=\"variable\">jwtRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtRealm</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">CredentialsMatcher</span> <span class=\"variable\">credentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JwtCredentialsMatcher</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        jwtRealm.setCredentialsMatcher(credentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jwtRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ShiroRealm  Realm </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroRealm <span class=\"title function_\">shiroRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroRealm</span> <span class=\"variable\">shiroRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroRealm</span>();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"type\">HashedCredentialsMatcher</span> <span class=\"variable\">credentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HashedCredentialsMatcher</span>(<span class=\"string\">&quot;SHA-1&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        credentialsMatcher.setHashIterations(<span class=\"number\">16</span>);</span><br><span class=\"line\">        shiroRealm.setCredentialsMatcher(credentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1.Authenticator</span></span><br><span class=\"line\">        securityManager.setAuthenticator(authenticator());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2.Realm</span></span><br><span class=\"line\">        List&lt;Realm&gt; realms = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Realm&gt;(<span class=\"number\">16</span>);</span><br><span class=\"line\">        realms.add(jwtRealm());</span><br><span class=\"line\">        realms.add(shiroRealm());</span><br><span class=\"line\">        securityManager.setRealms(realms);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3.shirosession</span></span><br><span class=\"line\">        <span class=\"type\">DefaultSubjectDAO</span> <span class=\"variable\">subjectDAO</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultSubjectDAO</span>();</span><br><span class=\"line\">        subjectDAO.setSessionStorageEvaluator(sessionStorageEvaluator());</span><br><span class=\"line\">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"JWT-\"><a href=\"#JWT-\" class=\"headerlink\" title=\"JWT \"></a>JWT </h3><ol>\n<li><p>JWT token tokensubject.logout sessiontokentoken</p>\n<p></p>\n<ol>\n<li>tokenredis</li>\n<li>tokenredis</li>\n</ol>\n<p>redissessionId</p>\n</li>\n</ol>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_jwt\"></a></p>\n"},{"title":"shiro + redis + jwt ","date":"2021-06-15T12:20:38.000Z","_content":"\nshiro-redis  shiro-jwt \n\n1. \n2. \n3. \n4. ...\n\n session+redis\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_redis_token)\n","source":"_posts/spring/springboot/shiro/shiro-redis-jwt.md","raw":"---\ntitle: shiro + redis + jwt \ndate: 2021-06-15 20:20:38\ncategories:\n  - spring\n  - springboot\n  - shiro\ntags:\n  - springboot\n  - shiro\n  - jwt\n  - redis\n---\n\nshiro-redis  shiro-jwt \n\n1. \n2. \n3. \n4. ...\n\n session+redis\n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_redis_token)\n","slug":"spring/springboot/shiro/shiro-redis-jwt","published":1,"updated":"2022-05-10T08:25:56.402Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4qb009txklo6qpshaqt","content":"<p>shiro-redis  shiro-jwt </p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p> session+redis</p>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_redis_token\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>shiro-redis  shiro-jwt </p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p> session+redis</p>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_redis_token\"></a></p>\n"},{"title":"shiro ","date":"2021-06-15T12:21:42.000Z","_content":"\n1.  filter\n\n   \n\n   ```java\n   @Slf4j\n   public class CustomFilter extends BasicHttpAuthenticationFilter {\n       /**\n        * \n        */\n       @Override\n       protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {\n           HttpServletRequest httpServletRequest = WebUtils.toHttp(request);\n           HttpServletResponse httpServletResponse = WebUtils.toHttp(response);\n           // optionoption\n           if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) {\n               httpServletResponse.setStatus(HttpStatus.OK.value());\n               return false;\n           }\n           return super.preHandle(request, response);\n       }\n   \n       /**\n        * \n        */\n       @Override\n       protected void postHandle(ServletRequest request, ServletResponse response) {\n           // \n           this.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));\n       }\n   \n       /**\n        * \n        *  true \n        * false  onAccessDenied()\n        */\n       @Override\n       protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) {\n           // Header JWT token \n           if (this.isLoginRequest(request, response))\n               return false;\n           boolean allowed = false;\n           try {\n               // Header JWT token token\n               allowed = executeLogin(request, response);\n           } catch (IllegalStateException e) { // not found any token\n               log.error(\"Not found any token\");\n           } catch (Exception e) {\n               log.error(\"Error occurs when login\", e);\n           }\n           return allowed || super.isPermissive(mappedValue);\n       }\n   \n       /**\n        * Header JWT token \n        */\n       @Override\n       protected boolean isLoginAttempt(ServletRequest request, ServletResponse response) {\n           return ((HttpServletRequest) request).getHeader(\"Authorization\") == null;\n       }\n   \n       /**\n        * , JWT token \n        */\n       @Override\n       protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception {\n           AuthenticationToken token = createToken(request, response);\n           if (token == null) {\n               String msg = \"createToken method implementation returned null. A valid non-null AuthenticationToken \"\n                       + \"must be created in order to execute a login attempt.\";\n               throw new IllegalStateException(msg);\n           }\n           try {\n               Subject subject = getSubject(request, response);\n               subject.login(token); //  Shiro \n               return onLoginSuccess(token, subject, request, response);\n           } catch (AuthenticationException e) {\n               return onLoginFailure(token, e, request, response);\n           }\n       }\n   \n       /**\n        *  Header  JWT token\n        */\n       @Override\n       protected AuthenticationToken createToken(ServletRequest servletRequest, ServletResponse servletResponse) {\n           HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n           String authorization = httpServletRequest.getHeader(\"Authorization\");\n           CustomToken token = new CustomToken(authorization);\n           return token;\n       }\n   \n       /**\n        * isAccessAllowed()false\n        */\n       @Override\n       protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(servletResponse);\n           httpResponse.setCharacterEncoding(\"UTF-8\");\n           httpResponse.setContentType(\"application/json;charset=UTF-8\");\n           httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());\n           PrintWriter writer = httpResponse.getWriter();\n           writer.write(\"{\\\"errCode\\\": 401, \\\"msg\\\": \\\"UNAUTHORIZED\\\"}\");\n           fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);\n           return false;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginSuccess(AuthenticationToken token, Subject subject, ServletRequest request,\n                                        ServletResponse response) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(response);\n           String newToken = null;\n           if (token instanceof CustomToken) {\n               newToken = ((CustomToken) token).getToken();\n           }\n           if (newToken != null)\n               httpResponse.setHeader(\"Authorization\", newToken);\n           return true;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request,\n                                        ServletResponse response) {\n           //  false   onAccessDenied()\n           return false;\n       }\n   \n       /**\n        * \n        */\n       protected void fillCorsHeader(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\n           httpServletResponse.setHeader(\"Access-control-Allow-Origin\", httpServletRequest.getHeader(\"Origin\"));\n           httpServletResponse.setHeader(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS,HEAD\");\n           httpServletResponse.setHeader(\"Access-Control-Allow-Headers\",\n                   httpServletRequest.getHeader(\"Access-Control-Request-Headers\"));\n       }\n   ```\n\n   \n\n2.  realm\n\n    token credentialsMatcher \n\n   ```java\n   public class CustomRealm extends AuthorizingRealm {\n   \n       /**\n        * token\n        * @param token\n        * @return\n        */\n       @Override\n       public boolean supports(AuthenticationToken token) {\n           return token instanceof CustomToken;\n       }\n   \n       /**\n        *  {xx,yy}\n        * @param principals\n        * @return\n        */\n       @Override\n       protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {\n           SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();\n           Set<String> roles = new HashSet<>();\n           roles.add(\"xx\");\n           roles.add(\"yy\");\n           info.setRoles(roles);\n           info.setStringPermissions(roles);\n           return info;\n       }\n   \n       /**\n        * tokenss\n        * @param token\n        * @return\n        * @throws AuthenticationException\n        */\n       @Override\n       protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {\n           String t = token.getPrincipal().toString();\n           if (t.equals(\"ss\")) {\n               return new SimpleAuthenticationInfo(t, t, getName());\n           } else {\n               throw new AuthenticationException(\"xxx\");\n           }\n       }\n   ```\n\n   \n\n3.  credentialsMatcher\n\n   token\n   \n   ```java\n   public class CustomCredentialsMatcher implements CredentialsMatcher {\n   \n       /**\n        * token\n        * @param token\n        * @param info\n        * @return true false \n        */\n       @Override\n       public boolean doCredentialsMatch(AuthenticationToken token, AuthenticationInfo info) {\n           return true;\n       }\n   }\n   ```\n   \n   \n   \n4. filter,realm,creadentialsMatchershiro\n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n       /**\n        *  Spring  Shiro-Bean \n        */\n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        *  Spring-Bean  Shiro \n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) {\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       @Bean\n       public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() {\n           DefaultAdvisorAutoProxyCreator app = new DefaultAdvisorAutoProxyCreator();\n           app.setProxyTargetClass(true);\n           return app;\n   \n       }\n   \n       /**\n        * \n        */\n       @Bean\n       ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) {\n           ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           shiroFilterFactoryBean.setSuccessUrl(\"/authorized\");\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/unauthorized\");\n   \n           Map<String, Filter> filterMap = new LinkedHashMap<>();\n           CustomFilter customFilter = new CustomFilter();\n           filterMap.put(\"custom\", customFilter);\n           shiroFilterFactoryBean.setFilters(filterMap);\n   \n           LinkedHashMap<String, String> filterChainDefinitionMap = new LinkedHashMap<String, String>();\n           filterChainDefinitionMap.put(\"/login\", \"custom\"); // \n   //        filterChainDefinitionMap.put(\"/logout\", \"logout\"); // \n           filterChainDefinitionMap.put(\"/**\", \"custom\"); // \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n   \n       @Bean\n       CustomRealm customRealm() {\n           CustomRealm customRealm = new CustomRealm();\n           CustomCredentialsMatcher customCredentialsMatcher = new CustomCredentialsMatcher();\n           customRealm.setCredentialsMatcher(customCredentialsMatcher);\n           return customRealm;\n       }\n   \n   \n       /**\n        *  SecurityManager\n        */\n       @Bean\n       public SecurityManager securityManager() {\n           DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();\n           List<Realm> realms = new ArrayList<>(4);\n           realms.add(customRealm());\n           securityManager.setRealms(realms);\n           return securityManager;\n       }\n   ```\n\n   \n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_custom_encryption)\n\n","source":"_posts/spring/springboot/shiro/shiro-customer-encryption.md","raw":"---\ntitle: shiro \ndate: 2021-06-15 20:21:42\ncategories:\n  - spring\n  - springboot\n  - shiro\ntags:\n  - springboot\n  - shiro\n  - encryption\n---\n\n1.  filter\n\n   \n\n   ```java\n   @Slf4j\n   public class CustomFilter extends BasicHttpAuthenticationFilter {\n       /**\n        * \n        */\n       @Override\n       protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception {\n           HttpServletRequest httpServletRequest = WebUtils.toHttp(request);\n           HttpServletResponse httpServletResponse = WebUtils.toHttp(response);\n           // optionoption\n           if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) {\n               httpServletResponse.setStatus(HttpStatus.OK.value());\n               return false;\n           }\n           return super.preHandle(request, response);\n       }\n   \n       /**\n        * \n        */\n       @Override\n       protected void postHandle(ServletRequest request, ServletResponse response) {\n           // \n           this.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));\n       }\n   \n       /**\n        * \n        *  true \n        * false  onAccessDenied()\n        */\n       @Override\n       protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) {\n           // Header JWT token \n           if (this.isLoginRequest(request, response))\n               return false;\n           boolean allowed = false;\n           try {\n               // Header JWT token token\n               allowed = executeLogin(request, response);\n           } catch (IllegalStateException e) { // not found any token\n               log.error(\"Not found any token\");\n           } catch (Exception e) {\n               log.error(\"Error occurs when login\", e);\n           }\n           return allowed || super.isPermissive(mappedValue);\n       }\n   \n       /**\n        * Header JWT token \n        */\n       @Override\n       protected boolean isLoginAttempt(ServletRequest request, ServletResponse response) {\n           return ((HttpServletRequest) request).getHeader(\"Authorization\") == null;\n       }\n   \n       /**\n        * , JWT token \n        */\n       @Override\n       protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception {\n           AuthenticationToken token = createToken(request, response);\n           if (token == null) {\n               String msg = \"createToken method implementation returned null. A valid non-null AuthenticationToken \"\n                       + \"must be created in order to execute a login attempt.\";\n               throw new IllegalStateException(msg);\n           }\n           try {\n               Subject subject = getSubject(request, response);\n               subject.login(token); //  Shiro \n               return onLoginSuccess(token, subject, request, response);\n           } catch (AuthenticationException e) {\n               return onLoginFailure(token, e, request, response);\n           }\n       }\n   \n       /**\n        *  Header  JWT token\n        */\n       @Override\n       protected AuthenticationToken createToken(ServletRequest servletRequest, ServletResponse servletResponse) {\n           HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n           String authorization = httpServletRequest.getHeader(\"Authorization\");\n           CustomToken token = new CustomToken(authorization);\n           return token;\n       }\n   \n       /**\n        * isAccessAllowed()false\n        */\n       @Override\n       protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(servletResponse);\n           httpResponse.setCharacterEncoding(\"UTF-8\");\n           httpResponse.setContentType(\"application/json;charset=UTF-8\");\n           httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());\n           PrintWriter writer = httpResponse.getWriter();\n           writer.write(\"{\\\"errCode\\\": 401, \\\"msg\\\": \\\"UNAUTHORIZED\\\"}\");\n           fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);\n           return false;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginSuccess(AuthenticationToken token, Subject subject, ServletRequest request,\n                                        ServletResponse response) throws Exception {\n           HttpServletResponse httpResponse = WebUtils.toHttp(response);\n           String newToken = null;\n           if (token instanceof CustomToken) {\n               newToken = ((CustomToken) token).getToken();\n           }\n           if (newToken != null)\n               httpResponse.setHeader(\"Authorization\", newToken);\n           return true;\n       }\n   \n       /**\n        * Shiro  JWT token \n        */\n       @Override\n       protected boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request,\n                                        ServletResponse response) {\n           //  false   onAccessDenied()\n           return false;\n       }\n   \n       /**\n        * \n        */\n       protected void fillCorsHeader(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\n           httpServletResponse.setHeader(\"Access-control-Allow-Origin\", httpServletRequest.getHeader(\"Origin\"));\n           httpServletResponse.setHeader(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS,HEAD\");\n           httpServletResponse.setHeader(\"Access-Control-Allow-Headers\",\n                   httpServletRequest.getHeader(\"Access-Control-Request-Headers\"));\n       }\n   ```\n\n   \n\n2.  realm\n\n    token credentialsMatcher \n\n   ```java\n   public class CustomRealm extends AuthorizingRealm {\n   \n       /**\n        * token\n        * @param token\n        * @return\n        */\n       @Override\n       public boolean supports(AuthenticationToken token) {\n           return token instanceof CustomToken;\n       }\n   \n       /**\n        *  {xx,yy}\n        * @param principals\n        * @return\n        */\n       @Override\n       protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {\n           SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();\n           Set<String> roles = new HashSet<>();\n           roles.add(\"xx\");\n           roles.add(\"yy\");\n           info.setRoles(roles);\n           info.setStringPermissions(roles);\n           return info;\n       }\n   \n       /**\n        * tokenss\n        * @param token\n        * @return\n        * @throws AuthenticationException\n        */\n       @Override\n       protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {\n           String t = token.getPrincipal().toString();\n           if (t.equals(\"ss\")) {\n               return new SimpleAuthenticationInfo(t, t, getName());\n           } else {\n               throw new AuthenticationException(\"xxx\");\n           }\n       }\n   ```\n\n   \n\n3.  credentialsMatcher\n\n   token\n   \n   ```java\n   public class CustomCredentialsMatcher implements CredentialsMatcher {\n   \n       /**\n        * token\n        * @param token\n        * @param info\n        * @return true false \n        */\n       @Override\n       public boolean doCredentialsMatch(AuthenticationToken token, AuthenticationInfo info) {\n           return true;\n       }\n   }\n   ```\n   \n   \n   \n4. filter,realm,creadentialsMatchershiro\n\n   ```java\n   @Configuration\n   public class ShiroConfig {\n       /**\n        *  Spring  Shiro-Bean \n        */\n       @Bean\n       public static LifecycleBeanPostProcessor getLifecycleBeanPostProcessor() {\n           return new LifecycleBeanPostProcessor();\n       }\n   \n       /**\n        *  Spring-Bean  Shiro \n        */\n       @Bean\n       public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) {\n           AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();\n           authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);\n           return authorizationAttributeSourceAdvisor;\n       }\n   \n       @Bean\n       public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() {\n           DefaultAdvisorAutoProxyCreator app = new DefaultAdvisorAutoProxyCreator();\n           app.setProxyTargetClass(true);\n           return app;\n   \n       }\n   \n       /**\n        * \n        */\n       @Bean\n       ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) {\n           ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();\n           shiroFilterFactoryBean.setSecurityManager(securityManager);\n           shiroFilterFactoryBean.setLoginUrl(\"/login\");\n           shiroFilterFactoryBean.setSuccessUrl(\"/authorized\");\n           shiroFilterFactoryBean.setUnauthorizedUrl(\"/unauthorized\");\n   \n           Map<String, Filter> filterMap = new LinkedHashMap<>();\n           CustomFilter customFilter = new CustomFilter();\n           filterMap.put(\"custom\", customFilter);\n           shiroFilterFactoryBean.setFilters(filterMap);\n   \n           LinkedHashMap<String, String> filterChainDefinitionMap = new LinkedHashMap<String, String>();\n           filterChainDefinitionMap.put(\"/login\", \"custom\"); // \n   //        filterChainDefinitionMap.put(\"/logout\", \"logout\"); // \n           filterChainDefinitionMap.put(\"/**\", \"custom\"); // \n           shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);\n           return shiroFilterFactoryBean;\n       }\n   \n   \n       @Bean\n       CustomRealm customRealm() {\n           CustomRealm customRealm = new CustomRealm();\n           CustomCredentialsMatcher customCredentialsMatcher = new CustomCredentialsMatcher();\n           customRealm.setCredentialsMatcher(customCredentialsMatcher);\n           return customRealm;\n       }\n   \n   \n       /**\n        *  SecurityManager\n        */\n       @Bean\n       public SecurityManager securityManager() {\n           DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();\n           List<Realm> realms = new ArrayList<>(4);\n           realms.add(customRealm());\n           securityManager.setRealms(realms);\n           return securityManager;\n       }\n   ```\n\n   \n\n[](https://github.com/idream68/spring-demo/tree/master/shiro_custom_encryption)\n\n","slug":"spring/springboot/shiro/shiro-customer-encryption","published":1,"updated":"2022-05-10T08:25:56.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl3k7f4qb009vxklo36fa873b","content":"<ol>\n<li><p> filter</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomFilter</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BasicHttpAuthenticationFilter</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> WebUtils.toHttp(request);</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpServletResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"comment\">// optionoption</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class=\"line\">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.preHandle(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *  true </span></span><br><span class=\"line\"><span class=\"comment\">     * false  onAccessDenied()</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isAccessAllowed</span><span class=\"params\">(ServletRequest request, ServletResponse response, Object mappedValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Header JWT token </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.isLoginRequest(request, response))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">allowed</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Header JWT token token</span></span><br><span class=\"line\">            allowed = executeLogin(request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalStateException e) &#123; <span class=\"comment\">// not found any token</span></span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Not found any token&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Error occurs when login&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> allowed || <span class=\"built_in\">super</span>.isPermissive(mappedValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Header JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isLoginAttempt</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((HttpServletRequest) request).getHeader(<span class=\"string\">&quot;Authorization&quot;</span>) == <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * , JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">executeLogin</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthenticationToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> createToken(request, response);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;createToken method implementation returned null. A valid non-null AuthenticationToken &quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot;must be created in order to execute a login attempt.&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Subject</span> <span class=\"variable\">subject</span> <span class=\"operator\">=</span> getSubject(request, response);</span><br><span class=\"line\">            subject.login(token); <span class=\"comment\">//  Shiro </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginSuccess(token, subject, request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginFailure(token, e, request, response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Header  JWT token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationToken <span class=\"title function_\">createToken</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">authorization</span> <span class=\"operator\">=</span> httpServletRequest.getHeader(<span class=\"string\">&quot;Authorization&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">CustomToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomToken</span>(authorization);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * isAccessAllowed()false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onAccessDenied</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(servletResponse);</span><br><span class=\"line\">        httpResponse.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setContentType(<span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> httpResponse.getWriter();</span><br><span class=\"line\">        writer.write(<span class=\"string\">&quot;&#123;\\&quot;errCode\\&quot;: 401, \\&quot;msg\\&quot;: \\&quot;UNAUTHORIZED\\&quot;&#125;&quot;</span>);</span><br><span class=\"line\">        fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginSuccess</span><span class=\"params\">(AuthenticationToken token, Subject subject, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">newToken</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token <span class=\"keyword\">instanceof</span> CustomToken) &#123;</span><br><span class=\"line\">            newToken = ((CustomToken) token).getToken();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newToken != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            httpResponse.setHeader(<span class=\"string\">&quot;Authorization&quot;</span>, newToken);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginFailure</span><span class=\"params\">(AuthenticationToken token, AuthenticationException e, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  false   onAccessDenied()</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">fillCorsHeader</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class=\"string\">&quot;Origin&quot;</span>));</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;GET,POST,OPTIONS,HEAD&quot;</span>);</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class=\"line\">                httpServletRequest.getHeader(<span class=\"string\">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> realm</p>\n<p> token credentialsMatcher </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomRealm</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AuthorizingRealm</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(AuthenticationToken token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token <span class=\"keyword\">instanceof</span> CustomToken;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  &#123;xx,yy&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> principals</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthorizationInfo <span class=\"title function_\">doGetAuthorizationInfo</span><span class=\"params\">(PrincipalCollection principals)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SimpleAuthorizationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthorizationInfo</span>();</span><br><span class=\"line\">        Set&lt;String&gt; roles = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">        roles.add(<span class=\"string\">&quot;xx&quot;</span>);</span><br><span class=\"line\">        roles.add(<span class=\"string\">&quot;yy&quot;</span>);</span><br><span class=\"line\">        info.setRoles(roles);</span><br><span class=\"line\">        info.setStringPermissions(roles);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * tokenss</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> AuthenticationException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationInfo <span class=\"title function_\">doGetAuthenticationInfo</span><span class=\"params\">(AuthenticationToken token)</span> <span class=\"keyword\">throws</span> AuthenticationException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> token.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t.equals(<span class=\"string\">&quot;ss&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthenticationInfo</span>(t, t, getName());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthenticationException</span>(<span class=\"string\">&quot;xxx&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> credentialsMatcher</p>\n<p>token</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomCredentialsMatcher</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">CredentialsMatcher</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> info</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true false </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">doCredentialsMatch</span><span class=\"params\">(AuthenticationToken token, AuthenticationInfo info)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p>filter,realm,creadentialsMatchershiro</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring  Shiro-Bean </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring-Bean  Shiro </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultAdvisorAutoProxyCreator <span class=\"title function_\">defaultAdvisorAutoProxyCreator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultAdvisorAutoProxyCreator</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class=\"line\">        app.setProxyTargetClass(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> app;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroFilterFactoryBean <span class=\"title function_\">shiroFilterFactoryBean</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/authorized&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/unauthorized&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Map&lt;String, Filter&gt; filterMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">CustomFilter</span> <span class=\"variable\">customFilter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomFilter</span>();</span><br><span class=\"line\">        filterMap.put(<span class=\"string\">&quot;custom&quot;</span>, customFilter);</span><br><span class=\"line\">        shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class=\"line\"></span><br><span class=\"line\">        LinkedHashMap&lt;String, String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"string\">&quot;custom&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//        filterChainDefinitionMap.put(&quot;/logout&quot;, &quot;logout&quot;); // </span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;custom&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    CustomRealm <span class=\"title function_\">customRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">CustomRealm</span> <span class=\"variable\">customRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomRealm</span>();</span><br><span class=\"line\">        <span class=\"type\">CustomCredentialsMatcher</span> <span class=\"variable\">customCredentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomCredentialsMatcher</span>();</span><br><span class=\"line\">        customRealm.setCredentialsMatcher(customCredentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> customRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\">        List&lt;Realm&gt; realms = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(<span class=\"number\">4</span>);</span><br><span class=\"line\">        realms.add(customRealm());</span><br><span class=\"line\">        securityManager.setRealms(realms);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_custom_encryption\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p> filter</p>\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomFilter</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BasicHttpAuthenticationFilter</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> WebUtils.toHttp(request);</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpServletResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"comment\">// optionoption</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class=\"line\">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>.preHandle(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postHandle</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.fillCorsHeader(WebUtils.toHttp(request), WebUtils.toHttp(response));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *  true </span></span><br><span class=\"line\"><span class=\"comment\">     * false  onAccessDenied()</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isAccessAllowed</span><span class=\"params\">(ServletRequest request, ServletResponse response, Object mappedValue)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Header JWT token </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.isLoginRequest(request, response))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">allowed</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Header JWT token token</span></span><br><span class=\"line\">            allowed = executeLogin(request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalStateException e) &#123; <span class=\"comment\">// not found any token</span></span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Not found any token&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;Error occurs when login&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> allowed || <span class=\"built_in\">super</span>.isPermissive(mappedValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Header JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isLoginAttempt</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((HttpServletRequest) request).getHeader(<span class=\"string\">&quot;Authorization&quot;</span>) == <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * , JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">executeLogin</span><span class=\"params\">(ServletRequest request, ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthenticationToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> createToken(request, response);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;createToken method implementation returned null. A valid non-null AuthenticationToken &quot;</span></span><br><span class=\"line\">                    + <span class=\"string\">&quot;must be created in order to execute a login attempt.&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(msg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Subject</span> <span class=\"variable\">subject</span> <span class=\"operator\">=</span> getSubject(request, response);</span><br><span class=\"line\">            subject.login(token); <span class=\"comment\">//  Shiro </span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginSuccess(token, subject, request, response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> onLoginFailure(token, e, request, response);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Header  JWT token</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationToken <span class=\"title function_\">createToken</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletRequest</span> <span class=\"variable\">httpServletRequest</span> <span class=\"operator\">=</span> (HttpServletRequest) servletRequest;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">authorization</span> <span class=\"operator\">=</span> httpServletRequest.getHeader(<span class=\"string\">&quot;Authorization&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">CustomToken</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomToken</span>(authorization);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * isAccessAllowed()false</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onAccessDenied</span><span class=\"params\">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(servletResponse);</span><br><span class=\"line\">        httpResponse.setCharacterEncoding(<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setContentType(<span class=\"string\">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">        httpResponse.setStatus(HttpStatus.UNAUTHORIZED.value());</span><br><span class=\"line\">        <span class=\"type\">PrintWriter</span> <span class=\"variable\">writer</span> <span class=\"operator\">=</span> httpResponse.getWriter();</span><br><span class=\"line\">        writer.write(<span class=\"string\">&quot;&#123;\\&quot;errCode\\&quot;: 401, \\&quot;msg\\&quot;: \\&quot;UNAUTHORIZED\\&quot;&#125;&quot;</span>);</span><br><span class=\"line\">        fillCorsHeader(WebUtils.toHttp(servletRequest), httpResponse);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginSuccess</span><span class=\"params\">(AuthenticationToken token, Subject subject, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">HttpServletResponse</span> <span class=\"variable\">httpResponse</span> <span class=\"operator\">=</span> WebUtils.toHttp(response);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">newToken</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token <span class=\"keyword\">instanceof</span> CustomToken) &#123;</span><br><span class=\"line\">            newToken = ((CustomToken) token).getToken();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newToken != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            httpResponse.setHeader(<span class=\"string\">&quot;Authorization&quot;</span>, newToken);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Shiro  JWT token </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">onLoginFailure</span><span class=\"params\">(AuthenticationToken token, AuthenticationException e, ServletRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                                     ServletResponse response)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  false   onAccessDenied()</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">fillCorsHeader</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class=\"string\">&quot;Origin&quot;</span>));</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;GET,POST,OPTIONS,HEAD&quot;</span>);</span><br><span class=\"line\">        httpServletResponse.setHeader(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class=\"line\">                httpServletRequest.getHeader(<span class=\"string\">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> realm</p>\n<p> token credentialsMatcher </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomRealm</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AuthorizingRealm</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(AuthenticationToken token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> token <span class=\"keyword\">instanceof</span> CustomToken;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  &#123;xx,yy&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> principals</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthorizationInfo <span class=\"title function_\">doGetAuthorizationInfo</span><span class=\"params\">(PrincipalCollection principals)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SimpleAuthorizationInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthorizationInfo</span>();</span><br><span class=\"line\">        Set&lt;String&gt; roles = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">        roles.add(<span class=\"string\">&quot;xx&quot;</span>);</span><br><span class=\"line\">        roles.add(<span class=\"string\">&quot;yy&quot;</span>);</span><br><span class=\"line\">        info.setRoles(roles);</span><br><span class=\"line\">        info.setStringPermissions(roles);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> info;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * tokenss</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> AuthenticationException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> AuthenticationInfo <span class=\"title function_\">doGetAuthenticationInfo</span><span class=\"params\">(AuthenticationToken token)</span> <span class=\"keyword\">throws</span> AuthenticationException &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> token.getPrincipal().toString();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t.equals(<span class=\"string\">&quot;ss&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleAuthenticationInfo</span>(t, t, getName());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthenticationException</span>(<span class=\"string\">&quot;xxx&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p> credentialsMatcher</p>\n<p>token</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CustomCredentialsMatcher</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">CredentialsMatcher</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> info</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true false </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">doCredentialsMatch</span><span class=\"params\">(AuthenticationToken token, AuthenticationInfo info)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p>filter,realm,creadentialsMatchershiro</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ShiroConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring  Shiro-Bean </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> LifecycleBeanPostProcessor <span class=\"title function_\">getLifecycleBeanPostProcessor</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LifecycleBeanPostProcessor</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  Spring-Bean  Shiro </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> AuthorizationAttributeSourceAdvisor <span class=\"title function_\">authorizationAttributeSourceAdvisor</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AuthorizationAttributeSourceAdvisor</span> <span class=\"variable\">authorizationAttributeSourceAdvisor</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class=\"line\">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authorizationAttributeSourceAdvisor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DefaultAdvisorAutoProxyCreator <span class=\"title function_\">defaultAdvisorAutoProxyCreator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultAdvisorAutoProxyCreator</span> <span class=\"variable\">app</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class=\"line\">        app.setProxyTargetClass(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> app;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    ShiroFilterFactoryBean <span class=\"title function_\">shiroFilterFactoryBean</span><span class=\"params\">(SecurityManager securityManager)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShiroFilterFactoryBean</span> <span class=\"variable\">shiroFilterFactoryBean</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShiroFilterFactoryBean</span>();</span><br><span class=\"line\">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class=\"line\">        shiroFilterFactoryBean.setLoginUrl(<span class=\"string\">&quot;/login&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setSuccessUrl(<span class=\"string\">&quot;/authorized&quot;</span>);</span><br><span class=\"line\">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class=\"string\">&quot;/unauthorized&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Map&lt;String, Filter&gt; filterMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">CustomFilter</span> <span class=\"variable\">customFilter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomFilter</span>();</span><br><span class=\"line\">        filterMap.put(<span class=\"string\">&quot;custom&quot;</span>, customFilter);</span><br><span class=\"line\">        shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class=\"line\"></span><br><span class=\"line\">        LinkedHashMap&lt;String, String&gt; filterChainDefinitionMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"string\">&quot;custom&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">//        filterChainDefinitionMap.put(&quot;/logout&quot;, &quot;logout&quot;); // </span></span><br><span class=\"line\">        filterChainDefinitionMap.put(<span class=\"string\">&quot;/**&quot;</span>, <span class=\"string\">&quot;custom&quot;</span>); <span class=\"comment\">// </span></span><br><span class=\"line\">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> shiroFilterFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    CustomRealm <span class=\"title function_\">customRealm</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">CustomRealm</span> <span class=\"variable\">customRealm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomRealm</span>();</span><br><span class=\"line\">        <span class=\"type\">CustomCredentialsMatcher</span> <span class=\"variable\">customCredentialsMatcher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CustomCredentialsMatcher</span>();</span><br><span class=\"line\">        customRealm.setCredentialsMatcher(customCredentialsMatcher);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> customRealm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  SecurityManager</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> SecurityManager <span class=\"title function_\">securityManager</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DefaultWebSecurityManager</span> <span class=\"variable\">securityManager</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultWebSecurityManager</span>();</span><br><span class=\"line\">        List&lt;Realm&gt; realms = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(<span class=\"number\">4</span>);</span><br><span class=\"line\">        realms.add(customRealm());</span><br><span class=\"line\">        securityManager.setRealms(realms);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> securityManager;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><a href=\"https://github.com/idream68/spring-demo/tree/master/shiro_custom_encryption\"></a></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl3k7f4om0001xkloez7x4ysw","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4ot000fxkloff5vekmj"},{"post_id":"cl3k7f4ot000dxklobneofipm","category_id":"cl3k7f4os000bxklo0bu12ym3","_id":"cl3k7f4ow000kxklog2o2ehbf"},{"post_id":"cl3k7f4oo0003xklo40l2eflq","category_id":"cl3k7f4os000bxklo0bu12ym3","_id":"cl3k7f4oy000oxklo4alp4h30"},{"post_id":"cl3k7f4or0007xklo2zwt48fc","category_id":"cl3k7f4os000bxklo0bu12ym3","_id":"cl3k7f4oz000sxklo0osc3ju8"},{"post_id":"cl3k7f4or0009xklo43lb86fd","category_id":"cl3k7f4os000bxklo0bu12ym3","_id":"cl3k7f4p1000yxklo87l608qi"},{"post_id":"cl3k7f4os000axklo8adw1e2r","category_id":"cl3k7f4oy000rxklo029208jx","_id":"cl3k7f4p20015xklo4p36c8mz"},{"post_id":"cl3k7f4ot000exklofen81yq1","category_id":"cl3k7f4oy000rxklo029208jx","_id":"cl3k7f4p4001bxkloammub0v1"},{"post_id":"cl3k7f4ou000ixklofxue7mhs","category_id":"cl3k7f4p20014xklobotleuke","_id":"cl3k7f4p5001gxklob1s678l0"},{"post_id":"cl3k7f4ov000jxklo7qe9etni","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4p7001oxklob2zi7pd9"},{"post_id":"cl3k7f4ox000nxklo3x8o2ibc","category_id":"cl3k7f4oy000rxklo029208jx","_id":"cl3k7f4p8001uxklo3oui28g0"},{"post_id":"cl3k7f4oz000vxklo5by87kj9","category_id":"cl3k7f4p20014xklobotleuke","_id":"cl3k7f4p90020xklo903nfzkx"},{"post_id":"cl3k7f4p1000xxklofkiscvlc","category_id":"cl3k7f4p8001txklocvgy78ov","_id":"cl3k7f4pa0027xklo6npke4b0"},{"post_id":"cl3k7f4p10010xklo16af1t1u","category_id":"cl3k7f4p90021xklo93a6ei9h","_id":"cl3k7f4pb002exklo2nuu4w53"},{"post_id":"cl3k7f4pa0026xklo9t3ucbpo","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pc002jxklob75s426b"},{"post_id":"cl3k7f4p30017xklo7f0q6vu5","category_id":"cl3k7f4pa0029xklo56f1em2h","_id":"cl3k7f4pd002lxklo2vy038hr"},{"post_id":"cl3k7f4pb002dxklo7z9rep6y","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pd002pxklo8n3s73kv"},{"post_id":"cl3k7f4pc002hxklobgtt96qq","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pe002sxklo3yr977nz"},{"post_id":"cl3k7f4pc002kxklog71k7tcr","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pf002xxklo7rrdbnj9"},{"post_id":"cl3k7f4p3001axklo1i9daoc2","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pf0030xklo2mm9dqn6"},{"post_id":"cl3k7f4p3001axklo1i9daoc2","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4pg0034xklog7vb65ln"},{"post_id":"cl3k7f4pd002mxklo445i5y71","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pg0038xklo8km9ge4r"},{"post_id":"cl3k7f4p4001dxklo9tar226s","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4ph003bxklo3mpoednz"},{"post_id":"cl3k7f4p4001dxklo9tar226s","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4ph003fxklo1xpn7dah"},{"post_id":"cl3k7f4pe002txklo97e23hyh","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pi003ixklock4m2r94"},{"post_id":"cl3k7f4pf002yxkloeudjdpso","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pj003lxklo6nptgnlf"},{"post_id":"cl3k7f4p4001fxklo0c8ygwgy","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pj003pxklo8wj2964c"},{"post_id":"cl3k7f4p4001fxklo0c8ygwgy","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4pk003sxklo57lec3q4"},{"post_id":"cl3k7f4p5001hxklo1j5q486s","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pk003wxklo87u6dlxg"},{"post_id":"cl3k7f4p5001hxklo1j5q486s","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4pl003zxklohkpa1v9w"},{"post_id":"cl3k7f4p6001kxklo1qk7dtw3","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pl0042xklofkzicsb1"},{"post_id":"cl3k7f4p6001kxklo1qk7dtw3","category_id":"cl3k7f4ph003axklo18fm1vi6","_id":"cl3k7f4pm0045xklohvvibi7x"},{"post_id":"cl3k7f4p6001mxklob2yn48t8","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pm0048xklo1mivb4j7"},{"post_id":"cl3k7f4p6001mxklob2yn48t8","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4pn004axklocvjo5kax"},{"post_id":"cl3k7f4p7001qxklo3qdcd659","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pn004fxklo2t21bm4n"},{"post_id":"cl3k7f4p7001qxklo3qdcd659","category_id":"cl3k7f4pb002fxkloagt957zi","_id":"cl3k7f4po004hxklogopeb2fz"},{"post_id":"cl3k7f4p8001sxkloh7tsdu6y","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4po004lxklo48cg8arz"},{"post_id":"cl3k7f4p8001sxkloh7tsdu6y","category_id":"cl3k7f4pk003vxklo424w3hp0","_id":"cl3k7f4po004mxklo2m1p19v4"},{"post_id":"cl3k7f4p8001xxklo2nfq92l2","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4po004pxklodp9j2738"},{"post_id":"cl3k7f4p8001xxklo2nfq92l2","category_id":"cl3k7f4pk003vxklo424w3hp0","_id":"cl3k7f4po004qxkloddp34nq0"},{"post_id":"cl3k7f4p9001zxklobtuw8cwx","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4po004sxklo1c3xb97j"},{"post_id":"cl3k7f4p9001zxklobtuw8cwx","category_id":"cl3k7f4pk003vxklo424w3hp0","_id":"cl3k7f4pp004vxkloblxg370k"},{"post_id":"cl3k7f4p90024xklof5bs9oru","category_id":"cl3k7f4p4001cxklogppj8b19","_id":"cl3k7f4pp004xxklo8rxfdvot"},{"post_id":"cl3k7f4p90024xklof5bs9oru","category_id":"cl3k7f4pk003vxklo424w3hp0","_id":"cl3k7f4pp0051xklo7rgy9syi"},{"post_id":"cl3k7f4pa002axklo03e36t9q","category_id":"cl3k7f4op0004xklohlg600kh","_id":"cl3k7f4pp0053xkloclko8752"},{"post_id":"cl3k7f4pa002axklo03e36t9q","category_id":"cl3k7f4po004jxklo078w31of","_id":"cl3k7f4pq0056xklo6dtv7cx9"},{"post_id":"cl3k7f4pd002qxkload3ibh3k","category_id":"cl3k7f4po004oxklobryp8pzz","_id":"cl3k7f4pq0058xklo42szbib6"},{"post_id":"cl3k7f4pl0040xkloenhf35wd","category_id":"cl3k7f4ps005txkloe6q10sjb","_id":"cl3k7f4pu005zxklogaubglpb"},{"post_id":"cl3k7f4pf0031xkloctmgdokn","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4pw006gxkloa4o42zhp"},{"post_id":"cl3k7f4pf0031xkloctmgdokn","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4pw006ixklobogucag3"},{"post_id":"cl3k7f4pg0036xklo9zgdea2v","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4pw006lxklobz4x829s"},{"post_id":"cl3k7f4pg0036xklo9zgdea2v","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4px006oxkloc8a8eam9"},{"post_id":"cl3k7f4pg0039xklo0olkd0fa","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4px006qxkloafgg87yi"},{"post_id":"cl3k7f4pg0039xklo0olkd0fa","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4px006txklogevo9hbs"},{"post_id":"cl3k7f4ph003dxklo0wndf26n","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4px006vxklocb7j27a9"},{"post_id":"cl3k7f4ph003dxklo0wndf26n","category_id":"cl3k7f4pw006kxkloh2ok3j32","_id":"cl3k7f4px006xxklo82ta2vyr"},{"post_id":"cl3k7f4ph003gxklo2vhuaoez","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4py0070xklofwadf0me"},{"post_id":"cl3k7f4ph003gxklo2vhuaoez","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4py0073xklo07wle4ii"},{"post_id":"cl3k7f4pi003jxkloex6r538a","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4py0076xklo8cru544g"},{"post_id":"cl3k7f4pi003jxkloex6r538a","category_id":"cl3k7f4pw006kxkloh2ok3j32","_id":"cl3k7f4pz0078xklo23pt7ucz"},{"post_id":"cl3k7f4pj003nxklo8qzraxzl","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4q0007axklog3d7df21"},{"post_id":"cl3k7f4pj003nxklo8qzraxzl","category_id":"cl3k7f4pw006kxkloh2ok3j32","_id":"cl3k7f4q0007cxklobs3odzy3"},{"post_id":"cl3k7f4pj003qxklo3lz19uv4","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4q1007exklo7ali9u4j"},{"post_id":"cl3k7f4pj003qxklo3lz19uv4","category_id":"cl3k7f4pw006kxkloh2ok3j32","_id":"cl3k7f4q2007ixklo2k8thssr"},{"post_id":"cl3k7f4pk003xxklo91v14sqt","category_id":"cl3k7f4ps005qxklo1siy0v66","_id":"cl3k7f4q2007jxklo7jme1d5c"},{"post_id":"cl3k7f4pk003xxklo91v14sqt","category_id":"cl3k7f4q00079xklo5am66uw2","_id":"cl3k7f4q2007mxkloaoa1ab3d"},{"post_id":"cl3k7f4pl0043xklobx457xho","category_id":"cl3k7f4pt005wxkloeh435dlj","_id":"cl3k7f4q3007oxkloc0wz83bt"},{"post_id":"cl3k7f4pl0043xklobx457xho","category_id":"cl3k7f4q1007fxklo641i0cea","_id":"cl3k7f4q3007qxklofmikhq6q"},{"post_id":"cl3k7f4pm0049xklo15zmaila","category_id":"cl3k7f4pu0063xklo4k54cfzp","_id":"cl3k7f4q4007yxklofjjs24wv"},{"post_id":"cl3k7f4pm0049xklo15zmaila","category_id":"cl3k7f4q2007nxklo40i6c5c9","_id":"cl3k7f4q40080xklo0gotbjo9"},{"post_id":"cl3k7f4pm0046xklo9quce1dj","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4q50085xklo4v4nb0pm"},{"post_id":"cl3k7f4pm0046xklo9quce1dj","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4q50087xklo2uqyh7jq"},{"post_id":"cl3k7f4pm0046xklo9quce1dj","category_id":"cl3k7f4q4007xxklo1v6yadrd","_id":"cl3k7f4q50088xklo8xige808"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4q5008axkloc7radzfz"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4q5008cxklo8hgb6z34"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","category_id":"cl3k7f4q4007xxklo1v6yadrd","_id":"cl3k7f4q5008fxkloe70659ip"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4qc009wxklogp5l8v69"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4qc009yxklo92yme67z"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","category_id":"cl3k7f4q4007xxklo1v6yadrd","_id":"cl3k7f4qc00a0xklo9he0cmx0"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4qc00a3xkloaah44l8o"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4qc00a5xklo321cbohe"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","category_id":"cl3k7f4q4007xxklo1v6yadrd","_id":"cl3k7f4qc00a7xkloercn4wcs"},{"post_id":"cl3k7f4qb009vxklo36fa873b","category_id":"cl3k7f4po004txklof6ys8r84","_id":"cl3k7f4qc00a9xklo6djnbp17"},{"post_id":"cl3k7f4qb009vxklo36fa873b","category_id":"cl3k7f4pv0069xklo1f0k1u32","_id":"cl3k7f4qc00abxklofba2gz77"},{"post_id":"cl3k7f4qb009vxklo36fa873b","category_id":"cl3k7f4q4007xxklo1v6yadrd","_id":"cl3k7f4qc00adxklohcq98xif"}],"PostTag":[{"post_id":"cl3k7f4om0001xkloez7x4ysw","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4oy000pxklo4t9e8gsa"},{"post_id":"cl3k7f4om0001xkloez7x4ysw","tag_id":"cl3k7f4os000cxklo7qhz870h","_id":"cl3k7f4oz000txklofzzlbr34"},{"post_id":"cl3k7f4om0001xkloez7x4ysw","tag_id":"cl3k7f4ot000hxkloc21ygayn","_id":"cl3k7f4p1000wxklo2btb4z9a"},{"post_id":"cl3k7f4oo0003xklo40l2eflq","tag_id":"cl3k7f4ox000mxklo8h4r12vi","_id":"cl3k7f4p20012xklocdf4cmj0"},{"post_id":"cl3k7f4oo0003xklo40l2eflq","tag_id":"cl3k7f4oz000uxkloashfg4xe","_id":"cl3k7f4p30016xkloby60hfuk"},{"post_id":"cl3k7f4or0007xklo2zwt48fc","tag_id":"cl3k7f4ox000mxklo8h4r12vi","_id":"cl3k7f4p30019xklo19lm4pcc"},{"post_id":"cl3k7f4p5001hxklo1j5q486s","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4p6001lxklo86ru7z3e"},{"post_id":"cl3k7f4or0009xklo43lb86fd","tag_id":"cl3k7f4ox000mxklo8h4r12vi","_id":"cl3k7f4p8001rxklo3k3g502a"},{"post_id":"cl3k7f4or0009xklo43lb86fd","tag_id":"cl3k7f4p4001exklo9h9kh0ys","_id":"cl3k7f4p8001vxklobv0qadn3"},{"post_id":"cl3k7f4or0009xklo43lb86fd","tag_id":"cl3k7f4p6001jxkloemvwgj6l","_id":"cl3k7f4p9001yxklo5x3hef6w"},{"post_id":"cl3k7f4p6001mxklob2yn48t8","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4p90022xklofoe13gxy"},{"post_id":"cl3k7f4p7001qxklo3qdcd659","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4pa0025xklofjscbdy7"},{"post_id":"cl3k7f4os000axklo8adw1e2r","tag_id":"cl3k7f4p7001pxklo30z5civ9","_id":"cl3k7f4pa0028xklog69v30tx"},{"post_id":"cl3k7f4ot000dxklobneofipm","tag_id":"cl3k7f4ox000mxklo8h4r12vi","_id":"cl3k7f4pb002cxkloh88q8278"},{"post_id":"cl3k7f4ot000dxklobneofipm","tag_id":"cl3k7f4p90023xklo6t5359lm","_id":"cl3k7f4pc002gxklo5kq96g9n"},{"post_id":"cl3k7f4ot000exklofen81yq1","tag_id":"cl3k7f4p7001pxklo30z5civ9","_id":"cl3k7f4pe002rxklocedh7m1q"},{"post_id":"cl3k7f4ot000exklofen81yq1","tag_id":"cl3k7f4pc002ixklof8nxc5up","_id":"cl3k7f4pe002vxklo5asrer37"},{"post_id":"cl3k7f4ou000ixklofxue7mhs","tag_id":"cl3k7f4pd002oxkloazgf8ob4","_id":"cl3k7f4pf002zxklo140x14p5"},{"post_id":"cl3k7f4pf002yxkloeudjdpso","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pg0033xklo46lcaplv"},{"post_id":"cl3k7f4ov000jxklo7qe9etni","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pg0037xklo0ojj4ftb"},{"post_id":"cl3k7f4ox000nxklo3x8o2ibc","tag_id":"cl3k7f4p7001pxklo30z5civ9","_id":"cl3k7f4ph003exklo6ooqgzrk"},{"post_id":"cl3k7f4oy000qxklo4jgbdzpy","tag_id":"cl3k7f4ph003cxklocf8x8y9b","_id":"cl3k7f4pj003mxklody520c4a"},{"post_id":"cl3k7f4oz000vxklo5by87kj9","tag_id":"cl3k7f4pd002oxkloazgf8ob4","_id":"cl3k7f4pk003txklogfxodoxo"},{"post_id":"cl3k7f4p1000xxklofkiscvlc","tag_id":"cl3k7f4pk003rxklo62669vun","_id":"cl3k7f4pn004exklobe945p8n"},{"post_id":"cl3k7f4p1000xxklofkiscvlc","tag_id":"cl3k7f4pl003yxklo9elph0jl","_id":"cl3k7f4po004gxklo4meq4p7c"},{"post_id":"cl3k7f4p1000xxklofkiscvlc","tag_id":"cl3k7f4pm0044xklodyrjcgva","_id":"cl3k7f4po004kxklo2ormcnc1"},{"post_id":"cl3k7f4p10010xklo16af1t1u","tag_id":"cl3k7f4pn004bxklo5e0i9a3l","_id":"cl3k7f4pp004uxklod2vha46r"},{"post_id":"cl3k7f4p10010xklo16af1t1u","tag_id":"cl3k7f4po004ixklog0nk9e0j","_id":"cl3k7f4pp004wxklo212d49su"},{"post_id":"cl3k7f4p10010xklo16af1t1u","tag_id":"cl3k7f4po004nxklo81xa3qnj","_id":"cl3k7f4pp0050xkloawsidgdg"},{"post_id":"cl3k7f4p30017xklo7f0q6vu5","tag_id":"cl3k7f4po004rxkloe02k5olg","_id":"cl3k7f4pp0052xklo0gqpeysp"},{"post_id":"cl3k7f4p3001axklo1i9daoc2","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4pq0057xklodwjecw3i"},{"post_id":"cl3k7f4p3001axklo1i9daoc2","tag_id":"cl3k7f4pp004yxkloggglgc90","_id":"cl3k7f4pq0059xklo1q0b98wh"},{"post_id":"cl3k7f4p4001dxklo9tar226s","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4pq005cxklo5hr1gne0"},{"post_id":"cl3k7f4p4001dxklo9tar226s","tag_id":"cl3k7f4pp0054xkloc0skbj82","_id":"cl3k7f4pq005dxklobe6agljc"},{"post_id":"cl3k7f4p4001fxklo0c8ygwgy","tag_id":"cl3k7f4oq0005xklo1erk8475","_id":"cl3k7f4pq005gxklo739zh30d"},{"post_id":"cl3k7f4p4001fxklo0c8ygwgy","tag_id":"cl3k7f4pq005bxklo58f9flws","_id":"cl3k7f4pq005ixklobito6s8v"},{"post_id":"cl3k7f4p6001kxklo1qk7dtw3","tag_id":"cl3k7f4pq005fxklo8y6i63q6","_id":"cl3k7f4pr005mxklo00sccecw"},{"post_id":"cl3k7f4p6001kxklo1qk7dtw3","tag_id":"cl3k7f4pr005jxklo1o9n75uc","_id":"cl3k7f4ps005oxklo3xykdlh9"},{"post_id":"cl3k7f4p8001sxkloh7tsdu6y","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4ps005sxklo2b16hwhj"},{"post_id":"cl3k7f4p8001sxkloh7tsdu6y","tag_id":"cl3k7f4ps005pxklo25slf3ae","_id":"cl3k7f4ps005uxklo8wke0ihn"},{"post_id":"cl3k7f4p8001xxklo2nfq92l2","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pu005yxkloggk3cci5"},{"post_id":"cl3k7f4p8001xxklo2nfq92l2","tag_id":"cl3k7f4ps005vxklo62bz61ok","_id":"cl3k7f4pu0061xklo3uve3fqj"},{"post_id":"cl3k7f4p9001zxklobtuw8cwx","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pv0065xkloa4ru7rjd"},{"post_id":"cl3k7f4p9001zxklobtuw8cwx","tag_id":"cl3k7f4ps005pxklo25slf3ae","_id":"cl3k7f4pv0067xklofwg85839"},{"post_id":"cl3k7f4p90024xklof5bs9oru","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pw006bxklohkzjek4g"},{"post_id":"cl3k7f4p90024xklof5bs9oru","tag_id":"cl3k7f4ps005vxklo62bz61ok","_id":"cl3k7f4pw006cxklo0itz3sag"},{"post_id":"cl3k7f4pa0026xklo9t3ucbpo","tag_id":"cl3k7f4pv006axklofkm9djwy","_id":"cl3k7f4pw006jxklo6i7y3ezy"},{"post_id":"cl3k7f4pa0026xklo9t3ucbpo","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4pw006mxklo21rchb5c"},{"post_id":"cl3k7f4pa002axklo03e36t9q","tag_id":"cl3k7f4pw006hxkloc8hghjhz","_id":"cl3k7f4px006pxkloghrgeg4h"},{"post_id":"cl3k7f4pb002dxklo7z9rep6y","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4px006yxkloh40oddwn"},{"post_id":"cl3k7f4pb002dxklo7z9rep6y","tag_id":"cl3k7f4px006sxklo2vtjccwi","_id":"cl3k7f4py0071xklogjrseoqq"},{"post_id":"cl3k7f4pc002hxklobgtt96qq","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4py0074xklogab3228w"},{"post_id":"cl3k7f4pc002kxklog71k7tcr","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4q1007dxklo137wetbg"},{"post_id":"cl3k7f4pc002kxklog71k7tcr","tag_id":"cl3k7f4py0077xkloc7f83g42","_id":"cl3k7f4q1007gxklo3uwhe8up"},{"post_id":"cl3k7f4pd002mxklo445i5y71","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4q3007rxklogaqe15mx"},{"post_id":"cl3k7f4pd002mxklo445i5y71","tag_id":"cl3k7f4py0077xkloc7f83g42","_id":"cl3k7f4q3007sxklo8u7w6q2p"},{"post_id":"cl3k7f4pd002mxklo445i5y71","tag_id":"cl3k7f4pq005bxklo58f9flws","_id":"cl3k7f4q3007vxklo7gb014zc"},{"post_id":"cl3k7f4pd002qxkload3ibh3k","tag_id":"cl3k7f4q3007pxkloah28440f","_id":"cl3k7f4q3007wxklo1t12a7v4"},{"post_id":"cl3k7f4pe002txklo97e23hyh","tag_id":"cl3k7f4pe002wxklocqq51saz","_id":"cl3k7f4q50083xklog1zn68or"},{"post_id":"cl3k7f4pe002txklo97e23hyh","tag_id":"cl3k7f4py0077xkloc7f83g42","_id":"cl3k7f4q50084xklohogs4vuq"},{"post_id":"cl3k7f4pf0031xkloctmgdokn","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q5008bxklo87tle7v0"},{"post_id":"cl3k7f4pf0031xkloctmgdokn","tag_id":"cl3k7f4q50086xklo0auu12zp","_id":"cl3k7f4q5008dxklo5xn51uhy"},{"post_id":"cl3k7f4pg0036xklo9zgdea2v","tag_id":"cl3k7f4q50089xklo97jw4fpl","_id":"cl3k7f4q6008hxklohe62e70c"},{"post_id":"cl3k7f4pg0036xklo9zgdea2v","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q6008ixklo9mwc61ch"},{"post_id":"cl3k7f4pg0039xklo0olkd0fa","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q6008kxklo2b866zm4"},{"post_id":"cl3k7f4ph003dxklo0wndf26n","tag_id":"cl3k7f4q6008jxklof6j4c9ot","_id":"cl3k7f4q6008nxklobvd9fj8f"},{"post_id":"cl3k7f4ph003dxklo0wndf26n","tag_id":"cl3k7f4q6008lxklodfbz2uyo","_id":"cl3k7f4q6008oxklobh8y8wmi"},{"post_id":"cl3k7f4ph003gxklo2vhuaoez","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q6008qxkloc2algw3v"},{"post_id":"cl3k7f4pi003jxkloex6r538a","tag_id":"cl3k7f4q6008jxklof6j4c9ot","_id":"cl3k7f4q7008txklo253w8mpj"},{"post_id":"cl3k7f4pi003jxkloex6r538a","tag_id":"cl3k7f4q6008lxklodfbz2uyo","_id":"cl3k7f4q7008uxkloak501412"},{"post_id":"cl3k7f4pj003nxklo8qzraxzl","tag_id":"cl3k7f4q6008jxklof6j4c9ot","_id":"cl3k7f4q7008xxklo00tk47dc"},{"post_id":"cl3k7f4pj003nxklo8qzraxzl","tag_id":"cl3k7f4q6008lxklodfbz2uyo","_id":"cl3k7f4q7008yxklo1gbk3mu0"},{"post_id":"cl3k7f4pj003qxklo3lz19uv4","tag_id":"cl3k7f4q6008jxklof6j4c9ot","_id":"cl3k7f4q70091xklodfnjdxy7"},{"post_id":"cl3k7f4pj003qxklo3lz19uv4","tag_id":"cl3k7f4q6008lxklodfbz2uyo","_id":"cl3k7f4q70092xklodbp2fil0"},{"post_id":"cl3k7f4pk003xxklo91v14sqt","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q80095xklo4l1h2euh"},{"post_id":"cl3k7f4pk003xxklo91v14sqt","tag_id":"cl3k7f4q80093xklo8jljff8d","_id":"cl3k7f4q80096xklo155l6ruh"},{"post_id":"cl3k7f4pl0040xkloenhf35wd","tag_id":"cl3k7f4q80094xklof123dsmq","_id":"cl3k7f4q80099xklo59imdj2q"},{"post_id":"cl3k7f4pl0040xkloenhf35wd","tag_id":"cl3k7f4q80097xklo26mugvms","_id":"cl3k7f4q8009axklodw4c63hc"},{"post_id":"cl3k7f4pl0043xklobx457xho","tag_id":"cl3k7f4q80098xklo0m4r1qwh","_id":"cl3k7f4q9009dxklo86c7bryn"},{"post_id":"cl3k7f4pl0043xklobx457xho","tag_id":"cl3k7f4q8009bxkloadf58j67","_id":"cl3k7f4q9009exklo8map0eib"},{"post_id":"cl3k7f4pm0046xklo9quce1dj","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4q9009hxklo83u3apes"},{"post_id":"cl3k7f4pm0046xklo9quce1dj","tag_id":"cl3k7f4q9009fxklo3sel632v","_id":"cl3k7f4q9009ixklo41xkdqbg"},{"post_id":"cl3k7f4pm0049xklo15zmaila","tag_id":"cl3k7f4q9009gxklobt1h41l1","_id":"cl3k7f4q9009lxklo5j5ncyyi"},{"post_id":"cl3k7f4pm0049xklo15zmaila","tag_id":"cl3k7f4q8009bxkloadf58j67","_id":"cl3k7f4q9009mxklo641ccq5h"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4qa009pxklo3j704d1w"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","tag_id":"cl3k7f4pq005fxklo8y6i63q6","_id":"cl3k7f4qa009qxklo8pny3qsl"},{"post_id":"cl3k7f4pn004cxklohvp0c87p","tag_id":"cl3k7f4q9009fxklo3sel632v","_id":"cl3k7f4qa009rxklo53oh9hjx"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4qc009zxklohxeh7j07"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","tag_id":"cl3k7f4q9009fxklo3sel632v","_id":"cl3k7f4qc00a1xklog93i72hj"},{"post_id":"cl3k7f4qa009sxklo8scg6u6m","tag_id":"cl3k7f4qb009uxkloeojo9vhu","_id":"cl3k7f4qc00a4xklocii6hg51"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4qc00a6xkloabg98fj8"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","tag_id":"cl3k7f4q9009fxklo3sel632v","_id":"cl3k7f4qc00a8xkloah9u637i"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","tag_id":"cl3k7f4qb009uxkloeojo9vhu","_id":"cl3k7f4qc00aaxklog7sm8gn5"},{"post_id":"cl3k7f4qb009txklo6qpshaqt","tag_id":"cl3k7f4pq005fxklo8y6i63q6","_id":"cl3k7f4qc00acxklo8o7g4mxh"},{"post_id":"cl3k7f4qb009vxklo36fa873b","tag_id":"cl3k7f4q40082xklob20mgca3","_id":"cl3k7f4qc00aexklo9is49orn"},{"post_id":"cl3k7f4qb009vxklo36fa873b","tag_id":"cl3k7f4q9009fxklo3sel632v","_id":"cl3k7f4qc00afxklobxbkbaj2"},{"post_id":"cl3k7f4qb009vxklo36fa873b","tag_id":"cl3k7f4qc00a2xklo69v3axcy","_id":"cl3k7f4qc00agxklobxbt2t7r"}],"Tag":[{"name":"mysql","_id":"cl3k7f4oq0005xklo1erk8475"},{"name":"mongo","_id":"cl3k7f4os000cxklo7qhz870h"},{"name":"","_id":"cl3k7f4ot000hxkloc21ygayn"},{"name":"docker","_id":"cl3k7f4ox000mxklo8h4r12vi"},{"name":"docker install","_id":"cl3k7f4oz000uxkloashfg4xe"},{"name":"docker swarm","_id":"cl3k7f4p4001exklo9h9kh0ys"},{"name":"docker ","_id":"cl3k7f4p6001jxkloemvwgj6l"},{"name":"git","_id":"cl3k7f4p7001pxklo30z5civ9"},{"name":"Dockerfile","_id":"cl3k7f4p90023xklo6t5359lm"},{"name":"ssh","_id":"cl3k7f4pc002ixklof8nxc5up"},{"name":"markdown","_id":"cl3k7f4pd002oxkloazgf8ob4"},{"name":"java","_id":"cl3k7f4pe002wxklocqq51saz"},{"name":"help","_id":"cl3k7f4ph003cxklocf8x8y9b"},{"name":"selenium","_id":"cl3k7f4pk003rxklo62669vun"},{"name":"linux selenium","_id":"cl3k7f4pl003yxklo9elph0jl"},{"name":"docker selenium","_id":"cl3k7f4pm0044xklodyrjcgva"},{"name":"python","_id":"cl3k7f4pn004bxklo5e0i9a3l"},{"name":"opencv","_id":"cl3k7f4po004ixklog0nk9e0j"},{"name":"","_id":"cl3k7f4po004nxklo81xa3qnj"},{"name":"elasticsearch","_id":"cl3k7f4po004rxkloe02k5olg"},{"name":"base","_id":"cl3k7f4pp004yxkloggglgc90"},{"name":"","_id":"cl3k7f4pp0054xkloc0skbj82"},{"name":"","_id":"cl3k7f4pq005bxklo58f9flws"},{"name":"redis","_id":"cl3k7f4pq005fxklo8y6i63q6"},{"name":"cache","_id":"cl3k7f4pr005jxklo1o9n75uc"},{"name":"Map","_id":"cl3k7f4ps005pxklo25slf3ae"},{"name":"list","_id":"cl3k7f4ps005vxklo62bz61ok"},{"name":"","_id":"cl3k7f4pv006axklofkm9djwy"},{"name":"mongodb","_id":"cl3k7f4pw006hxkloc8hghjhz"},{"name":"cas","_id":"cl3k7f4px006sxklo2vtjccwi"},{"name":"","_id":"cl3k7f4py0077xkloc7f83g42"},{"name":"maven","_id":"cl3k7f4q3007pxkloah28440f"},{"name":"springboot","_id":"cl3k7f4q40082xklob20mgca3"},{"name":"path","_id":"cl3k7f4q50086xklo0auu12zp"},{"name":"swagger","_id":"cl3k7f4q50089xklo97jw4fpl"},{"name":"spring","_id":"cl3k7f4q6008jxklof6j4c9ot"},{"name":"spring","_id":"cl3k7f4q6008lxklodfbz2uyo"},{"name":"","_id":"cl3k7f4q80093xklo8jljff8d"},{"name":"spring cloud","_id":"cl3k7f4q80094xklof123dsmq"},{"name":"","_id":"cl3k7f4q80097xklo26mugvms"},{"name":"rabbitmq","_id":"cl3k7f4q80098xklo0m4r1qwh"},{"name":"queue","_id":"cl3k7f4q8009bxkloadf58j67"},{"name":"shiro","_id":"cl3k7f4q9009fxklo3sel632v"},{"name":"kafka","_id":"cl3k7f4q9009gxklobt1h41l1"},{"name":"jwt","_id":"cl3k7f4qb009uxkloeojo9vhu"},{"name":"encryption","_id":"cl3k7f4qc00a2xklo69v3axcy"}]}}