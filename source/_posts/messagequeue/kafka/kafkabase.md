---
title: kafka 基础
date: 2022-05-11 15:08:11
categories:
  - kafka
  - queue
tags:
  - kafka
  - queue
---

## 概述

`Kafka`结合了三个关键功能:

- 发布（写入）和订阅（读取）[事件流](/2022/05/19/messagequeue/kafka/eventstream/)，包括从其他系统持续导入/导出数据 。
- 根据需要持久可靠地 存储事件流。
- 在事件发生时或回顾性 地处理事件流。
所有这些功能都以分布式、高度可扩展、弹性、容错和安全的方式提供。Kafka 可以部署在裸机硬件、虚拟机和容器上，也可以部署在本地和云端。

## 工作原理概述

`Kafka`是一个分布式系统，由通过高性能TCP网络协议进行通信的`服务器`和`客户端`组成。

- 服务器：Kafka 作为一个或多个服务器的集群运行，可以跨越多个数据中心或云区域。其中一些服务器形成存储层，称为代理。其他服务器运行 Kafka Connect以将数据作为事件流持续导入和导出，以将 Kafka 与现有的系统（如关系数据库以及其他 Kafka 集群）集成。Kafka 集群具有高度可扩展性和容错性：如果其中任何一个服务器出现故障，其他服务器将接管它们的工作，以确保持续运行而不会丢失任何数据。

- [客户端](https://cwiki.apache.org/confluence/display/KAFKA/Clients)：支持分布式应用程序和微服务，以并行、大规模和容错方式读取、写入和处理事件流，即使在网络问题或机器故障的情况下也是如此。

## 概念和术语

**事件**： 记录了业务中“发生了某事” 的事实。在文档中也称为记录或消息。从概念上讲，事件具有键、值、时间戳和可选的元数据标头。
  示例：
  事件键：“爱丽丝”
  事件描述：“向 Bob 支付了 200 美元”
  事件时间戳：“2020 年 6 月 25 日下午 2:06”

**生产者**是那些向 Kafka 发布（写入）事件的客户端应用程序，而**消费者**是订阅（读取和处理）这些事件的那些客户端应用程序。在 Kafka 中，生产者和消费者完全解耦并且彼此不可知，生产者永远不需要等待消费者。

**事件**被组织并持久地存储在**主题**中。非常简单，**主题**类似于文件系统中的`文件夹`，**事件**是该文件夹中的`文件`。示例主题名称可以是“付款”。在Kafka一个主题可以有`零个`、`一个`或`多个`向其写入事件的**生产者**，以及`零个`、`一个`或`多个`订阅这些事件的**消费者**。**主题**中的**事件**可以根据需要随时读取——与传统的消息传递系统不同，**事件**在`消费后不会被删除`。相反，可以通过每个主题的配置设置来定义 Kafka 应该保存事件多长时间，过期事件将被丢弃。

**主题**是**分区**的，这意味着一个主题分布在位于不同 Kafka 代理上的多个“桶”中。数据的这种分布式放置对于可伸缩性非常重要，因为它允许客户端应用程序同时从多个代理读取和写入数据。当一个新事件发布到一个主题时，它实际上是`附加`到主题的分区之一。具有相同`事件键`（例如，客户或车辆 ID）的事件被写入`同一个分区`，并且 Kafka保证给定`主题分区`的任何消费者将始终以与写入事件`完全相同的顺序`读取该分区的事件。
![images](/images/kafka-base/streams-and-tables-p1_p4.png)
图：此示例主题有四个分区 P1–P4。两个不同的生产者客户端通过网络将事件写入主题的分区，彼此独立地向主题发布新事件。具有相同键的事件（在图中由它们的颜色表示）被写入同一个分区。**如果合适的话，两个生产者都可以写入同一个分区。**

为了使数据具有容错性和高可用性，可以复制每个主题，甚至跨地理区域或数据中心，以便始终有多个代理拥有数据副本，以防万一出现问题，等等。一个常见的生产设置是复制因子为 3，即始终存在三个数据副本。此复制在主题分区级别执行。

[官网](https://kafka.apache.org/)
